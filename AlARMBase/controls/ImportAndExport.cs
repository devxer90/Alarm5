
using System;
using System.Collections.Generic;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Xml;
using ALARm.Core;
using ALARm.Services;
using Microsoft.VisualBasic.FileIO;

namespace ALARm
{
    public static class ImportAndExport
    {
        internal static bool Export(MetroFramework.Controls.MetroProgressBar progressBar, long admRoadId, DateTime date)
        {
            string roadName = "";
            if (admRoadId != -1)
                roadName = ExportImportService.ExportQueryReturnString($@"select name from adm_road where id = {admRoadId}");
            else
                roadName = "all";
            string dirName = System.IO.Directory.GetCurrentDirectory() + "\\export_ALARm\\" + Transliter.cyrToLat(roadName) + "_" + date.ToString("dd_MM_yyyy");
            DirectoryInfo dirInfo = new DirectoryInfo(dirName);

            if (!dirInfo.Exists)
                dirInfo.Create();

            progressBar.Value = 0;
            progressBar.Step = 100 / 50;
            bool result = true;
            if (admRoadId != -1)
            {
                // ADM_STRUCTURE
                result &= ExportImportService.Execute($@"COPY (SELECT * FROM ADM_ROAD where id = {admRoadId}) TO '{dirName + "\\adm_road.csv"}' with CSV delimiter ',' header;");

                result &= ExportImportService.Execute($@"COPY (SELECT * FROM adm_nod where adm_road_id = {admRoadId}) TO '{dirName + "\\adm_nod.csv"}' with CSV delimiter ',' header;");
                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT distance.* FROM adm_distance distance
                    inner join adm_nod nod on nod.id = distance.adm_nod_id
                    where nod.adm_road_id = {admRoadId}) TO '{dirName + "\\adm_distance.csv"}' with CSV delimiter ',' header;");
                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT pchu.* FROM adm_pchu pchu
                    inner join adm_distance distance on distance.id = pchu.adm_distance_id
                    inner join adm_nod nod on nod.id = distance.adm_nod_id
                    where nod.adm_road_id = {admRoadId}) TO '{dirName + "\\adm_pchu.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT pd.* FROM adm_pd pd
                    inner join adm_pchu pchu on pchu.id = pd.adm_pchu_id
                    inner join adm_distance distance on distance.id = pchu.adm_distance_id
                    inner join adm_nod nod on nod.id = distance.adm_nod_id
                    where nod.adm_road_id = {admRoadId}) TO '{dirName + "\\adm_pd.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT pdb.* FROM adm_pdb pdb
                    inner join adm_pd pd on pd.id = pdb.adm_pd_id
                    inner join adm_pchu pchu on pchu.id = pd.adm_pchu_id
                    inner join adm_distance distance on distance.id = pchu.adm_distance_id
                    inner join adm_nod nod on nod.id = distance.adm_nod_id
                    where nod.adm_road_id = {admRoadId}) TO '{dirName + "\\adm_pdb.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT rd.* from road_direction rd
                    where rd.road_id = {admRoadId}) TO '{dirName + "\\road_direction.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT direction.* from adm_direction direction
                    inner join road_direction rd on rd.direction_id = direction.id
                    where rd.road_id = {admRoadId}) TO '{dirName + "\\adm_direction.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT track.* from adm_track track
                    where track.adm_direction_id in (select direction.id from adm_direction direction
                        inner join road_direction rd on rd.road_id = {admRoadId} and rd.direction_id = direction.id)
                    or track.id in (select strack.adm_track_id from stw_track strack
                        inner join adm_nod nod on nod.adm_road_id = {admRoadId}
                        inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
                    or track.id in (select strack.adm_track_id from stw_park_track strack
                        inner join adm_nod nod on nod.adm_road_id = {admRoadId}
                        inner join adm_station station on station.adm_nod_id = nod.id 
                        inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id)
                    ) TO '{dirName + "\\adm_track.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT station.* FROM adm_station station
                    inner join adm_nod nod on nod.id = station.adm_nod_id
                    where nod.adm_road_id = {admRoadId}) TO '{dirName + "\\adm_station.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT park.* FROM stw_park park
                    inner join adm_station station on station.id = park.adm_station_id
                    inner join adm_nod nod on nod.id = station.adm_nod_id
                    where nod.adm_road_id = {admRoadId}) TO '{dirName + "\\stw_park.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT sobject.* from stw_object sobject
                    inner join stw_park park on park.id = sobject.stw_park_id
                    inner join adm_station station on station.id = park.adm_station_id
                    inner join adm_nod nod on nod.id = station.adm_nod_id
                    where nod.adm_road_id = {admRoadId}) TO '{dirName + "\\stw_object.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT strack.* FROM stw_track strack
                    inner join adm_station station on station.id = strack.adm_station_id
                    inner join adm_nod nod on nod.id = station.adm_nod_id
                    where nod.adm_road_id = {admRoadId}) TO '{dirName + "\\stw_track.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT strack.* FROM stw_park_track strack
                    inner join stw_park park on park.id = strack.stw_park_id
                    inner join adm_station station on station.id = park.adm_station_id
                    inner join adm_nod nod on nod.id = station.adm_nod_id
                    where nod.adm_road_id = {admRoadId}) TO '{dirName + "\\stw_park_track.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                //PERIOD
                result &= ExportImportService.Execute($@"COPY (SELECT tpl_period.* from tpl_period
                    where (tpl_period.adm_track_id in (select track.id from adm_track track
                        inner join road_direction rd on rd.road_id = {admRoadId} and rd.direction_id = track.adm_direction_id)
                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_track strack
                        inner join adm_nod nod on nod.adm_road_id = {admRoadId}
                        inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_park_track strack
                        inner join adm_nod nod on nod.adm_road_id = {admRoadId}
                        inner join adm_station station on station.adm_nod_id = nod.id 
                        inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id))
                    and ('{date.ToString("dd-MM-yyyy")}' between tpl_period.start_date and tpl_period.final_date)
                    ) TO '{dirName + "\\tpl_period.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                //MTO STRUCTURE
                List<string> mtoStructure = new List<string> { "apr_artificial_construction", "apr_ballast", "apr_cham_joint", "apr_communication", "apr_coordinate_gnss", "apr_crosstie", "apr_curve", "apr_defects_earth", "apr_dimension",
                    "apr_elevation", "apr_long_rails", "apr_norma_width", "apr_profmarks", "apr_rails_braces", "apr_rails_sections", "apr_ref_point", "apr_rfid", "apr_speed", "apr_straightening_thread", "apr_tempspeed", "apr_trackclass",
                    "apr_traffic", "apr_waycat", "tpl_check_sections", "tpl_deep", "tpl_dist_section", "tpl_distance_between_tracks", "tpl_non_ext_km", "tpl_nst_km", "tpl_pdb_section", "tpl_profile_object", "tpl_station_section", "tpl_switch"
                };

                foreach (var nameOfStructure in mtoStructure)
                {
                    result &= ExportImportService.Execute($@"COPY (select struct.* from {nameOfStructure} struct
                        inner join tpl_period tpl_period on tpl_period.id = struct.period_id
                        where (tpl_period.adm_track_id in (select track.id from adm_track track
                            inner join road_direction rd on rd.road_id = {admRoadId} and rd.direction_id = track.adm_direction_id)
                        or tpl_period.adm_track_id in (select strack.adm_track_id from stw_track strack
                            inner join adm_nod nod on nod.adm_road_id = {admRoadId}
                            inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
                        or tpl_period.adm_track_id in (select strack.adm_track_id from stw_park_track strack
                            inner join adm_nod nod on nod.adm_road_id = {admRoadId}
                            inner join adm_station station on station.adm_nod_id = nod.id 
                            inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id))
                        and ('{date.ToString("dd-MM-yyyy")}' between tpl_period.start_date and tpl_period.final_date)
                        ) TO '{$@"{dirName}\\{nameOfStructure}.csv"}' with CSV delimiter ',' header;");

                    progressBar.PerformStep();
                }

                result &= ExportImportService.Execute($@"COPY (select elcurve.* from apr_elcurve elcurve
                    inner join apr_curve curve on curve.id = elcurve.curve_id
                    inner join tpl_period tpl_period on tpl_period.id = curve.period_id
                    where (tpl_period.adm_track_id in (select track.id from adm_track track
                        inner join road_direction rd on rd.road_id = {admRoadId} and rd.direction_id = track.adm_direction_id)
                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_track strack
                        inner join adm_nod nod on nod.adm_road_id = {admRoadId}
                        inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_park_track strack
                        inner join adm_nod nod on nod.adm_road_id = {admRoadId}
                        inner join adm_station station on station.adm_nod_id = nod.id 
                        inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id))
                    and ('{date.ToString("dd-MM-yyyy")}' between tpl_period.start_date and tpl_period.final_date)
                    ) TO '{$@"{dirName}\\apr_elcurve.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (select stcurve.* from apr_stcurve stcurve
                    inner join apr_curve curve on curve.id = stcurve.curve_id
                    inner join tpl_period tpl_period on tpl_period.id = curve.period_id
                    where (tpl_period.adm_track_id in (select track.id from adm_track track
                        inner join road_direction rd on rd.road_id = {admRoadId} and rd.direction_id = track.adm_direction_id)
                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_track strack
                        inner join adm_nod nod on nod.adm_road_id = {admRoadId}
                        inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_park_track strack
                        inner join adm_nod nod on nod.adm_road_id = {admRoadId}
                        inner join adm_station station on station.adm_nod_id = nod.id 
                        inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id))
                    and ('{date.ToString("dd-MM-yyyy")}' between tpl_period.start_date and tpl_period.final_date)
                    ) TO '{$@"{dirName}\\apr_stcurve.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (select repair.* from repair_project repair 
                        where repair.adm_track_id in (select track.id from adm_track track
                            inner join road_direction rd on rd.road_id = {admRoadId} and rd.direction_id = track.adm_direction_id)
                        or repair.adm_track_id in (select strack.adm_track_id from stw_track strack
                            inner join adm_nod nod on nod.adm_road_id = {admRoadId}
                            inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
                        or repair.adm_track_id in (select strack.adm_track_id from stw_park_track strack
                            inner join adm_nod nod on nod.adm_road_id = {admRoadId}
                            inner join adm_station station on station.adm_nod_id = nod.id 
                            inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id)
                        ) TO '{$@"{dirName}\\repair_project.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();
            }
            else
            {
                // ADM_STRUCTURE
                result &= ExportImportService.Execute($@"COPY (SELECT * FROM ADM_ROAD) TO '{dirName + "\\adm_road.csv"}' with CSV delimiter ',' header;");


                result &= ExportImportService.Execute($@"COPY (SELECT * FROM adm_nod where adm_road_id in (select id from adm_road)) TO '{dirName + "\\adm_nod.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT distance.* FROM adm_distance distance
                    inner join adm_nod nod on nod.id = distance.adm_nod_id
                    where nod.adm_road_id in (select id from adm_road)) TO '{dirName + "\\adm_distance.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT pchu.* FROM adm_pchu pchu
                    inner join adm_distance distance on distance.id = pchu.adm_distance_id
                    inner join adm_nod nod on nod.id = distance.adm_nod_id
                    where nod.adm_road_id in (select id from adm_road)) TO '{dirName + "\\adm_pchu.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT pd.* FROM adm_pd pd
                    inner join adm_pchu pchu on pchu.id = pd.adm_pchu_id
                    inner join adm_distance distance on distance.id = pchu.adm_distance_id
                    inner join adm_nod nod on nod.id = distance.adm_nod_id
                    where nod.adm_road_id in (select id from adm_road)) TO '{dirName + "\\adm_pd.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT pdb.* FROM adm_pdb pdb
                    inner join adm_pd pd on pd.id = pdb.adm_pd_id
                    inner join adm_pchu pchu on pchu.id = pd.adm_pchu_id
                    inner join adm_distance distance on distance.id = pchu.adm_distance_id
                    inner join adm_nod nod on nod.id = distance.adm_nod_id
                    where nod.adm_road_id in (select id from adm_road)) TO '{dirName + "\\adm_pdb.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT rd.* from road_direction rd
                    where rd.road_id in (select id from adm_road)) TO '{dirName + "\\road_direction.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT direction.* from adm_direction direction
                    inner join road_direction rd on rd.direction_id = direction.id
                    where rd.road_id in (select id from adm_road)) TO '{dirName + "\\adm_direction.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT track.* from adm_track track
                    where track.adm_direction_id in (select direction.id from adm_direction direction
                        inner join road_direction rd on rd.road_id in (select id from adm_road) and rd.direction_id = direction.id)
                    or track.id in (select strack.adm_track_id from stw_track strack
                        inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
                        inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
                    or track.id in (select strack.adm_track_id from stw_park_track strack
                        inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
                        inner join adm_station station on station.adm_nod_id = nod.id 
                        inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id)
                    ) TO '{dirName + "\\adm_track.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT station.* FROM adm_station station
                    inner join adm_nod nod on nod.id = station.adm_nod_id
                    where nod.adm_road_id in (select id from adm_road)) TO '{dirName + "\\adm_station.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT park.* FROM stw_park park
                    inner join adm_station station on station.id = park.adm_station_id
                    inner join adm_nod nod on nod.id = station.adm_nod_id
                    where nod.adm_road_id in (select id from adm_road)) TO '{dirName + "\\stw_park.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT sobject.* from stw_object sobject
                    inner join stw_park park on park.id = sobject.stw_park_id
                    inner join adm_station station on station.id = park.adm_station_id
                    inner join adm_nod nod on nod.id = station.adm_nod_id
                    where nod.adm_road_id in (select id from adm_road)) TO '{dirName + "\\stw_object.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT strack.* FROM stw_track strack
                    inner join adm_station station on station.id = strack.adm_station_id
                    inner join adm_nod nod on nod.id = station.adm_nod_id
                    where nod.adm_road_id in (select id from adm_road)) TO '{dirName + "\\stw_track.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (SELECT strack.* FROM stw_park_track strack
                    inner join stw_park park on park.id = strack.stw_park_id
                    inner join adm_station station on station.id = park.adm_station_id
                    inner join adm_nod nod on nod.id = station.adm_nod_id
                    where nod.adm_road_id in (select id from adm_road)) TO '{dirName + "\\stw_park_track.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                //PERIOD
                result &= ExportImportService.Execute($@"COPY (SELECT tpl_period.* from tpl_period
                    where (tpl_period.adm_track_id in (select track.id from adm_track track
                        inner join road_direction rd on rd.road_id in (select id from adm_road) and rd.direction_id = track.adm_direction_id)
                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_track strack
                        inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
                        inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_park_track strack
                        inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
                        inner join adm_station station on station.adm_nod_id = nod.id 
                        inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id))
                    and ('{date.ToString("dd-MM-yyyy")}' between tpl_period.start_date and tpl_period.final_date)
                    ) TO '{dirName + "\\tpl_period.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                //MTO STRUCTURE
                List<string> mtoStructure = new List<string> { "apr_artificial_construction", "apr_ballast", "apr_cham_joint", "apr_communication", "apr_coordinate_gnss", "apr_crosstie", "apr_curve", "apr_defects_earth", "apr_dimension",
                    "apr_elevation", "apr_long_rails", "apr_norma_width", "apr_profmarks", "apr_rails_braces", "apr_rails_sections", "apr_ref_point", "apr_rfid", "apr_speed", "apr_straightening_thread", "apr_tempspeed", "apr_trackclass",
                    "apr_traffic", "apr_waycat", "tpl_check_sections", "tpl_deep", "tpl_dist_section", "tpl_distance_between_tracks", "tpl_non_ext_km", "tpl_nst_km", "tpl_pdb_section", "tpl_profile_object", "tpl_station_section", "tpl_switch"
                };

                foreach (var nameOfStructure in mtoStructure)
                {
                    result &= ExportImportService.Execute($@"COPY (select struct.* from {nameOfStructure} struct
                        inner join tpl_period tpl_period on tpl_period.id = struct.period_id
                        where (tpl_period.adm_track_id in (select track.id from adm_track track
                            inner join road_direction rd on rd.road_id in (select id from adm_road) and rd.direction_id = track.adm_direction_id)
                        or tpl_period.adm_track_id in (select strack.adm_track_id from stw_track strack
                            inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
                            inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
                        or tpl_period.adm_track_id in (select strack.adm_track_id from stw_park_track strack
                            inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
                            inner join adm_station station on station.adm_nod_id = nod.id 
                            inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id))
                        and ('{date.ToString("dd-MM-yyyy")}' between tpl_period.start_date and tpl_period.final_date)
                        ) TO '{$@"{dirName}\\{nameOfStructure}.csv"}' with CSV delimiter ',' header;");

                    progressBar.PerformStep();
                }

                result &= ExportImportService.Execute($@"COPY (select elcurve.* from apr_elcurve elcurve
                    inner join apr_curve curve on curve.id = elcurve.curve_id
                    inner join tpl_period tpl_period on tpl_period.id = curve.period_id
                    where (tpl_period.adm_track_id in (select track.id from adm_track track
                        inner join road_direction rd on rd.road_id in (select id from adm_road) and rd.direction_id = track.adm_direction_id)
                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_track strack
                        inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
                        inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_park_track strack
                        inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
                        inner join adm_station station on station.adm_nod_id = nod.id 
                        inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id))
                    and ('{date.ToString("dd-MM-yyyy")}' between tpl_period.start_date and tpl_period.final_date)
                    ) TO '{$@"{dirName}\\apr_elcurve.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (select stcurve.* from apr_stcurve stcurve
                    inner join apr_curve curve on curve.id = stcurve.curve_id
                    inner join tpl_period tpl_period on tpl_period.id = curve.period_id
                    where (tpl_period.adm_track_id in (select track.id from adm_track track
                        inner join road_direction rd on rd.road_id in (select id from adm_road) and rd.direction_id = track.adm_direction_id)
                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_track strack
                        inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
                        inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_park_track strack
                        inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
                        inner join adm_station station on station.adm_nod_id = nod.id 
                        inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id))
                    and ('{date.ToString("dd-MM-yyyy")}' between tpl_period.start_date and tpl_period.final_date)
                    ) TO '{$@"{dirName}\\apr_stcurve.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();

                result &= ExportImportService.Execute($@"COPY (select repair.* from repair_project repair 
                        where repair.adm_track_id in (select track.id from adm_track track
                            inner join road_direction rd on rd.road_id in (select id from adm_road) and rd.direction_id = track.adm_direction_id)
                        or repair.adm_track_id in (select strack.adm_track_id from stw_track strack
                            inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
                            inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
                        or repair.adm_track_id in (select strack.adm_track_id from stw_park_track strack
                            inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
                            inner join adm_station station on station.adm_nod_id = nod.id 
                            inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id)
                        ) TO '{$@"{dirName}\\repair_project.csv"}' with CSV delimiter ',' header;");

                progressBar.PerformStep();
            }

            return result;
        }

        internal static bool Import(FileInfo[] fileInfo, MetroFramework.Controls.MetroProgressBar progressBar, int import_type, long road_id, long nod_id, Period period)
        {

            //for (int i = 19; i < 346; i++)
            //{
            //    var droptable = RdStructureService.DropTable(i);
            //}




            Console.WriteLine("Tables dropped successfully.");
            string dirName = System.IO.Directory.GetCurrentDirectory() + "\\logs";
            DirectoryInfo dirInfo = new DirectoryInfo(dirName);

            if (!dirInfo.Exists)
                dirInfo.Create();

            string logFile = System.IO.Directory.GetCurrentDirectory() + "\\logs\\import_log.txt";

            using (StreamWriter outputFile = new StreamWriter(logFile, false))
            {
                outputFile.WriteLine(DateTime.Now);
                outputFile.WriteLine(fileInfo.First().DirectoryName);
                outputFile.WriteLine();
            }

            List<ImportListDirTrackID> listIDs = new List<ImportListDirTrackID>();
            List<ImportListDirTrackID> Ekasui_listIDS = new List<ImportListDirTrackID>();

            List<ImportListStationID> listStationIDs = new List<ImportListStationID>();
            List<ImportListCurveID> listCurveIDs = new List<ImportListCurveID>();
            List<ImportListCurveID> newListCurveId = new List<ImportListCurveID>();

            List<ImportListCurveID> listPAPAIDS = new List<ImportListCurveID>();
            List<ImportListCurveID> listLevelIDS = new List<ImportListCurveID>();

            bool curveAdd = false;
            ImportListCurveID listCurveID = new ImportListCurveID();
            ImportListCurveID listCurveID_old = new ImportListCurveID();
            ImportListCurveID listCurveID_new = new ImportListCurveID();
            List<ImportListElCurve> listElCurves = new List<ImportListElCurve>();
            List<ImportListStCurve> listStCurves = new List<ImportListStCurve>();
            List<ImportListPDBID> listPDBIDs = new List<ImportListPDBID>();

            List<ImportListStationSection> listStationSections = new List<ImportListStationSection>();

            ImportListEkasui list_Ekasui_Curve = new ImportListEkasui();
            List<ImportListEkasui> list_Ekasui_Curves = new List<ImportListEkasui>();




            var select_tpl_peiod = ExportImportService.ExportListPeriod("select * from TPL_PERIOD ");
            if (select_tpl_peiod.Count() > 0)
            {
                var start_date = select_tpl_peiod.Last().Start_date;
                var final_date = select_tpl_peiod.Last().Final_date;
                var new_finaldate = period.Start_Date;
                DateTime new_date = final_date.AddDays(-1);

                var nestart_Date = ExportImportService.Execute($@"UPDATE tpl_period SET start_date = '{start_date}', final_date = '{new_date}' WHERE start_date = '{start_date}' and final_date ='{final_date}'");
            }






            progressBar.Value = 0;
            progressBar.Step = 100 / 20;

            if (fileInfo.Where(tmp => tmp.Name == "WAY.xml").Count() > 0)
            {
                progressBar.PerformStep();
                List<ImportListDirTrackID> listdirid = new List<ImportListDirTrackID>();
                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "WAY.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;

                    listCurveID_new = new ImportListCurveID();
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "way")
                        {
                            if (count > 0)
                                continue;
                            var contains = ExportImportService.ExportList("select * from ekasui_way");
                            if (contains.Count() > 0)
                            {
                                contains = ExportImportService.ExportList("DELETE FROM ekasui_way");
                            }
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {
                                var ASSETNUM = z_row.Attributes["ASSETNUM"].Value;

                                var upnom = z_row.Attributes["UP_NOM"].Value;
                                var location = z_row.Attributes["LOCATION"].Value;
                                var put_nom = z_row.Attributes["NOM"].Value;

                                ExportImportService.Execute("insert into ekasui_way (assetnum, put_nom, up_nom, location) values ('" + ASSETNUM + "','" + put_nom + "','" + upnom + "','" + location + "')");
                                count = count + 1;
                            }
                        }
                    }
                }
                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "CURVES.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;

                    listCurveID_new = new ImportListCurveID();
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "curves")
                        {
                            if (count > 0)
                                continue;

                            var contains = ExportImportService.ExportList("select * from ekasui_curves");
                            if (contains.Count() > 0)
                            {
                                contains = ExportImportService.ExportList("DELETE FROM ekasui_curves");
                            }
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {


                                var ASSETNUM = z_row.Attributes["ASSETNUM"].Value;
                                var CURVEID = z_row.Attributes["CURVEID"].Value;
                                var KMN_start_km = z_row.Attributes["KMN"].Value;
                                var MN_start_m = z_row.Attributes["MN"].Value;
                                var KMK_final_km = z_row.Attributes["KMK"].Value;
                                var MK_final_m = z_row.Attributes["MK"].Value;
                                var L = z_row.Attributes["L"].Value;
                                var R = z_row.Attributes["R"].Value;
                                var NAPR = z_row.Attributes["NAPR"].Value;
                                var siteid = z_row.Attributes["SITEID"].Value;

                                ExportImportService.Execute("insert into ekasui_curves (assetnum, kmn,mn,kmk,mk,l,r,napr,curveid,siteid) values ('" + ASSETNUM + "','" + KMN_start_km + "','" + MN_start_m + "','" +
                                    KMK_final_km + "','" + MK_final_m + "','" + L + "','" + R + "','" + NAPR + "','" + CURVEID + "','" + siteid + "')");
                                count = count + 1;
                            }

                        }
                    }
                }

                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "STANKM.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    var fl_st = false;
                    var fl_ur = false;
                    listCurveID_new = new ImportListCurveID();
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "stankm")
                        {
                            if (count > 0)
                                continue;
                            var contains = ExportImportService.ExportList("select * from ekasui_stankm");
                            if (contains.Count() > 0)
                            {
                                contains = ExportImportService.ExportList("DELETE FROM ekasui_stankm");
                            }
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {
                                var upnom = z_row.Attributes["UP_NOM"].Value;
                                var km = z_row.Attributes["KM"].Value;
                                var m = z_row.Attributes["M"].Value;
                                var siteid = z_row.Attributes["SITEID"].Value;
                                var stankmid = z_row.Attributes["STANKMID"].Value;

                                var rowstamp = z_row.Attributes["ROWSTAMP"].Value;
                                var code = z_row.Attributes["CODE"].Value;

                                ExportImportService.Execute("insert into ekasui_stankm (code, km, m, siteid, stankmid, up_nom, rowstamp) values (" + code + "," + km + "," + m + "," + siteid + "," + stankmid + "," + upnom + "," + rowstamp + ")");
                                count = count + 1;
                                if (upnom == "13808")
                                {

                                }

                            }
                        }
                    }
                }

                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "PLANPOINTS.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    var fl_st = false;
                    var fl_ur = false;
                    listCurveID_new = new ImportListCurveID();
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "planpoints")
                        {
                            if (count > 0)
                                continue;
                            var contains = ExportImportService.ExportList("select * from ekasui_planpoints_rightlevel");
                            if (contains.Count() > 0)
                            {
                                contains = ExportImportService.ExportList("DELETE FROM ekasui_planpoints_rightlevel");
                            }
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {

                                var up_nom = z_row.Attributes["UP_NOM"].Value;

                                if (up_nom == "13808")
                                {

                                }
                                var D_IZN = z_row.Attributes["D_IZN"].Value;
                                var IZN = z_row.Attributes["IZN"].Value;
                                var KM = z_row.Attributes["KM"].Value;
                                var M = z_row.Attributes["M"].Value;
                                var PLANPOINTSID = z_row.Attributes["PLANPOINTSID"].Value;
                                var PUT_NOM = z_row.Attributes["PUT_NOM"].Value;
                                var RIHT = z_row.Attributes["RIHT"].Value;
                                var SHAB = z_row.Attributes["SHAB"].Value;
                                var SITEID = z_row.Attributes["SITEID"].Value;
                                var TYPE = z_row.Attributes["TYPE"].Value;
                                var UROV = z_row.Attributes["UROV"].Value;
                                if (UROV.Contains('.'))
                                {
                                    UROV = UROV.Split('.').First();
                                }
                                var ASSETNUM = z_row.Attributes["ASSETNUM"].Value;
                                ExportImportService.Execute("insert into ekasui_planpoints_rightlevel(d_izn,izn,km, m,planid,put_nom,radius,shab,siteid,type,up_nom,urov,assetnum)" +
                               " values ('" + D_IZN + "','" + IZN + "','" + KM + "'," + M + "," + PLANPOINTSID + ",'" + PUT_NOM + "','" + RIHT
                               + "','" + SHAB + "'," + SITEID + "," + TYPE + "," + up_nom + ",'" + UROV + "','" + ASSETNUM + "')");
                                count = count + 1;
                            }
                        }
                    }
                }
                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "PLAN.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    var fl_st = false;
                    var fl_ur = false;
                    listCurveID_new = new ImportListCurveID();
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "plan")
                        {
                            if (count > 0)
                                continue;
                            var contains = ExportImportService.ExportList("select * from ekasui_plan_rightlevel");
                            if (contains.Count() > 0)
                            {
                                contains = ExportImportService.ExportList("DELETE FROM ekasui_plan_rightlevel");
                            }
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {

                                var up_nom = z_row.Attributes["UP_NOM"].Value;

                                if (up_nom == "13808")
                                {


                                }
                                var D_IZN = z_row.Attributes["D_IZN"].Value;
                                var IZN = z_row.Attributes["IZN"].Value;
                                var KM = z_row.Attributes["KM"].Value;
                                var M = z_row.Attributes["M"].Value;
                                var PLANPOINTSID = z_row.Attributes["PLANID"].Value;
                                var PUT_NOM = z_row.Attributes["PUT_NOM"].Value;
                                var RIHT = z_row.Attributes["RIHT"].Value;
                                var SHAB = z_row.Attributes["SHAB"].Value;
                                var SITEID = z_row.Attributes["SITEID"].Value;
                                var TYPE = z_row.Attributes["TYPE"].Value;
                                var UROV = z_row.Attributes["UROV"].Value;
                                if (UROV.Contains('.'))
                                {
                                    UROV = UROV.Split('.').First();
                                }
                                var ASSETNUM = z_row.Attributes["ASSETNUM"].Value;




                                ExportImportService.Execute("insert into ekasui_plan_rightlevel(d_izn,izn,km, m,planid,put_nom,radius,shab,siteid,type,up_nom,urov,assetnum)" +
                                    " values ('" + D_IZN + "','" + IZN + "','" + KM + "'," + M + "," + PLANPOINTSID + ",'" + PUT_NOM + "','" + RIHT
                                    + "','" + SHAB + "'," + SITEID + "," + TYPE + "," + up_nom + ",'" + UROV + "','" + ASSETNUM + "')");
                                count = count + 1;

                            }
                        }
                    }
                }


                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "STR.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    var fl_st = false;
                    var fl_ur = false;
                    listCurveID_new = new ImportListCurveID();
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "str")
                        {
                            if (count > 0)
                                continue;
                            var contains = ExportImportService.ExportList("select * from ekasui_str");
                            if (contains.Count() > 0)
                            {
                                contains = ExportImportService.ExportList("DELETE FROM ekasui_str");
                            }
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {

                                var up_nom = z_row.Attributes["UP_NOM"].Value;
                                var ST_KOD = z_row.Attributes["ST_KOD"].Value;
                                var KM = z_row.Attributes["KM"].Value;
                                var M = z_row.Attributes["M"].Value;
                                var TYPE = z_row.Attributes["TYPE"].Value;
                                var NOM = z_row.Attributes["NOM"].Value;
                                var OTB = z_row.Attributes["OTB"].Value;
                                var POSH = z_row.Attributes["POSH"].Value;
                                var PUT_NOM = z_row.Attributes["PUT_NOM"].Value;

                                if (NOM.Contains("#"))
                                {
                                    string[] substrings = NOM.Split('#');
                                    NOM = substrings[1];

                                    // Do something with the substrings array
                                }
                                ExportImportService.Execute("insert into ekasui_str(up_nom, st_kod,put_nom,km, m,type,nom,otb,posh) values ('" + up_nom + "'," + ST_KOD + ",'" + PUT_NOM + "'," + KM + "," + M + "," + TYPE + ",'" + NOM + "'," + OTB + "," + POSH + ")");
                                count = count + 1;
                            }
                        }
                    }
                }
                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "KMPOINTS.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    var fl_st = false;
                    var fl_ur = false;
                    listCurveID_new = new ImportListCurveID();
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "kmpoints")
                        {
                            if (count > 0)
                                continue;
                            var contains = ExportImportService.ExportList("select * from ekasui_kmpoints");
                            if (contains.Count() > 0)
                            {
                                contains = ExportImportService.ExportList("DELETE FROM ekasui_kmpoints");
                            }
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {
                                var km = z_row.Attributes["KM"].Value;
                                var PUT_NOM = z_row.Attributes["PUT_NOM"].Value;
                                var UP_NOM = z_row.Attributes["UP_NOM"].Value;
                                ExportImportService.Execute("insert into ekasui_kmpoints (km, put_nom,up_nom) values (" + km + ",'" + PUT_NOM + "'," + UP_NOM + ")");
                                count = count + 1;
                            }
                        }
                    }
                }

                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "PODRGR.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    var fl_st = false;
                    var fl_ur = false;
                    listCurveID_new = new ImportListCurveID();
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "podrgr")
                        {
                            if (count > 0)
                                continue;
                            var contains = ExportImportService.ExportListPodgr("select * from ekasui_podgr");
                            if (contains.Count() > 0)
                            {
                                contains = ExportImportService.ExportListPodgr("DELETE FROM ekasui_podgr");
                            }
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {
                                var skm = z_row.Attributes["BEGIN_KM"].Value;
                                var sm = z_row.Attributes["BEGIN_M"].Value;
                                var fkm = z_row.Attributes["END_KM"].Value;
                                var fm = z_row.Attributes["END_M"].Value;

                                var NUM = z_row.Attributes["NUM"].Value;
                                var PUT_NOM = z_row.Attributes["PUT_NOM"].Value;
                                var TYPE = z_row.Attributes["TYPE"].Value;
                                var UP_NOM = z_row.Attributes["UP_NOM"].Value;


                                ExportImportService.Execute("insert into ekasui_podgr (kmn, mn, kmk, mk, num, put_nom,type,up_nom) values (" + skm + "," + sm + "," + fkm + "," + fm + "," + NUM + ",'" + PUT_NOM + "','" + TYPE + "'," + UP_NOM + ")");
                                count = count + 1;
                            }
                        }
                    }
                }


                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "STR.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    var fl_st = false;
                    var fl_ur = false;
                    listCurveID_new = new ImportListCurveID();
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "str")
                        {
                            if (count > 0)
                                continue;
                            var contains = ExportImportService.ExportList("select * from ekasui_str");
                            if (contains.Count() > 0)
                            {
                                contains = ExportImportService.ExportList("DELETE FROM ekasui_str");
                            }
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {

                                var up_nom = z_row.Attributes["UP_NOM"].Value;
                                var ST_KOD = z_row.Attributes["ST_KOD"].Value;
                                var KM = z_row.Attributes["KM"].Value;
                                var M = z_row.Attributes["M"].Value;
                                var TYPE = z_row.Attributes["TYPE"].Value;
                                var NOM = z_row.Attributes["NOM"].Value;
                                var OTB = z_row.Attributes["OTB"].Value;
                                var POSH = z_row.Attributes["POSH"].Value;
                                var PUT_NOM = z_row.Attributes["PUT_NOM"].Value;

                                if (NOM.Contains("#"))
                                {
                                    string[] substrings = NOM.Split('#');
                                    NOM = substrings[1];

                                    // Do something with the substrings array
                                }
                                ExportImportService.Execute("insert into ekasui_str(up_nom, st_kod,put_nom,km, m,type,nom,otb,posh) values ('" + up_nom + "'," + ST_KOD + ",'" + PUT_NOM + "'," + KM + "," + M + "," + TYPE + ",'" + NOM + "'," + OTB + "," + POSH + ")");
                                count = count + 1;
                            }

                        }
                    }
                }

                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "KM.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    var fl_st = false;
                    var fl_ur = false;
                    listCurveID_new = new ImportListCurveID();
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "km")
                        {
                            if (count > 0)
                                continue;
                            var contains = ExportImportService.ExportList("select * from ekasui_non_ext");
                            if (contains.Count() > 0)
                            {
                                contains = ExportImportService.ExportList("DELETE FROM ekasui_non_ext");
                            }
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {

                                var up_nom = z_row.Attributes["UP_NOM"].Value;
                                var KM = z_row.Attributes["KM"].Value;
                                var PUT_NOM = z_row.Attributes["PUT_NOM"].Value;
                                var startM = z_row.Attributes["BEGIN_M"].Value;
                                var endM = z_row.Attributes["END_M"].Value;


                                ExportImportService.Execute("insert into ekasui_non_ext(up_nom,put_nom,km,start_m,final_m) values ('" + up_nom + "','" + PUT_NOM + "','" + KM + "','" + startM + "','" + endM + "')");
                                count = count + 1;
                            }
                        }
                    }
                }

                ///*done*/
                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "GB.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    var fl_st = false;
                    var fl_ur = false;
                    listCurveID_new = new ImportListCurveID();
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "gb")
                        {
                            if (count > 0)
                                continue;
                            var contains = ExportImportService.ExportList("select * from ekasui_gb");
                            if (contains.Count() > 0)
                            {
                                contains = ExportImportService.ExportList("DELETE FROM ekasui_gb");
                            }
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {

                                string crosstieID;
                                if (z_row.Attributes["TYPE"].Value == "0")
                                    crosstieID = "2";
                                else if (z_row.Attributes["TYPE"].Value == "1")
                                    crosstieID = "1";
                                else crosstieID = "-1";
                                var start_km = int.Parse(z_row.Attributes["BEGIN_KM"].Value);
                                var start_m = int.Parse(z_row.Attributes["BEGIN_M"].Value);
                                var end_km = int.Parse(z_row.Attributes["END_KM"].Value);
                                var end_m = int.Parse(z_row.Attributes["END_M"].Value);
                                var up_nom = z_row.Attributes["UP_NOM"].Value;
                                var put_nom = z_row.Attributes["PUT_NOM"].Value;


                                ExportImportService.Execute("insert into ekasui_gb(start_km,start_m,final_km,final_m,type,up_nom,put_nom) values ('" + start_km + "','" + start_m + "','" + end_km + "','" + end_m + "','" + crosstieID + "','" + up_nom + "','" + put_nom + "')");
                                count = count + 1;
                            }
                        }
                    }
                }

                ///*done*/
                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "UP.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {

                        if (xmlNode.Name == "up")
                        {
                            if (count > 0)
                                continue;

                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {
                                string name = z_row.Attributes["NAME"].Value;
                                string code = z_row.Attributes["UP_NOM"].Value;
                                string stantiontype = z_row.Attributes["TYPE"].Value;
                                int typeid = 0;
                                //if (code == "13808")
                                //{
                                //    if (code == "13868")
                                //{

                                if (stantiontype == "Станция")
                                    typeid = 1;
                                if (stantiontype == "Обгонный пункт")
                                    typeid = 2;

                                else if (stantiontype == "Разьезд")
                                    typeid = 3;
                                else if (stantiontype == "Блок-Пост")
                                    typeid = 4;
                                else if (stantiontype == "Граница направления")
                                    typeid = 5;
                                else if (stantiontype == "Парк")
                                    typeid = 6;

                                ImportListStationID listStationID = new ImportListStationID();
                                if (z_row.Attributes["TYPE"].Value == "Направление")
                                {
                                    string directionName = z_row.Attributes["NAME"].Value;
                                    string directionCode = z_row.Attributes["UP_NOM"].Value; //ekasui_ID
                                                                                             //string assetnum = z_row.Attributes["ASSETNUM"].Value;//ASSETNUM

                                    var directionIDS = ExportImportService.ImportQueryReturnLong("SELECT COUNT(*) as record_count FROM ADM_DIRECTION  where code = '" + directionCode + "' and ADM_NOD_ID =" + nod_id + "");

                                    if (directionIDS == 0)
                                    {
                                        Int64 directionID = ExportImportService.ImportQueryReturnLong("insert into ADM_DIRECTION (CODE, NAME,adm_nod_id) values (\'" + directionCode + "\', \'" + directionName + "\'," + nod_id + ") returning ID");
                                    }
                                    else
                                    {
                                        continue;
                                    }

                                }
                                if (z_row.Attributes["TYPE"].Value == "Станция")
                                {
                                    string directionName = z_row.Attributes["NAME"].Value;
                                    string directionCode = z_row.Attributes["UP_NOM"].Value; //ekasui_ID
                                    if (directionCode == "944702")
                                    {

                                    }
                                    var adm_direction_ids = ExportImportService.ImportQueryReturnListString($@"Select up_nom from ekasui_stankm where code = '{directionCode}' ");

                                    if (adm_direction_ids.Count() > 0)
                                    {
                                        foreach (var adm_dir_ids in adm_direction_ids)
                                        {

                                            listStationID.NewStationID = ExportImportService.ImportQueryReturnLong("insert into ADM_STATION (TYPE_ID, CODE, NAME, ADM_NOD_ID, ADM_DIRECTION_ID) values (" + typeid.ToString() + ", " + directionCode + ", \'" + directionName + "\', " + nod_id + " ," + adm_dir_ids + ") returning ID");
                                        }
                                    }

                                }
                                if (z_row.Attributes["TYPE"].Value == "Парк")
                                {
                                    string directionName = z_row.Attributes["NAME"].Value;
                                    string directionCode = z_row.Attributes["UP_NOM"].Value; //ekasui_ID
                                    string numberAsString = directionCode.ToString();
                                    string firstSixDigits = "";
                                    if (numberAsString.Length >= 6)
                                    {
                                        firstSixDigits = numberAsString.Substring(0, 6);
                                        Console.WriteLine("Первые шесть цифр: " + firstSixDigits);
                                    }
                                    else
                                    {
                                        Console.WriteLine("Число имеет менее шести цифр.");
                                    }
                                    if (directionCode == "944702")
                                    {

                                    }
                                    var adm_direction_ids = ExportImportService.ImportQueryReturnListString($@"Select up_nom from ekasui_stankm where code = '{firstSixDigits}' ");
                                    if (adm_direction_ids.Count() > 0)
                                    {
                                        foreach (var adm_dir_ids in adm_direction_ids)
                                        {
                                            listStationID.NewStationID = ExportImportService.ImportQueryReturnLong("insert into ADM_STATION (TYPE_ID, CODE, NAME, ADM_NOD_ID,ADM_DIRECTION_ID) values (" + typeid.ToString() + ", " + directionCode + ", \'" + directionName + "\', " + nod_id + " ," + adm_dir_ids + ") returning ID");

                                        }
                                    }

                                }

                                count = count + 1;
                            }


                            //}


                        }

                    }
                }
                progressBar.PerformStep();
                /*done*/
                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "WAY.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {

                        if (xmlNode.Name == "way")
                        {

                            if (count > 0)
                                continue;
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {
                                var code = (z_row.Attributes["UP_NOM"].Value);
                                //if (code == "13808")
                                //{
                                if (code == "94790802")
                                {

                                }
                                if (z_row.Attributes["NOM"].Value == "10Б" && code == "94790802")
                                {

                                }
                                if (z_row.Attributes["NOM"].Value == "2Б" && code == "94790802")
                                {

                                }

                                if (z_row.Attributes["TYPE"].Value == "Главный")
                                {
                                    string directionCode = int.Parse(z_row.Attributes["UP_NOM"].Value).ToString();
                                    string trackCode = z_row.Attributes["NOM"].Value;
                                    var directionnName = ExportImportService.ExportQueryReturnString("SELECT  NAME  from ADM_DIRECTION where code = '" + directionCode + "' and adm_nod_id=" + nod_id + "");
                                    if (directionnName == null)
                                    {
                                        continue;
                                    }
                                    var directionIDs = ExportImportService.ImportQueryReturnListLong("SELECT  id  from ADM_DIRECTION where code = '" + directionCode + "' and adm_nod_id=" + nod_id + "");
                                    if (directionIDs == null)
                                    {
                                        continue;
                                    }
                                    foreach (var directionID in directionIDs)
                                    {
                                        //var directionCodeID = ExportImportService.ImportQueryReturnListLong("SELECT  code  from ADM_DIRECTION where code = '" + directionCode + "'").First();

                                        if (listIDs.Where(tmp => tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() < 1)//UPID
                                        {
                                            ImportListDirTrackID listID = new ImportListDirTrackID();
                                            listID.OldDirection = int.Parse(z_row.Attributes["UP_NOM"].Value);
                                            Int64 trackID = ExportImportService.ImportQueryReturnLong("insert into ADM_TRACK (CODE, ADM_DIRECTION_ID,UP_NOM,adm_nod_id) values (\'" + trackCode + "\', \'" + directionID.ToString() + "\','" + directionCode + "\', " + nod_id + ") returning ID");
                                            ExportImportService.Execute($@"insert into road_direction (road_id, direction_id) values({road_id}, {directionID})");

                                            listID.NewDirectionID = directionID;
                                            listID.NewTrackID = trackID;
                                            listID.Code = directionCode;
                                            listID.Stationname = directionnName;

                                            listID.OldDirectionID = int.Parse(z_row.Attributes["UP_NOM"].Value);
                                            listID.OldTrackID = (z_row.Attributes["NOM"].Value).ToString();

                                            listIDs.Add(listID);
                                        }
                                        else
                                        {
                                            ImportListDirTrackID listID = new ImportListDirTrackID();
                                            listID.OldDirection = int.Parse(z_row.Attributes["UP_NOM"].Value);
                                            Int64 trackID = ExportImportService.ImportQueryReturnLong("insert into ADM_TRACK (CODE, ADM_DIRECTION_ID,UP_NOM,adm_nod_id) values (\'" + trackCode + "\', \'" + directionID.ToString() + "\','" + directionCode + "\', " + nod_id + ") returning ID");

                                            listID.NewDirectionID = directionID;
                                            listID.NewTrackID = trackID;
                                            listID.Code = directionCode;

                                            listID.Stationname = directionnName;

                                            listID.OldDirectionID = int.Parse(z_row.Attributes["UP_NOM"].Value);
                                            listID.OldTrackID = (z_row.Attributes["NOM"].Value).ToString();
                                            listIDs.Add(listID);
                                        }
                                    }



                                }
                                else
                                {
                                    string up_nom = int.Parse(z_row.Attributes["UP_NOM"].Value).ToString();
                                    string Nom = z_row.Attributes["NOM"].Value;
                                    if (up_nom == "940006")
                                    {

                                    }
                                    ImportListStationID liststations = new ImportListStationID();
                                    var stationName = ExportImportService.ExportQueryReturnString("SELECT  NAME  from ADM_STATION where code = '" + up_nom + "' and adm_nod_id=" + nod_id + "");
                                    if (stationName == null)
                                    {
                                        continue;
                                    }
                                    var stationIDSS = ExportImportService.ImportQueryReturnListLong("SELECT  id  from ADM_STATION where code = '" + up_nom + "' and adm_nod_id=" + nod_id + "");

                                    foreach (var stationIDs in stationIDSS)
                                    {
                                        var adm_direction_id = ExportImportService.ImportQueryReturnListLong("SELECT  adm_direction_id  from ADM_STATION where id = '" + stationIDs + "'");
                                        var adm_direction_id_2 = ExportImportService.ImportQueryReturnListLong("SELECT  id  from adm_direction where code = '" + (int)adm_direction_id.First() + "'");

                                        if (!stationName.Contains("/"))
                                        {

                                            string cat_track_type = z_row.Attributes["TYPE"].Value;
                                            int cat_track_typeid = 0;
                                            if (cat_track_type == "Главный")
                                                cat_track_typeid = 1;
                                            if (cat_track_type == "Приемо-отправочный" || cat_track_type == "Приемо-отп.")
                                                cat_track_typeid = 2;
                                            if (cat_track_type == "Сортировочный")
                                                cat_track_typeid = 3;
                                            if (cat_track_type == "Погрузочно-выгрузочный")
                                                cat_track_typeid = 4;
                                            if (cat_track_type == "Вытяжной")
                                                cat_track_typeid = 5;
                                            if (cat_track_type == "6оединительный")
                                                cat_track_typeid = 6;
                                            if (cat_track_type == "Подъездной")
                                                cat_track_typeid = 7;
                                            if (cat_track_type == "Другой" || cat_track_type == "Прочий")
                                                cat_track_typeid = 8;


                                            string trackCode = z_row.Attributes["NOM"].Value;

                                            if (listStationIDs.Where(tmp => tmp.Station == stationName && up_nom.Contains(tmp.Code.ToString()) && tmp.OldDirection == (int)adm_direction_id.First()).Count() > 0)
                                            {
                                                ImportListDirTrackID listID = new ImportListDirTrackID();
                                                listID.OldDirection = (int)adm_direction_id.First();
                                                Int64 stationID = listStationIDs.Where(tmp => tmp.Station == stationName && up_nom.Contains(tmp.Code.ToString())).First().NewStationID;

                                                Int64 trackID = ExportImportService.ImportQueryReturnLong("insert into adm_track (code,adm_station_id,UP_NOM,adm_nod_id,olddirection) values (\'" + trackCode + "\', \'" + stationIDs.ToString() + "\','" + up_nom + "\', " + nod_id + "," + listID.OldDirection + ") returning ID");
                                                ExportImportService.Execute("insert into stw_track (adm_station_id, adm_track_id, type_id,adm_nod_id) values (" + stationID.ToString() + ", " + trackID.ToString() + ", \'" + cat_track_typeid + "\', " + nod_id + ")");

                                                listID.NewDirectionID = stationID;
                                                listID.NewTrackID = trackID;
                                                listID.Code = up_nom;

                                                listID.OldDirectionID = int.Parse(z_row.Attributes["UP_NOM"].Value);
                                                listID.OldTrackID = (z_row.Attributes["NOM"].Value).ToString();
                                                listID.Stationname = stationName;
                                                if (listID.Stationname == "Лесная")
                                                {
                                                    //лесная 1 1 6139 834 6140 708
                                                    listID.Stationname = "Лесная";
                                                }
                                                listIDs.Add(listID);
                                            }
                                            else
                                            {
                                                int typeid = 1;
                                                ImportListStationID listStationID = new ImportListStationID();

                                                foreach (FileInfo tempFile in fileInfo.Where(tmp => tmp.Name == "UP.xml"))
                                                {
                                                    XmlDocument tempXmlDocument = new XmlDocument();
                                                    tempXmlDocument.Load(tempFile.FullName);
                                                    XmlElement tempXmlElement = tempXmlDocument.DocumentElement;
                                                    foreach (XmlNode tempXmlNode in tempXmlElement)
                                                    {
                                                        if (tempXmlNode.Name == "up")
                                                        {
                                                            foreach (XmlNode tempz_row in tempXmlNode.ParentNode)
                                                            {
                                                                if (tempz_row.Attributes["UP_NOM"].Value == (up_nom))
                                                                {
                                                                    listStationID.OldStationID = int.Parse(tempz_row.Attributes["UP_NOM"].Value);
                                                                    break;
                                                                }
                                                            }
                                                        }
                                                    }
                                                }

                                                listStationID.Station = stationName;
                                                listStationID.Code = up_nom;
                                                listStationID.OldTrackId = Nom;
                                                listStationID.OldDirection = (int)adm_direction_id.First();

                                                if (listStationID.Station == "Лесная")
                                                {
                                                    //лесная 1 1 6139 834 6140 708
                                                    listStationID.Station = "Лесная";
                                                }
                                                //listStationID.NewStationID = ExportImportService.ImportQueryReturnLong("insert into ADM_STATION (TYPE_ID, CODE, NAME, ADM_NOD_ID) values (" + typeid.ToString() + ", " + listStationID.Code + ", \'" + stationName + "\', " + nod_id + ") returning ID");
                                                listStationID.NewStationID = ExportImportService.ImportQueryReturnLong("select id from adm_station where type_id =" + typeid + "  and code = '" + listStationID.Code + "' and name = '" + listStationID.Station + "' and ADM_NOD_ID =" + nod_id + " and adm_direction_id =" + listStationID.OldDirection + "");
                                                listStationIDs.Add(listStationID);

                                                Int64 trackID = ExportImportService.ImportQueryReturnLong("insert into adm_track (code,adm_station_id,UP_NOM,adm_nod_id,olddirection) values (\'" + trackCode + "\', \'" + stationIDs.ToString() + "\','" + up_nom + "\', " + nod_id + "," + listStationID.OldDirection + ") returning ID");
                                                ExportImportService.Execute("insert into stw_track (adm_station_id, adm_track_id, type_id,adm_nod_id) values (" + listStationID.NewStationID + ", " + trackID + ",\'" + cat_track_typeid + "\', " + nod_id + ")");

                                                ImportListDirTrackID listID = new ImportListDirTrackID();
                                                listID.NewDirectionID = listStationID.NewStationID;
                                                listID.NewTrackID = trackID;
                                                listID.Code = up_nom;
                                                listID.Stationname = stationName;
                                                if (listID.Stationname == "Лесная")
                                                {
                                                    //лесная 1 1 6139 834 6140 708
                                                    listID.Stationname = "Лесная";
                                                }
                                                listID.OldDirection = (int)adm_direction_id.First();
                                                listID.OldDirectionID = int.Parse(z_row.Attributes["UP_NOM"].Value);
                                                listID.OldTrackID = (z_row.Attributes["NOM"].Value).ToString();
                                                listIDs.Add(listID);
                                            }
                                        }
                                        //liststations.Station = stationName;
                                        //listStationIDs.Add(liststations);
                                        //var directionID = ExportImportService.ImportQueryReturnListLong("SELECT  id  from ADM_DIRECTION where code = '" + directionCode + "'").First();

                                        else
                                        {

                                            string trackCode = z_row.Attributes["NOM"].Value;

                                            //var stationIDs = ExportImportService.ImportQueryReturnListLong("SELECT  id  from ADM_STATION where code = '" + up_nom + "'").First();
                                            //continue;
                                            var parkName = ExportImportService.ExportQueryReturnString("SELECT  NAME  from ADM_STATION where code = '" + up_nom + "' and adm_nod_id =" + nod_id + "");
                                            if (parkName == "Юрты")
                                            {

                                            }
                                            //var adm_direction_id = ExportImportService.ImportQueryReturnListLong("SELECT  adm_direction_id  from ADM_STATION where id = '" + stationIDs + "' or NAME ='"+ parkName + "'");
                                            string cat_track_type = z_row.Attributes["TYPE"].Value;
                                            int cat_track_typeid = 0;
                                            if (cat_track_type == "Главный")
                                                cat_track_typeid = 1;
                                            if (cat_track_type == "Приемо-отп.")
                                                cat_track_typeid = 2;
                                            if (cat_track_type == "Другой" || cat_track_type == "Прочий")
                                                cat_track_typeid = 3;
                                            //cat_track_typeid = 3;
                                            string[] stations = parkName.Split(new char[] { '/' }, StringSplitOptions.RemoveEmptyEntries);
                                            if (listStationIDs.Count < 1)
                                                continue;
                                            var containtsstation = listIDs.Where(tmp => tmp.Code.Contains(up_nom.Remove(6)));

                                            if (!containtsstation.Any())
                                            {
                                                continue;
                                            }

                                            if (listIDs.Where(tmp => tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() < 1 && listIDs.Where(tmp => tmp.Stationname.Contains(stations[0]) && tmp.Code.Contains(up_nom.Remove(6))).Count() > 0)
                                            //if (listIDs.Where(tmp => tmp.Stationname.Contains(stations[0]) && tmp.Code.Contains(up_nom.Remove(6))).Count() > 0)
                                            {
                                                string stationID = listIDs.Where(tmp => tmp.Stationname.Contains(stations[0]) && tmp.Code.Contains(up_nom.Remove(6))).First().NewDirectionID.ToString();
                                                //var stationID = ExportImportService.ImportQueryReturnListLong("select ID from adm_station where code = '" + z_row.Attributes["UP_NOM"].Value + "'");
                                                ImportListStationID listStationID = new ImportListStationID();
                                                listStationID.Station = parkName;
                                                listStationID.Code = up_nom;
                                                listStationID.OldTrackId = Nom;
                                                listStationID.OldDirection = (int)adm_direction_id.First();
                                                listStationID.OldStationID = int.Parse(z_row.Attributes["UP_NOM"].Value);
                                                listStationID.NewStationID = ExportImportService.ImportQueryReturnLong("insert into stw_park (TYPE_ID, adm_station_id, name,adm_nod_id,olddirection) values (" + cat_track_typeid + ", " + stationID + ", \'" + parkName + "\'," + nod_id + "," + listStationID.OldDirection + ") returning ID");
                                                //listStationID.NewStationID = ExportImportService.ImportQueryReturnLong("insert into stw_park (TYPE_ID, adm_station_id, name) values (3, " + stationID + ", \'" + stations[0] + "\') returning ID");
                                                listStationIDs.Add(listStationID);

                                                Int64 trackID = ExportImportService.ImportQueryReturnLong("insert into adm_track (code,adm_station_id,UP_NOM,adm_nod_id,olddirection) values (\'" + trackCode + "\', \'" + stationIDs.ToString() + "\','" + up_nom + "\'," + nod_id + "," + listStationID.OldDirection + ") returning ID");
                                                ExportImportService.Execute("insert into stw_park_track (stw_park_id, adm_track_id, type_id,adm_nod_id) values (" + listStationID.NewStationID.ToString() + ", " + trackID.ToString() + "," + cat_track_typeid + ", " + nod_id + ")");

                                                ImportListDirTrackID listID = new ImportListDirTrackID();
                                                listID.NewDirectionID = listStationID.NewStationID;
                                                listID.NewTrackID = trackID;
                                                listID.Code = up_nom;
                                                listID.Stationname = parkName;
                                                listID.OldDirection = (int)adm_direction_id.First();
                                                listID.OldDirectionID = int.Parse(z_row.Attributes["UP_NOM"].Value);
                                                listID.OldTrackID = (z_row.Attributes["NOM"].Value).ToString();
                                                listIDs.Add(listID);
                                            }
                                            else
                                            {
                                                string stationID = listIDs.Where(tmp => tmp.Stationname.Contains(stations[0]) && tmp.Code.Contains(up_nom.Remove(6))).First().NewDirectionID.ToString();
                                                //var stationID = ExportImportService.ImportQueryReturnListLong("select ID from adm_station where code = '" + z_row.Attributes["UP_NOM"].Value + "'");
                                                var parkID_selected = ExportImportService.ImportQueryReturnListLong("select ID from stw_park where adm_station_id = " + stationID + " and  name = '" + parkName + "'  and  adm_nod_id = '" + nod_id + "'");
                                                ImportListDirTrackID listID = new ImportListDirTrackID();
                                                listID.OldDirection = (int)adm_direction_id.First();
                                                //string[] stations = parkName.Split(new char[] { '/' }, StringSplitOptions.RemoveEmptyEntries);
                                                //long parkID = ExportImportService.ImportQueryReturnLong("insert into stw_park (TYPE_ID, adm_station_id, name,adm_nod_id,olddirection) values (" + cat_track_typeid + ", " + stationID.First() + ", \'" + parkName + "\'," + nod_id + "," + listID.OldDirection + ") returning ID");
                                                //string parkID = listStationIDs.Where(tmp => tmp.Station == parkName && tmp.Code.Contains(up_nom) ).Last().NewStationID.ToString();
                                                //string parkID = listStationIDs.Where(tmp => tmp.Station == stations[0] && tmp.Code.Contains(up_nom)).First().NewStationID.ToString();

                                                Int64 trackID = ExportImportService.ImportQueryReturnLong("insert into adm_track (code,adm_station_id,UP_NOM,adm_nod_id,olddirection) values (\'" + trackCode + "\', \'" + stationIDs.ToString() + "\','" + up_nom + "\'," + nod_id + "," + listID.OldDirection + ") returning ID");
                                                ExportImportService.Execute("insert into stw_park_track (stw_park_id, adm_track_id, type_id,adm_nod_id) values (" + parkID_selected.First() + ", " + trackID.ToString() + "," + cat_track_typeid + "," + nod_id + ")");


                                                listID.NewDirectionID = parkID_selected.First();
                                                listID.NewTrackID = trackID;
                                                listID.Code = up_nom;
                                                listID.Stationname = parkName;

                                                listID.OldDirectionID = int.Parse(z_row.Attributes["UP_NOM"].Value);
                                                listID.OldTrackID = (z_row.Attributes["NOM"].Value).ToString();
                                                listIDs.Add(listID);
                                                //ExportImportService.Execute("insert into adm_list_st (stw_park_id, adm_track_id, type_id,adm_nod_id) values (" + parkID + ", " + trackID.ToString() + "," + cat_track_typeid + nod_id + ")");
                                                //ExportImportService.Execute("insert into adm_list_station (stw_park_id, adm_track_id, type_id,adm_nod_id) values (" + parkID + ", " + trackID.ToString() + "," + cat_track_typeid + nod_id + ")");

                                            }
                                        }
                                    }
                                }
                                count = count + 1;

                                //}

                            }//для up_nom = 13808

                        }

                    }
                }
                foreach (var insertlist in listIDs)
                {
                    if (insertlist.OldTrackID == null)
                    {
                        insertlist.OldTrackID = "";
                    }
                    if (insertlist.Code == null)
                    {
                        insertlist.Code = "";
                    }
                    if (insertlist.Stationname == null)
                    {
                        insertlist.Stationname = "";
                    }
                    if (insertlist.OldTrackID == "4" && insertlist.OldDirectionID == 13810)
                    {


                    }

                    if (insertlist.OldTrackID == "гл" && insertlist.OldDirectionID == 24630)
                    {

                    }
                    ExportImportService.Execute("insert into adm_list_st (id,newDirectionID,oldDirectionID,oldDirection,oldTrackID,code,stationname,curveID) values (" + insertlist.NewTrackID + "," + insertlist.NewDirectionID + "," + insertlist.OldDirectionID + ", " + insertlist.OldDirection + ",'" + insertlist.OldTrackID + "', " + insertlist.Code + ", '" + insertlist.Stationname + "', " + insertlist.CurveID + ")");
                }
                foreach (var insertlist in listStationIDs)
                {
                    if (insertlist.OldTrackId == null)
                    {
                        insertlist.OldTrackId = "";
                    }
                    if (insertlist.Code == null)
                    {
                        insertlist.Code = "";
                    }
                    if (insertlist.Station == null)
                    {
                        insertlist.Station = "";
                    }
                    ExportImportService.Execute("insert into adm_list_station (oldtrackid,newdirectionid,newstationid,olddirection,code,oldstationid,station)" +
                                                           " values ('" + insertlist.OldTrackId + "'," + insertlist.NewDirectionID + "," + insertlist.NewStationID + ", " + insertlist.OldDirection + "," + insertlist.Code + ", " + insertlist.OldStationID + ", '" + insertlist.Station + "')");
                }
                progressBar.PerformStep();

                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "PODR.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "podr")
                        {
                            if (count > 0)
                                continue;
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {
                                ImportListPCH listPCHID = new ImportListPCH();
                                List<ImportListDirTrackID> listPCHIDs = new List<ImportListDirTrackID>();

                                listPCHID.Type = z_row.Attributes["TYPE"].Value;
                                if (listPCHID.Type == "ПЧ")
                                {
                                    listPCHID.Distance = z_row.Attributes["NUM"].Value;
                                    //listPCHID.ID = int.Parse(z_row.Attributes["ID"].Value);//текущий айди обьекта
                                    listPCHID.Ekasui_id = int.Parse(z_row.Attributes["ID"].Value);//предыдущий айди обьекта

                                    var adm_distance_id = ExportImportService.ImportQueryReturnListLong("SELECT  ekasui_id  from ADM_DISTANCE where ekasui_id = '" + listPCHID.Ekasui_id + "'  and  code ='" + listPCHID.Distance + "' and adm_nod_id =" + nod_id + " ");
                                    if (!adm_distance_id.Contains(listPCHID.Ekasui_id))
                                    {
                                        listPCHID.DistanceID = ExportImportService.ImportQueryReturnLong("insert into ADM_DISTANCE (CODE, NAME, ADM_NOD_ID,EKASUI_ID) values (\'" + listPCHID.Distance + "\', \'" + "ПЧ-" + listPCHID.Distance + "\',\'" + nod_id.ToString() + "\'," + listPCHID.Ekasui_id + ") returning ID");
                                        //listPCHIDs.Add(listPCHID);
                                    }
                                    else
                                    {
                                        continue;
                                    }


                                }
                                count = count + 1;
                            }

                        }

                    }
                }
                progressBar.PerformStep();

                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "PODR.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "podr")
                        {
                            if (count > 0)
                                continue;
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {
                                ImportListPCH listPCHUID = new ImportListPCH();

                                listPCHUID.Type = z_row.Attributes["TYPE"].Value;
                                if (listPCHUID.Type == "ПЧУ")
                                {
                                    listPCHUID.Ekasui_id = int.Parse(z_row.Attributes["PARENT_ID"].Value);
                                    listPCHUID.ID = int.Parse(z_row.Attributes["ID"].Value);
                                    var listPCHD = ExportImportService.ImportQueryReturnListLong("SELECT  ekasui_id,id,code  from adm_distance where ekasui_id = " + listPCHUID.Ekasui_id + " ");
                                    var DIstanceID = ExportImportService.ImportQueryReturnListLong("SELECT  id  from adm_distance where ekasui_id = " + listPCHUID.Ekasui_id + "");
                                    if (listPCHD.Contains(listPCHUID.Ekasui_id))
                                    {
                                        var adm_distance_id = ExportImportService.ImportQueryReturnListLong("SELECT  ekasui_id  from ADM_PCHU where id_parent = '" + listPCHUID.Ekasui_id + "'and adm_nod_id =" + nod_id + " ");
                                        if (!adm_distance_id.Contains(listPCHUID.Ekasui_id))
                                        {
                                            listPCHUID.FIO = z_row.Attributes["CHIEF_NAME"] != null ? z_row.Attributes["CHIEF_NAME"].Value : "";
                                            listPCHUID.PCHU = z_row.Attributes["NUM"].Value;
                                            listPCHUID.PCHUID = ExportImportService.ImportQueryReturnLong("insert into ADM_PCHU (CODE, CHIEF_FULLNAME, ADM_DISTANCE_ID,EKASUI_ID,ID_PARENT,adm_nod_id) values (\'" + listPCHUID.PCHU + "\', \'" + listPCHUID.FIO + "\',\' " + DIstanceID.First() + "\',\'" + listPCHUID.Ekasui_id + "\'," + listPCHUID.ID + "," + nod_id + ") returning ID");

                                        }
                                        else
                                        {
                                            continue;
                                        }
                                    }
                                }
                                count = count + 1;
                            }
                        }

                    }
                }
                progressBar.PerformStep();
                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "PODR.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "podr")
                        {
                            if (count > 0)
                                continue;
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {
                                ImportListPCH listPDID = new ImportListPCH();

                                listPDID.Type = z_row.Attributes["TYPE"].Value;
                                if (listPDID.Type == "ПД")
                                {
                                    listPDID.Ekasui_id = int.Parse(z_row.Attributes["PARENT_ID"].Value);
                                    listPDID.ID = int.Parse(z_row.Attributes["ID"].Value);

                                    var listPD = ExportImportService.ImportQueryReturnListLong("SELECT  id_parent  from adm_pchu where id_parent = " + listPDID.Ekasui_id + "");
                                    var PCHUID = ExportImportService.ImportQueryReturnListLong("SELECT  id  from adm_pchu where id_parent = " + listPDID.Ekasui_id + "");


                                    if (listPD.Contains(listPDID.Ekasui_id))
                                    {
                                        var adm_distance_id = ExportImportService.ImportQueryReturnListLong("SELECT  id_parent  from ADM_PD where id_parent = '" + listPDID.Ekasui_id + "' and adm_nod_id =" + nod_id + " ");
                                        if (!adm_distance_id.Contains(listPDID.Ekasui_id))
                                        {
                                            listPDID.FIO = z_row.Attributes["CHIEF_NAME"] != null ? z_row.Attributes["CHIEF_NAME"].Value : "";
                                            listPDID.PD = z_row.Attributes["NUM"].Value;
                                            listPDID.PDID = ExportImportService.ImportQueryReturnLong("insert into ADM_PD (CODE, CHIEF_FULLNAME, ADM_PCHU_ID,EKASUI_ID,ID_PARENT,adm_nod_id) values (\'" + listPDID.PD + "\', \'" + listPDID.FIO + "\',\'" + PCHUID.First() + "\',\'" + listPDID.Ekasui_id + "\'," + listPDID.ID + "," + nod_id + ") returning ID");
                                        }
                                        else
                                        {
                                            continue;
                                        }

                                    }
                                }
                                count = count + 1;
                            }
                        }

                    }
                }
                progressBar.PerformStep();
                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "PODR.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "podr")
                        {
                            if (count > 0)
                                continue;
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {
                                ImportListPCH listPDBID = new ImportListPCH();

                                listPDBID.Type = z_row.Attributes["TYPE"].Value;
                                if (listPDBID.Type == "ПДБ")
                                {
                                    listPDBID.Ekasui_id = int.Parse(z_row.Attributes["PARENT_ID"].Value);
                                    listPDBID.ID = int.Parse(z_row.Attributes["ID"].Value);

                                    var listPDB = ExportImportService.ImportQueryReturnListLong("SELECT  id_parent  from adm_pd where id_parent = " + listPDBID.Ekasui_id + "");
                                    var PDID = ExportImportService.ImportQueryReturnListLong("SELECT  id  from adm_pd where id_parent = " + listPDBID.Ekasui_id + "");


                                    if (listPDB.Contains(listPDBID.Ekasui_id))
                                    {

                                        var adm_distance_id = ExportImportService.ImportQueryReturnListLong("SELECT  id_parent  from ADM_PDB where id_parent = '" + listPDBID.Ekasui_id + "' and adm_nod_id =" + nod_id + " ");
                                        if (!adm_distance_id.Contains(listPDBID.Ekasui_id))
                                        {
                                            listPDBID.FIO = z_row.Attributes["CHIEF_NAME"] != null ? z_row.Attributes["CHIEF_NAME"].Value : "";
                                            listPDBID.PDB = z_row.Attributes["NUM"].Value;
                                            listPDBID.PDBID = ExportImportService.ImportQueryReturnLong("insert into ADM_PDB (CODE, CHIEF_FULLNAME, ADM_PD_ID,EKASUI_ID,ID_PARENT,adm_nod_id) values (\'" + listPDBID.PDB + "\', \'" + listPDBID.FIO + "\',\'" + PDID.First() + "\',\'" + listPDBID.Ekasui_id + "\'," + listPDBID.ID + "," + nod_id + ") returning ID");

                                        }
                                        else
                                        {
                                            continue;
                                        }
                                    }
                                }
                                count = count + 1;
                            }
                        }

                    }
                }
                progressBar.PerformStep();
                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "PODRGR.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {

                        if (xmlNode.Name == "podrgr")
                        {
                            if (count > 0)
                                continue;

                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {
                                ImportListPDBID listPDBID = new ImportListPDBID();

                                var Type = z_row.Attributes["TYPE"].Value;
                                if (Type == "ПЧ")
                                {
                                    var oldtrack = int.Parse(z_row.Attributes["ID"].Value);
                                    var up_nom = int.Parse(z_row.Attributes["UP_NOM"].Value);
                                    string Put_nom = z_row.Attributes["PUT_NOM"].Value;//номер пути

                                    var adm_distance_ids = ExportImportService.ImportQueryReturnListLong("SELECT  id  from adm_distance where ekasui_id = '" + oldtrack + "' and  adm_nod_id =" + nod_id + "");
                                    if (adm_distance_ids.Count == 0)
                                        continue;
                                    var adM_track = ExportImportService.ImportQueryReturnListLong("SELECT  id  from adm_track where up_nom = '" + up_nom + "' and code = '" + Put_nom + "' and adm_nod_id=" + nod_id + " ");
                                    if (adM_track.Count == 0)
                                        continue;

                                    //Int64 newTrackID = adM_track.First();
                                    foreach (Int64 adm_distance_id in adm_distance_ids)
                                    {
                                        foreach (Int64 newTrackID in adM_track)
                                        {

                                            if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + newTrackID.ToString() + " and MTO_TYPE = 0").Count() > 0)
                                            {
                                                Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + newTrackID.ToString() + " and MTO_TYPE = 0");
                                                ExportImportService.Execute("insert into tpl_dist_section (adm_distance_id, PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M,adm_nod_id) values (" + adm_distance_id + ", " + periodID.ToString() + ", " + int.Parse(z_row.Attributes["BEGIN_KM"].Value) + ", " + int.Parse(z_row.Attributes["BEGIN_M"].Value) + ", " + int.Parse(z_row.Attributes["END_KM"].Value) + ", " + int.Parse(z_row.Attributes["END_M"].Value) + "," + nod_id + ")");
                                            }
                                            else
                                            {
                                                Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + newTrackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 0) returning ID");
                                                ExportImportService.Execute("insert into tpl_dist_section (adm_distance_id, PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M,adm_nod_id) values (" + adm_distance_id + ", " + periodID.ToString() + ", " + int.Parse(z_row.Attributes["BEGIN_KM"].Value) + ", " + int.Parse(z_row.Attributes["BEGIN_M"].Value) + ", " + int.Parse(z_row.Attributes["END_KM"].Value) + ", " + int.Parse(z_row.Attributes["END_M"].Value) + "," + nod_id + ")");

                                                Int64 periodID_D = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + newTrackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 5) returning ID");
                                                ExportImportService.Execute("insert into apr_norma_width (PERIOD_ID, start_km, start_m, final_km, final_m, norma_width) values (" + periodID_D.ToString() + ", "
                                                      + int.Parse(z_row.Attributes["BEGIN_KM"].Value) + ", " + int.Parse(z_row.Attributes["BEGIN_M"].Value) + ", " + int.Parse(z_row.Attributes["END_KM"].Value) + ", " + int.Parse(z_row.Attributes["END_M"].Value) + "," + "1520" + ")");
                                            }

                                        }
                                    }


                                }

                                if (Type == "ПДБ")
                                {
                                    var oldtrack = int.Parse(z_row.Attributes["ID"].Value);
                                    var up_nom = int.Parse(z_row.Attributes["UP_NOM"].Value);
                                    string Put_nom = z_row.Attributes["PUT_NOM"].Value;//номер пути
                                    var DISTANCEEKASUIIDs = ExportImportService.ImportQueryReturnListLong("SELECT  id  from adm_pdb where id_parent = '" + oldtrack + "'and  adm_nod_id =" + nod_id + "");
                                    if (DISTANCEEKASUIIDs.Count == 0)
                                        continue;
                                    var adM_track = ExportImportService.ImportQueryReturnListLong("SELECT  id  from adm_track where up_nom = '" + up_nom + "' and code = '" + Put_nom + "' and adm_nod_id=" + nod_id + " ");
                                    if (adM_track.Count == 0)
                                        continue;


                                    //Int64 trackID = adM_track.First();
                                    foreach (Int64 DISTANCEEKASUIID in DISTANCEEKASUIIDs)
                                    {
                                        foreach (Int64 trackID in adM_track)
                                        {
                                            if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 9").Count() > 0)
                                            {
                                                Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 9");
                                                ExportImportService.Execute("insert into TPL_PDB_SECTION (ADM_PDB_ID, PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M,adm_nod_id) values (" + DISTANCEEKASUIID + ", " + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + "," + nod_id + ")");
                                            }
                                            else
                                            {
                                                Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 9) returning ID");
                                                ExportImportService.Execute("insert into TPL_PDB_SECTION (ADM_PDB_ID, PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M,adm_nod_id) values (" + DISTANCEEKASUIID + ", " + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + "," + nod_id + ")");
                                            }
                                        }
                                    }


                                }

                                count = count + 1;
                            }
                        }

                    }
                }
                progressBar.PerformStep();
                listPDBIDs.Clear();



                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "STR.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "str")
                        {
                            if (count > 0)
                                continue;

                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {

                                string km = z_row.Attributes["KM"].Value;
                                string m = z_row.Attributes["M"].Value;
                                string num = z_row.Attributes["NOM"].Value;
                                if (num == "10Б" || num == "10б")
                                {

                                }

                                string sideID;
                                //string POINT_ID = z_row.Attributes["NOM"].Value;
                                string POINT_ID = "35";
                                string dirID = z_row.Attributes["POSH"].Value;//положение

                                string markID = z_row.Attributes["TYPE"].Value;

                                //sideID = (z_row.Attributes["OTB"].Value);


                                int Sidetype = -1;
                                if (!int.TryParse(z_row.Attributes["OTB"].Value, out Sidetype))
                                    sideID = "0";
                                else
                                {
                                    if (Sidetype == 1)
                                        sideID = "0";
                                    else if (Sidetype == 2)
                                        sideID = "2";
                                    else if (Sidetype == 3)
                                        sideID = "1";
                                    else if (Sidetype == 4)
                                        sideID = "0";
                                    else if (Sidetype == 0)
                                        sideID = "0";
                                    else sideID = "0";
                                }
                                if (z_row.Attributes["UP_NOM"].Value == "94790802" && z_row.Attributes["PUT_NOM"].Value == "1Б" && num == "14")
                                {

                                }
                                if (z_row.Attributes["UP_NOM"].Value == "94790802" && z_row.Attributes["PUT_NOM"].Value == "1" && num == "14")
                                {

                                }

                                string directionCode = z_row.Attributes["UP_NOM"].Value; //ekasui_ID
                                string numberAsString = directionCode.ToString();
                                string firstSixDigits = "";
                                if (numberAsString.Length > 6)
                                {
                                    firstSixDigits = numberAsString.Substring(0, 6);
                                    Console.WriteLine("Первые шесть цифр: " + firstSixDigits);
                                }
                                else
                                {
                                    Console.WriteLine("Число имеет менее шести цифр.");
                                }
                                //var st_kod = z_row.Attributes["ST_KOD"].Value;
                                //var listNom = ExportImportService.ImportQueryReturnListString($@"Select nom from ekasui_str where nom = '{num}' and st_kod = '{st_kod}'");

                                if (listIDs.Where(tmp => tmp.OldDirection == int.Parse(z_row.Attributes["UP_NOM"].Value) && tmp.OldDirectionID == int.Parse(z_row.Attributes["ST_KOD"].Value)).Count() > 0)
                                //if (listStationIDs.Where(tmp => (tmp.OldDirection == int.Parse(z_row.Attributes["UP_NOM"].Value) && tmp.OldStationID == int.Parse(z_row.Attributes["ST_KOD"].Value))).Count() > 0)


                                {
                                    var lsitsationId = listIDs.Where(tmp => tmp.OldDirectionID == int.Parse(z_row.Attributes["ST_KOD"].Value));
                                    var listSTATid = lsitsationId.Select(o => o.NewDirectionID).ToList();

                                    var selcetd_same_pertiod = ExportImportService.ImportQueryReturnListLong("select period_id from tpl_switch where km = " + km + " and meter =" + m + " and num ='" + num + "'");
                                    if (selcetd_same_pertiod.Count() > 0)
                                    {
                                        if (z_row.Attributes["UP_NOM"].Value != z_row.Attributes["ST_KOD"].Value && firstSixDigits == z_row.Attributes["ST_KOD"].Value)
                                        {
                                            if (listIDs.Where(tmp => (tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value))).Count() > 0)
                                            {
                                                listSTATid = ExportImportService.ImportQueryReturnListLong("select ID from adm_station where code = '" + z_row.Attributes["UP_NOM"].Value + "'");
                                                foreach (Int64 stationId in listSTATid)
                                                {

                                                    if ((listIDs.Where(tmp => tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value) && tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value)).Count() > 0))
                                                    {
                                                        var trackID = ExportImportService.ImportQueryReturnListLong("select adm_track_id from TPL_PERIOD where id = " + selcetd_same_pertiod.First() + " ");



                                                        if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.First() + " and MTO_TYPE = 15 ").Count() > 0)
                                                        {
                                                            Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.First() + " and MTO_TYPE = 15");
                                                            ExportImportService.Execute("insert into TPL_SWITCH (PERIOD_ID, KM, METER, NUM, MARK_ID, DIR_ID, SIDE_ID, POINT_ID, station_id) values (" + periodID.ToString() + ", " + km + ", " + m + ", \'" + num + "\', " + markID + ", " + (dirID == "1" ? dirID = "-1" : dirID == "2" ? dirID = "1" : dirID = "0") + ", "
                                                                + sideID + "," + markID + ", " + stationId.ToString() + ")");
                                                        }
                                                        else
                                                        {
                                                            Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 15) returning ID");
                                                            ExportImportService.Execute("insert into TPL_SWITCH (PERIOD_ID, KM, METER, NUM, MARK_ID, DIR_ID, SIDE_ID, POINT_ID, station_id) values (" + periodID.ToString() + ", " + km + ", " + m + ", \'" + num + "\', " + markID + ", " + (dirID == "1" ? dirID = "-1" : dirID == "2" ? dirID = "1" : dirID = "0") + ", "
                                                                + sideID + "," + markID + ", " + stationId.ToString() + ")");
                                                        }


                                                        if (listStationSections.Where(l => l.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && l.OldStationID.Equals(z_row.Attributes["ST_KOD"].Value) && l.OldDirectionID.Equals(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                                                        {
                                                            if (z_row.Attributes["M"].Value == "1" && z_row.Attributes["KM"].Value == "5781")
                                                            {

                                                            }
                                                            //if ((z_row.Attributes["PUT_NOM"].Value.Count() == 0) || (z_row.Attributes["ST_KOD"].Value.Count() == 0) || (z_row.Attributes["UP_NOM"].Value.Count() == 0))
                                                            //{
                                                            //    continue;
                                                            //}
                                                            ImportListStationSection listStationSection = listStationSections.Where(l => l.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && l.OldStationID.Equals(z_row.Attributes["ST_KOD"].Value) && l.OldDirectionID.Equals(z_row.Attributes["UP_NOM"].Value)).First();
                                                            int pos = int.Parse(km) * 1000 + int.Parse(m);

                                                            if (pos < listStationSection.Start_pos)
                                                            {
                                                                listStationSection.Start_pos = pos;
                                                                listStationSection.Axis_pos = (listStationSection.Start_pos + listStationSection.Final_pos) / 2;
                                                            }
                                                            else if (pos > listStationSection.Final_pos)
                                                            {
                                                                listStationSection.Final_pos = pos;
                                                                listStationSection.Axis_pos = (listStationSection.Start_pos + listStationSection.Final_pos) / 2;
                                                            }
                                                        }
                                                        else
                                                        {
                                                            ImportListStationSection listStationSection = new ImportListStationSection
                                                            {
                                                                OldTrackID = z_row.Attributes["PUT_NOM"].Value,
                                                                OldStationID = z_row.Attributes["ST_KOD"].Value,
                                                                OldDirectionID = z_row.Attributes["UP_NOM"].Value,
                                                                Start_pos = int.Parse(km) * 1000 + int.Parse(m),
                                                                Axis_pos = int.Parse(km) * 1000 + int.Parse(m),
                                                                Final_pos = int.Parse(km) * 1000 + int.Parse(m),
                                                                Point_id = markID
                                                                //add km kmstr
                                                                //metert to km in kilometrs

                                                            };
                                                            listStationSections.Add(listStationSection);
                                                        }
                                                    }
                                                    break;
                                                }

                                            }
                                        }


                                        //Int64 stationId = listStationIDs.Where(tmp => tmp.OldStationID == int.Parse(z_row.Attributes["ST_KOD"].Value)).First().NewStationID;


                                    }
                                    else
                                    {
                                        foreach (Int64 stationId in listSTATid)
                                        {

                                            if ((listIDs.Where(tmp => tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value) && tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value)).Count() > 0))
                                            {
                                                Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value) && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;



                                                if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 15 ").Count() > 0)
                                                {
                                                    Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 15");
                                                    ExportImportService.Execute("insert into TPL_SWITCH (PERIOD_ID, KM, METER, NUM, MARK_ID, DIR_ID, SIDE_ID, POINT_ID, station_id) values (" + periodID.ToString() + ", " + km + ", " + m + ", \'" + num + "\', " + markID + ", " + (dirID == "1" ? dirID = "-1" : dirID == "2" ? dirID = "1" : dirID = "0") + ", "
                                                        + sideID + "," + markID + ", " + stationId.ToString() + ")");
                                                }
                                                else
                                                {
                                                    Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 15) returning ID");
                                                    ExportImportService.Execute("insert into TPL_SWITCH (PERIOD_ID, KM, METER, NUM, MARK_ID, DIR_ID, SIDE_ID, POINT_ID, station_id) values (" + periodID.ToString() + ", " + km + ", " + m + ", \'" + num + "\', " + markID + ", " + (dirID == "1" ? dirID = "-1" : dirID == "2" ? dirID = "1" : dirID = "0") + ", "
                                                        + sideID + "," + markID + ", " + stationId.ToString() + ")");
                                                }


                                                if (listStationSections.Where(l => l.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && l.OldStationID.Equals(z_row.Attributes["ST_KOD"].Value) && l.OldDirectionID.Equals(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                                                {
                                                    if (z_row.Attributes["M"].Value == "1" && z_row.Attributes["KM"].Value == "5781")
                                                    {

                                                    }
                                                    //if ((z_row.Attributes["PUT_NOM"].Value.Count() == 0) || (z_row.Attributes["ST_KOD"].Value.Count() == 0) || (z_row.Attributes["UP_NOM"].Value.Count() == 0))
                                                    //{
                                                    //    continue;
                                                    //}
                                                    ImportListStationSection listStationSection = listStationSections.Where(l => l.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && l.OldStationID.Equals(z_row.Attributes["ST_KOD"].Value) && l.OldDirectionID.Equals(z_row.Attributes["UP_NOM"].Value)).First();
                                                    int pos = int.Parse(km) * 1000 + int.Parse(m);

                                                    if (pos < listStationSection.Start_pos)
                                                    {
                                                        listStationSection.Start_pos = pos;
                                                        listStationSection.Axis_pos = (listStationSection.Start_pos + listStationSection.Final_pos) / 2;
                                                    }
                                                    else if (pos > listStationSection.Final_pos)
                                                    {
                                                        listStationSection.Final_pos = pos;
                                                        listStationSection.Axis_pos = (listStationSection.Start_pos + listStationSection.Final_pos) / 2;
                                                    }
                                                }
                                                else
                                                {
                                                    ImportListStationSection listStationSection = new ImportListStationSection
                                                    {
                                                        OldTrackID = z_row.Attributes["PUT_NOM"].Value,
                                                        OldStationID = z_row.Attributes["ST_KOD"].Value,
                                                        OldDirectionID = z_row.Attributes["UP_NOM"].Value,
                                                        Start_pos = int.Parse(km) * 1000 + int.Parse(m),
                                                        Axis_pos = int.Parse(km) * 1000 + int.Parse(m),
                                                        Final_pos = int.Parse(km) * 1000 + int.Parse(m),
                                                        Point_id = markID
                                                        //add km kmstr
                                                        //metert to km in kilometrs

                                                    };
                                                    listStationSections.Add(listStationSection);
                                                }
                                            }
                                            break;
                                        }
                                    }




                                    //var lsitsationId = listIDs.Where(tmp => tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value) && tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value));

                                    //var listSTATid = lsitsationId.Select(o => o.NewDirectionID).ToList();




                                    //Int64 stationId = listStationIDs.Where(tmp => tmp.OldStationID == int.Parse(z_row.Attributes["ST_KOD"].Value)).First().NewStationID;
                                }

                                count = count + 1;
                            }
                        }
                    }
                }

                progressBar.PerformStep();

                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "STR.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "str")
                        {
                            if (count > 0)
                                continue;

                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {

                                string km = z_row.Attributes["KM"].Value;
                                string m = z_row.Attributes["M"].Value;
                                string num = z_row.Attributes["NOM"].Value;
                                if (num == "10Б" || num == "10б")
                                {

                                }

                                string sideID;
                                //string POINT_ID = z_row.Attributes["NOM"].Value;
                                string POINT_ID = "35";
                                string dirID = z_row.Attributes["POSH"].Value;//положение

                                string markID = z_row.Attributes["TYPE"].Value;

                                //sideID = (z_row.Attributes["OTB"].Value);


                                int Sidetype = -1;
                                if (!int.TryParse(z_row.Attributes["OTB"].Value, out Sidetype))
                                    sideID = "0";
                                else
                                {
                                    if (Sidetype == 1)
                                        sideID = "0";
                                    else if (Sidetype == 2)
                                        sideID = "2";
                                    else if (Sidetype == 3)
                                        sideID = "1";
                                    else if (Sidetype == 4)
                                        sideID = "0";
                                    else if (Sidetype == 0)
                                        sideID = "0";
                                    else sideID = "0";
                                }
                                if (z_row.Attributes["UP_NOM"].Value == "94790802" && z_row.Attributes["PUT_NOM"].Value == "1Б" && num == "14")
                                {

                                }
                                if (z_row.Attributes["UP_NOM"].Value == "94790802" && z_row.Attributes["PUT_NOM"].Value == "1" && num == "14")
                                {

                                }

                                string directionCode = z_row.Attributes["UP_NOM"].Value; //ekasui_ID
                                string numberAsString = directionCode.ToString();
                                string firstSixDigits = "";
                                if (numberAsString.Length > 6)
                                {
                                    firstSixDigits = numberAsString.Substring(0, 6);
                                    Console.WriteLine("Первые шесть цифр: " + firstSixDigits);
                                }
                                else
                                {
                                    Console.WriteLine("Число имеет менее шести цифр.");
                                }
                                //var st_kod = z_row.Attributes["ST_KOD"].Value;
                                //var listNom = ExportImportService.ImportQueryReturnListString($@"Select nom from ekasui_str where nom = '{num}' and st_kod = '{st_kod}'");

                                if (listIDs.Where(tmp => tmp.OldDirectionID == int.Parse(z_row.Attributes["ST_KOD"].Value)).Count() > 0)
                                //if (listStationIDs.Where(tmp => (tmp.OldDirection == int.Parse(z_row.Attributes["UP_NOM"].Value) && tmp.OldStationID == int.Parse(z_row.Attributes["ST_KOD"].Value))).Count() > 0)


                                {
                                    var lsitsationId = listIDs.Where(tmp => tmp.OldDirectionID == int.Parse(z_row.Attributes["ST_KOD"].Value));
                                    var listSTATid = lsitsationId.Select(o => o.NewDirectionID).ToList();

                                    var selcetd_same_pertiod = ExportImportService.ImportQueryReturnListLong("select period_id from tpl_switch where km = " + km + " and meter =" + m + " and num ='" + num + "'");
                                    if (selcetd_same_pertiod.Count() > 0)
                                    {
                                        if (z_row.Attributes["UP_NOM"].Value != z_row.Attributes["ST_KOD"].Value && firstSixDigits == z_row.Attributes["ST_KOD"].Value)
                                        {
                                            if (listIDs.Where(tmp => (tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value))).Count() > 0)
                                            {
                                                listSTATid = ExportImportService.ImportQueryReturnListLong("select ID from adm_station where code = '" + z_row.Attributes["UP_NOM"].Value + "'");
                                                foreach (Int64 stationId in listSTATid)
                                                {

                                                    if ((listIDs.Where(tmp => tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value) && tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value)).Count() > 0))
                                                    {
                                                        var trackID = ExportImportService.ImportQueryReturnListLong("select adm_track_id from TPL_PERIOD where id = " + selcetd_same_pertiod.First() + " ");



                                                        if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.First() + " and MTO_TYPE = 15 ").Count() > 0)
                                                        {
                                                            Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.First() + " and MTO_TYPE = 15");
                                                            ExportImportService.Execute("insert into TPL_SWITCH (PERIOD_ID, KM, METER, NUM, MARK_ID, DIR_ID, SIDE_ID, POINT_ID, station_id) values (" + periodID.ToString() + ", " + km + ", " + m + ", \'" + num + "\', " + markID + ", " + (dirID == "1" ? dirID = "-1" : dirID == "2" ? dirID = "1" : dirID = "0") + ", "
                                                                + sideID + "," + markID + ", " + stationId.ToString() + ")");
                                                        }
                                                        else
                                                        {
                                                            Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 15) returning ID");
                                                            ExportImportService.Execute("insert into TPL_SWITCH (PERIOD_ID, KM, METER, NUM, MARK_ID, DIR_ID, SIDE_ID, POINT_ID, station_id) values (" + periodID.ToString() + ", " + km + ", " + m + ", \'" + num + "\', " + markID + ", " + (dirID == "1" ? dirID = "-1" : dirID == "2" ? dirID = "1" : dirID = "0") + ", "
                                                                + sideID + "," + markID + ", " + stationId.ToString() + ")");
                                                        }


                                                        if (listStationSections.Where(l => l.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && l.OldStationID.Equals(z_row.Attributes["ST_KOD"].Value) && l.OldDirectionID.Equals(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                                                        {
                                                            if (z_row.Attributes["M"].Value == "1" && z_row.Attributes["KM"].Value == "5781")
                                                            {

                                                            }
                                                            //if ((z_row.Attributes["PUT_NOM"].Value.Count() == 0) || (z_row.Attributes["ST_KOD"].Value.Count() == 0) || (z_row.Attributes["UP_NOM"].Value.Count() == 0))
                                                            //{
                                                            //    continue;
                                                            //}
                                                            ImportListStationSection listStationSection = listStationSections.Where(l => l.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && l.OldStationID.Equals(z_row.Attributes["ST_KOD"].Value) && l.OldDirectionID.Equals(z_row.Attributes["UP_NOM"].Value)).First();
                                                            int pos = int.Parse(km) * 1000 + int.Parse(m);

                                                            if (pos < listStationSection.Start_pos)
                                                            {
                                                                listStationSection.Start_pos = pos;
                                                                listStationSection.Axis_pos = (listStationSection.Start_pos + listStationSection.Final_pos) / 2;
                                                            }
                                                            else if (pos > listStationSection.Final_pos)
                                                            {
                                                                listStationSection.Final_pos = pos;
                                                                listStationSection.Axis_pos = (listStationSection.Start_pos + listStationSection.Final_pos) / 2;
                                                            }
                                                        }
                                                        else
                                                        {
                                                            ImportListStationSection listStationSection = new ImportListStationSection
                                                            {
                                                                OldTrackID = z_row.Attributes["PUT_NOM"].Value,
                                                                OldStationID = z_row.Attributes["ST_KOD"].Value,
                                                                OldDirectionID = z_row.Attributes["UP_NOM"].Value,
                                                                Start_pos = int.Parse(km) * 1000 + int.Parse(m),
                                                                Axis_pos = int.Parse(km) * 1000 + int.Parse(m),
                                                                Final_pos = int.Parse(km) * 1000 + int.Parse(m),
                                                                Point_id = markID
                                                                //add km kmstr
                                                                //metert to km in kilometrs

                                                            };
                                                            listStationSections.Add(listStationSection);
                                                        }
                                                    }
                                                    break;
                                                }

                                            }
                                        }


                                        //Int64 stationId = listStationIDs.Where(tmp => tmp.OldStationID == int.Parse(z_row.Attributes["ST_KOD"].Value)).First().NewStationID;


                                    }
                                    else
                                    {
                                        continue;
                                    }




                                    //var lsitsationId = listIDs.Where(tmp => tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value) && tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value));

                                    //var listSTATid = lsitsationId.Select(o => o.NewDirectionID).ToList();




                                    //Int64 stationId = listStationIDs.Where(tmp => tmp.OldStationID == int.Parse(z_row.Attributes["ST_KOD"].Value)).First().NewStationID;
                                }

                                count = count + 1;
                            }
                        }
                    }
                }

                progressBar.PerformStep();



                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "STR.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "str")
                        {
                            if (count > 0)
                                continue;
                            bool inserted = false;
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {

                                string km = z_row.Attributes["KM"].Value;
                                string m = z_row.Attributes["M"].Value;
                                string num = z_row.Attributes["NOM"].Value;
                                string st = z_row.Attributes["ST_KOD"].Value;
                                string up = z_row.Attributes["UP_NOM"].Value;
                                string put = z_row.Attributes["PUT_NOM"].Value;
                                string sideID;
                                string POINT_ID = "35";
                                int dirID = int.Parse(z_row.Attributes["POSH"].Value);//положение
                                if (dirID == 1)
                                {
                                    dirID = -1;
                                }
                                else if (dirID == 2)
                                {
                                    dirID = 1;
                                }
                                else
                                {
                                    dirID = 0;
                                }
                                string markID = z_row.Attributes["TYPE"].Value;


                                int Sidetype = -1;
                                if (!int.TryParse(z_row.Attributes["OTB"].Value, out Sidetype))
                                    sideID = "0";
                                else
                                {
                                    if (Sidetype == 1)
                                        sideID = "0";
                                    else if (Sidetype == 2)
                                        sideID = "2";
                                    else if (Sidetype == 3)
                                        sideID = "1";
                                    else if (Sidetype == 4)
                                        sideID = "0";
                                    else if (Sidetype == 0)
                                        sideID = "0";
                                    else sideID = "0";




                                    if (st == up)
                                    {
                                        var lsitsationId = listIDs.Where(tmp => tmp.Code == (z_row.Attributes["ST_KOD"].Value) && tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value));
                                        var listSTATid = lsitsationId.Select(o => o.NewDirectionID).ToList();
                                        //var listSTATid = ExportImportService.ImportQueryReturnListLong("select ID from adm_station where code = '" + z_row.Attributes["ST_KOD"].Value + "'");
                                        if (listSTATid.Count() > 1)
                                        {

                                        }
                                        foreach (Int64 stationId in listSTATid)
                                        {
                                            Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == z_row.Attributes["PUT_NOM"].Value && tmp.Code == z_row.Attributes["ST_KOD"].Value && tmp.NewDirectionID == stationId).First().NewTrackID;

                                            if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 15 ").Count() > 0)
                                            {
                                                Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 15");
                                                ExportImportService.Execute("insert into TPL_SWITCH (PERIOD_ID, KM, METER, NUM, MARK_ID, DIR_ID, SIDE_ID, POINT_ID, station_id,olddirection) values (" + periodID.ToString() + ", " + km + ", " + m + ", \'" + num + "\', " + markID + ", " + dirID + ", "
                                                    + sideID + "," + markID + ", " + stationId.ToString() + ", " + z_row.Attributes["UP_NOM"].Value + ")");
                                            }
                                            else
                                            {
                                                Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 15) returning ID");
                                                ExportImportService.Execute("insert into TPL_SWITCH (PERIOD_ID, KM, METER, NUM, MARK_ID, DIR_ID, SIDE_ID, POINT_ID, station_id,olddirection) values (" + periodID.ToString() + ", " + km + ", " + m + ", \'" + num + "\', " + markID + ", " + dirID + ", "
                                                    + sideID + "," + markID + ", " + stationId.ToString() + ", " + z_row.Attributes["UP_NOM"].Value + ")");
                                            }


                                            if (listStationSections.Where(l => l.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && l.OldStationID.Equals(z_row.Attributes["ST_KOD"].Value) && l.OldDirectionID.Equals(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                                            {
                                                if (z_row.Attributes["M"].Value == "1" && z_row.Attributes["KM"].Value == "5781")
                                                {

                                                }
                                                ImportListStationSection listStationSection = listStationSections.Where(l => l.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && l.OldStationID.Equals(z_row.Attributes["ST_KOD"].Value) && l.OldDirectionID.Equals(z_row.Attributes["UP_NOM"].Value)).First();
                                                int pos = int.Parse(km) * 1000 + int.Parse(m);

                                                if (pos < listStationSection.Start_pos)
                                                {
                                                    listStationSection.Start_pos = pos;
                                                    listStationSection.Axis_pos = (listStationSection.Start_pos + listStationSection.Final_pos) / 2;
                                                }
                                                else if (pos > listStationSection.Final_pos)
                                                {
                                                    listStationSection.Final_pos = pos;
                                                    listStationSection.Axis_pos = (listStationSection.Start_pos + listStationSection.Final_pos) / 2;
                                                }
                                            }
                                            else
                                            {
                                                ImportListStationSection listStationSection = new ImportListStationSection
                                                {
                                                    OldTrackID = z_row.Attributes["PUT_NOM"].Value,
                                                    OldStationID = z_row.Attributes["ST_KOD"].Value,
                                                    OldDirectionID = z_row.Attributes["UP_NOM"].Value,
                                                    Start_pos = int.Parse(km) * 1000 + int.Parse(m),
                                                    Axis_pos = int.Parse(km) * 1000 + int.Parse(m),
                                                    Final_pos = int.Parse(km) * 1000 + int.Parse(m),
                                                    Point_id = markID

                                                };
                                                ExportImportService.Execute("insert into adm_list_station_section(put_nom,up_nom,st_kod,start_pos,axis_pos,final_pos,point_id) values ('" + listStationSection.OldTrackID + "','" + listStationSection.OldDirectionID + "','" + listStationSection.OldStationID
                                                    + "','" + listStationSection.Start_pos + "','" + listStationSection.Axis_pos + "','" + listStationSection.Final_pos + "','" + listStationSection.Point_id + "')");
                                                listStationSections.Add(listStationSection);

                                            }
                                        }
                                    }

                                }

                                count = count + 1;

                            }

                        }
                    }
                }

                progressBar.PerformStep();

                foreach (string trackId in listStationSections.GroupBy(l => l.OldTrackID).Select(l => l.Key))
                {
                    foreach (var stationSection in listStationSections.Where(l => l.OldTrackID.Equals(trackId)))
                    {


                        foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "STANKM.xml"))
                        {
                            XmlDocument xmlDocument = new XmlDocument();
                            xmlDocument.Load(file.FullName);
                            XmlElement xmlElement = xmlDocument.DocumentElement;
                            var count = 0;
                            foreach (XmlNode xmlNode in xmlElement)
                            {

                                if (xmlNode.Name == "stankm")
                                {
                                    if (count > 0)
                                        continue;
                                    bool inserted = false;
                                    foreach (XmlNode z_row in xmlNode.ParentNode)
                                    {
                                        bool truestart = true;
                                        bool truefinal = true;

                                        if (z_row.Attributes["UP_NOM"].Value.Equals(stationSection.OldDirectionID) && z_row.Attributes["CODE"].Value.Equals(stationSection.OldStationID))
                                        {

                                            if (z_row.Attributes["CODE"].Value.Equals("941600"))
                                            {

                                            }
                                            int axisKm = int.Parse(z_row.Attributes["KM"].Value);
                                            int axisM = int.Parse(z_row.Attributes["M"].Value);
                                            if (z_row.Attributes["M"].Value == "1" && z_row.Attributes["KM"].Value == "5781")
                                            {

                                            }

                                            int startKm = stationSection.Start_pos / 1000, startM = stationSection.Start_pos % 1000, finalKm = stationSection.Final_pos / 1000, finalM = stationSection.Final_pos % 1000;
                                            string Point_id = stationSection.Point_id;

                                            if (stationSection.Start_pos >= axisKm * 1000 + axisM)
                                            {
                                                startKm = (axisKm * 1000 + axisM - 1) / 1000;
                                                startM = (axisKm * 1000 + axisM - 1) % 1000;
                                                truestart = true;
                                            }

                                            if (stationSection.Final_pos <= axisKm * 1000 + axisM)
                                            {
                                                finalKm = (axisKm * 1000 + axisM + 1) / 1000;
                                                finalM = (axisKm * 1000 + axisM + 1) % 1000;
                                                truefinal = true;
                                            }

                                            var tmp2 = listIDs.Where(tmp => tmp.OldTrackID == (trackId) && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value));
                                            if (z_row.Attributes["UP_NOM"].Value.Equals("24701") && z_row.Attributes["CODE"].Value.Equals("951617"))
                                            {
                                                //лесная 1 1 6139 834 6140 708
                                            }
                                            var trackIDs = tmp2.Select(o => o.NewTrackID).ToList();
                                            long stationID = listIDs.Where(tmp => tmp.OldDirection.ToString() == stationSection.OldDirectionID && tmp.OldDirectionID.ToString() == stationSection.OldStationID).First().NewDirectionID;
                                            if (truefinal == true || truestart == true)
                                            {
                                                foreach (Int64 trackID in trackIDs)
                                                {
                                                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 10").Count() > 0)
                                                    {
                                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 10");
                                                        ExportImportService.Execute("insert into TPL_STATION_SECTION (STATION_ID, PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M, AXIS_KM, AXIS_M, POINT_ID) values (" + stationID.ToString() + ", " + periodID.ToString() + ", " + startKm.ToString() + ", " + startM.ToString() + ", " + finalKm.ToString() + ", " + finalM.ToString() + ", " + axisKm.ToString() + ", " + axisM.ToString() + "," + Point_id + " )");

                                                    }
                                                    else
                                                    {

                                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 10) returning ID");
                                                        ExportImportService.Execute("insert into TPL_STATION_SECTION (STATION_ID, PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M, AXIS_KM, AXIS_M, POINT_ID) values (" + stationID.ToString() + ", " + periodID.ToString() + ", " + startKm.ToString() + ", " + startM.ToString() + ", " + finalKm.ToString() + ", " + finalM.ToString() + ", " + axisKm.ToString() + ", " + axisM.ToString() + "," + Point_id + " )");
                                                    }
                                                }
                                            }

                                            truestart = false;
                                            truefinal = false;
                                            inserted = true;
                                            break;
                                        }
                                        count = count + 1;
                                    }

                                    if (!inserted)
                                    {
                                        var tmp2 = listIDs.Where(tmp => tmp.OldTrackID == (trackId) && tmp.OldDirectionID.ToString() == stationSection.OldStationID);
                                        if (tmp2.Count() < 0)
                                        {
                                            continue;
                                        }
                                        var trackIDs = tmp2.Select(o => o.NewTrackID).ToList();
                                        var listcount = listIDs.Where(tmp => tmp.OldTrackID.ToString() == stationSection.OldTrackID && tmp.OldDirectionID.ToString() == stationSection.OldStationID).Count();
                                        if (listcount < 1)
                                        {
                                            continue;
                                        }
                                        long stationID = listIDs.Where(tmp => tmp.OldTrackID.ToString() == stationSection.OldTrackID && tmp.OldDirectionID.ToString() == stationSection.OldStationID).First().NewDirectionID;
                                        int startKm = stationSection.Start_pos / 1000, startM = stationSection.Start_pos % 1000, finalKm = stationSection.Final_pos / 1000, finalM = stationSection.Final_pos % 1000;
                                        int axisKm = stationSection.Axis_pos / 1000;
                                        int axisM = stationSection.Axis_pos % 1000;
                                        string Point_id = stationSection.Point_id;
                                        if (stationSection.Start_pos == stationSection.Final_pos)
                                        {
                                            startKm = (stationSection.Start_pos - 1) / 1000;
                                            startM = (stationSection.Start_pos - 1) % 1000;
                                            finalKm = (stationSection.Final_pos + 1) / 1000;
                                            finalM = (stationSection.Final_pos + 1) % 1000;
                                        }
                                        foreach (Int64 trackID in trackIDs)
                                        {

                                            if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 10").Count() > 0)
                                            {
                                                Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 10");
                                                ExportImportService.Execute("insert into TPL_STATION_SECTION (STATION_ID, PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M, AXIS_KM, AXIS_M, POINT_ID) values (" + stationID.ToString() + ", " + periodID.ToString() + ", " + startKm.ToString() + ", " + startM.ToString() + ", " + finalKm.ToString() + ", " + finalM.ToString() + ", " + axisKm.ToString() + ", " + axisM.ToString() + "," + Point_id + " )");
                                            }
                                            else
                                            {
                                                Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 10) returning ID");
                                                ExportImportService.Execute("insert into TPL_STATION_SECTION (STATION_ID, PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M, AXIS_KM, AXIS_M, POINT_ID) values (" + stationID.ToString() + ", " + periodID.ToString() + ", " + startKm.ToString() + ", " + startM.ToString() + ", " + finalKm.ToString() + ", " + finalM.ToString() + ", " + axisKm.ToString() + ", " + axisM.ToString() + "," + Point_id + " )");
                                            }
                                        }
                                    }
                                }

                                count = count + 1;

                            }

                        }
                    }
                }

                string sideIDSTR;
                string POINT_IDSTR = "35";
                string markIDSTR = "0";
                sideIDSTR = "0";



                listStationIDs.Clear();
                listStationSections.Clear();
                progressBar.PerformStep();

                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "STR.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "str")
                        {
                            if (count > 0)
                                continue;

                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {

                                string km = z_row.Attributes["KM"].Value;
                                string m = z_row.Attributes["M"].Value;
                                string num = z_row.Attributes["NOM"].Value;
                                string sideID;
                                //string POINT_ID = z_row.Attributes["NOM"].Value;
                                string POINT_ID = "35";
                                string dirID = z_row.Attributes["POSH"].Value;//положение

                                string markID = z_row.Attributes["TYPE"].Value;

                                //sideID = (z_row.Attributes["OTB"].Value);


                                int Sidetype = -1;
                                if (!int.TryParse(z_row.Attributes["OTB"].Value, out Sidetype))
                                    sideID = "0";
                                else
                                {
                                    if (Sidetype == 1)
                                        sideID = "0";
                                    else if (Sidetype == 2)
                                        sideID = "2";
                                    else if (Sidetype == 3)
                                        sideID = "1";
                                    else if (Sidetype == 4)
                                        sideID = "0";
                                    else if (Sidetype == 0)
                                        sideID = "0";
                                    else sideID = "0";
                                }
                                if (z_row.Attributes["UP_NOM"].Value == "94790802" && z_row.Attributes["ST_KOD"].Value == "947908")
                                {

                                }
                                string directionCode = z_row.Attributes["UP_NOM"].Value; //ekasui_ID
                                string numberAsString = directionCode.ToString();
                                string firstSixDigits = "";
                                if (numberAsString.Length >= 6)
                                {
                                    firstSixDigits = numberAsString.Substring(0, 6);
                                    Console.WriteLine("Первые шесть цифр: " + firstSixDigits);
                                }
                                else
                                {
                                    Console.WriteLine("Число имеет менее шести цифр.");
                                }

                                if (z_row.Attributes["UP_NOM"].Value == "94790802" && z_row.Attributes["PUT_NOM"].Value == "10Б")
                                {

                                }
                                if (z_row.Attributes["UP_NOM"].Value == "94790802")
                                {

                                }
                                if (z_row.Attributes["UP_NOM"].Value == "94790802" && z_row.Attributes["PUT_NOM"].Value == "10Б")
                                {

                                }

                                if (z_row.Attributes["UP_NOM"].Value != z_row.Attributes["ST_KOD"].Value && firstSixDigits == z_row.Attributes["ST_KOD"].Value)
                                {
                                    if (listIDs.Where(tmp => (tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value))).Count() > 0)


                                    {
                                        if (z_row.Attributes["M"].Value == "1" && z_row.Attributes["KM"].Value == "5781")
                                        {

                                        }


                                        //var lsitsationId = listIDs.Where(tmp => tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value) && tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value));

                                        //var listSTATid = lsitsationId.Select(o => o.NewDirectionID).ToList();
                                        var listSTATid = ExportImportService.ImportQueryReturnListLong("select ID from adm_station where code = '" + z_row.Attributes["UP_NOM"].Value + "'");



                                        foreach (Int64 stationId in listSTATid)
                                        {

                                            if ((listIDs.Where(tmp => tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value) && tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value)).Count() > 0))
                                            {
                                                Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value) && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;


                                                if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 15 ").Count() > 0)
                                                {
                                                    Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 15");
                                                    ExportImportService.Execute("insert into TPL_SWITCH (PERIOD_ID, KM, METER, NUM, MARK_ID, DIR_ID, SIDE_ID, POINT_ID, station_id) values (" + periodID.ToString() + ", " + km + ", " + m + ", \'" + num + "\', " + markID + ", " + (dirID == "1" ? dirID = "-1" : dirID == "2" ? dirID = "1" : dirID = "0") + ", "
                                                        + sideID + "," + markID + ", " + stationId.ToString() + ")");
                                                }
                                                else
                                                {
                                                    Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 15) returning ID");
                                                    ExportImportService.Execute("insert into TPL_SWITCH (PERIOD_ID, KM, METER, NUM, MARK_ID, DIR_ID, SIDE_ID, POINT_ID, station_id) values (" + periodID.ToString() + ", " + km + ", " + m + ", \'" + num + "\', " + markID + ", " + (dirID == "1" ? dirID = "-1" : dirID == "2" ? dirID = "1" : dirID = "0") + ", "
                                                        + sideID + "," + markID + ", " + stationId.ToString() + ")");
                                                }


                                                if (listStationSections.Where(l => l.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && l.OldStationID.Equals(z_row.Attributes["ST_KOD"].Value) && l.OldParkID.Equals(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                                                {
                                                    if (z_row.Attributes["M"].Value == "1" && z_row.Attributes["KM"].Value == "5781")
                                                    {

                                                    }
                                                    //if ((z_row.Attributes["put_nom"].Value. == 0) || (z_row.Attributes["st_kod"].Value.count() == 0) || (z_row.Attributes["up_nom"].Value.count() == 0))
                                                    //{
                                                    //    continue;
                                                    //}
                                                    ImportListStationSection listStationSection = listStationSections.Where(l => l.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && l.OldStationID.Equals(z_row.Attributes["ST_KOD"].Value) && l.OldParkID.Equals(z_row.Attributes["UP_NOM"].Value)).First();
                                                    int pos = int.Parse(km) * 1000 + int.Parse(m);

                                                    if (pos < listStationSection.Start_pos)
                                                    {
                                                        listStationSection.Start_pos = pos;
                                                        listStationSection.Axis_pos = (listStationSection.Start_pos + listStationSection.Final_pos) / 2;
                                                    }
                                                    else if (pos > listStationSection.Final_pos)
                                                    {
                                                        listStationSection.Final_pos = pos;
                                                        listStationSection.Axis_pos = (listStationSection.Start_pos + listStationSection.Final_pos) / 2;
                                                    }

                                                }
                                                else
                                                {
                                                    var adm_oldirection = ExportImportService.ImportQueryReturnListString($@"Select olddirection from adm_list_station where oldstationid = '{z_row.Attributes["UP_NOM"].Value}' ");
                                                    ImportListStationSection listStationSection = new ImportListStationSection
                                                    {
                                                        OldTrackID = z_row.Attributes["PUT_NOM"].Value,
                                                        OldStationID = z_row.Attributes["ST_KOD"].Value,
                                                        OldDirectionID = adm_oldirection.First().ToString(),
                                                        OldParkID = z_row.Attributes["UP_NOM"].Value,
                                                        Start_pos = int.Parse(km) * 1000 + int.Parse(m),
                                                        Axis_pos = int.Parse(km) * 1000 + int.Parse(m),
                                                        Final_pos = int.Parse(km) * 1000 + int.Parse(m),
                                                        Point_id = markID
                                                        //add km kmstr
                                                        //metert to km in kilometrs

                                                    };
                                                    ExportImportService.Execute("insert into adm_list_station_section(put_nom,up_nom,st_kod,start_pos,axis_pos,final_pos,point_id) values ('" + listStationSection.OldTrackID + "','" + listStationSection.OldDirectionID + "','" + listStationSection.OldStationID
                                                  + "','" + listStationSection.Start_pos + "','" + listStationSection.Axis_pos + "','" + listStationSection.Final_pos + "','" + listStationSection.Point_id + "')");
                                                    listStationSections.Add(listStationSection);
                                                }
                                            }
                                            break;
                                        }
                                        //Int64 stationId = listStationIDs.Where(tmp => tmp.OldStationID == int.Parse(z_row.Attributes["ST_KOD"].Value)).First().NewStationID;
                                    }

                                }


                                count = count + 1;
                            }
                        }
                    }
                }

                progressBar.PerformStep();
                foreach (string trackId in listStationSections.GroupBy(l => l.OldTrackID).Select(l => l.Key))
                {
                    foreach (var stationSection in listStationSections.Where(l => l.OldTrackID.Equals(trackId)))
                    {


                        foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "STANKM.xml"))
                        {
                            XmlDocument xmlDocument = new XmlDocument();
                            xmlDocument.Load(file.FullName);
                            XmlElement xmlElement = xmlDocument.DocumentElement;
                            var count = 0;
                            foreach (XmlNode xmlNode in xmlElement)
                            {

                                if (xmlNode.Name == "stankm")
                                {
                                    if (count > 0)
                                        continue;
                                    bool inserted = false;
                                    foreach (XmlNode z_row in xmlNode.ParentNode)
                                    {
                                        bool truestart = true;
                                        bool truefinal = true;

                                        //if (z_row.Attributes["CODE"].Value.Equals(stationSection.OldStationID))
                                        if (z_row.Attributes["UP_NOM"].Value.Equals(stationSection.OldDirectionID) && z_row.Attributes["CODE"].Value.Equals(stationSection.OldStationID))
                                        {

                                            if (z_row.Attributes["CODE"].Value.Equals("952906"))
                                            {

                                            }
                                            int axisKm = int.Parse(z_row.Attributes["KM"].Value);
                                            int axisM = int.Parse(z_row.Attributes["M"].Value);
                                            if (z_row.Attributes["M"].Value == "1" && z_row.Attributes["KM"].Value == "5781")
                                            {

                                            }

                                            int startKm = stationSection.Start_pos / 1000, startM = stationSection.Start_pos % 1000, finalKm = stationSection.Final_pos / 1000, finalM = stationSection.Final_pos % 1000;
                                            string Point_id = stationSection.Point_id;

                                            if (stationSection.Start_pos >= axisKm * 1000 + axisM)
                                            {
                                                startKm = (axisKm * 1000 + axisM - 1) / 1000;
                                                startM = (axisKm * 1000 + axisM - 1) % 1000;
                                                truestart = true;
                                            }

                                            if (stationSection.Final_pos <= axisKm * 1000 + axisM)
                                            {
                                                finalKm = (axisKm * 1000 + axisM + 1) / 1000;
                                                finalM = (axisKm * 1000 + axisM + 1) % 1000;
                                                truefinal = true;
                                            }

                                            //var tmp2 = listIDs.Where(tmp => tmp.OldTrackID == (trackId) && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value));
                                            var tmp2 = listIDs.Where(tmp => tmp.OldTrackID == (trackId) && tmp.OldDirectionID.ToString() == stationSection.OldParkID);

                                            //if (z_row.Attributes["UP_NOM"].Value.Equals("24701") && z_row.Attributes["CODE"].Value.Equals("951617"))
                                            {
                                                //лесная 1 1 6139 834 6140 708
                                            }
                                            var trackIDs = tmp2.Select(o => o.NewTrackID).ToList();
                                            long stationID = listIDs.Where(tmp => tmp.OldDirection.ToString() == stationSection.OldDirectionID && tmp.OldDirectionID.ToString() == stationSection.OldParkID).First().NewDirectionID;
                                            if (truefinal == true || truestart == true)
                                            {
                                                foreach (Int64 trackID in trackIDs)
                                                {
                                                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 10").Count() > 0)
                                                    {
                                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 10");
                                                        ExportImportService.Execute("insert into TPL_STATION_SECTION (STATION_ID, PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M, AXIS_KM, AXIS_M, POINT_ID) values (" + stationID.ToString() + ", " + periodID.ToString() + ", " + startKm.ToString() + ", " + startM.ToString() + ", " + finalKm.ToString() + ", " + finalM.ToString() + ", " + axisKm.ToString() + ", " + axisM.ToString() + "," + Point_id + " )");

                                                    }
                                                    else
                                                    {

                                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 10) returning ID");
                                                        ExportImportService.Execute("insert into TPL_STATION_SECTION (STATION_ID, PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M, AXIS_KM, AXIS_M, POINT_ID) values (" + stationID.ToString() + ", " + periodID.ToString() + ", " + startKm.ToString() + ", " + startM.ToString() + ", " + finalKm.ToString() + ", " + finalM.ToString() + ", " + axisKm.ToString() + ", " + axisM.ToString() + "," + Point_id + " )");
                                                    }
                                                    break;
                                                }
                                            }

                                            truestart = false;
                                            truefinal = false;
                                            inserted = true;
                                            break;
                                        }
                                        count = count + 1;
                                    }

                                    if (!inserted)
                                    {
                                        var tmp2 = listIDs.Where(tmp => tmp.OldTrackID == (trackId) && tmp.OldDirectionID.ToString() == stationSection.OldStationID);
                                        if (tmp2.Count() < 0)
                                        {
                                            continue;
                                        }
                                        var trackIDs = tmp2.Select(o => o.NewTrackID).ToList();
                                        var listcount = listIDs.Where(tmp => tmp.OldTrackID.ToString() == stationSection.OldTrackID && tmp.OldDirectionID.ToString() == stationSection.OldStationID).Count();
                                        if (listcount < 1)
                                        {
                                            continue;
                                        }
                                        long stationID = listIDs.Where(tmp => tmp.OldTrackID.ToString() == stationSection.OldTrackID && tmp.OldDirectionID.ToString() == stationSection.OldStationID).First().NewDirectionID;
                                        int startKm = stationSection.Start_pos / 1000, startM = stationSection.Start_pos % 1000, finalKm = stationSection.Final_pos / 1000, finalM = stationSection.Final_pos % 1000;
                                        int axisKm = stationSection.Axis_pos / 1000;
                                        int axisM = stationSection.Axis_pos % 1000;
                                        string Point_id = stationSection.Point_id;
                                        if (stationSection.Start_pos == stationSection.Final_pos)
                                        {
                                            startKm = (stationSection.Start_pos - 1) / 1000;
                                            startM = (stationSection.Start_pos - 1) % 1000;
                                            finalKm = (stationSection.Final_pos + 1) / 1000;
                                            finalM = (stationSection.Final_pos + 1) % 1000;
                                        }
                                        foreach (Int64 trackID in trackIDs)
                                        {

                                            if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 10").Count() > 0)
                                            {
                                                Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 10");
                                                ExportImportService.Execute("insert into TPL_STATION_SECTION (STATION_ID, PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M, AXIS_KM, AXIS_M, POINT_ID) values (" + stationID.ToString() + ", " + periodID.ToString() + ", " + startKm.ToString() + ", " + startM.ToString() + ", " + finalKm.ToString() + ", " + finalM.ToString() + ", " + axisKm.ToString() + ", " + axisM.ToString() + "," + Point_id + " )");
                                            }
                                            else
                                            {
                                                Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 10) returning ID");
                                                ExportImportService.Execute("insert into TPL_STATION_SECTION (STATION_ID, PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M, AXIS_KM, AXIS_M, POINT_ID) values (" + stationID.ToString() + ", " + periodID.ToString() + ", " + startKm.ToString() + ", " + startM.ToString() + ", " + finalKm.ToString() + ", " + finalM.ToString() + ", " + axisKm.ToString() + ", " + axisM.ToString() + "," + Point_id + " )");
                                            }
                                        }
                                    }
                                }

                                count = count + 1;

                            }

                        }
                    }
                }



                listStationSections.Clear();



                progressBar.PerformStep();



                listStationIDs.Clear();
                listStationSections.Clear();
                progressBar.PerformStep();

                var liscrosstie = ExportImportService.ImportQueryReturnListImportedElevation($@"SELECT * from ekasui_gb ORDER BY start_km,start_m");

                var start_km_liscrosstie = 0;
                var start_km_next_liscrosstie = 0;
                var start_m_liscrosstie = 0;
                var start_m_next_liscrosstie = 0;
                var final_km_liscrosstie = 0;
                var final_km_next_liscrosstie = 0;
                var final_m_liscrosstie = 0;
                var final_m_next_liscrosstie = 0;

                var crosstieID_liscrosstie = 0;


                var curve_napr_liscrosstie = 0;
                var curve_put_liscrosstie = "";
                for (int g = 0; g < liscrosstie.Count() - 1; g += 1)
                {

                    curve_napr_liscrosstie = liscrosstie[g].Up_nom;
                    curve_put_liscrosstie = liscrosstie[g].Put_nom;
                    start_km_liscrosstie = int.Parse(liscrosstie[g].start_km);
                    start_m_liscrosstie = int.Parse(liscrosstie[g].start_m);
                    final_km_liscrosstie = int.Parse(liscrosstie[g].final_km);
                    final_m_liscrosstie = int.Parse(liscrosstie[g].final_m);
                    final_km_next_liscrosstie = int.Parse(liscrosstie[g + 1].final_km);
                    start_m_next_liscrosstie = int.Parse(liscrosstie[g + 1].start_m);
                    start_km_next_liscrosstie = int.Parse(liscrosstie[g + 1].start_km);
                    crosstieID_liscrosstie = liscrosstie[g].Type;

                    if (final_km_liscrosstie == start_km_next_liscrosstie && final_m_liscrosstie == start_m_next_liscrosstie)
                    {
                        final_m_liscrosstie = final_m_liscrosstie - 1;


                    }





                    if (listIDs.Where(tmp => tmp.OldTrackID == curve_put_liscrosstie && tmp.OldDirectionID == curve_napr_liscrosstie).Count() > 0)
                    {
                        Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == curve_put_liscrosstie && tmp.OldDirectionID == curve_napr_liscrosstie).First().NewTrackID;
                        if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 1").Count() > 0)
                        {
                            Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 1");
                            ExportImportService.Execute("insert into APR_CROSSTIE (PERIOD_ID, CROSSTIE_TYPE_ID, START_KM, START_M, FINAL_KM, FINAL_M) values (" + periodID.ToString() + ", " + crosstieID_liscrosstie + ", " + start_km_liscrosstie + ", " + start_m_liscrosstie + ", " + final_km_liscrosstie + ", " + final_m_liscrosstie + ")");
                        }
                        else
                        {
                            Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 1) returning ID");
                            ExportImportService.Execute("insert into APR_CROSSTIE (PERIOD_ID, CROSSTIE_TYPE_ID, START_KM, START_M, FINAL_KM, FINAL_M) values (" + periodID.ToString() + ", " + crosstieID_liscrosstie + ", " + start_km_liscrosstie + ", " + start_m_liscrosstie + ", " + final_km_liscrosstie + ", " + final_m_liscrosstie + ")");
                        }
                    }
                }
                progressBar.PerformStep();
                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "KM.xml"))//ГОТОВО
                {
                    using (StreamWriter outputFile = new StreamWriter(logFile, true))
                    {
                        outputFile.WriteLine("KM.xml");
                    }
                    var count = 0;
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "km")
                        {
                            if (count > 0)
                                continue;
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {
                                string km = z_row.Attributes["KM"].Value;
                                string length = z_row.Attributes["END_M"].Value;
                                string length2 = z_row.Attributes["LENGTH"].Value;
                                string start = z_row.Attributes["BEGIN_M"].Value;
                                string final = z_row.Attributes["END_M"].Value;
                                string UP_NOM = z_row.Attributes["UP_NOM"].Value;
                                string PUT_NOM = z_row.Attributes["PUT_NOM"].Value;
                                if (listIDs.Where(tmp => (tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value)) && (tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)) && length != "1000").Count() > 0)
                                {
                                    try
                                    {
                                        Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                                        if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 2").Count() > 0)
                                        {
                                            Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 2");
                                            ExportImportService.Execute("insert into TPL_NST_KM (PERIOD_ID, KM, LEN) values (" + periodID.ToString() + ", " + km + ", " + length + ")");
                                        }
                                        else
                                        {
                                            Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values " +
                                                "(" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 2) returning ID");
                                            ExportImportService.Execute("insert into TPL_NST_KM (PERIOD_ID, KM, LEN) values (" + periodID.ToString() + ", " + km + ", " + length + ")");
                                        }
                                    }
                                    catch (Exception e)
                                    {
                                        using (StreamWriter outputFile = new StreamWriter(logFile, true))
                                        {
                                            outputFile.WriteLine(z_row.Attributes["PUT_NOM"].Value + ", km: " + z_row.Attributes["KM"].Value + ", len: " + z_row.Attributes["END_M"].Value);
                                            outputFile.WriteLine(e.Message);
                                        }
                                    }
                                }
                                else
                                {
                                    using (StreamWriter outputFile = new StreamWriter(logFile, true))
                                    {
                                        outputFile.WriteLine(z_row.Attributes["PUT_NOM"].Value + ", km: " + z_row.Attributes["KM"].Value + ", len: " + z_row.Attributes["END_M"].Value);
                                        outputFile.WriteLine("Путь по ID не найден");
                                    }
                                }
                                count = count + 1;
                            }
                        }
                    }

                    using (StreamWriter outputFile = new StreamWriter(logFile, true))
                    {
                        outputFile.WriteLine();
                    }
                }

                progressBar.PerformStep();


                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "NAKL.xml"))//ГОТОВО
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "nakl")
                        {
                            if (count > 0)
                                continue;
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {

                                string Type = z_row.Attributes["TYPE"].Value;//track расположение на фрагментах
                                int nakl = 0;


                                switch (Type)
                                {
                                    case "0":
                                        nakl = 2;
                                        //KB
                                        break;
                                    case "1":
                                        nakl = 1;
                                        //ARS
                                        break;
                                    case "2":
                                        nakl = 3;
                                        //ЖБР
                                        break;


                                }
                                ///в таблицы доабвить ПЕРИУД АЙДИ

                                if (listIDs.Where(tmp => tmp.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                                {

                                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 16").Count() > 0)
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 16");
                                        ExportImportService.Execute("insert into apr_long_rails (PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M,type_id) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + "," + nakl + ")");
                                    }
                                    else
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 16) returning ID");
                                        ExportImportService.Execute("insert into apr_long_rails (PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M,type_id) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + "," + nakl + ")");
                                    }
                                }
                                count = count + 1;
                            }
                        }
                    }
                }

                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "CTRLUCH.xml"))//Готово
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "ctrluch")
                        {
                            if (count > 0)
                                continue;
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {
                                int type = int.Parse(z_row.Attributes["TYPE"].Value);

                                //0-левая 1- правая в ебпд
                                //у нас 1-правая 2 левая
                                string avg_lev = z_row.Attributes["UR_MO"].Value; // Ваша строка

                                if (avg_lev.StartsWith("-"))
                                {
                                    // Строка начинается с минуса, убираем его
                                    avg_lev = avg_lev.Substring(1);
                                }
                                else
                                {
                                    // Строка не начинается с минуса, добавляем его
                                    avg_lev = "-" + avg_lev;
                                }

                                //avg_level = avg_level.ToString();

                                //type 0 =Контрольный
                                //type 1 = Юстировочный
                                if (listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                                {
                                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 28").Count() > 0)
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 28");
                                        ExportImportService.Execute("insert into tpl_check_sections (PERIOD_ID, start_km, start_m, final_km, final_m, avg_width, avg_level, sko_width, sko_level,type) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + ", " + z_row.Attributes["SH_MO"].Value + ", " + avg_lev + ", " + z_row.Attributes["SH_SKO"].Value + ", " + z_row.Attributes["UR_SKO"].Value + ", " + type + ")");
                                    }
                                    else
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 28) returning ID");
                                        ExportImportService.Execute("insert into tpl_check_sections (PERIOD_ID, start_km, start_m, final_km, final_m, avg_width, avg_level, sko_width, sko_level,type) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + ", " + z_row.Attributes["SH_MO"].Value + ", " + avg_lev + ", " + z_row.Attributes["SH_SKO"].Value + ", " + z_row.Attributes["UR_SKO"].Value + ", " + type + ")");
                                    }
                                }
                                count = count + 1;
                            }
                        }
                    }
                }

                progressBar.PerformStep();
                var listup_nom = listIDs.Select(o => o.OldDirectionID);


                var containss = ExportImportService.ImportQueryReturnListImportedCurvedelete("SELECT kmn as startkm,mn as startm,* from ekasui_curves ORDER BY assetnum,kmn,mn");
                if (containss.Count() > 0)
                {

                    for (int i = 0; i < containss.Count() - 1; i++)
                    {
                        if ((containss[i].StartKM == containss[i + 1].StartKM) && (Math.Abs(int.Parse(containss[i].StartM) - int.Parse(containss[i + 1].StartM)) < 2)
                            && (containss[i].Assetnum == containss[i + 1].Assetnum))
                        {
                            ExportImportService.Execute($@"DELETE FROM ekasui_curves where kmn={ containss[i].StartKM} and mn={containss[i].StartM} ");
                        }
                    }

                }



                var listoldirection = ExportImportService.ImportQueryReturnListImportedElevation($@"SELECT DISTINCT up_nom from ekasui_non_ext    GROUP BY UP_nom");
                //var listoldirection = ExportImportService.ImportQueryReturnListImportedElevation($@"SELECT code as up_nom from adm_direction ORDER BY code");
                var listoldtrack = ExportImportService.ImportQueryReturnListImportedElevation($@"SELECT DISTINCT put_nom from ekasui_non_ext    GROUP BY put_nom");

                //foreach (var upnom in listoldirection)//для ширины колеии
                //{

                //    foreach (var putnom in listoldtrack)
                //    {
                //        var listcurve = ExportImportService.ImportQueryReturnListImportedElevation($@"SELECT
                //                                                                                     selected.start_km,
                //                                                                                     selected.start_m,
                //                                                                                     selected.final_km,
                //                                                                                     selected.final_m,
                //                                                                                     selected.width,
                //                                                                                     selected.up_nom,
                //                                                                                        selected.put_nom	
                //                                                                                    FROM
                //                                                                                     (
                //                                                                                     SELECT
                //                                                                                      ast.start_km,
                //                                                                                      ast.start_m,
                //                                                                                      ast.final_km,
                //                                                                                      ast.final_m,
                //                                                                                      ast.width,
                //                                                                                      ac.up_nom,
                //                                                                                      ac.put_nom,
                //                                                                                      ROW_NUMBER ( ) OVER ( PARTITION BY curve_id ORDER BY ac.ID ASC ) rn 
                //                                                                                     FROM
                //                                                                                      apr_curve AS ac
                //                                                                                      INNER JOIN apr_stcurve AS ast ON ac.ID = ast.curve_id 
                //                                                                                     WHERE
                //                                                                                      ac.up_nom = '{upnom.Up_nom}' 
                //                                                                                      AND ac.put_nom = '{putnom.Put_nom}' 
                //                                                                                      AND ast.width > 1520 
                //                                                                                     ORDER BY
                //                                                                                      ast.start_km,
                //                                                                                      ast.start_m 
                //                                                                                     ) AS selected 
                //                                                                                    WHERE
                //                                                                                     rn = 1");
                //        var listKM = ExportImportService.ImportQueryReturnListImportedElevation($@"SELECT* from ekasui_non_ext WHERE up_nom = '{upnom.Up_nom}' and put_nom = '{putnom.Put_nom}' ORDER BY km,start_m,final_m");
                //        var norma = "1520";


                //        string startkm, startM, finalM, finalKm;

                //        if (listKM.Count() == 0)
                //        {
                //            continue;
                //        }
                //        if (listcurve.Count() != 0)
                //        {
                //            startkm = listKM.Select(o => o.Km).First();
                //            startM = listKM.Select(o => o.start_m).First();
                //            finalKm = listKM.Select(o => o.Km).Last();
                //            finalM = listKM.Select(o => o.final_m).Last();

                //            if (listIDs.Where(tmp => tmp.OldTrackID == putnom.Put_nom && tmp.OldDirectionID == upnom.Up_nom).Count() > 0)
                //            {

                //                Int64 trackIDanw = listIDs.Where(tmp => tmp.OldTrackID == putnom.Put_nom && tmp.OldDirectionID == upnom.Up_nom).First().NewTrackID;
                //                if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackIDanw.ToString() + " and MTO_TYPE = 5").Count() > 0)
                //                {
                //                    Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackIDanw.ToString() + " and MTO_TYPE = 5");
                //                    ExportImportService.Execute("insert into apr_norma_width (PERIOD_ID, start_km, start_m, final_km, final_m, norma_width) values (" + periodID.ToString() + ", "
                //                        + startkm + ", " + startM + ", " + finalKm + ", " + finalM + "," + norma + ")");
                //                }
                //                else
                //                {
                //                    Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackIDanw.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 5) returning ID");
                //                    ExportImportService.Execute("insert into apr_norma_width (PERIOD_ID, start_km, start_m, final_km, final_m, norma_width) values (" + periodID.ToString() + ", "
                //                            + startkm + ", " + startM + ", " + finalKm + ", " + finalM + "," + norma + ")");
                //                }

                //            }
                //            continue;
                //        }


                //        startkm = listKM.Select(o => o.Km).First();
                //        startM = listKM.Select(o => o.start_m).First();
                //        finalM = listcurve.Select(o => o.start_m).First();
                //        finalKm = listcurve.Select(o => o.start_km).First();

                //        for (int i = 1; i < listcurve.Count() - 1; i++)
                //        {
                //            if (i > 0)
                //            {
                //                startkm = listcurve[i - 1].final_km;
                //                startM = listcurve[i - 1].final_m;
                //                finalKm = listcurve[i].start_km;
                //                finalM = listcurve[i].start_m;
                //            }
                //            if (i == listcurve.Count() - 1)
                //            {
                //                startkm = listcurve[i - 1].final_km;
                //                startM = listcurve[i - 1].final_m;
                //                finalKm = listKM.Select(o => o.Km).Last();
                //                finalM = listKM.Select(o => o.final_m).Last();
                //            }

                //            if ((Math.Abs(int.Parse(startkm) - int.Parse(finalKm)) * 1000 + Math.Abs(int.Parse(startM) - int.Parse(finalM))) >= 25)
                //            {
                //                if (listIDs.Where(tmp => tmp.OldTrackID == listcurve[i].Put_nom && tmp.OldDirectionID == listcurve[i].Up_nom).Count() > 0)
                //                {
                //                    Int64 trackIDanw = listIDs.Where(tmp => tmp.OldTrackID == listcurve[i].Put_nom && tmp.OldDirectionID == listcurve[i].Up_nom).First().NewTrackID;
                //                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackIDanw.ToString() + " and MTO_TYPE = 5").Count() > 0)
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackIDanw.ToString() + " and MTO_TYPE = 5");
                //                        ExportImportService.Execute("insert into apr_norma_width (PERIOD_ID, start_km, start_m, final_km, final_m, norma_width) values (" + periodID.ToString() + ", "
                //                            + startkm + ", " + startM + ", " + finalKm + ", " + finalM + "," + norma + ")");
                //                    }
                //                    else
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackIDanw.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 5) returning ID");
                //                        ExportImportService.Execute("insert into apr_norma_width (PERIOD_ID, start_km, start_m, final_km, final_m, norma_width) values (" + periodID.ToString() + ", "
                //                               + startkm + ", " + startM + ", " + finalKm + ", " + finalM + "," + norma + ")");
                //                    }
                //                }
                //            }

                //        }
                //    }
                //}
                //foreach (var upnom in listoldirection)//Для несуществующих
                //{

                //    foreach (var putnom in listoldtrack)
                //    {

                //        var list = ExportImportService.ImportQueryReturnListImportedElevation($@"SELECT* from ekasui_non_ext WHERE up_nom = '{upnom.Up_nom}'  ORDER BY km");

                //        //var list = ExportImportService.ImportQueryReturnListImportedElevation($@"SELECT* from ekasui_non_ext WHERE up_nom = '{upnom.Up_nom}' and put_nom = '{putnom.Put_nom}' ORDER BY km");

                //        for (int i = 0; i < list.Count() - 1; i++)
                //        {
                //            if ((Math.Abs(int.Parse(list[i].Km) - int.Parse(list[i + 1].Km)) == 1) || (Math.Abs(int.Parse(list[i].Km) - int.Parse(list[i + 1].Km)) == 0))
                //                continue;

                //            var non_ext_km = (int.Parse(list[i].Km) + 1).ToString();

                //            if (list[i].Put_nom == null || list[i].Up_nom == null)

                //            {
                //                continue;

                //            }
                //            Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == list[i].Put_nom && tmp.OldDirectionID == list[i].Up_nom).First().NewTrackID;
                //            if (trackID == 0)
                //            {
                //                continue;
                //            }
                //            if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 18").Count() > 0)
                //            {
                //                Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 18");
                //                ExportImportService.Execute("insert into TPL_NON_EXT_KM (PERIOD_ID, KM) values (" + periodID.ToString() + ", " + non_ext_km + ")");
                //            }
                //            else
                //            {
                //                Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 18) returning ID");
                //                ExportImportService.Execute("insert into TPL_NON_EXT_KM (PERIOD_ID, KM) values (" + periodID.ToString() + ", " + non_ext_km + ")");
                //            }

                //        }
                //    }
                //}




                var list_not_filt_arp_curve = ExportImportService.ImportQueryReturnListImportedCurve($@"
                     SELECT  up_nom as OldDirectionID ,put_nom as  OldTrackID,* from ekasui_plan_rightlevel  where type=0   ORDER BY up_nom,put_nom,km,m");
                var filter_Curves = new List<ImportListCurveID>();
                var multi_filter_Curve_start = new List<ImportListCurveID>();
                //bool isMultiCurve = false;
                ImportListCurveID filter_Curve = new ImportListCurveID();
                //ImportListCurveID multi_filter_Curve_start = new ImportListCurveID();

                int i_filter = 0;
                var prom_curve = new List<ImportListCurveID>();
                var distinctCurves_filter = new List<ImportListCurveID>();
                bool isMultiCurve_filter = false;
                bool isMultiCurvestart = false;
                ImportListCurveID multiCurve_filter = new ImportListCurveID();

                List<ImportListCurveID> listStIDs = new List<ImportListCurveID>();
                List<ImportListCurveID> listLevelIDs = new List<ImportListCurveID>();
                List<ImportListCurveID> missingCurves = new List<ImportListCurveID>();




                //var g = 0;
                var flagstart = false;
                var flagfinal = false;

                var frst_curve = "";
                var next_curve = "";
                var curve_direction = 0;
                var curve_direction_next = 0;
                var curve_put = "";
                var curve_put_next = "";

                //foreach (var curves in list_not_filt_arp_curve)
                for (int g = 0; g < list_not_filt_arp_curve.Count() - 1; g += 1)
                {

                    frst_curve = "";
                    next_curve = "";
                    curve_direction = 0;
                    curve_direction_next = 0;
                    curve_put = "";
                    curve_put_next = "";

                    frst_curve = list_not_filt_arp_curve[g].Radius;
                    next_curve = list_not_filt_arp_curve[g + 1].Radius;
                    curve_direction = list_not_filt_arp_curve[g].OldDirectionID;
                    curve_direction_next = list_not_filt_arp_curve[g + 1].OldDirectionID;
                    curve_put = list_not_filt_arp_curve[g].OldTrackID;
                    curve_put_next = list_not_filt_arp_curve[g + 1].OldTrackID;

                    if (int.Parse(frst_curve) == 0 && int.Parse(next_curve) != 0 && flagstart == false && curve_direction == curve_direction_next && curve_put == curve_put_next)
                    {
                        multiCurve_filter.StartKM = list_not_filt_arp_curve[g].Km;
                        multiCurve_filter.StartM = list_not_filt_arp_curve[g].M;

                        multiCurve_filter.OldDirectionID = list_not_filt_arp_curve[g].OldDirectionID;
                        multiCurve_filter.OldTrackID = list_not_filt_arp_curve[g].OldTrackID;



                        flagstart = true;
                    }
                    if (int.Parse(frst_curve) != 0 && int.Parse(next_curve) != 0 && flagstart)
                    {

                    }
                    if (int.Parse(frst_curve) != 0 && int.Parse(next_curve) == 0 && flagstart)
                    {

                        multiCurve_filter.FinalKM = list_not_filt_arp_curve[g + 1].Km;
                        multiCurve_filter.FinalM = list_not_filt_arp_curve[g + 1].M;
                        multiCurve_filter.SHAB = list_not_filt_arp_curve[g + 1].SHAB;
                        if (int.Parse(frst_curve) > 0)
                        {
                            multiCurve_filter.napr = 2;//левая

                        }
                        if (int.Parse(frst_curve) < 0)
                        {
                            multiCurve_filter.napr = 1;//правая

                        }
                        distinctCurves_filter.Add(multiCurve_filter);
                        multiCurve_filter = new ImportListCurveID();
                        isMultiCurvestart = false;
                        isMultiCurve_filter = false;
                        flagstart = false;
                    }



                }




                List<long> apr_curveIds = new List<long>();
                foreach (var aprcurve in distinctCurves_filter)
                {
                    //0-левая 1- правая в ебпд
                    //у нас 1-правая 2 левая
                    if (listIDs.Where(tmp => tmp.OldDirectionID == aprcurve.OldDirectionID && tmp.OldTrackID == aprcurve.OldTrackID.ToString()).Count() > 0)
                    {
                        Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == aprcurve.OldTrackID.ToString() && tmp.OldDirectionID == aprcurve.OldDirectionID).First().NewTrackID;
                        if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 11").Count() > 0)
                        {
                            Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 11");
                            apr_curveIds.Add(ExportImportService.ImportQueryReturnLong("insert into apr_curve(PERIOD_ID, start_km, start_m, final_km, final_m, side_id,up_nom,put_nom)  values (" + periodID.ToString() + ", " + int.Parse(aprcurve.StartKM) + ", " + int.Parse(aprcurve.StartM) + ", " + int.Parse(aprcurve.FinalKM) + ", " + int.Parse(aprcurve.FinalM)
                                + "," + (aprcurve.napr) + ",'" + aprcurve.OldDirectionID + "','" + aprcurve.OldTrackID + "') returning ID"));
                        }

                        else
                        {
                            Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 11) returning ID");
                            apr_curveIds.Add(ExportImportService.ImportQueryReturnLong("insert into apr_curve(PERIOD_ID, start_km, start_m, final_km, final_m, side_id,up_nom,put_nom)  values (" + periodID.ToString() + ", " + int.Parse(aprcurve.StartKM) + ", " + int.Parse(aprcurve.StartM) + ", " + int.Parse(aprcurve.FinalKM) + ", " + int.Parse(aprcurve.FinalM)
                                + "," + (aprcurve.napr) + ",'" + aprcurve.OldDirectionID + "','" + aprcurve.OldTrackID + "') returning ID"));
                        }
                    }

                }



                var distinctCurves = new List<ImportListCurveID>();
                bool isMultiCurve = false;

                ImportListCurveID multiCurve = new ImportListCurveID();


                ImportListStCurve listStCurve = new ImportListStCurve();
                ImportListElCurve listElCurve = new ImportListElCurve();
                List<long> curveIds = new List<long>();




                int curveIdIndex = -1;
                isMultiCurve = false;
                multiCurve = new ImportListCurveID();



                Int64 curveID = 0;

                foreach (var aprcurve in distinctCurves_filter)
                {
                    if (listIDs.Where(tmp => tmp.OldDirectionID == aprcurve.OldDirectionID && tmp.OldTrackID == aprcurve.OldTrackID.ToString()).Count() > 0 == false)
                    {
                        continue;
                    }

                    curveIdIndex++;
                    curveID = 0;
                    if (apr_curveIds.Count() > 0 && curveIdIndex < apr_curveIds.Count())
                    {
                        curveID = apr_curveIds[curveIdIndex];
                    }
                    else
                    {
                        break;
                    }

                    if (aprcurve.StartKM == "6539" && aprcurve.StartM == "65")
                    {

                    }

                    var first_len = 0;
                    var last_len = 0;


                    listStIDs = RdStructureService.Get_list_St_IDs_Curves(aprcurve.StartKM,
                          aprcurve.StartM, aprcurve.FinalKM, aprcurve.FinalM, aprcurve.OldDirectionID, aprcurve.OldTrackID, first_len, last_len, 0);

                    if (listStIDs != null)
                    {
                        if (listStIDs.Count() == 0) continue;
                        first_len = 0;
                        last_len = 0;

                        ///////////////////

                        bool t1 = true;
                        bool t2 = false;

                        var act_start_m = "-1";
                        var act_final_m = "-1";
                        //////////////////////////////////////
                        var vershInd = 0;



                        while (vershInd < listStIDs.Count() - 1)
                        {
                            var currRiht = Math.Abs(int.Parse(listStIDs[vershInd].Radius));
                            var nextRiht = Math.Abs(int.Parse(listStIDs[vershInd + 1].Radius));

                            if (nextRiht - currRiht == 0)
                            {
                                vershInd++;
                                continue;
                            }


                            var kilometr = ExportImportService.ImportQueryReturnListImportedCurve($@"select start_m as StartM,final_m as FinalM,*  from apr_km where up_nom = '{listStIDs[vershInd].OldDirectionID}' and put_nom='{listStIDs[vershInd].OldTrackID}' and km='{listStIDs[vershInd].Km}' ");
                            var kilometr_next = ExportImportService.ImportQueryReturnListImportedCurve($@"select start_m as StartM,final_m as FinalM,*  from apr_km where up_nom = '{listStIDs[vershInd + 1].OldDirectionID}' and put_nom='{listStIDs[vershInd + 1].OldTrackID}' and km='{listStIDs[vershInd + 1].Km}' ");

                            var kilometr_plan_level = ExportImportService.ImportQueryReturnListImportedCurve($@"SELECT * from ekasui_plan_rightlevel where km = '{listStIDs[vershInd].Km}'  and up_nom='{listStIDs[vershInd + 1].OldDirectionID}' and put_nom ='{listStIDs[vershInd + 1].OldTrackID}' ORDER BY m");

                            if ((nextRiht - currRiht > 0
                                && (aprcurve.napr == 1 || aprcurve.napr == 0)) || (nextRiht / (Math.Pow(nextRiht, 2) + 0.001) - currRiht / (Math.Pow(currRiht, 2) + 0.001) > 0 && aprcurve.napr == 2))
                            {
                                if (t1)
                                {
                                    if (act_start_m == "-1")
                                    {
                                        act_start_m = listStIDs[vershInd].M;
                                    }

                                    if ((listStIDs[vershInd].Km == listStIDs[vershInd + 1].Km) || kilometr.Count() == 0 || kilometr_next.Count() == 0)
                                    {
                                        listStCurve.T1 = (int.Parse(listStIDs[vershInd + 1].Km.ToString()) * 1000 +
                                                            int.Parse(listStIDs[vershInd + 1].M.ToString())) -
                                                           (int.Parse(listStIDs[vershInd].Km.ToString()) * 1000 +
                                                            int.Parse(listStIDs[vershInd].M.ToString()));
                                        if (listStCurve.T1.ToString().Contains("-") || listStCurve.T2.ToString().Contains("-"))
                                        {

                                        }
                                        if (listStCurve.T1.ToString().Contains("-")) break;
                                    }
                                    else
                                    {
                                        listStCurve.T1 = (int.Parse(kilometr.First().FinalM.ToString())) -
                                                        (int.Parse(listStIDs[vershInd].M.ToString())) +
                                                        (int.Parse(listStIDs[vershInd + 1].M.ToString())) -
                                                        (int.Parse(kilometr_next.First().StartM.ToString()));
                                        if (listStCurve.T1.ToString().Contains("-") || listStCurve.T2.ToString().Contains("-"))
                                        {

                                        }
                                        if (listStCurve.T1.ToString().Contains("-")) break;
                                    }

                                    listStCurve.StartKM = listStIDs[vershInd].Km;
                                    listStCurve.StartM = listStIDs[vershInd].M;
                                }
                                else
                                {
                                    listStCurve.T2 = 0;
                                    listStCurve.FinalKM = listStIDs[vershInd].Km;
                                    listStCurve.FinalM = listStIDs[vershInd].M;
                                    act_final_m = listStIDs[vershInd].M;
                                }
                            }
                            else
                            {
                                if (t2)
                                {
                                    if ((listStIDs[vershInd].Km == listStIDs[vershInd + 1].Km) || kilometr.Count() == 0 || kilometr_next.Count() == 0)
                                    {
                                        listStCurve.T2 = (int.Parse(listStIDs[vershInd + 1].Km.ToString()) * 1000 +
                                                            int.Parse(listStIDs[vershInd + 1].M.ToString())) -
                                                           (int.Parse(listStIDs[vershInd].Km.ToString()) * 1000 +
                                                            int.Parse(listStIDs[vershInd].M.ToString()));
                                        if (listStCurve.T2.ToString().Contains("-")) break;
                                    }
                                    else
                                    {
                                        listStCurve.T2 = (int.Parse(kilometr.First().FinalM.ToString())) -
                                                        (int.Parse(listStIDs[vershInd].M.ToString())) +
                                                        (int.Parse(listStIDs[vershInd + 1].M.ToString())) -
                                                        (int.Parse(kilometr_next.First().StartM.ToString()));
                                        if (listStCurve.T2.ToString().Contains("-")) break;
                                    }

                                    listStCurve.FinalKM = listStIDs[vershInd + 1].Km;
                                    listStCurve.FinalM = listStIDs[vershInd + 1].M;
                                    act_final_m = listStIDs[vershInd + 1].M;
                                }
                                else
                                {
                                    if (act_start_m == "-1")
                                    {
                                        act_start_m = listStIDs[vershInd + 1].M;
                                    }
                                    listStCurve.T1 = 0;
                                    listStCurve.StartKM = listStIDs[vershInd + 1].Km;
                                    listStCurve.StartM = listStIDs[vershInd + 1].M;
                                }
                            }

                            if (t2)
                            {

                                if (listStCurve.T2 == 0 && listStCurve.T1 == 0 && int.Parse(listStIDs[vershInd].Radius) == 0)
                                {

                                    vershInd += 2;
                                    continue;
                                }
                                listStCurve.SideID = aprcurve.napr.ToString();
                                listStCurve.Width = listStIDs[vershInd].SHAB;
                                listStCurve.Wear = listStIDs[vershInd].IZN;
                                listStCurve.Radius = Math.Abs(int.Parse(listStIDs[vershInd].Radius)).ToString();//рихтовка
                                listStCurve.OldTrackID = aprcurve.OldTrackID;

                                String StCurveInsertString = "insert into apr_stcurve (curve_id, start_km, start_m, final_km, final_m, radius, transition_1, transition_2, width, wear) values ("
                                        + curveID.ToString() + ", " + listStCurve.StartKM + ", " + listStCurve.StartM + ", " + listStCurve.FinalKM + ", " + listStCurve.FinalM + ", " + listStCurve.Radius + ", "
                                        + listStCurve.T1 + ", " + listStCurve.T2 + ", " + listStCurve.Width + ", " + listStCurve.Wear + ")";

                                ExportImportService.Execute(StCurveInsertString);
                            }
                            else
                            {
                                vershInd += 2;
                            }

                            t2 = !t2;
                            t1 = !t1;
                        }

                        listStIDs.Clear();
                    }




                }


                missingCurves.Clear();

                curveIdIndex = -1;

                foreach (var aprcurve in distinctCurves_filter)
                {
                    if (listIDs.Where(tmp => tmp.OldDirectionID == aprcurve.OldDirectionID && tmp.OldTrackID == aprcurve.OldTrackID.ToString()).Count() > 0 == false)
                    {
                        continue;
                    }
                    curveIdIndex++;


                    curveID = 0;
                    if (apr_curveIds.Count() > 0 && curveIdIndex < apr_curveIds.Count())
                    {
                        curveID = apr_curveIds[curveIdIndex];
                    }
                    else
                    {
                        break;
                    }





                    var first_len = 0;
                    var last_len = 0;
                    if (aprcurve.StartKM == "6195")
                    {

                    }
                    if (aprcurve.FinalKM == "6912")
                    {

                    }
                    listLevelIDS = RdStructureService.Get_list_St_IDs_Curves(aprcurve.StartKM,
                         aprcurve.StartM, aprcurve.FinalKM, aprcurve.FinalM, aprcurve.OldDirectionID, aprcurve.OldTrackID, first_len, last_len, 1);

                    //if (listLevelIDS.Count() == 0)
                    //{

                    //}
                    //else 
                    //{

                    //}

                    if (listLevelIDS != null && listLevelIDS.Count() != 0)
                    {
                        var vershInd = 0;
                        bool t1 = true;
                        bool t2 = false;
                        while (vershInd < listLevelIDS.Count() - 1)
                        {
                            var currRiht = Math.Abs(float.Parse(listLevelIDS[vershInd].Urov, CultureInfo.InvariantCulture.NumberFormat));
                            var nextRiht = Math.Abs(float.Parse(listLevelIDS[vershInd + 1].Urov, CultureInfo.InvariantCulture.NumberFormat));

                            if (nextRiht - currRiht == 0)
                            {
                                vershInd++;
                                continue;
                            }

                            var kilometr = ExportImportService.ImportQueryReturnListImportedCurve($@"select start_m as StartM,final_m as FinalM,* from apr_km where up_nom = '{listLevelIDS[vershInd].OldDirectionID}' and put_nom='{listLevelIDS[vershInd].OldTrackID}' and km='{listLevelIDS[vershInd].Km}' ");
                            var kilometr_next = ExportImportService.ImportQueryReturnListImportedCurve($@"select start_m as StartM,final_m as FinalM,*  from apr_km where up_nom = '{listLevelIDS[vershInd + 1].OldDirectionID}' and put_nom='{listLevelIDS[vershInd + 1].OldTrackID}' and km='{listLevelIDS[vershInd + 1].Km}' ");


                            if ((nextRiht - currRiht > 0 && (aprcurve.napr == 1 || aprcurve.napr == 0))
                                    || (nextRiht / (Math.Pow(nextRiht, 2) + 0.001) - currRiht / (Math.Pow(currRiht, 2) + 0.001) > 0 && aprcurve.napr == 2)

                                    )

                            {
                                if (t1)
                                {
                                    if ((listLevelIDS[vershInd].Km == listLevelIDS[vershInd + 1].Km) || kilometr.Count() == 0 || kilometr_next.Count() == 0)
                                    {
                                        listElCurve.T1 = (int.Parse(listLevelIDS[vershInd + 1].Km.ToString()) * 1000 +
                                                            int.Parse(listLevelIDS[vershInd + 1].M.ToString())) -
                                                           (int.Parse(listLevelIDS[vershInd].Km.ToString()) * 1000 +
                                                            int.Parse(listLevelIDS[vershInd].M.ToString()));
                                        if (listElCurve.T1.ToString().Contains("-") || listStCurve.T2.ToString().Contains("-"))
                                        {

                                        }
                                        if (listElCurve.T1.ToString().Contains("-")) break;
                                    }
                                    else
                                    {
                                        listElCurve.T1 = (int.Parse(kilometr.First().FinalM.ToString())) -
                                                        (int.Parse(listLevelIDS[vershInd].M.ToString())) +
                                                        (int.Parse(listLevelIDS[vershInd + 1].M.ToString())) -
                                                        (int.Parse(kilometr_next.First().StartM.ToString()));
                                        if (listElCurve.T1.ToString().Contains("-") || listElCurve.T2.ToString().Contains("-"))
                                        {

                                        }
                                        if (listElCurve.T1.ToString().Contains("-")) break;
                                    }
                                    //listElCurve.T1 = (int.Parse(listLevelIDS[vershInd + 1].Km.ToString()) * 1000 + int.Parse(listLevelIDS[vershInd + 1].M.ToString())) - (int.Parse(listLevelIDS[vershInd].Km.ToString()) * 1000 + int.Parse(listLevelIDS[vershInd].M.ToString()));
                                    listElCurve.StartKM = listLevelIDS[vershInd].Km;
                                    listElCurve.StartM = listLevelIDS[vershInd].M;
                                }
                                else
                                {
                                    listElCurve.T2 = 0;
                                    listElCurve.FinalKM = listLevelIDS[vershInd].Km;
                                    listElCurve.FinalM = listLevelIDS[vershInd].M;
                                }
                            }
                            else
                            {
                                if (t2)
                                {
                                    if ((listLevelIDS[vershInd].Km == listLevelIDS[vershInd + 1].Km) || kilometr.Count() == 0 || kilometr_next.Count() == 0)
                                    {
                                        listElCurve.T2 = (int.Parse(listLevelIDS[vershInd + 1].Km.ToString()) * 1000 +
                                                            int.Parse(listLevelIDS[vershInd + 1].M.ToString())) -
                                                           (int.Parse(listLevelIDS[vershInd].Km.ToString()) * 1000 +
                                                            int.Parse(listLevelIDS[vershInd].M.ToString()));
                                        if (listElCurve.T1.ToString().Contains("-") || listElCurve.T2.ToString().Contains("-"))
                                        {

                                        }
                                        if (listElCurve.T2.ToString().Contains("-")) break;
                                    }
                                    else
                                    {
                                        listElCurve.T2 = (int.Parse(kilometr.First().FinalM.ToString())) -
                                                        (int.Parse(listLevelIDS[vershInd].M.ToString())) +
                                                        (int.Parse(listLevelIDS[vershInd + 1].M.ToString())) -
                                                        (int.Parse(kilometr_next.First().StartM.ToString()));
                                        if (listElCurve.T1.ToString().Contains("-") || listElCurve.T2.ToString().Contains("-"))
                                        {

                                        }
                                        if (listElCurve.T2.ToString().Contains("-")) break;
                                    }
                                    //listElCurve.T2 =(int.Parse(listLevelIDS[vershInd + 1].Km.ToString()) * 1000 + int.Parse(listLevelIDS[vershInd + 1].M.ToString())) - (int.Parse(listLevelIDS[vershInd].Km.ToString()) * 1000 + int.Parse(listLevelIDS[vershInd].M.ToString()));
                                    listElCurve.FinalKM = listLevelIDS[vershInd + 1].Km;
                                    listElCurve.FinalM = listLevelIDS[vershInd + 1].M;
                                }
                                else
                                {
                                    listElCurve.T1 = 0;
                                    listElCurve.StartKM = listLevelIDS[vershInd + 1].Km;
                                    listElCurve.StartM = listLevelIDS[vershInd + 1].M;
                                }
                            }

                            if (t2)
                            {
                                if (listElCurve.T2 == 0 && listElCurve.T1 == 0 && int.Parse(listLevelIDS[vershInd].Urov) == 0)
                                {

                                    vershInd += 2;
                                    continue;
                                }

                                listElCurve.SideID = aprcurve.napr.ToString();
                                listElCurve.Lvl = Math.Abs(float.Parse(listLevelIDS[vershInd].Urov, CultureInfo.InvariantCulture.NumberFormat));
                                listElCurve.OldTrackID = aprcurve.OldTrackID;
                                ExportImportService.Execute("insert into apr_elcurve (curve_id, start_km, start_m, final_km, final_m, lvl, transition_1, transition_2) values ("
                                + curveID.ToString() + ", " + listElCurve.StartKM + ", " + listElCurve.StartM + ", " + listElCurve.FinalKM + ", " + listElCurve.FinalM + ", " + listElCurve.Lvl + ", "
                                + listElCurve.T1 + ", " + listElCurve.T2 + ")");

                            }
                            else
                            {
                                vershInd += 2;
                            }
                            t2 = !t2;
                            t1 = !t1;
                        }
                    }
                    else
                    {
                        listStIDs = RdStructureService.Get_list_St_IDs_Curves(aprcurve.StartKM,
                         aprcurve.StartM, aprcurve.FinalKM, aprcurve.FinalM, aprcurve.OldDirectionID, aprcurve.OldTrackID, first_len, last_len, 0);
                        if (listStIDs.Count() == 0) continue;
                        first_len = 0;
                        last_len = 0;

                        ///////////////////

                        bool t1 = true;
                        bool t2 = false;

                        var act_start_m = "-1";
                        var act_final_m = "-1";
                        //////////////////////////////////////
                        var vershInd = 0;



                        while (vershInd < listStIDs.Count() - 1)
                        {
                            var currRiht = Math.Abs(int.Parse(listStIDs[vershInd].Radius));
                            var nextRiht = Math.Abs(int.Parse(listStIDs[vershInd + 1].Radius));

                            if (nextRiht - currRiht == 0)
                            {
                                vershInd++;
                                continue;
                            }


                            var kilometr = ExportImportService.ImportQueryReturnListImportedCurve($@"select start_m as StartM,final_m as FinalM,*  from apr_km where up_nom = '{listStIDs[vershInd].OldDirectionID}' and put_nom='{listStIDs[vershInd].OldTrackID}' and km='{listStIDs[vershInd].Km}' ");
                            var kilometr_next = ExportImportService.ImportQueryReturnListImportedCurve($@"select start_m as StartM,final_m as FinalM,*  from apr_km where up_nom = '{listStIDs[vershInd + 1].OldDirectionID}' and put_nom='{listStIDs[vershInd + 1].OldTrackID}' and km='{listStIDs[vershInd + 1].Km}' ");

                            var kilometr_plan_level = ExportImportService.ImportQueryReturnListImportedCurve($@"SELECT * from ekasui_plan_rightlevel where km = '{listStIDs[vershInd].Km}'  and up_nom='{listStIDs[vershInd + 1].OldDirectionID}' and put_nom ='{listStIDs[vershInd + 1].OldTrackID}' ORDER BY m");

                            if ((nextRiht - currRiht > 0
                                && (aprcurve.napr == 1 || aprcurve.napr == 0)) || (nextRiht / (Math.Pow(nextRiht, 2) + 0.001) - currRiht / (Math.Pow(currRiht, 2) + 0.001) > 0 && aprcurve.napr == 2))
                            {
                                if (t1)
                                {
                                    if (act_start_m == "-1")
                                    {
                                        act_start_m = listStIDs[vershInd].M;
                                    }

                                    if ((listStIDs[vershInd].Km == listStIDs[vershInd + 1].Km) || kilometr.Count() == 0 || kilometr_next.Count() == 0)
                                    {
                                        listElCurve.T1 = (int.Parse(listStIDs[vershInd + 1].Km.ToString()) * 1000 +
                                                            int.Parse(listStIDs[vershInd + 1].M.ToString())) -
                                                           (int.Parse(listStIDs[vershInd].Km.ToString()) * 1000 +
                                                            int.Parse(listStIDs[vershInd].M.ToString()));
                                        if (listElCurve.T1.ToString().Contains("-") || listElCurve.T2.ToString().Contains("-"))
                                        {

                                        }
                                        if (listElCurve.T1.ToString().Contains("-")) break;
                                    }
                                    else
                                    {
                                        listElCurve.T1 = (int.Parse(kilometr.First().FinalM.ToString())) -
                                                        (int.Parse(listStIDs[vershInd].M.ToString())) +
                                                        (int.Parse(listStIDs[vershInd + 1].M.ToString())) -
                                                        (int.Parse(kilometr_next.First().StartM.ToString()));
                                        if (listElCurve.T1.ToString().Contains("-") || listElCurve.T2.ToString().Contains("-"))
                                        {

                                        }
                                        if (listElCurve.T1.ToString().Contains("-")) break;
                                    }

                                    listElCurve.StartKM = listStIDs[vershInd].Km;
                                    listElCurve.StartM = listStIDs[vershInd].M;
                                }
                                else
                                {
                                    listElCurve.T2 = 0;
                                    listElCurve.FinalKM = listStIDs[vershInd].Km;
                                    listElCurve.FinalM = listStIDs[vershInd].M;
                                    act_final_m = listStIDs[vershInd].M;
                                }
                            }
                            else
                            {
                                if (t2)
                                {
                                    if ((listStIDs[vershInd].Km == listStIDs[vershInd + 1].Km) || kilometr.Count() == 0 || kilometr_next.Count() == 0)
                                    {
                                        listElCurve.T2 = (int.Parse(listStIDs[vershInd + 1].Km.ToString()) * 1000 +
                                                            int.Parse(listStIDs[vershInd + 1].M.ToString())) -
                                                           (int.Parse(listStIDs[vershInd].Km.ToString()) * 1000 +
                                                            int.Parse(listStIDs[vershInd].M.ToString()));
                                        if (listElCurve.T2.ToString().Contains("-")) break;
                                    }
                                    else
                                    {
                                        listElCurve.T2 = (int.Parse(kilometr.First().FinalM.ToString())) -
                                                        (int.Parse(listStIDs[vershInd].M.ToString())) +
                                                        (int.Parse(listStIDs[vershInd + 1].M.ToString())) -
                                                        (int.Parse(kilometr_next.First().StartM.ToString()));
                                        if (listElCurve.T2.ToString().Contains("-")) break;
                                    }

                                    listElCurve.FinalKM = listStIDs[vershInd + 1].Km;
                                    listElCurve.FinalM = listStIDs[vershInd + 1].M;
                                    act_final_m = listStIDs[vershInd + 1].M;
                                }
                                else
                                {
                                    if (act_start_m == "-1")
                                    {
                                        act_start_m = listStIDs[vershInd + 1].M;
                                    }
                                    listElCurve.T1 = 0;
                                    listElCurve.StartKM = listStIDs[vershInd + 1].Km;
                                    listElCurve.StartM = listStIDs[vershInd + 1].M;
                                }
                            }

                            if (t2)
                            {

                                if (listElCurve.T2 == 0 && listElCurve.T1 == 0 && int.Parse(listStIDs[vershInd].Radius) == 0)
                                {

                                    vershInd += 2;
                                    continue;
                                }

                                ExportImportService.Execute("insert into apr_elcurve (curve_id, start_km, start_m, final_km, final_m, lvl, transition_1, transition_2) values ("
                                + curveID.ToString() + ", " + listStCurve.StartKM + ", " + listStCurve.StartM + ", " + listStCurve.FinalKM + ", " + listStCurve.FinalM + ", " + 0 + ", "
                                + listElCurve.T1 + ", " + listElCurve.T2 + ")");
                            }
                            else
                            {
                                vershInd += 2;
                            }

                            t2 = !t2;
                            t1 = !t1;
                        }

                        listStIDs.Clear();
                    }

                }











                //foreach (var listtracks in listStationIDs)
                //{
                //    var listPut = ExportImportService.ImportQueryReturnListSTRTrack("select * from ekasui_str where st_kod = '" + listtracks.OldStationID + "' and up_nom = '" + listtracks.OldStationID + "'");
                //    foreach (var list in listPut)
                //    {
                //        var trackID = ExportImportService.ImportQueryReturnListLong("SELECT track.id FROM adm_track track inner join stw_track st on st.adm_track_id = track.id where track.code = '" + list.Put_nom + "' and track.up_nom = " + list.Up_nom + "");
                //        var strlist = ExportImportService.ImportQueryReturnListSTRTrack("select * from ekasui_str where put_nom = '" + list.Put_nom + "' and st_kod = '" + listtracks.OldStationID + "' ");
                //        foreach (var str in strlist)
                //        {
                //            //var lsitsationId = strlist.Where(tmp => tmp.st == str.St_kod);
                //            //var listSTATid = lsitsationId.Select(o => o.NewStationID).ToList();
                //            //foreach (Int64 stationId in listSTATid)
                //            //{

                //            if (trackID.Count < 1)
                //            {
                //                continue;
                //            }
                //            //foreach (var trackID in trackIDstation)
                //            //{
                //            //Int64 trackID = ExportImportService.ImportQueryReturnListLong(" ");
                //            //Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (str.Put_nom)).First().NewTrackID;
                //            string POINTID = "35";


                //            var lsitsationId = listStationIDs.Where(tmp => tmp.OldStationID == int.Parse(str.St_kod));
                //            var listSTATid = lsitsationId.Select(o => o.NewStationID).ToList();



                //            switch (str.Otb)
                //            {

                //                case "1":
                //                    sideIDSTR = "0";
                //                    break;
                //                case "2":
                //                    sideIDSTR = "2";
                //                    break;
                //                case "3":
                //                    sideIDSTR = "1";
                //                    break;
                //                case "0":
                //                    sideIDSTR = "0";
                //                    break;

                //            }


                //            if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.First().ToString() + " and MTO_TYPE = 15 ").Count() > 0)
                //            {
                //                Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.First().ToString() + " and MTO_TYPE = 15");
                //                ExportImportService.Execute("insert into TPL_SWITCH (PERIOD_ID, KM, METER, NUM, MARK_ID, DIR_ID, SIDE_ID, POINT_ID, station_id) values (" + periodID.ToString() + ", " + str.Km + ", " + str.M + ", \'" + str.Nom + "\', " + str.Type + ", " + (str.PosH == "1" ? str.PosH = "-1" : str.PosH == "2" ? str.PosH = "1" : str.PosH = "0") + ", "
                //                    + sideIDSTR + "," + str.Type + ", " + listSTATid.First().ToString() + ")");
                //            }
                //            else
                //            {
                //                Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.First().ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 15) returning ID");
                //                ExportImportService.Execute("insert into TPL_SWITCH (PERIOD_ID, KM, METER, NUM, MARK_ID, DIR_ID, SIDE_ID, POINT_ID, station_id) values (" + periodID.ToString() + ", " + str.Km + ", " + str.M + ", \'" + str.Nom + "\', " + str.Type + ", " + (str.PosH == "1" ? str.PosH = "-1" : str.PosH == "2" ? str.PosH = "1" : str.PosH = "0") + ", "
                //                    + sideIDSTR + "," + str.Type + ", " + listSTATid.First().ToString() + ")");
                //            }
                //            //}

                //            //}
                //        }
                //    }
                //}


                listStationIDs.Clear();
                listStationSections.Clear();
                progressBar.PerformStep();











                List<ImportListElevationsix> listshablonL = new List<ImportListElevationsix>();
                //6мм
                listshablonL = ExportImportService.ImportQueryReturnListImportedElevation($@"SELECT * from ekasui_plan_rightlevel where urov='6' or  urov='0'     ORDER BY up_nom,put_nom,km,m");
                distinctCurves_filter = new List<ImportListCurveID>();
                for (int g = 0; g < listshablonL.Count() - 1; g += 1)
                {

                    frst_curve = "";
                    next_curve = "";
                    curve_direction = 0;
                    curve_direction_next = 0;
                    curve_put = "";
                    curve_put_next = "";

                    frst_curve = listshablonL[g].Urov;
                    next_curve = listshablonL[g + 1].Urov;
                    curve_direction = listshablonL[g].Up_nom;
                    curve_direction_next = listshablonL[g + 1].Up_nom;
                    curve_put = listshablonL[g].Put_nom;
                    curve_put_next = listshablonL[g + 1].Put_nom;

                    if (int.Parse(frst_curve) == 0 && int.Parse(next_curve) != 0 && flagstart == false && curve_direction == curve_direction_next && curve_put == curve_put_next)
                    {
                        multiCurve_filter.StartKM = listshablonL[g].Km;
                        multiCurve_filter.StartM = listshablonL[g].M;

                        multiCurve_filter.OldDirectionID = listshablonL[g].Up_nom;
                        multiCurve_filter.OldTrackID = listshablonL[g].Put_nom;



                        flagstart = true;
                    }
                    if (int.Parse(frst_curve) != 0 && int.Parse(next_curve) != 0 && flagstart)
                    {

                    }
                    if (int.Parse(frst_curve) != 0 && int.Parse(next_curve) == 0 && flagstart)
                    {

                        multiCurve_filter.FinalKM = listshablonL[g + 1].Km;
                        multiCurve_filter.FinalM = listshablonL[g + 1].M;

                        distinctCurves_filter.Add(multiCurve_filter);
                        multiCurve_filter = new ImportListCurveID();
                        isMultiCurvestart = false;
                        isMultiCurve_filter = false;
                        flagstart = false;
                    }



                }

                var caountel = 0;
                List<long> apr_level_six = new List<long>();
                foreach (var aprcurve in distinctCurves_filter)
                {
                    //0-левая 1- правая в ебпд
                    //у нас 1-правая 2 левая
                    if (listIDs.Where(tmp => tmp.OldTrackID == aprcurve.OldTrackID && tmp.OldDirectionID == aprcurve.OldDirectionID).Count() > 0)
                    {
                        Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == aprcurve.OldTrackID && tmp.OldDirectionID == aprcurve.OldDirectionID).First().NewTrackID;

                        if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 8").Count() > 0)
                        {
                            Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 8");
                            ExportImportService.Execute("insert into apr_elevation (PERIOD_ID, level_id, START_KM, START_M, FINAL_KM, FINAL_M) values (" + periodID.ToString() + ", " + "6" + ", " + aprcurve.StartKM + ", " + (int.Parse(aprcurve.StartM)) + ", " + aprcurve.FinalKM + ", " + (int.Parse(aprcurve.FinalM)) + ")");
                        }
                        else
                        {
                            Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 8) returning ID");
                            ExportImportService.Execute("insert into apr_elevation (PERIOD_ID, level_id, START_KM, START_M, FINAL_KM, FINAL_M) values (" + periodID.ToString() + ", " + "6" + ", " + aprcurve.StartKM + ", " + (int.Parse(aprcurve.StartM)) + ", " + aprcurve.FinalKM + ", " + (int.Parse(aprcurve.FinalM)) + ")");
                        }
                    }

                }




                List<ImportListElevationsix> listshablonR = new List<ImportListElevationsix>();

                listshablonR = ExportImportService.ImportQueryReturnListImportedElevation($@"SELECT * from ekasui_plan_rightlevel where urov='-6' or  urov='0'     ORDER BY up_nom,put_nom,km,m");

                ImportListCurveID listelevationsixR = new ImportListCurveID();
                distinctCurves_filter = new List<ImportListCurveID>();

                var caounteR = 0;
                //List<ImportListCurveID> listelevationsix = new List<ImportListCurveID>();
                for (int g = 0; g < listshablonR.Count() - 1; g += 1)
                {

                    frst_curve = "";
                    next_curve = "";
                    curve_direction = 0;
                    curve_direction_next = 0;
                    curve_put = "";
                    curve_put_next = "";

                    frst_curve = listshablonR[g].Urov;
                    next_curve = listshablonR[g + 1].Urov;
                    curve_direction = listshablonR[g].Up_nom;
                    curve_direction_next = listshablonR[g + 1].Up_nom;
                    curve_put = listshablonR[g].Put_nom;
                    curve_put_next = listshablonR[g + 1].Put_nom;

                    if (int.Parse(frst_curve) == 0 && int.Parse(next_curve) != 0 && flagstart == false && curve_direction == curve_direction_next && curve_put == curve_put_next)
                    {
                        multiCurve_filter.StartKM = listshablonR[g].Km;
                        multiCurve_filter.StartM = listshablonR[g].M;

                        multiCurve_filter.OldDirectionID = listshablonR[g].Up_nom;
                        multiCurve_filter.OldTrackID = listshablonR[g].Put_nom;



                        flagstart = true;
                    }
                    if (int.Parse(frst_curve) != 0 && int.Parse(next_curve) != 0 && flagstart)
                    {

                    }
                    if (int.Parse(frst_curve) != 0 && int.Parse(next_curve) == 0 && flagstart)
                    {

                        multiCurve_filter.FinalKM = listshablonR[g + 1].Km;
                        multiCurve_filter.FinalM = listshablonR[g + 1].M;

                        distinctCurves_filter.Add(multiCurve_filter);
                        multiCurve_filter = new ImportListCurveID();
                        isMultiCurvestart = false;
                        isMultiCurve_filter = false;
                        flagstart = false;
                    }



                }
                foreach (var aprcurve in distinctCurves_filter)
                {
                    //0-левая 1- правая в ебпд
                    //у нас 1-правая 2 левая
                    if (listIDs.Where(tmp => tmp.OldTrackID == aprcurve.OldTrackID && tmp.OldDirectionID == aprcurve.OldDirectionID).Count() > 0)
                    {
                        Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == aprcurve.OldTrackID && tmp.OldDirectionID == aprcurve.OldDirectionID).First().NewTrackID;
                        if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 8").Count() > 0)
                        {
                            Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 8");
                            ExportImportService.Execute("insert into apr_elevation (PERIOD_ID, level_id, START_KM, START_M, FINAL_KM, FINAL_M) values (" + periodID.ToString() + ", " + "-6" + ", " + aprcurve.StartKM + ", " + (int.Parse(aprcurve.StartM)) + ", " + aprcurve.FinalKM + ", " + (int.Parse(aprcurve.FinalM)) + ")");
                        }
                        else
                        {
                            Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 8) returning ID");
                            ExportImportService.Execute("insert into apr_elevation (PERIOD_ID, level_id, START_KM, START_M, FINAL_KM, FINAL_M) values (" + periodID.ToString() + ", " + "-6" + ", " + aprcurve.StartKM + ", " + (int.Parse(aprcurve.StartM)) + ", " + aprcurve.FinalKM + ", " + (int.Parse(aprcurve.FinalM)) + ")");
                        }
                    }

                }


                foreach (var upnom in listoldirection)//для ширины колеии
                {

                    foreach (var putnom in listoldtrack)
                    {
                        var listcurve = ExportImportService.ImportQueryReturnListImportedElevation($@"SELECT
                                                                                                     selected.start_km,
                                                                                                     selected.start_m,
                                                                                                     selected.final_km,
                                                                                                     selected.final_m,
                                                                                                     selected.width,
                                                                                                     selected.up_nom,
                                                                                                        selected.put_nom	
                                                                                                    FROM
                                                                                                     (
                                                                                                     SELECT
                                                                                                      ast.start_km,
                                                                                                      ast.start_m,
                                                                                                      ast.final_km,
                                                                                                      ast.final_m,
                                                                                                      ast.width,
                                                                                                      ac.up_nom,
                                                                                                      ac.put_nom,
                                                                                                      ROW_NUMBER ( ) OVER ( PARTITION BY curve_id ORDER BY ac.ID ASC ) rn 
                                                                                                     FROM
                                                                                                      apr_curve AS ac
                                                                                                      INNER JOIN apr_stcurve AS ast ON ac.ID = ast.curve_id 
                                                                                                     WHERE
                                                                                                      ac.up_nom = '{upnom.Up_nom}' 
                                                                                                      AND ac.put_nom = '{putnom.Put_nom}' 
                                                                                                      AND ast.width > 1520 
                                                                                                     ORDER BY
                                                                                                      ast.start_km,
                                                                                                      ast.start_m 
                                                                                                     ) AS selected 
                                                                                                    WHERE
                                                                                                     rn = 1");
                        var listKM = ExportImportService.ImportQueryReturnListImportedElevation($@"SELECT* from ekasui_non_ext WHERE up_nom = '{upnom.Up_nom}' and put_nom = '{putnom.Put_nom}' ORDER BY km,start_m,final_m");
                        var norma = "1520";


                        string startkm, startM, finalM, finalKm;

                        if (listKM.Count() == 0)
                        {
                            continue;
                        }
                        //if (listcurve.Count() != 0)
                        //{
                        //    //startkm = listKM.Select(o => o.Km).First();
                        //    //startM = listKM.Select(o => o.start_m).First();
                        //    //finalKm = listKM.Select(o => o.Km).Last();
                        //    //finalM = listKM.Select(o => o.final_m).Last();

                        //    //if (listIDs.Where(tmp => tmp.OldTrackID == putnom.Put_nom && tmp.OldDirectionID == upnom.Up_nom).Count() > 0)
                        //    //{

                        //    //    Int64 trackIDanw = listIDs.Where(tmp => tmp.OldTrackID == putnom.Put_nom && tmp.OldDirectionID == upnom.Up_nom).First().NewTrackID;
                        //    //    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackIDanw.ToString() + " and MTO_TYPE = 5").Count() > 0)
                        //    //    {
                        //    //        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackIDanw.ToString() + " and MTO_TYPE = 5");
                        //    //        ExportImportService.Execute("insert into apr_norma_width (PERIOD_ID, start_km, start_m, final_km, final_m, norma_width) values (" + periodID.ToString() + ", "
                        //    //            + startkm + ", " + startM + ", " + finalKm + ", " + finalM + "," + norma + ")");
                        //    //    }
                        //    //    else
                        //    //    {
                        //    //        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackIDanw.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 5) returning ID");
                        //    //        ExportImportService.Execute("insert into apr_norma_width (PERIOD_ID, start_km, start_m, final_km, final_m, norma_width) values (" + periodID.ToString() + ", "
                        //    //                + startkm + ", " + startM + ", " + finalKm + ", " + finalM + "," + norma + ")");
                        //    //    }

                        //    //}
                        //    //continue;
                        //    startkm = listKM.Select(o => o.Km).First();
                        //    startM = listKM.Select(o => o.start_m).First();
                        //    finalM = listcurve.Select(o => o.start_m).First();
                        //    finalKm = listcurve.Select(o => o.start_km).First();

                        //    for (int i = 1; i < listcurve.Count() - 1; i++)
                        //    {
                        //        if (i > 0)
                        //        {
                        //            startkm = listcurve[i - 1].final_km;
                        //            startM = listcurve[i - 1].final_m;
                        //            finalKm = listcurve[i].start_km;
                        //            finalM = listcurve[i].start_m;
                        //        }
                        //        if (i == listcurve.Count() - 1)
                        //        {
                        //            startkm = listcurve[i - 1].final_km;
                        //            startM = listcurve[i - 1].final_m;
                        //            finalKm = listKM.Select(o => o.Km).Last();
                        //            finalM = listKM.Select(o => o.final_m).Last();
                        //        }

                        //        if ((Math.Abs(int.Parse(startkm) - int.Parse(finalKm)) * 1000 + Math.Abs(int.Parse(startM) - int.Parse(finalM))) >= 25)
                        //        {
                        //            if (listIDs.Where(tmp => tmp.OldTrackID == listcurve[i].Put_nom && tmp.OldDirectionID == listcurve[i].Up_nom).Count() > 0)
                        //            {
                        //                Int64 trackIDanw = listIDs.Where(tmp => tmp.OldTrackID == listcurve[i].Put_nom && tmp.OldDirectionID == listcurve[i].Up_nom).First().NewTrackID;
                        //                if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackIDanw.ToString() + " and MTO_TYPE = 5").Count() > 0)
                        //                {
                        //                    Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackIDanw.ToString() + " and MTO_TYPE = 5");
                        //                    ExportImportService.Execute("insert into apr_norma_width (PERIOD_ID, start_km, start_m, final_km, final_m, norma_width) values (" + periodID.ToString() + ", "
                        //                        + startkm + ", " + startM + ", " + finalKm + ", " + finalM + "," + norma + ")");
                        //                }
                        //                else
                        //                {
                        //                    Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackIDanw.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 5) returning ID");
                        //                    ExportImportService.Execute("insert into apr_norma_width (PERIOD_ID, start_km, start_m, final_km, final_m, norma_width) values (" + periodID.ToString() + ", "
                        //                           + startkm + ", " + startM + ", " + finalKm + ", " + finalM + "," + norma + ")");
                        //                }
                        //            }
                        //        }

                        //    }



                        //}
                    }
                }





                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "REM.xml"))//ГОТОВО
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "rem")
                        {
                            if (count > 0)
                                continue;
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {
                                //int tupe_rem = int.Parse(z_row.Attributes["TYPE"].Value);
                                string tupe_rem = z_row.Attributes["TYPE"].Value;
                                int tupe_remid = 0;
                                string shorname = "";

                                //0 –  Просроченный капитальный ремонт, ....юю
                                //1 –  Усиленный капитальный ремонт, ююю
                                //2 –  Капитальный ремонт новый, ююю
                                //3 –  Средний ремонт,..юю
                                //4 –  Усиленный средний ремонт,.. юю
                                //5 –  Подъемочный ремонт,..юю
                                //6 –  Сплошная замена новая, ..юю
                                //7 –  Сплошная замена старая, юю
                                //8 –  Планово предупредительный ремонт, 
                                //9 –  Необходим планово предупредительный ремонт,
                                //10 –  Реконструкция пути,
                                //11 –  Капитальный ремонт старый,    
                                //12 –  Просроченный восстановительный,
                                //13 –  Переложенные рельсы


                                //0   Не определен    НО
                                //1   Кап.усил.УК....
                                //2   Кап.на новых рельсах К
                                //3   Кап.на с/ г рельс.К
                                //4   Сред.усил.УС
                                //5   Сред.С
                                //6   Подъем.П
                                //7   Подъем.усил.УП
                                //8   Смена рельсов новыми РСююю  
                                //9   Смена рельсов с / г   РС  юю
                                //10  Смена наружной  рельсовой нити новыми РИК
                                //11  Смена наружной рельсовой нити с / г   РИК
                                //12  Смена внутренней рельсовой нити новыми РИК
                                //13  Смена внутренней рельсовой нити с / г РИК
                                //14  Планово - предупредительная выправка В
                                //15  Сварка рельсов  СР
                                //16  Наплавка рельсов    Н
                                //17  Шлифовка профильная ШР
                                //18  Шлифовка поверхностная  ШР
                                //19  Наплавка крестовин  Н
                                //20  Новое строительство НС
                                //21 –  Реконструкция пути,
                                //22 - Смена   рельсов   с   переменой рабочего канта
                                //23  Просроченный капитальный ремонт ПКР....

                                //24 –  Капитальный ремонт новый,  КРН...
                                //25 –  Планово предупредительный ремонт, 
                                //26 –  Необходим планово предупредительный ремонт,

                                //27 –  Просроченный восстановительный,
                                //28 –  Переложенные рельсы
                                switch (tupe_rem)
                                {
                                    case "0":
                                        tupe_remid = 23;
                                        shorname = "ПКРП";
                                        break;
                                    case "1":
                                        tupe_remid = 1;
                                        shorname = "УК";
                                        break;
                                    case "2":
                                        tupe_remid = 2;
                                        shorname = "К";
                                        break;
                                    case "3":
                                        tupe_remid = 5;
                                        shorname = "С";
                                        break;
                                    case "4":
                                        tupe_remid = 4;
                                        shorname = "УС";
                                        break;
                                    case "5":
                                        tupe_remid = 5;
                                        shorname = "П";
                                        break;
                                    case "6":
                                        tupe_remid = 8;
                                        shorname = "СРН";
                                        break;
                                    case "7":
                                        tupe_remid = 9;
                                        shorname = "СРС";
                                        break;
                                    case "8":
                                        tupe_remid = 14;
                                        shorname = "В";
                                        //14 –  Планово предупредительный ремонт, 
                                        break;
                                    case "9":
                                        tupe_remid = 26;
                                        shorname = "НППР";
                                        //24 –  Необходим планово предупредительный ремонт,
                                        break;
                                    case "10":
                                        tupe_remid = 21;
                                        shorname = "Р";
                                        //21 –  Реконструкция пути,
                                        break;
                                    case "11":
                                        tupe_remid = 3;
                                        shorname = "КС";
                                        //3 –  Капитальный ремонт старый,    
                                        break;
                                    case "12":
                                        tupe_remid = 27;
                                        shorname = "ПВ";
                                        //28 –  Просроченный восстановительный,

                                        break;
                                    case "13":
                                        tupe_remid = 28;
                                        shorname = "ПР";
                                        //29 –  Переложенные рельсы

                                        break;


                                }
                                var start_km = z_row.Attributes["BEGIN_KM"].Value;
                                var start_m = z_row.Attributes["BEGIN_M"].Value;
                                var final_km = z_row.Attributes["END_KM"].Value;
                                var final_m = int.Parse(z_row.Attributes["END_M"].Value);
                                final_m = final_m - 1;
                                string daterem = z_row.Attributes["DATEREM"].Value.ToString();
                                var DateTime_rem = DateTime.Parse(daterem);
                                //string DateTime_rem = DateTime.Split('T').ToString();//надо сделать с анияр
                                if (listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                                {
                                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 26").Count() > 0)
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 26");
                                        ExportImportService.Execute("insert into repair_project (PERIOD_ID, ADM_TRACK_ID,start_km, start_m, final_km, final_m, type_id,repair_date,accept_id) values (" + periodID.ToString() + "," + trackID.ToString() + ", " + start_km + ", "
                                            + start_m + ", " + final_km + ", " + final_m + ", " + tupe_remid.ToString() + ", \'" + DateTime_rem.ToString() + "\'" + "," + 1 + ")");
                                    }
                                    else
                                    {

                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 26) returning ID");
                                        ExportImportService.Execute("insert into repair_project (PERIOD_ID, ADM_TRACK_ID,start_km, start_m, final_km, final_m, type_id,repair_date,accept_id) values (" + periodID.ToString() + "," + trackID.ToString() + ", " + start_km + ", "
                                                + start_m + ", " + final_km + ", " + final_m + ", " + tupe_remid.ToString() + ", \'" + DateTime_rem.ToString() + "\'" + "," + 1 + ")");
                                    }
                                }
                                count = count + 1;
                            }
                        }
                    }
                }
                progressBar.PerformStep();
                //progressBar.PerformStep();


                progressBar.PerformStep();

                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "ISO.xml"))//ГОТОВО
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "iso")
                        {
                            if (count > 0)
                                continue;
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {
                                if (listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                                {
                                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 19").Count() > 0)
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 19");
                                        ExportImportService.Execute("insert into TPL_PROFILE_OBJECT (PERIOD_ID, OBJECT_ID, SIDE_ID, KM, METER) values (" + periodID.ToString() + ", 26, 0, " + z_row.Attributes["KM"].Value + ", " + z_row.Attributes["M"].Value + ")");
                                    }
                                    else
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 19) returning ID");
                                        ExportImportService.Execute("insert into TPL_PROFILE_OBJECT (PERIOD_ID, OBJECT_ID, SIDE_ID, KM, METER) values (" + periodID.ToString() + ", 26, 0, " + z_row.Attributes["KM"].Value + ", " + z_row.Attributes["M"].Value + ")");
                                    }
                                }
                            }
                            count = count + 1;
                        }
                    }
                }

                progressBar.PerformStep();
                ////   ///*done*/

                ///*done*/









                ////progressBar.PerformStep();
                ///////*done*/

                ///////*done not_yet*/
                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "ISSOEXT.xml"))//ГОТОВО
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "issoext")
                        {
                            if (count > 0)
                                continue;
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {
                                string start_km = z_row.Attributes["BEGIN_KM"].Value;
                                string start_m = z_row.Attributes["BEGIN_M"].Value;
                                string final_km = z_row.Attributes["END_KM"].Value;
                                string final_m = z_row.Attributes["END_M"].Value;
                                string up_nom = z_row.Attributes["UP_NOM"].Value;

                                var len = ExportImportService.ImportQueryReturnLong($@"select getdistancefrom({start_km}, {start_m}, {final_km}, {final_m}, {up_nom}, '10/10/2020')");
                                var coord = ExportImportService.ImportQueryReturnDouble($@"select getcoordbylen({start_km}, {start_m}, {len / 2}, {up_nom}, '10/10/2020')");

                                int km = (int)Math.Truncate(coord);
                                int m = (int)((coord - km) * 10000);

                                string typeid = "0";


                                switch (z_row.Attributes["TYPE"].Value)
                                {
                                    //0-не определенно (возмодн мост)
                                    case "0":
                                        typeid = "0";
                                        break;
                                    case "1":
                                        typeid = "1";
                                        break;
                                    case "2":
                                        typeid = "2";
                                        break;
                                    case "3":
                                        typeid = "3";
                                        break;
                                    case "4.":
                                        typeid = "4";
                                        break;
                                    case "5":
                                        typeid = "5";
                                        break;
                                    case "6":
                                        typeid = "6";
                                        break;
                                }

                                if (listIDs.Where(tmp => tmp.OldTrackID == z_row.Attributes["PUT_NOM"].Value.ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value.ToString())).Count() > 0)
                                {
                                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == z_row.Attributes["PUT_NOM"].Value.ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value.ToString())).First().NewTrackID;
                                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 14").Count() > 0)
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 14");
                                        ExportImportService.Execute("insert into APR_ARTIFICIAL_CONSTRUCTION (PERIOD_ID, km, meter, len, TYPE_ID) values (" + periodID.ToString() + ", " + km + "," + m + ", " + len.ToString() + ", " + typeid + ")");
                                    }
                                    else
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 14) returning ID");
                                        ExportImportService.Execute("insert into APR_ARTIFICIAL_CONSTRUCTION (PERIOD_ID, km, meter, len, TYPE_ID) values (" + periodID.ToString() + ", " + km + "," + m + ", " + len.ToString() + ", " + typeid + ")"); ;
                                    }
                                }
                                count = count + 1;
                            }
                        }
                    }
                }

                //progressBar.PerformStep();
                //foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "KV_NSK.xml"))
                //{
                //    XmlDocument xmlDocument = new XmlDocument();
                //    xmlDocument.Load(file.FullName);
                //    XmlElement xmlElement = xmlDocument.DocumentElement;
                //    foreach (XmlNode xmlNode in xmlElement)
                //    {
                //        if (xmlNode.Name == "rs:data")
                //        {
                //            foreach (XmlNode z_row in xmlNode.ParentNode)
                //            {
                //                string start_km = z_row.Attributes["KMN"].Value;
                //                string start_m = z_row.Attributes["MN"].Value;
                //                string final_km = z_row.Attributes["KMK"].Value;
                //                string final_m = z_row.Attributes["MK"].Value;
                //                string width = z_row.Attributes["NORMA"].Value;
                //                if (listIDs.Where(tmp => tmp.OldTrackID == z_row.Attributes["NOM"].Value.ToString()).Count() > 0)
                //                {
                //                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == z_row.Attributes["NOM"].Value.ToString()).First().NewTrackID;
                //                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 5").Count() > 0)
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 5");
                //                        ExportImportService.Execute("insert into APR_NORMA_WIDTH (PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M, NORMA_WIDTH) values (" + periodID.ToString() + ", " + start_km + "," + start_m + ", " + final_km + "," + final_m + ", " + width + ")");
                //                    }
                //                    else
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 5) returning ID");
                //                        ExportImportService.Execute("insert into APR_NORMA_WIDTH (PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M, NORMA_WIDTH) values (" + periodID.ToString() + ", " + start_km + "," + start_m + ", " + final_km + "," + final_m + ", " + width + ")");
                //                    }
                //                }
                //            }
                //        }
                //    }
                //}

                //progressBar.PerformStep();


                //foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "PUCH.xml"))//Готово
                //{
                //    XmlDocument xmlDocument = new XmlDocument();
                //    xmlDocument.Load(file.FullName);
                //    XmlElement xmlElement = xmlDocument.DocumentElement;
                //    var count = 0;
                //    foreach (XmlNode xmlNode in xmlElement)
                //    {
                //        if (xmlNode.Name == "puch")
                //        {
                //            if (count > 0)
                //                continue;
                //            foreach (XmlNode z_row in xmlNode.ParentNode)
                //            {


                //                if (listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                //                {
                //                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                //                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 35").Count() > 0)
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 35");
                //                        ExportImportService.Execute("insert into tpl_deep (PERIOD_ID, start_km, start_m, final_km, final_m) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + ")");
                //                    }
                //                    else
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 35) returning ID");
                //                        ExportImportService.Execute("insert into tpl_deep (PERIOD_ID, start_km, start_m, final_km, final_m) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + ")");
                //                    }
                //                }
                //                count = count + 1;
                //            }
                //        }
                //    }
                //}
                //progressBar.PerformStep();
                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "UPSEXT.xml"))//Готово
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "upsext")
                        {
                            if (count > 0)
                                continue;
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {
                                string objectID;
                                if (z_row.Attributes["VID"].Value == "Уравн. приб")
                                    objectID = "2";
                                else if (z_row.Attributes["VID"].Value == "Уравн. стык")
                                    objectID = "1";
                                else objectID = "1";
                                if (listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                                {
                                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == z_row.Attributes["PUT_NOM"].Value.ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 21").Count() > 0)
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 21");
                                        ExportImportService.Execute("insert into apr_cham_joint (PERIOD_ID, start_km, start_m, final_km, final_m, type_id) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + ", " + objectID + ")");
                                    }
                                    else
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 21) returning ID");
                                        ExportImportService.Execute("insert into apr_cham_joint (PERIOD_ID, start_km, start_m, final_km, final_m, type_id) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + ", " + objectID + ")");
                                    }
                                }
                                count = count + 1;
                            }
                        }
                    }
                }
                progressBar.PerformStep();

                //foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "GB.xml"))//Готово
                //{
                //    XmlDocument xmlDocument = new XmlDocument();
                //    xmlDocument.Load(file.FullName);
                //    XmlElement xmlElement = xmlDocument.DocumentElement;
                //    var count = 0;
                //    foreach (XmlNode xmlNode in xmlElement)
                //    {

                //        if (xmlNode.Name == "gb")
                //        {

                //            if (count > 0)
                //                continue;
                //            foreach (XmlNode z_row in xmlNode.ParentNode)
                //            {
                //                string crosstieID;
                //                if (z_row.Attributes["TYPE"].Value == "0")
                //                    crosstieID = "2";
                //                else if (z_row.Attributes["TYPE"].Value == "1")
                //                    crosstieID = "1";
                //                else crosstieID = "-1";
                //                if (listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                //                {
                //                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == z_row.Attributes["PUT_NOM"].Value.ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                //                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 1").Count() > 0)
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 1");
                //                        ExportImportService.Execute("insert into APR_CROSSTIE (PERIOD_ID, CROSSTIE_TYPE_ID, START_KM, START_M, FINAL_KM, FINAL_M) values (" + periodID.ToString() + ", " + crosstieID + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + ")");
                //                    }
                //                    else
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 1) returning ID");
                //                        ExportImportService.Execute("insert into APR_CROSSTIE (PERIOD_ID, CROSSTIE_TYPE_ID, START_KM, START_M, FINAL_KM, FINAL_M) values (" + periodID.ToString() + ", " + crosstieID + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + ")");
                //                    }
                //                }
                //                count = count + 1;
                //            }
                //        }
                //    }
                //}
                //foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "GABTYPE.xml"))//Готово
                //{
                //    XmlDocument xmlDocument = new XmlDocument();
                //    xmlDocument.Load(file.FullName);
                //    XmlElement xmlElement = xmlDocument.DocumentElement;
                //    var count = 0;
                //    foreach (XmlNode xmlNode in xmlElement)
                //    {

                //        if (xmlNode.Name == "gabtype")
                //        {

                //            if (count > 0)
                //                continue;
                //            foreach (XmlNode z_row in xmlNode.ParentNode)
                //            {
                //                string dimenssionID;
                //                if (z_row.Attributes["TYPE"].Value == "0")
                //                    dimenssionID = "0";
                //                else if (z_row.Attributes["TYPE"].Value == "1")
                //                    dimenssionID = "1";
                //                else dimenssionID = "-1";
                //                if (listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                //                {
                //                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                //                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 37").Count() > 0)
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 37");
                //                        ExportImportService.Execute("insert into apr_dimension (PERIOD_ID,  START_KM, START_M, FINAL_KM, FINAL_M,type_id) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + ", " + dimenssionID + ")");
                //                    }
                //                    else
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 37) returning ID");
                //                        ExportImportService.Execute("insert into apr_dimension (PERIOD_ID,  START_KM, START_M, FINAL_KM, FINAL_M,type_id) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + ", " + dimenssionID + ")");
                //                    }
                //                }
                //                count = count + 1;
                //            }
                //        }
                //    }
                //}
                //  Действующие предупреждения
                //foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "WRN.xml"))//Готово
                //{
                //    XmlDocument xmlDocument = new XmlDocument();
                //    xmlDocument.Load(file.FullName);
                //    XmlElement xmlElement = xmlDocument.DocumentElement;
                //    var count = 0;
                //    foreach (XmlNode xmlNode in xmlElement)
                //    {

                //        if (xmlNode.Name == "wrn")
                //        {

                //            if (count > 0)
                //                continue;
                //            foreach (XmlNode z_row in xmlNode.ParentNode)
                //            {

                //                string reason_id;
                //                if (z_row.Attributes["KOD"].Value == "440")
                //                    reason_id = "6";
                //                else if (z_row.Attributes["KOD"].Value == "512")
                //                    reason_id = "7";
                //                else if (z_row.Attributes["KOD"].Value == "513")
                //                    reason_id = "8";
                //                else if (z_row.Attributes["KOD"].Value == "514")
                //                    reason_id = "9";
                //                else if (z_row.Attributes["KOD"].Value == "515")
                //                    reason_id = "10";
                //                else if (z_row.Attributes["KOD"].Value == "522")
                //                    reason_id = "11";
                //                else if (z_row.Attributes["KOD"].Value == "525")
                //                    reason_id = "12";
                //                else if (z_row.Attributes["KOD"].Value == "550")
                //                    reason_id = "1";
                //                else if (z_row.Attributes["KOD"].Value == "551")
                //                    reason_id = "2";
                //                else if (z_row.Attributes["KOD"].Value == "552")
                //                    reason_id = "3";
                //                else if (z_row.Attributes["KOD"].Value == "553")
                //                    reason_id = "4";
                //                else if (z_row.Attributes["KOD"].Value == "561")
                //                    reason_id = "13";
                //                else if (z_row.Attributes["KOD"].Value == "562")
                //                    reason_id = "14";

                //                else reason_id = "0";
                //                var speed = z_row.Attributes["SPEED"].Value;
                //                //string start_date = z_row.Attributes["B_DATE"].Value;
                //                //start_date = start_date.Split('T')[0];

                //                //string start_date = z_row.Attributes["B_DATE"].Value.ToString();
                //                //var DateTime_rem = DateTime.Parse(start_date);


                //                //var dateTime_satart = DateTime.ParseExact(start_date, "yyyy-MM-dd", CultureInfo.InvariantCulture);
                //                //var yourNewString_start = dateTime_satart.ToString("yyyy-MM-dd");

                //                string dateTime_satart = z_row.Attributes["B_DATE"].Value.ToString();
                //                var yourNewString_start = DateTime.Parse(dateTime_satart);

                //                //var final_date = z_row.Attributes["E_DATE"].Value;
                //                //final_date = final_date.Split('T')[0];
                //                //var dateTime_final = DateTime.ParseExact(final_date, "yyyy-MM-dd", CultureInfo.InvariantCulture);
                //                //var yourNewString_final = dateTime_final.ToString("yyyy-MM-dd");

                //                string final_date = z_row.Attributes["E_DATE"].Value.ToString();
                //                var yourNewString_final = DateTime.Parse(final_date);

                //                string canselled;
                //                if (z_row.Attributes["CANCELLED"].Value == "0")
                //                    canselled = "0";
                //                else if (z_row.Attributes["CANCELLED"].Value == "1")
                //                    canselled = "1";
                //                else canselled = "-1";
                //                if (listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                //                {
                //                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                //                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 7").Count() > 0)
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 7");
                //                        ExportImportService.Execute("insert into apr_tempspeed (period_id, start_km, start_m, final_km, final_m, reason_id,canselled, passenger, freight, empty_freight,start_date,final_date) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value
                //                           + reason_id + ", " + canselled + ", " + speed + ", " + ", " + speed + ", " + speed + ", " + speed + ", " + yourNewString_start + ", " + yourNewString_final + ")");
                //                    }
                //                    else
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 7) returning ID");
                //                        ExportImportService.Execute("insert into apr_tempspeed (period_id, start_km, start_m, final_km, final_m, reason_id,canselled, passenger, freight, empty_freight,start_date,final_date) values" +
                //                            " (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value
                //                        + reason_id + ", " + canselled + ", " + speed + ", " + speed + ", " + speed + ", " + speed + ",' " + yourNewString_start + "', '" + yourNewString_final + "')");
                //                    }
                //                }
                //                count = count + 1;
                //            }
                //        }
                //    }
                //}
                //progressBar.PerformStep();
                //foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "COM.xml"))//Готово
                //{
                //    var count = 0;
                //    XmlDocument xmlDocument = new XmlDocument();
                //    xmlDocument.Load(file.FullName);
                //    XmlElement xmlElement = xmlDocument.DocumentElement;
                //    foreach (XmlNode xmlNode in xmlElement)
                //    {

                //        if (xmlNode.Name == "com")
                //        {
                //            if (count > 0)
                //                continue;
                //            foreach (XmlNode z_row in xmlNode.ParentNode)
                //            {
                //                string objectID;
                //                if (z_row.Attributes["NAME"].Value.ToLower() == "энергокабель")
                //                    objectID = "85";
                //                else if (z_row.Attributes["NAME"].Value.ToLower() == "нефтепровод")
                //                    objectID = "86";
                //                else if (z_row.Attributes["NAME"].Value.ToLower() == "кабель связи")
                //                    objectID = "87";
                //                else if (z_row.Attributes["NAME"].Value.ToLower() == "водопровод")
                //                    objectID = "88";
                //                else if (z_row.Attributes["NAME"].Value.ToLower() == "канализация")
                //                    objectID = "89";
                //                else if (z_row.Attributes["NAME"].Value.ToLower() == "турбопровод")
                //                    objectID = "90";
                //                else if (z_row.Attributes["NAME"].Value.ToLower() == "теплотрасса")
                //                    objectID = "91";
                //                else if (z_row.Attributes["NAME"].Value.ToLower() == "теплосеть")
                //                    objectID = "92";
                //                else if (z_row.Attributes["NAME"].Value.ToLower() == "кабельная линия")
                //                    objectID = "93";
                //                else if (z_row.Attributes["NAME"].Value.ToLower() == "влэп")
                //                    objectID = "94";
                //                else if (z_row.Attributes["NAME"].Value.ToLower() == "магистральный кабель")
                //                    objectID = "95";
                //                else if (z_row.Attributes["NAME"].Value.ToLower() == "путепровод")
                //                    objectID = "96";
                //                else if (z_row.Attributes["NAME"].Value.ToLower() == "трасса гидрозолоудаления")
                //                    objectID = "97";
                //                else if (z_row.Attributes["NAME"].Value.ToLower() == "клэп")
                //                    objectID = "98";
                //                else if (z_row.Attributes["NAME"].Value.ToLower() == "коллектор канализационный")
                //                    objectID = "99";
                //                else if (z_row.Attributes["NAME"].Value.ToLower() == "золопровод")
                //                    objectID = "100";
                //                else if (z_row.Attributes["NAME"].Value.ToLower() == "паропровод")
                //                    objectID = "101";
                //                else if (z_row.Attributes["NAME"].Value.ToLower() == "газопровод")
                //                    objectID = "102";
                //                else objectID = "35";
                //                if (listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                //                {
                //                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                //                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 31").Count() > 0)
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 31");
                //                        ExportImportService.Execute("insert into apr_communication (PERIOD_ID, OBJECT_ID, KM, METER) values (" + periodID.ToString() + ", " + objectID + ", " + z_row.Attributes["KM"].Value + ", " + z_row.Attributes["M"].Value + ")");
                //                    }
                //                    else
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 31) returning ID");
                //                        ExportImportService.Execute("insert into apr_communication (PERIOD_ID, OBJECT_ID, KM, METER) values (" + periodID.ToString() + ", " + objectID + ", " + z_row.Attributes["KM"].Value + ", " + z_row.Attributes["M"].Value + ")");
                //                    }

                //                }
                //                count = count + 1;
                //            }
                //        }
                //    }
                //}

                //progressBar.PerformStep();



                //foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "DZP.xml"))
                //{
                //    XmlDocument xmlDocument = new XmlDocument();
                //    xmlDocument.Load(file.FullName);
                //    XmlElement xmlElement = xmlDocument.DocumentElement;
                //    var count = 0;
                //    foreach (XmlNode xmlNode in xmlElement)
                //    {
                //        if (xmlNode.Name == "dzp")
                //        {
                //            if (count > 0)
                //                continue;
                //            foreach (XmlNode z_row in xmlNode.ParentNode)//Готово
                //            {
                //                string defEarth = z_row.Attributes["NAME"].Value;

                //                int defEarthID = 0;
                //                if (defEarth.Contains("Длит.ос-ки на подх.к мост"))
                //                {
                //                    defEarthID = 18;

                //                }

                //                switch (defEarth)
                //                {
                //                    case "выпирание грунтов в выемке":
                //                        defEarthID = 1;
                //                        break;
                //                    case "карсты":
                //                        defEarthID = 2;
                //                        break;
                //                    case "осадка из-за выпора грунтов":
                //                        defEarthID = 3;
                //                        break;
                //                    case "осадка из-за сползания насыпи":
                //                        defEarthID = 4;
                //                        break;
                //                    case "Расползание насыпи":
                //                        defEarthID = 5;
                //                        break;
                //                    case "сплыв откоса выемки":
                //                        defEarthID = 6;
                //                        break;
                //                    case "вывал":
                //                        defEarthID = 7;
                //                        break;
                //                    case "оползень":
                //                        defEarthID = 8;
                //                        break;
                //                    case "оползень, осадка":
                //                        defEarthID = 9;
                //                        break;
                //                    case "оползень, сплыв":
                //                        defEarthID = 10;
                //                        break;
                //                    case "сплыв":
                //                        defEarthID = 11;
                //                        break;
                //                    case "сплыв, оползень":
                //                        defEarthID = 12;
                //                        break;
                //                    case "Осадки и перекосы из-за выпора":
                //                        defEarthID = 13;
                //                        break;
                //                    case "Пучина":
                //                        defEarthID = 14;
                //                        break;
                //                    case "Карсты":
                //                        defEarthID = 15;
                //                        break;
                //                    case "Осадки пути из-за протаивания":
                //                        defEarthID = 16;
                //                        break;
                //                    case "Осадки пути из-за слаб.грунтов":
                //                        defEarthID = 17;
                //                        break;

                //                    case "Длит.ос-ки на подх.к мост&amp;труб":
                //                        defEarthID = 18;
                //                        break;

                //                    case "Осадки пути из-за расползания":
                //                        defEarthID = 19;
                //                        break;
                //                    case "Осадки пути из-за сползания":
                //                        defEarthID = 20;
                //                        break;



                //                }

                //                if (listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                //                {
                //                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                //                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 33").Count() > 0)
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 33");
                //                        ExportImportService.Execute("insert into apr_defects_earth (PERIOD_ID, start_km, start_m, final_km, final_m, type_id) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + ", " + defEarthID.ToString() + ")");
                //                    }
                //                    else
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 33) returning ID");
                //                        ExportImportService.Execute("insert into apr_defects_earth (PERIOD_ID, start_km, start_m, final_km, final_m, type_id) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + ", " + defEarthID.ToString() + ")");
                //                    }
                //                }
                //                count = count + 1;
                //            }
                //        }
                //    }
                //}
                //foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "GNSSS.xml"))//Готово
                //{
                //    XmlDocument xmlDocument = new XmlDocument();
                //    xmlDocument.Load(file.FullName);
                //    XmlElement xmlElement = xmlDocument.DocumentElement;
                //    var count = 0;
                //    foreach (XmlNode xmlNode in xmlElement)
                //    {
                //        if (xmlNode.Name == "gnss")
                //        {
                //            if (count > 0)
                //                continue;
                //            foreach (XmlNode z_row in xmlNode.ParentNode)
                //            {
                //                int km = int.Parse(z_row.Attributes["KM"].Value);
                //                string meter = z_row.Attributes["M"].Value;
                //                string lat = z_row.Attributes["LAT"].Value;
                //                string lon = z_row.Attributes["LON"].Value;
                //                string high = z_row.Attributes["HGT"].Value;
                //                int gnssid = int.Parse(z_row.Attributes["GNSSID"].Value);
                //                var track = z_row.Attributes["TRACK"].Value;
                //                int up_nom = int.Parse(z_row.Attributes["UP_NOM"].Value);
                //                string assetnum = (z_row.Attributes["ASSETNUM"].Value).ToString();
                //                if (listIDs.Where(tmp => tmp.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value.ToString()) && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                //                {
                //                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value.ToString()) && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;

                //                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 32").Count() > 0)
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 32");
                //                        ExportImportService.Execute("insert into apr_coordinate_gnss (period_id, km, meter, latitude, longtitude, altitude, ) values (" + periodID.ToString() + ", " + km + ", " + meter + ", " + lat + ", " + lon + ", " + high + ")");
                //                    }
                //                    else
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 32) returning ID");
                //                        ExportImportService.Execute("insert into apr_coordinate_gnss (period_id, km, meter, latitude, longtitude, altitude) values (" + periodID.ToString() + "," + km + ", " + meter + ", " + lat + ", " + lon + ", " + high + ")");
                //                    }
                //                }
                //                count = count + 1;
                //            }
                //        }
                //    }
                //}
                //progressBar.PerformStep();




                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "SCR.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "scr")
                        {
                            if (count > 0)
                                continue;

                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {
                                string Type = z_row.Attributes["TYPE"].Value;//track расположение на фрагментах



                                int brace_type_id = 0;


                                switch (Type)
                                {
                                    case "0":
                                        brace_type_id = 11;
                                        //KB
                                        break;
                                    case "1":
                                        brace_type_id = 7;
                                        //ARS
                                        break;
                                    case "2":
                                        brace_type_id = 2;
                                        //ЖБР
                                        break;
                                    case "3":
                                        brace_type_id = 12;

                                        break;
                                    case "4":
                                        brace_type_id = 5;

                                        break;
                                    case "5":
                                        brace_type_id = 13;

                                        break;
                                    case "6":
                                        brace_type_id = 9;

                                        break;
                                    case "7":
                                        brace_type_id = 14;

                                        break;
                                    case "8":
                                        brace_type_id = 15;

                                        //СБ-3
                                        break;
                                    case "9":
                                        brace_type_id = 16;

                                        //Pandrol,
                                        break;
                                    case "10":
                                        brace_type_id = 10;

                                        //
                                        break;
                                }





                                if (listIDs.Where(tmp => tmp.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                                {
                                    //result = db.Execute("UPDATE APR_TRACKCLASS SET START_KM=@skm, START_M=@sm, FINAL_KM=@fkm, FINAL_M=@fm, CLASS_ID=@classid WHERE ID=@id",
                                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 4").Count() > 0)
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 4");
                                        ExportImportService.Execute("insert into apr_rails_braces (PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M,brace_type_id) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + "," + brace_type_id + ")");
                                    }
                                    else
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 4) returning ID");
                                        ExportImportService.Execute("insert into apr_rails_braces (PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M,brace_type_id) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + "," + brace_type_id + ")");
                                    }
                                }
                                count = count + 1;
                            }
                        }
                    }
                }



                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "CAT.xml"))//Готово "категория пути"
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "cat")
                        {
                            if (count > 0)
                                continue;

                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {
                                string Type = z_row.Attributes["CAT"].Value;//track расположение на фрагментах



                                int traffic = 0;


                                switch (Type)
                                {
                                    case "0":
                                        traffic = 0;
                                        //KB
                                        break;
                                    case "1":
                                        traffic = 1;
                                        //ARS
                                        break;
                                    case "2":
                                        traffic = 2;
                                        //ЖБР
                                        break;
                                    case "3":
                                        traffic = 3;

                                        break;
                                    case "4":
                                        traffic = 4;

                                        break;
                                    case "5":
                                        traffic = 5;

                                        break;
                                    case "6":
                                        traffic = 6;

                                        break;
                                    case "7":
                                        traffic = 7;
                                        break;

                                }


                                if (listIDs.Where(tmp => tmp.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                                {
                                    //result = db.Execute("UPDATE APR_TRACKCLASS SET START_KM=@skm, START_M=@sm, FINAL_KM=@fkm, FINAL_M=@fm, CLASS_ID=@classid WHERE ID=@id",
                                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 24").Count() > 0)
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 24");
                                        ExportImportService.Execute("insert into apr_waycat (PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M,type_id) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + "," + traffic + ")");
                                    }
                                    else
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 24) returning ID");
                                        ExportImportService.Execute("insert into apr_waycat (PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M,type_id) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + "," + traffic + ")");
                                    }
                                }
                                count = count + 1;
                            }
                        }
                    }
                }
                progressBar.PerformStep();

                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "RLT.xml"))//Готово
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "rlt")
                        {
                            if (count > 0)
                                continue;
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {

                                string Type = z_row.Attributes["TYPE"].Value;//track расположение на фрагментах
                                int brace_type_id = 0;


                                switch (Type)
                                {
                                    case "0":
                                        brace_type_id = 1;
                                        //p75
                                        break;
                                    case "1":
                                        brace_type_id = 2;
                                        //Р65
                                        break;
                                    case "2":
                                        brace_type_id = 4;
                                        //Р50
                                        break;
                                    case "3":
                                        brace_type_id = 5;


                                        break;

                                }



                                if (listIDs.Where(tmp => tmp.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                                {

                                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 17").Count() > 0)
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 17");
                                        ExportImportService.Execute("insert into apr_rails_sections (PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M,type_id) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + "," + brace_type_id + ")");
                                    }
                                    else
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 17) returning ID");
                                        ExportImportService.Execute("insert into apr_rails_sections (PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M,type_id) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + "," + brace_type_id + ")");
                                    }
                                }
                                count = count + 1;
                            }
                        }
                    }
                }
                progressBar.PerformStep();

                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "ISSOUCH.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "issouch")
                        {
                            if (count > 0)
                                continue;
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {

                                string Type = z_row.Attributes["TYPE"].Value;//track расположение на фрагментах
                                int most = 0;


                                switch (Type)
                                {
                                    case "0":
                                        most = 0;
                                        //KB
                                        break;
                                    case "1":
                                        most = 1;
                                        //ARS
                                        break;
                                    case "2":
                                        most = 2;
                                        //ЖБР
                                        break;
                                    case "3":
                                        most = 3;
                                        break;
                                    case "4":
                                        most = 4;
                                        break;
                                    case "5":
                                        most = 5;
                                        break;
                                    case "6":
                                        most = 6;
                                        break;

                                }

                                if (listIDs.Where(tmp => tmp.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                                {

                                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 46").Count() > 0)
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 46");
                                        ExportImportService.Execute("insert into apr_issouch (PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M,ISSOUCH_TYPE_ID) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + "," + most + ")");
                                    }
                                    else
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 46) returning ID");
                                        ExportImportService.Execute("insert into apr_issouch (PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M,ISSOUCH_TYPE_ID) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + "," + most + ")");
                                    }
                                }
                                count = count + 1;
                            }
                        }
                    }
                }
                progressBar.PerformStep();






                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "CLASS_LINE.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "class_line")
                        {
                            if (count > 0)
                                continue;
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {

                                //string Type = z_row.Attributes["TYPE"].Value;//track расположение на фрагментах


                                var CLASS_NOM = z_row.Attributes["CLASS_NOM"].Value;



                                if (listIDs.Where(tmp => tmp.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                                {

                                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 49").Count() > 0)
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 49");
                                        ExportImportService.Execute("insert into apr_class_line (PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M,CLASS_NOM) values (" + periodID.ToString() + ", "
                                            + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + ", " + CLASS_NOM + ")");
                                    }
                                    else
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 49) returning ID");
                                        ExportImportService.Execute("insert into apr_class_line (PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M,CLASS_NOM) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + ", " + CLASS_NOM + ")");
                                    }
                                }
                                count = count + 1;
                            }
                        }
                    }
                }
                progressBar.PerformStep();

                //foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "FRAGS.xml"))
                //{
                //    XmlDocument xmlDocument = new XmlDocument();
                //    xmlDocument.Load(file.FullName);
                //    XmlElement xmlElement = xmlDocument.DocumentElement;
                //    var count = 0;
                //    foreach (XmlNode xmlNode in xmlElement)
                //    {
                //        if (xmlNode.Name == "frags")
                //        {
                //            if (count > 0)
                //                continue;
                //            foreach (XmlNode z_row in xmlNode.ChildNodes)
                //            {



                //                if (listIDs.Where(tmp => tmp.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                //                {

                //                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString()).First().NewTrackID;
                //                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 48").Count() > 0)
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 48");
                //                        ExportImportService.Execute("insert into apr_frags_ekasui (PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M,LENGTH,BEGIN_SWITCH_ID,end_prim_type,end_switch_id,class) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", "
                //                            + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + ", " + z_row.Attributes["LENGTH"].Value + ", " + z_row.Attributes["BEGIN_PRIM_TYPE"].Value + ", " + z_row.Attributes["BEGIN_SWITCH_ID"].Value + ", " + z_row.Attributes["END_PRIM_TYPE"].Value + ", "
                //                            + z_row.Attributes["END_SWITCH_ID"].Value + ", " + z_row.Attributes["CLASS"].Value + ")");
                //                    }
                //                    else
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 48) returning ID");
                //                        ExportImportService.Execute("insert into apr_frags_ekasui (PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M,LENGTH,BEGIN_SWITCH_ID,end_prim_type,end_switch_id,class) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", "
                //                          + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + ", " + z_row.Attributes["LENGTH"].Value + ", " + z_row.Attributes["BEGIN_PRIM_TYPE"].Value + ", " + z_row.Attributes["BEGIN_SWITCH_ID"].Value + ", " + z_row.Attributes["END_PRIM_TYPE"].Value + ", "
                //                          + z_row.Attributes["END_SWITCH_ID"].Value + ", " + z_row.Attributes["CLASS"].Value + ")");
                //                    }
                //                }
                //                count = count + 1;
                //            }
                //        }
                //    }
                //}
                //progressBar.PerformStep();

                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "LRR.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "lrr")
                        {
                            if (count > 0)
                                continue;
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {
                                string sideID = "2";
                                if (listIDs.Where(tmp => tmp.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                                {

                                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 13").Count() > 0)
                                    {

                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 13");
                                        ExportImportService.Execute("insert into APR_STRAIGHTENING_THREAD (PERIOD_ID, SIDE_ID, START_KM, START_M, FINAL_KM, FINAL_M) values (" + periodID.ToString() + ", " + sideID + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + ")");
                                    }
                                    else
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 13) returning ID");
                                        ExportImportService.Execute("insert into APR_STRAIGHTENING_THREAD (PERIOD_ID, SIDE_ID, START_KM, START_M, FINAL_KM, FINAL_M) values (" + periodID.ToString() + ", " + sideID + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + ")");
                                    }
                                }
                                count = count + 1;
                            }
                        }
                    }
                }
                //foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "RFID.xml"))
                //{
                //    XmlDocument xmlDocument = new XmlDocument();
                //    xmlDocument.Load(file.FullName);
                //    XmlElement xmlElement = xmlDocument.DocumentElement;
                //    var count = 0;
                //    foreach (XmlNode xmlNode in xmlElement)
                //    {
                //        if (xmlNode.Name == "rfid")
                //        {
                //            if (count > 0)
                //                continue;
                //            foreach (XmlNode z_row in xmlNode.ParentNode)
                //            {
                //                int km = int.Parse(z_row.Attributes["KM"].Value);
                //                string meter = z_row.Attributes["M"].Value;
                //                string mark = z_row.Attributes["ID"].Value;

                //                int up_nom = int.Parse(z_row.Attributes["UP_NOM"].Value);

                //                string sideID = "2";
                //                if (listIDs.Where(tmp => tmp.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                //                {
                //                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                //                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 27").Count() > 0)
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 27");
                //                        ExportImportService.Execute($@"insert into apr_rfid (period_id, mark, km, meter) values  (" + periodID.ToString() + ", " + mark + ", " + km + ", " + meter + ")");
                //                    }

                //                    else
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 27) returning ID");
                //                        ExportImportService.Execute($@"insert into apr_rfid (period_id, mark, km, meter) values  (" + periodID.ToString() + ", " + mark + ", " + km + ", " + meter + ")");
                //                    }

                //                }
                //                count = count + 1;
                //            }
                //        }
                //    }
                //}

                //progressBar.PerformStep();

                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "CLASS_PUT.xml"))//Готово
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "class_put")
                        {
                            if (count > 0)
                                continue;

                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {



                                var track = z_row.Attributes["TRACK"].Value;//track расположение на фрагментах
                                var CLASSPUTID = z_row.Attributes["CLASS_PUTID"].Value;//CLASSPUTID_EKASUI расположение на фрагментах
                                var CLASSNOM = z_row.Attributes["CLASS_NOM"].Value;//CLASSNOM_EKASUI расположение на фрагментах

                                if (CLASSNOM == "")
                                {
                                    CLASSNOM = "6";
                                }
                                int up_nom = int.Parse(z_row.Attributes["UP_NOM"].Value);
                                string assetnum = (z_row.Attributes["ASSETNUM"].Value).ToString();

                                if (listIDs.Where(tmp => tmp.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                                {
                                    //result = db.Execute("UPDATE APR_TRACKCLASS SET START_KM=@skm, START_M=@sm, FINAL_KM=@fkm, FINAL_M=@fm, CLASS_ID=@classid WHERE ID=@id",
                                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 3").Count() > 0)
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 3");
                                        ExportImportService.Execute("insert into apr_trackclass (PERIOD_ID,  START_KM, START_M, FINAL_KM, FINAL_M,class_id) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + "," + int.Parse(CLASSNOM) + ")");
                                    }
                                    else
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 3) returning ID");
                                        ExportImportService.Execute("insert into apr_trackclass (PERIOD_ID,  START_KM, START_M, FINAL_KM, FINAL_M,class_id) values (" + periodID.ToString() + ", " + z_row.Attributes["BEGIN_KM"].Value + ", " + z_row.Attributes["BEGIN_M"].Value + ", " + z_row.Attributes["END_KM"].Value + ", " + z_row.Attributes["END_M"].Value + "," + int.Parse(CLASSNOM) + ")");
                                    }
                                }
                                count = count + 1;
                            }
                        }
                    }
                }

                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "VUS.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "vus")
                        {
                            if (count > 0)
                                continue;
                            foreach (XmlNode z_row in xmlNode.ParentNode)//Готово
                            {
                                string start_km = z_row.Attributes["BEGIN_KM"].Value;

                                string start_m = z_row.Attributes["BEGIN_M"].Value;



                                string final_km = z_row.Attributes["END_KM"].Value;
                                string f_m = z_row.Attributes["END_M"].Value;

                                int final_m = int.Parse(f_m) - 1;
                                string passenger = z_row.Attributes["VPASS"].Value;
                                string freight = z_row.Attributes["VGR"].Value;
                                string empty = z_row.Attributes["VPOR"].Value;
                                string sapsan = z_row.Attributes["VSAPS"].Value;
                                string lastochka = z_row.Attributes["VLAST"].Value;
                                string strij = z_row.Attributes["VSTRIJ"].Value;
                                string alegro = z_row.Attributes["VSTRIJ"].Value;
                                string alegro_nk = z_row.Attributes["VSTRIJ"].Value;
                                if (listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value.ToString())).Count() > 0)
                                {
                                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value.ToString())).First().NewTrackID;
                                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 6").Count() > 0)
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 6");
                                        ExportImportService.Execute("insert into APR_SPEED (sapsan, lastochka,strij,alegro,alegro_nk, PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M, PASSENGER, FREIGHT, EMPTY_FREIGHT) values (" + sapsan + "," + lastochka + "," + strij + "," + alegro + "," + alegro_nk + "," + periodID.ToString() + ", " + start_km + "," + start_m + ", " + final_km + "," + final_m + ", " + passenger + "," + freight + ", " + empty + ")");
                                    }
                                    else
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 6) returning ID");
                                        ExportImportService.Execute("insert into APR_SPEED (sapsan, lastochka, strij,alegro,alegro_nk,PERIOD_ID, START_KM, START_M, FINAL_KM, FINAL_M, PASSENGER, FREIGHT, EMPTY_FREIGHT) values (" + sapsan + "," + lastochka + "," + strij + "," + alegro + "," + alegro_nk + "," + periodID.ToString() + ", " + start_km + "," + start_m + ", " + final_km + "," + final_m + ", " + passenger + "," + freight + ", " + empty + ")");
                                    }
                                }
                                count = count + 1;
                            }

                        }
                    }
                }

                progressBar.PerformStep();


                foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "GNSS.xml"))
                {
                    XmlDocument xmlDocument = new XmlDocument();
                    xmlDocument.Load(file.FullName);
                    XmlElement xmlElement = xmlDocument.DocumentElement;
                    var count = 0;
                    foreach (XmlNode xmlNode in xmlElement)
                    {
                        if (xmlNode.Name == "gnss")
                        {
                            if (count > 0)
                                continue;
                            foreach (XmlNode z_row in xmlNode.ParentNode)
                            {
                                int km = int.Parse(z_row.Attributes["KM"].Value);
                                string meter = z_row.Attributes["M"].Value;
                                string mark = z_row.Attributes["HGT"].Value;

                                int up_nom = int.Parse(z_row.Attributes["UP_NOM"].Value);

                                string sideID = "2";
                                if (listIDs.Where(tmp => tmp.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                                {
                                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 25").Count() > 0)
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 25");
                                        ExportImportService.Execute($@"insert into apr_ref_point (period_id, mark, km, meter) values  (" + periodID.ToString() + ", " + mark + ", " + km + ", " + meter + ")");
                                    }

                                    else
                                    {
                                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 25) returning ID");
                                        ExportImportService.Execute($@"insert into apr_ref_point (period_id, mark, km, meter) values  (" + periodID.ToString() + ", " + mark + ", " + km + ", " + meter + ")");
                                    }

                                }
                                count = count + 1;
                            }
                        }
                    }
                }

                //progressBar.PerformStep();
                //foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "GNSSS.xml"))
                //{
                //    XmlDocument xmlDocument = new XmlDocument();
                //    xmlDocument.Load(file.FullName);
                //    XmlElement xmlElement = xmlDocument.DocumentElement;
                //    var count = 0;
                //    foreach (XmlNode xmlNode in xmlElement)
                //    {
                //        if (xmlNode.Name == "gnss")
                //        {
                //            if (count > 0)
                //                continue;
                //            foreach (XmlNode z_row in xmlNode.ParentNode)
                //            {
                //                int km = int.Parse(z_row.Attributes["KM"].Value);
                //                string meter = z_row.Attributes["M"].Value;
                //                string mark = z_row.Attributes["HGT"].Value;

                //                int up_nom = int.Parse(z_row.Attributes["UP_NOM"].Value);

                //                string sideID = "2";
                //                if (listIDs.Where(tmp => tmp.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                //                {
                //                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                //                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 22").Count() > 0)
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 22");
                //                        ExportImportService.Execute($@"insert into apr_profmarks (period_id, profil, km, meter) values  (" + periodID.ToString() + ", " + mark + ", " + km + ", " + meter + ")");
                //                    }

                //                    else
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 22) returning ID");
                //                        ExportImportService.Execute($@"insert into apr_profmarks (period_id, profil, km, meter) values  (" + periodID.ToString() + ", " + mark + ", " + km + ", " + meter + ")");
                //                    }

                //                }
                //                count = count + 1;
                //            }
                //        }
                //    }
                //}

                //progressBar.PerformStep();





                //foreach (FileInfo file in fileInfo.Where(tmp => tmp.Name == "CRS.xml"))//Пересечения пока не нашел 
                //{
                //    XmlDocument xmlDocument = new XmlDocument();
                //    xmlDocument.Load(file.FullName);
                //    XmlElement xmlElement = xmlDocument.DocumentElement;
                //    var count = 0;
                //    foreach (XmlNode xmlNode in xmlElement)
                //    {
                //        if (xmlNode.Name == "crs")
                //        {
                //            if (count > 0)
                //                continue;

                //            foreach (XmlNode z_row in xmlNode.ChildNodes)
                //            {
                //                string Type = z_row.Attributes["TYPE"].Value;//track расположение на фрагментах



                //                int traffic = 0;


                //                switch (Type)
                //                {
                //                    case "0":
                //                        traffic = 0;
                //                        //KB
                //                        break;
                //                    case "1":
                //                        traffic = 1;
                //                        //ARS
                //                        break;
                //                    case "2":
                //                        traffic = 2;
                //                        //ЖБР
                //                        break;
                //                    case "3":
                //                        traffic = 3;

                //                        break;
                //                    case "4":
                //                        traffic = 4;

                //                        break;
                //                    case "5":
                //                        traffic = 5;

                //                        break;
                //                    case "6":
                //                        traffic = 6;

                //                        break;
                //                    case "7":
                //                        traffic = 7;
                //                        break;

                //                }


                //                if (listIDs.Where(tmp => tmp.OldTrackID.Equals(z_row.Attributes["PUT_NOM"].Value) && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).Count() > 0)
                //                {
                //                    //result = db.Execute("UPDATE APR_TRACKCLASS SET START_KM=@skm, START_M=@sm, FINAL_KM=@fkm, FINAL_M=@fm, CLASS_ID=@classid WHERE ID=@id",
                //                    Int64 trackID = listIDs.Where(tmp => tmp.OldTrackID == (z_row.Attributes["PUT_NOM"].Value).ToString() && tmp.OldDirectionID == int.Parse(z_row.Attributes["UP_NOM"].Value)).First().NewTrackID;
                //                    if (ExportImportService.ImportQueryReturnListLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 23").Count() > 0)
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("select ID from TPL_PERIOD where ADM_TRACK_ID = " + trackID.ToString() + " and MTO_TYPE = 23");
                //                        ExportImportService.Execute("insert into apr_traffic (PERIOD_ID, KM, M,traffic) values (" + periodID.ToString() + ", " + z_row.Attributes["KM"].Value + ", " + z_row.Attributes["M"].Value + "," + traffic + ")");
                //                    }
                //                    else
                //                    {
                //                        Int64 periodID = ExportImportService.ImportQueryReturnLong("insert into TPL_PERIOD (ADM_TRACK_ID, START_DATE, FINAL_DATE, MTO_TYPE) values (" + trackID.ToString() + ", \'" + period.Start_Date.ToString("yyyy-MM-dd") + "\', \'" + period.Final_Date.ToString("yyyy-MM-dd") + "\', 23) returning ID");
                //                        ExportImportService.Execute("insert into apr_traffic     (PERIOD_ID, KM, M,traffic) values (" + periodID.ToString() + ", " + z_row.Attributes["KM"].Value + ", " + z_row.Attributes["M"].Value + "," + traffic + ")");
                //                    }
                //                }
                //                count = count + 1;
                //            }
                //        }
                //    }
                //}
                //progressBar.PerformStep();



                //catch (Exception e)
                //{
                //    using (StreamWriter outputFile = new StreamWriter(logFile, true))
                //    {
                //        outputFile.WriteLine(z_row.Attributes["PUT_NOM"].Value + ", km: " + non_ext_km);
                //        outputFile.WriteLine(e.Message);
                //    }
                //}

                //else
                //{
                //    using (StreamWriter outputFile = new StreamWriter(logFile, true))
                //    {
                //        outputFile.WriteLine(z_row.Attributes["PUT_NOM"].Value + ", km: " + non_ext_km);
                //        outputFile.WriteLine("Путь по ID не найден");
                //    }
                //}


                /*
                        case "KV_PKO":
                        case "KV_RPERIOD":
                */

                var chita = "13807";
                string adm_direct_id = "";
                adm_direct_id = ExportImportService.ExportQueryReturnString($@"select id from adm_direction where code = '{chita}'");


                var adm_track_id = ExportImportService.ExportQueryReturnString($@"select id from adm_track where adm_direction_id = {adm_direct_id} and code = '2'");
                var adm_escort_id = ExportImportService.ExportQueryReturnString($@"select id from adm_distance where name = 'ПЧ-1'");
                var nod = ExportImportService.ExportQueryReturnString($@"select adm_nod_id from adm_distance where name = 'ПЧ-1'");

                var start_section = ExportImportService.ExportQueryReturnString($@"select id from adm_station where name = 'Могоча'");
                var final_section = ExportImportService.ExportQueryReturnString($@"select id from adm_station where name = 'Ерофей Павлович'");


                ExportImportService.Execute($@"INSERT INTO public.fragments(id, trip_id, adm_track_id, start_km, start_m, final_km, final_m, start_switch_id, final_switch_id, belong_id, direction) VALUES (1244, 410, {adm_track_id}, 6906, 750, 7209, 252, -1, -1, 1768198, NULL);");
                ExportImportService.Execute($@"INSERT INTO public.escort(id, trip_id, distance_id, fullname) VALUES (137, 410, {adm_escort_id}, '');");

                ExportImportService.Execute($@"UPDATE trips SET direction_id = {adm_direct_id} WHERE id =410;");
                ExportImportService.Execute($@"update trips set start_station = {start_section} where id =410;");
                ExportImportService.Execute($@"update trips set final_station = {final_section} where id =410;");
                ExportImportService.Execute($@"update trips set road_id = {nod} where id =410;");
            }
            return true;
        }

        internal static bool Import(FileInfo[] fileInfo, MetroFramework.Controls.MetroProgressBar progressBar, int import_type)
        {
            progressBar.Value = 0;
            progressBar.Step = 100 / 50;
            bool result = true;
            List<ImportListId> roadIds = new List<ImportListId>();
            List<ImportListId> tempIds = new List<ImportListId>();
            List<ImportListId> temp2Ids = new List<ImportListId>();
            List<ImportListId> distanceIds = new List<ImportListId>();
            List<ImportListId> pdbIds = new List<ImportListId>();
            List<ImportListId> stationIds = new List<ImportListId>();
            List<ImportListId> directionIds = new List<ImportListId>();
            List<ImportListId> trackIds = new List<ImportListId>();
            List<ImportListId> periodIds = new List<ImportListId>();

            if (fileInfo.Any(tmp => tmp.Name == "adm_road.csv"))
            {
                //ADM STRUCTURE
                using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "adm_road.csv").FullName))
                {
                    csvParser.CommentTokens = new string[] { "#" };
                    csvParser.SetDelimiters(new string[] { "," });
                    csvParser.HasFieldsEnclosedInQuotes = true;

                    string[] fields = csvParser.ReadFields();
                    int id = fields.ToList().IndexOf("id"), code = fields.ToList().IndexOf("code"), name = fields.ToList().IndexOf("name"), abbr = fields.ToList().IndexOf("abbr");

                    while (!csvParser.EndOfData)
                    {
                        fields = csvParser.ReadFields();
                        string Id = fields[id];
                        string Code = fields[code];
                        string Name = fields[name];

                        long newRoadId = ExportImportService.ImportQueryReturnLong($@"insert into adm_road (code, name,abbr) values ('{Code}', '{Name}','{abbr}') returning coalesce(id, -1)");

                        if (newRoadId > 0)
                            roadIds.Add(new ImportListId
                            {
                                NewId = newRoadId,
                                OldId = long.Parse(Id)
                            });
                    }
                }

                if (fileInfo.Any(tmp => tmp.Name == "adm_nod.csv") && roadIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "adm_nod.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), code = fields.ToList().IndexOf("code"), name = fields.ToList().IndexOf("name"), roadid = fields.ToList().IndexOf("adm_road_id");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string Code = fields[code];
                            string Name = fields[name];
                            string RoadId = fields[roadid];

                            if (roadIds.Any(r => r.OldId.Equals(long.Parse(RoadId))))
                            {
                                long newId = ExportImportService.ImportQueryReturnLong($@"insert into adm_nod (code, name, adm_road_id) values ('{Code}', '{Name}', {roadIds.First(r => r.OldId.Equals(long.Parse(RoadId))).NewId}) returning coalesce(id, -1)");

                                if (newId > 0)
                                    tempIds.Add(new ImportListId
                                    {
                                        NewId = newId,
                                        OldId = long.Parse(Id)
                                    });
                            }
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "adm_distance.csv") && tempIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "adm_distance.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), code = fields.ToList().IndexOf("code"), name = fields.ToList().IndexOf("name"), nodid = fields.ToList().IndexOf("adm_nod_id"), ekasui_id = fields.ToList().IndexOf("ekasui_id");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string Code = fields[code];
                            string Name = fields[name];
                            string NodId = fields[nodid];

                            if (tempIds.Any(r => r.OldId.Equals(long.Parse(NodId))))
                            {
                                long newId = ExportImportService.ImportQueryReturnLong($@"insert into adm_distance (code, name, adm_nod_id,ekasui_id) values ('{Code}', '{Name}', {tempIds.First(r => r.OldId.Equals(long.Parse(NodId))).NewId},'{ekasui_id}') returning coalesce(id, -1)");

                                if (newId > 0)
                                    distanceIds.Add(new ImportListId
                                    {
                                        NewId = newId,
                                        OldId = long.Parse(Id)
                                    });
                            }
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "adm_station.csv") && tempIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "adm_station.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), code = fields.ToList().IndexOf("code"), name = fields.ToList().IndexOf("name"), nodid = fields.ToList().IndexOf("adm_nod_id"), typeid = fields.ToList().IndexOf("type_id"), adm_direction_id = fields.ToList().IndexOf("adm_direction_id");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string TypeId = fields[typeid];
                            string NodId = fields[nodid];
                            string Code = fields[code];
                            string Name = fields[name];

                            if (tempIds.Any(r => r.OldId.Equals(long.Parse(NodId))))
                            {
                                long newId = ExportImportService.ImportQueryReturnLong($@"insert into adm_station (code, name, adm_nod_id, type_id,adm_direction_id) values ('{Code}', '{Name}', {tempIds.First(r => r.OldId.Equals(long.Parse(NodId))).NewId}, {TypeId},{adm_direction_id}) returning coalesce(id, -1)");

                                if (newId > 0)
                                    stationIds.Add(new ImportListId
                                    {
                                        NewId = newId,
                                        OldId = long.Parse(Id)
                                    });
                            }
                        }
                    }
                tempIds.Clear();
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "adm_pchu.csv") && distanceIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "adm_pchu.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), code = fields.ToList().IndexOf("code"), name = fields.ToList().IndexOf("chief_fullname"), distanceid = fields.ToList().IndexOf("adm_distance_id"), id_parent = fields.ToList().IndexOf("id_parent"), ekasui_id = fields.ToList().IndexOf("ekasui_id");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string DistanceId = fields[distanceid];
                            string Code = fields[code];
                            string Name = fields[name];

                            if (distanceIds.Any(r => r.OldId.Equals(long.Parse(DistanceId))))
                            {
                                long newId = ExportImportService.ImportQueryReturnLong($@"insert into adm_pchu (code, chief_fullname, adm_distance_id,id_parent,ekasui_id) values ('{Code}', '{Name}', {distanceIds.First(r => r.OldId.Equals(long.Parse(DistanceId))).NewId},{id_parent},{ekasui_id}) returning coalesce(id, -1)");

                                if (newId > 0)
                                    tempIds.Add(new ImportListId
                                    {
                                        NewId = newId,
                                        OldId = long.Parse(Id)
                                    });
                            }
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "adm_pd.csv") && tempIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "adm_pd.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), code = fields.ToList().IndexOf("code"), name = fields.ToList().IndexOf("chief_fullname"), pchuid = fields.ToList().IndexOf("adm_pchu_id"), id_parent = fields.ToList().IndexOf("id_parent"), ekasui_id = fields.ToList().IndexOf("ekasui_id");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PchuId = fields[pchuid];
                            string Code = fields[code];
                            string Name = fields[name];

                            if (tempIds.Any(r => r.OldId.Equals(long.Parse(PchuId))))
                            {
                                long newId = ExportImportService.ImportQueryReturnLong($@"insert into adm_pd (code, chief_fullname, adm_pchu_id,id_parent,ekasui_id) values ('{Code}', '{Name}', {tempIds.First(r => r.OldId.Equals(long.Parse(PchuId))).NewId},{id_parent},{ekasui_id}) returning coalesce(id, -1)");

                                if (newId > 0)
                                    temp2Ids.Add(new ImportListId
                                    {
                                        NewId = newId,
                                        OldId = long.Parse(Id)
                                    });
                            }
                        }
                    }
                tempIds.Clear();
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "adm_pdb.csv") && temp2Ids.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "adm_pdb.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), code = fields.ToList().IndexOf("code"), name = fields.ToList().IndexOf("chief_fullname"), pdid = fields.ToList().IndexOf("adm_pd_id"), id_parent = fields.ToList().IndexOf("id_parent"), ekasui_id = fields.ToList().IndexOf("ekasui_id");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PdId = fields[pdid];
                            string Code = fields[code];
                            string Name = fields[name];

                            if (temp2Ids.Any(r => r.OldId.Equals(long.Parse(PdId))))
                            {
                                long newId = ExportImportService.ImportQueryReturnLong($@"insert into adm_pdb (code, chief_fullname, adm_pd_id,id_parent,ekasui_id) values ('{Code}', '{Name}', {temp2Ids.First(r => r.OldId.Equals(long.Parse(PdId))).NewId},{id_parent},{ekasui_id}) returning coalesce(id, -1)");

                                if (newId > 0)
                                    pdbIds.Add(new ImportListId
                                    {
                                        NewId = newId,
                                        OldId = long.Parse(Id)
                                    });
                            }
                        }
                    }
                temp2Ids.Clear();
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "stw_park.csv") && stationIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "stw_park.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), typeid = fields.ToList().IndexOf("type_id"), name = fields.ToList().IndexOf("name"), stationid = fields.ToList().IndexOf("adm_station_id");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string TypeId = fields[typeid];
                            string StationId = fields[stationid];
                            string Name = fields[name];

                            if (stationIds.Any(r => r.OldId.Equals(long.Parse(StationId))))
                            {
                                long newId = ExportImportService.ImportQueryReturnLong($@"insert into stw_park (name, adm_station_id, type_id) values ('{Name}', {stationIds.First(r => r.OldId.Equals(long.Parse(StationId))).NewId}, {TypeId}) returning coalesce(id, -1)");

                                if (newId > 0)
                                    tempIds.Add(new ImportListId
                                    {
                                        NewId = newId,
                                        OldId = long.Parse(Id)
                                    });
                            }
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "stw_object.csv") && tempIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "stw_object.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), typeid = fields.ToList().IndexOf("type_id"), name = fields.ToList().IndexOf("name"), parkid = fields.ToList().IndexOf("stw_park_id");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string Name = fields[name];
                            string ParkId = fields[parkid];
                            string TypeId = fields[typeid];

                            if (tempIds.Any(r => r.OldId.Equals(long.Parse(ParkId))))
                                ExportImportService.Execute($@"insert into stw_object (name, stw_park_id, type_id) values ('{Name}', {tempIds.First(r => r.OldId.Equals(long.Parse(ParkId))).NewId}, {TypeId}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "adm_direction.csv"))
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "adm_direction.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), code = fields.ToList().IndexOf("code"), name = fields.ToList().IndexOf("name");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string Code = fields[code];
                            string Name = fields[name];

                            long newId = ExportImportService.ImportQueryReturnLong($@"insert into adm_direction (code, name) values ('{Code}', '{Name}') returning coalesce(id, -1)");

                            if (newId > 0)
                                directionIds.Add(new ImportListId
                                {
                                    NewId = newId,
                                    OldId = long.Parse(Id)
                                });
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "road_direction.csv") && roadIds.Any() && directionIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "road_direction.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), roadid = fields.ToList().IndexOf("road_id"), directionid = fields.ToList().IndexOf("direction_id");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string RoadId = fields[roadid];
                            string DirectionId = fields[directionid];

                            if (roadIds.Any(r => r.OldId.Equals(long.Parse(RoadId))) && directionIds.Any(d => d.OldId.Equals(long.Parse(DirectionId))))
                            {
                                ExportImportService.Execute($@"insert into road_direction (road_id, direction_id) values ({roadIds.First(r => r.OldId.Equals(long.Parse(RoadId))).NewId}, {directionIds.First(d => d.OldId.Equals(long.Parse(DirectionId))).NewId}) returning coalesce(id, -1)");

                                if (!temp2Ids.Any(t => t.OldId.Equals(long.Parse(DirectionId))))
                                    temp2Ids.Add(new ImportListId
                                    {
                                        NewId = directionIds.First(d => d.OldId.Equals(long.Parse(DirectionId))).NewId,
                                        OldId = long.Parse(DirectionId)
                                    });
                            }
                        }
                    }
                directionIds.Clear();
                directionIds.AddRange(temp2Ids);
                temp2Ids.Clear();
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "adm_track.csv"))
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "adm_track.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), code = fields.ToList().IndexOf("code"), directionid = fields.ToList().IndexOf("adm_direction_id"), up_nom = fields.ToList().IndexOf("up_nom"), adm_station_id = fields.ToList().IndexOf("adm_station_id");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string Code = fields[code];
                            string DirectionId = fields[directionid];

                            if (!string.IsNullOrEmpty(DirectionId))
                            {
                                if (directionIds.Any(r => r.OldId.Equals(long.Parse(DirectionId))))
                                {
                                    long newId = ExportImportService.ImportQueryReturnLong($@"insert into adm_track (code, adm_direction_id,up_nom,adm_station_id) values ('{Code}', {directionIds.First(r => r.OldId.Equals(long.Parse(DirectionId))).NewId},{up_nom},{adm_station_id}) returning coalesce(id, -1)");

                                    if (newId > 0)
                                        trackIds.Add(new ImportListId
                                        {
                                            NewId = newId,
                                            OldId = long.Parse(Id)
                                        });
                                }
                            }
                            else
                            {
                                long newId = ExportImportService.ImportQueryReturnLong($@"insert into adm_track (code, adm_direction_id,up_nom,adm_station_id) values ('{Code}', null,null,null) returning coalesce(id, -1)");

                                if (newId > 0)
                                    temp2Ids.Add(new ImportListId
                                    {
                                        NewId = newId,
                                        OldId = long.Parse(Id)
                                    });
                            }
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "stw_track.csv") && temp2Ids.Any() && stationIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "stw_track.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), trackid = fields.ToList().IndexOf("adm_track_id"), stationid = fields.ToList().IndexOf("adm_station_id"), typeid = fields.ToList().IndexOf("type_id");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string StationId = fields[stationid];
                            string TypeId = fields[typeid];
                            string TrackId = fields[trackid];

                            if (stationIds.Any(r => r.OldId.Equals(long.Parse(StationId))) && temp2Ids.Any(r => r.OldId.Equals(long.Parse(TrackId))))
                            {
                                ExportImportService.Execute($@"insert into stw_track (adm_station_id, adm_track_id, type_id) values ({stationIds.First(r => r.OldId.Equals(long.Parse(StationId))).NewId}, {temp2Ids.First(r => r.OldId.Equals(long.Parse(TrackId))).NewId}, {TypeId}) returning coalesce(id, -1)");

                                if (!trackIds.Any(r => r.OldId.Equals(long.Parse(TrackId))))
                                    trackIds.Add(new ImportListId
                                    {
                                        NewId = temp2Ids.First(r => r.OldId.Equals(long.Parse(TrackId))).NewId,
                                        OldId = long.Parse(TrackId)
                                    });
                            }
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "stw_park_track.csv") && temp2Ids.Any() && tempIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "stw_park_track.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), parkid = fields.ToList().IndexOf("stw_park_id"), typeid = fields.ToList().IndexOf("type_id"), trackid = fields.ToList().IndexOf("adm_track_id");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string ParkId = fields[parkid];
                            string TypeId = fields[typeid];
                            string TrackId = fields[trackid];

                            if (tempIds.Any(r => r.OldId.Equals(long.Parse(ParkId))) && temp2Ids.Any(r => r.OldId.Equals(long.Parse(TrackId))))
                            {
                                ExportImportService.Execute($@"insert into stw_park_track (stw_park_id, adm_track_id, type_id) values ({tempIds.First(r => r.OldId.Equals(long.Parse(ParkId))).NewId}, {temp2Ids.First(r => r.OldId.Equals(long.Parse(TrackId))).NewId}, {TypeId}) returning coalesce(id, -1)");

                                if (!trackIds.Any(r => r.OldId.Equals(long.Parse(TrackId))))
                                    trackIds.Add(new ImportListId
                                    {
                                        NewId = temp2Ids.First(r => r.OldId.Equals(long.Parse(TrackId))).NewId,
                                        OldId = long.Parse(TrackId)
                                    });
                            }
                        }
                    }
                tempIds.Clear();
                temp2Ids.Clear();
                roadIds.Clear();
                directionIds.Clear();
                progressBar.PerformStep();

                //PERIOD
                if (fileInfo.Any(tmp => tmp.Name == "tpl_period.csv") && trackIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "tpl_period.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), startdate = fields.ToList().IndexOf("start_date"), finaldate = fields.ToList().IndexOf("final_date"), trackid = fields.ToList().IndexOf("adm_track_id"), changedate = fields.ToList().IndexOf("change_date"), comment = fields.ToList().IndexOf("comment"), mtotype = fields.ToList().IndexOf("mto_type");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string TrackId = fields[trackid];
                            string StartDate = fields[startdate];
                            string FinalDate = fields[finaldate];
                            string ChangeDate = fields[changedate];
                            string Comment = fields[comment];
                            string MtoType = fields[mtotype];

                            if (trackIds.Any(r => r.OldId.Equals(long.Parse(TrackId))))
                            {
                                long newId = ExportImportService.ImportQueryReturnLong($@"insert into tpl_period (adm_track_id, start_date, final_date, change_date, comment, mto_type) values ({trackIds.First(r => r.OldId.Equals(long.Parse(TrackId))).NewId}, '{StartDate}', '{FinalDate}', {(string.IsNullOrEmpty(ChangeDate) ? "null" : "\'" + ChangeDate + "\'")}, {(string.IsNullOrEmpty(Comment) ? "null" : "\'" + Comment + "\'")}, {MtoType}) returning coalesce(id, -1)");

                                if (newId > 0)
                                    periodIds.Add(new ImportListId
                                    {
                                        NewId = newId,
                                        OldId = long.Parse(Id)
                                    });
                            }
                        }
                    }
                progressBar.PerformStep();

                //MTO STRUCTURE
                if (fileInfo.Any(tmp => tmp.Name == "apr_artificial_construction.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_artificial_construction.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), typeid = fields.ToList().IndexOf("type_id"), km = fields.ToList().IndexOf("km"), meter = fields.ToList().IndexOf("meter"), len = fields.ToList().IndexOf("len");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string Km = fields[km];
                            string Meter = fields[meter];
                            string TypeId = fields[typeid];
                            string Len = fields[len];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_artificial_construction (period_id, type_id, km, meter, len) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {TypeId}, {Km}, {Meter}, {Len}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_ballast.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_ballast.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), ballast = fields.ToList().IndexOf("ballast"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string Ballast = fields[ballast];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_ballast (period_id, start_km, start_m, final_km, final_m, ballast) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {Ballast}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_cham_joint.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_cham_joint.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), typeid = fields.ToList().IndexOf("type_id"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string TypeId = fields[typeid];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_cham_joint (period_id, start_km, start_m, final_km, final_m, type_id) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {TypeId}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_communication.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_communication.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), objectid = fields.ToList().IndexOf("object_id"),
                            km = fields.ToList().IndexOf("km"), meter = fields.ToList().IndexOf("meter");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string Km = fields[km];
                            string Meter = fields[meter];
                            string ObjectId = fields[objectid];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_communication (period_id, object_id, km, meter) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {ObjectId}, {Km}, {Meter}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_coordinate_gnss.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_coordinate_gnss.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"),
                            km = fields.ToList().IndexOf("km"), meter = fields.ToList().IndexOf("meter"),
                            alti = fields.ToList().IndexOf("altitude"), longti = fields.ToList().IndexOf("longtitude"), lati = fields.ToList().IndexOf("latitude"),
                            coord = fields.ToList().IndexOf("exact_coordinate"), height = fields.ToList().IndexOf("exact_height");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string Km = fields[km];
                            string Meter = fields[meter];
                            string Latitude = fields[lati];
                            string Longtitude = fields[longti];
                            string Altitude = fields[alti];
                            string Coordinate = fields[coord];
                            string Height = fields[height];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_coordinate_gnss (period_id, km, meter, latitude, longtitude, altitude, exact_coordinate, exact_height) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {Km}, {Meter}, {Latitude}, {Longtitude}, {Altitude}, {Coordinate}, {Height}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_crosstie.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_crosstie.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), typeid = fields.ToList().IndexOf("crosstie_type_id"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string TypeId = fields[typeid];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_crosstie (period_id, start_km, start_m, final_km, final_m, crosstie_type_id) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {TypeId}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_curve.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_curve.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), sideid = fields.ToList().IndexOf("side_id"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string SideId = fields[sideid];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                            {
                                long newId = ExportImportService.ImportQueryReturnLong($@"insert into apr_curve (period_id, start_km, start_m, final_km, final_m, side_id) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {SideId}) returning coalesce(id, -1)");

                                if (newId > 0)
                                {
                                    tempIds.Add(new ImportListId
                                    {
                                        NewId = newId,
                                        OldId = long.Parse(Id)
                                    });
                                }
                            }
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_defects_earth.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_defects_earth.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), typeid = fields.ToList().IndexOf("type_id"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string TypeId = fields[typeid];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_defects_earth (period_id, start_km, start_m, final_km, final_m, type_id) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {TypeId}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_dimension.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_dimension.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), typeid = fields.ToList().IndexOf("type_id"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string TypeId = fields[typeid];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_dimension (period_id, start_km, start_m, final_km, final_m, type_id) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {TypeId}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_elcurve.csv") && tempIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_elcurve.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), curveid = fields.ToList().IndexOf("curve_id"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m"),
                            lvl = fields.ToList().IndexOf("lvl"), t1 = fields.ToList().IndexOf("transition_1"), t2 = fields.ToList().IndexOf("transition_2");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string CurveId = fields[curveid];
                            string Lvl = fields[lvl];
                            string Tran1 = fields[t1];
                            string Tran2 = fields[t2];

                            if (tempIds.Any(r => r.OldId.Equals(long.Parse(CurveId))))
                                ExportImportService.Execute($@"insert into apr_elcurve (curve_id, start_km, start_m, final_km, final_m, lvl, transition_1, transition_2) values ({tempIds.First(r => r.OldId.Equals(long.Parse(CurveId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {Lvl}, {Tran1}, {Tran2}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_elevation.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_elevation.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), lvlid = fields.ToList().IndexOf("level_id"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string LevelId = fields[lvlid];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_elevation (period_id, start_km, start_m, final_km, final_m, level_id) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {LevelId}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_long_rails.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_long_rails.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), typeid = fields.ToList().IndexOf("type_id"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string TypeId = fields[typeid];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_long_rails (period_id, start_km, start_m, final_km, final_m, type_id) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {TypeId}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_norma_width.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_norma_width.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), norma = fields.ToList().IndexOf("norma_width"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string Norma = fields[norma];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_norma_width (period_id, start_km, start_m, final_km, final_m, norma_width) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {Norma}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_profmarks.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_profmarks.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), profil = fields.ToList().IndexOf("profil"),
                            km = fields.ToList().IndexOf("km"), meter = fields.ToList().IndexOf("meter");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string Km = fields[km];
                            string Meter = fields[meter];
                            string Profil = fields[4];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_profmarks (period_id, profil, km, meter) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {Profil}, {Km}, {Meter}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_rails_braces.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_rails_braces.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), typeid = fields.ToList().IndexOf("brace_type_id"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string TypeId = fields[typeid];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_rails_braces (period_id, start_km, start_m, final_km, final_m, brace_type_id) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {TypeId}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_rails_sections.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_rails_sections.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), typeid = fields.ToList().IndexOf("type_id"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string TypeId = fields[typeid];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_rails_sections (period_id, start_km, start_m, final_km, final_m, type_id) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {TypeId}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_ref_point.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_ref_point.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), mark = fields.ToList().IndexOf("mark"),
                            km = fields.ToList().IndexOf("km"), meter = fields.ToList().IndexOf("meter");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string Km = fields[km];
                            string Meter = fields[meter];
                            string Mark = fields[mark];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_ref_point (period_id, mark, km, meter) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {Mark}, {Km}, {Meter}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_rfid.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_rfid.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), mark = fields.ToList().IndexOf("mark"),
                            km = fields.ToList().IndexOf("km"), meter = fields.ToList().IndexOf("meter"), len = fields.ToList().IndexOf("len");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string Km = fields[km];
                            string Meter = fields[meter];
                            string Mark = fields[mark];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_rfid (period_id, mark, km, meter) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, '{Mark}', {Km}, {Meter}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_speed.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_speed.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), sapsan = fields.ToList().IndexOf("sapsan"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m"),
                            last = fields.ToList().IndexOf("lastochka"), pass = fields.ToList().IndexOf("passenger"), frei = fields.ToList().IndexOf("freight"), emfrei = fields.ToList().IndexOf("empty_freight");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string Sapsan = fields[sapsan];
                            string Lastochka = fields[last];
                            string Pass = fields[pass];
                            string Frei = fields[frei];
                            string EmFrei = fields[emfrei];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_speed (period_id, start_km, start_m, final_km, final_m, sapsan, lastochka, passenger, freight, empty_freight) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {Sapsan}, {Lastochka}, {Pass}, {Frei}, {EmFrei}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_stcurve.csv") && tempIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_stcurve.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), curveid = fields.ToList().IndexOf("curve_id"), wear = fields.ToList().IndexOf("wear"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m"),
                            radius = fields.ToList().IndexOf("radius"), t1 = fields.ToList().IndexOf("transition_1"), t2 = fields.ToList().IndexOf("transition_2"), width = fields.ToList().IndexOf("width");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string CurveId = fields[curveid];
                            string Radius = fields[radius];
                            string Tran1 = fields[t1];
                            string Tran2 = fields[t2];
                            string Width = fields[width];
                            string Wear = fields[wear];

                            if (tempIds.Any(r => r.OldId.Equals(long.Parse(CurveId))))
                                ExportImportService.Execute($@"insert into apr_stcurve (curve_id, start_km, start_m, final_km, final_m, radius, transition_1, transition_2, width, wear) values ({tempIds.First(r => r.OldId.Equals(long.Parse(CurveId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {Radius}, {Tran1}, {Tran2}, {Width}, {Wear}) returning coalesce(id, -1)");
                        }
                    }
                tempIds.Clear();
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_straightening_thread.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_straightening_thread.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), sideid = fields.ToList().IndexOf("side_id"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string SideId = fields[sideid];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_straightening_thread (period_id, start_km, start_m, final_km, final_m, side_id) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {SideId}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_tempspeed.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_tempspeed.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m"),
                            reason = fields.ToList().IndexOf("reason_id"), pass = fields.ToList().IndexOf("passenger"), frei = fields.ToList().IndexOf("freight"), emfrei = fields.ToList().IndexOf("empty_freight"),
                            startdate = fields.ToList().IndexOf("start_date"), finaldate = fields.ToList().IndexOf("final_date");
                        //date = fields.ToList().IndexOf("repair_date");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string ReasonId = fields[reason];
                            // string RepairDate = fields[date];
                            string Sdate = fields[startdate];
                            string fdate = fields[finaldate];
                            string Pass = fields[pass];
                            string Frei = fields[frei];
                            string EmFrei = fields[emfrei];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_tempspeed (period_id, start_km, start_m, final_km, final_m, reason_id, passenger, freight, empty_freight,start_date,final_date) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {ReasonId}, {Pass}, {Frei}, {EmFrei},'{Sdate}','{fdate}') returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_trackclass.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_trackclass.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), classid = fields.ToList().IndexOf("class_id"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string ClassId = fields[classid];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_trackclass (period_id, start_km, start_m, final_km, final_m, class_id) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {ClassId}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_traffic.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_traffic.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), traffic = fields.ToList().IndexOf("traffic"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string Traffic = fields[traffic];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_traffic (period_id, start_km, start_m, final_km, final_m, traffic) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {Traffic}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "apr_waycat.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "apr_waycat.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), typeid = fields.ToList().IndexOf("type_id"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string TypeId = fields[typeid];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into apr_waycat (period_id, start_km, start_m, final_km, final_m, type_id) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {TypeId}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "repair_project.csv") && trackIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "repair_project.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), trackid = fields.ToList().IndexOf("adm_track_id"), typeid = fields.ToList().IndexOf("type_id"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m"),
                            accept = fields.ToList().IndexOf("accept_id"), date = fields.ToList().IndexOf("repair_date");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string TrackId = fields[trackid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string TypeId = fields[typeid];
                            string AcceptId = fields[accept];
                            string RepairDate = fields[date];

                            if (trackIds.Any(r => r.OldId.Equals(long.Parse(TrackId))))
                                ExportImportService.Execute($@"insert into repair_project (adm_track_id, start_km, start_m, final_km, final_m, type_id, accept_id, repair_date) values ({trackIds.First(r => r.OldId.Equals(long.Parse(TrackId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {TypeId}, {AcceptId}, '{RepairDate}') returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "tpl_check_sections.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "tpl_check_sections.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m"),
                            aw = fields.ToList().IndexOf("avg_width"), al = fields.ToList().IndexOf("avg_level"), sw = fields.ToList().IndexOf("sko_width"), sl = fields.ToList().IndexOf("sko_level");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string AvgW = fields[aw];
                            string AvgL = fields[al];
                            string SkoW = fields[sw];
                            string SkoL = fields[sl];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into tpl_check_sections (period_id, start_km, start_m, final_km, final_m, avg_width, avg_level, sko_width, sko_level) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {AvgW}, {AvgL}, {SkoW}, {SkoL}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "tpl_deep.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "tpl_deep.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into tpl_deep (period_id, start_km, start_m, final_km, final_m) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "tpl_dist_section.csv") && periodIds.Any() && distanceIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "tpl_dist_section.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), distid = fields.ToList().IndexOf("adm_distance_id"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string DistanceId = fields[distid];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))) && distanceIds.Any(r => r.OldId.Equals(long.Parse(DistanceId))))
                                ExportImportService.Execute($@"insert into tpl_dist_section (period_id, start_km, start_m, final_km, final_m, adm_distance_id) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {distanceIds.First(r => r.OldId.Equals(long.Parse(DistanceId))).NewId}) returning coalesce(id, -1)");
                        }
                    }
                distanceIds.Clear();
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "tpl_distance_between_tracks.csv") && periodIds.Any() && trackIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "tpl_distance_between_tracks.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), leftid = fields.ToList().IndexOf("left_adm_track_id"), rightid = fields.ToList().IndexOf("right_adm_track_id"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m"),
                            lm = fields.ToList().IndexOf("left_m"), rm = fields.ToList().IndexOf("right_m");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string LeftM = fields[lm];
                            string LeftTrack = fields[leftid];
                            string RightM = fields[rm];
                            string RightTrack = fields[rightid];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))) && trackIds.Any(r => r.OldId.Equals(long.Parse(LeftTrack))) && trackIds.Any(r => r.OldId.Equals(long.Parse(RightTrack))))
                                ExportImportService.Execute($@"insert into tpl_distance_between_tracks (period_id, start_km, start_m, final_km, final_m, left_m, right_m, left_adm_track_id, right_adm_track_id) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {LeftM}, {RightM}, {trackIds.First(r => r.OldId.Equals(long.Parse(LeftTrack))).NewId}, {trackIds.First(r => r.OldId.Equals(long.Parse(RightTrack))).NewId}) returning coalesce(id, -1)");
                        }
                    }
                trackIds.Clear();
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "tpl_non_ext_km.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "tpl_non_ext_km.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"),
                            km = fields.ToList().IndexOf("km");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string Km = fields[km];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into tpl_non_ext_km (period_id, km) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {Km}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "tpl_nst_km.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "tpl_nst_km.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"),
                            km = fields.ToList().IndexOf("km"), len = fields.ToList().IndexOf("len");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string Km = fields[km];
                            string Len = fields[len];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into tpl_nst_km (period_id, km, len) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {Km}, {Len}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "tpl_pdb_section.csv") && periodIds.Any() && pdbIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "tpl_pdb_section.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), pdbid = fields.ToList().IndexOf("adm_pdb_id"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string PdbId = fields[pdbid];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))) && pdbIds.Any(r => r.OldId.Equals(long.Parse(PdbId))))
                                ExportImportService.Execute($@"insert into tpl_pdb_section (period_id, start_km, start_m, final_km, final_m, adm_pdb_id) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {pdbIds.First(r => r.OldId.Equals(long.Parse(PdbId))).NewId}) returning coalesce(id, -1)");
                        }
                    }
                pdbIds.Clear();
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "tpl_profile_object.csv") && periodIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "tpl_profile_object.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), objid = fields.ToList().IndexOf("object_id"),
                            km = fields.ToList().IndexOf("km"), meter = fields.ToList().IndexOf("meter"), sid = fields.ToList().IndexOf("side_id");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string Km = fields[km];
                            string Meter = fields[meter];
                            string ObjectId = fields[objid];
                            string SideId = fields[sid];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))))
                                ExportImportService.Execute($@"insert into tpl_profile_object (period_id, object_id, side_id, km, meter) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {ObjectId}, {SideId}, {Km}, {Meter}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "tpl_station_section.csv") && periodIds.Any() && stationIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "tpl_station_section.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), stationid = fields.ToList().IndexOf("station_id"),
                            startkm = fields.ToList().IndexOf("start_km"), startm = fields.ToList().IndexOf("start_m"), finalkm = fields.ToList().IndexOf("final_km"), finalm = fields.ToList().IndexOf("final_m"),
                            axiskm = fields.ToList().IndexOf("axis_km"), axism = fields.ToList().IndexOf("axis_m"), pointid = fields.ToList().IndexOf("point_id");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string StartKm = fields[startkm];
                            string StartM = fields[startm];
                            string FinalKm = fields[finalkm];
                            string FinalM = fields[finalm];
                            string StationId = fields[stationid];
                            string PointId = fields[pointid];
                            string AxisKm = fields[axiskm];
                            string AxisM = fields[axism];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))) && stationIds.Any(r => r.OldId.Equals(long.Parse(StationId))))
                                ExportImportService.Execute($@"insert into tpl_station_section (period_id, start_km, start_m, final_km, final_m, axis_km, axis_m, point_id, station_id) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {StartKm}, {StartM}, {FinalKm}, {FinalM}, {AxisKm}, {AxisM}, {PointId}, {stationIds.First(r => r.OldId.Equals(long.Parse(StationId))).NewId}) returning coalesce(id, -1)");
                        }
                    }
                progressBar.PerformStep();

                if (fileInfo.Any(tmp => tmp.Name == "tpl_switch.csv") && periodIds.Any() && stationIds.Any())
                    using (TextFieldParser csvParser = new TextFieldParser(fileInfo.FirstOrDefault(f => f.Name == "tpl_switch.csv").FullName))
                    {
                        csvParser.CommentTokens = new string[] { "#" };
                        csvParser.SetDelimiters(new string[] { "," });
                        csvParser.HasFieldsEnclosedInQuotes = true;

                        string[] fields = csvParser.ReadFields();
                        int id = fields.ToList().IndexOf("id"), periodid = fields.ToList().IndexOf("period_id"), stationid = fields.ToList().IndexOf("station_id"),
                            km = fields.ToList().IndexOf("km"), meter = fields.ToList().IndexOf("meter"), sid = fields.ToList().IndexOf("side_id"),
                            pid = fields.ToList().IndexOf("point_id"), mid = fields.ToList().IndexOf("mark_id"), did = fields.ToList().IndexOf("dir_id"), num = fields.ToList().IndexOf("num");

                        while (!csvParser.EndOfData)
                        {
                            fields = csvParser.ReadFields();
                            string Id = fields[id];
                            string PeriodId = fields[periodid];
                            string Km = fields[km];
                            string Meter = fields[meter];
                            string StationId = fields[stationid];
                            string SideId = fields[sid];
                            string PointId = fields[pid];
                            string MarkId = fields[mid];
                            string DirId = fields[did];
                            string Num = fields[num];

                            if (periodIds.Any(r => r.OldId.Equals(long.Parse(PeriodId))) && stationIds.Any(r => r.OldId.Equals(long.Parse(StationId))))
                                ExportImportService.Execute($@"insert into tpl_switch (period_id, station_id, point_id, side_id, km, meter, mark_id, dir_id, num) values ({periodIds.First(r => r.OldId.Equals(long.Parse(PeriodId))).NewId}, {stationIds.First(r => r.OldId.Equals(long.Parse(StationId))).NewId}, {PointId}, {SideId}, {Km}, {Meter}, {MarkId}, {DirId}, '{Num}') returning coalesce(id, -1)");
                        }
                    }
                stationIds.Clear();
                periodIds.Clear();
                progressBar.PerformStep();
            }
            else
            {
                result = false;
            }

            return result;
        }
    }
}




//using system;
//using system.collections.generic;
//using system.globalization;
//using system.io;
//using system.linq;
//using system.text;
//using system.threading.tasks;
//using system.xml;
//using alarm.core;
//using alarm.services;
//using microsoft.visualbasic.fileio;

//namespace alarm
//{
//    public static class importandexport
//    {
//        internal static bool export(metroframework.controls.metroprogressbar progressbar, long admroadid, datetime date)
//        {
//            string roadname = "";
//            if (admroadid != -1)
//                roadname = exportimportservice.exportqueryreturnstring($@"select name from adm_road where id = {admroadid}");
//            else
//                roadname = "all";
//            string dirname = system.io.directory.getcurrentdirectory() + "\\export_alarm\\" + transliter.cyrtolat(roadname) + "_" + date.tostring("dd_mm_yyyy");
//            directoryinfo dirinfo = new directoryinfo(dirname);

//            if (!dirinfo.exists)
//                dirinfo.create();

//            progressbar.value = 0;
//            progressbar.step = 100 / 50;
//            bool result = true;
//            if (admroadid != -1)
//            {
//                // adm_structure
//                result &= exportimportservice.execute($@"copy (select * from adm_road where id = {admroadid}) to '{dirname + "\\adm_road.csv"}' with csv delimiter ',' header;");

//                result &= exportimportservice.execute($@"copy (select * from adm_nod where adm_road_id = {admroadid}) to '{dirname + "\\adm_nod.csv"}' with csv delimiter ',' header;");
//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select distance.* from adm_distance distance
//                    inner join adm_nod nod on nod.id = distance.adm_nod_id
//                    where nod.adm_road_id = {admroadid}) to '{dirname + "\\adm_distance.csv"}' with csv delimiter ',' header;");
//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select pchu.* from adm_pchu pchu
//                    inner join adm_distance distance on distance.id = pchu.adm_distance_id
//                    inner join adm_nod nod on nod.id = distance.adm_nod_id
//                    where nod.adm_road_id = {admroadid}) to '{dirname + "\\adm_pchu.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select pd.* from adm_pd pd
//                    inner join adm_pchu pchu on pchu.id = pd.adm_pchu_id
//                    inner join adm_distance distance on distance.id = pchu.adm_distance_id
//                    inner join adm_nod nod on nod.id = distance.adm_nod_id
//                    where nod.adm_road_id = {admroadid}) to '{dirname + "\\adm_pd.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select pdb.* from adm_pdb pdb
//                    inner join adm_pd pd on pd.id = pdb.adm_pd_id
//                    inner join adm_pchu pchu on pchu.id = pd.adm_pchu_id
//                    inner join adm_distance distance on distance.id = pchu.adm_distance_id
//                    inner join adm_nod nod on nod.id = distance.adm_nod_id
//                    where nod.adm_road_id = {admroadid}) to '{dirname + "\\adm_pdb.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select rd.* from road_direction rd
//                    where rd.road_id = {admroadid}) to '{dirname + "\\road_direction.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select direction.* from adm_direction direction
//                    inner join road_direction rd on rd.direction_id = direction.id
//                    where rd.road_id = {admroadid}) to '{dirname + "\\adm_direction.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select track.* from adm_track track
//                    where track.adm_direction_id in (select direction.id from adm_direction direction
//                        inner join road_direction rd on rd.road_id = {admroadid} and rd.direction_id = direction.id)
//                    or track.id in (select strack.adm_track_id from stw_track strack
//                        inner join adm_nod nod on nod.adm_road_id = {admroadid}
//                        inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
//                    or track.id in (select strack.adm_track_id from stw_park_track strack
//                        inner join adm_nod nod on nod.adm_road_id = {admroadid}
//                        inner join adm_station station on station.adm_nod_id = nod.id 
//                        inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id)
//                    ) to '{dirname + "\\adm_track.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select station.* from adm_station station
//                    inner join adm_nod nod on nod.id = station.adm_nod_id
//                    where nod.adm_road_id = {admroadid}) to '{dirname + "\\adm_station.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select park.* from stw_park park
//                    inner join adm_station station on station.id = park.adm_station_id
//                    inner join adm_nod nod on nod.id = station.adm_nod_id
//                    where nod.adm_road_id = {admroadid}) to '{dirname + "\\stw_park.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select sobject.* from stw_object sobject
//                    inner join stw_park park on park.id = sobject.stw_park_id
//                    inner join adm_station station on station.id = park.adm_station_id
//                    inner join adm_nod nod on nod.id = station.adm_nod_id
//                    where nod.adm_road_id = {admroadid}) to '{dirname + "\\stw_object.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select strack.* from stw_track strack
//                    inner join adm_station station on station.id = strack.adm_station_id
//                    inner join adm_nod nod on nod.id = station.adm_nod_id
//                    where nod.adm_road_id = {admroadid}) to '{dirname + "\\stw_track.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select strack.* from stw_park_track strack
//                    inner join stw_park park on park.id = strack.stw_park_id
//                    inner join adm_station station on station.id = park.adm_station_id
//                    inner join adm_nod nod on nod.id = station.adm_nod_id
//                    where nod.adm_road_id = {admroadid}) to '{dirname + "\\stw_park_track.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                //period
//                result &= exportimportservice.execute($@"copy (select tpl_period.* from tpl_period
//                    where (tpl_period.adm_track_id in (select track.id from adm_track track
//                        inner join road_direction rd on rd.road_id = {admroadid} and rd.direction_id = track.adm_direction_id)
//                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_track strack
//                        inner join adm_nod nod on nod.adm_road_id = {admroadid}
//                        inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
//                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_park_track strack
//                        inner join adm_nod nod on nod.adm_road_id = {admroadid}
//                        inner join adm_station station on station.adm_nod_id = nod.id 
//                        inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id))
//                    and ('{date.tostring("dd-mm-yyyy")}' between tpl_period.start_date and tpl_period.final_date)
//                    ) to '{dirname + "\\tpl_period.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                //mto structure
//                list<string> mtostructure = new list<string> { "apr_artificial_construction", "apr_ballast", "apr_cham_joint", "apr_communication", "apr_coordinate_gnss", "apr_crosstie", "apr_curve", "apr_defects_earth", "apr_dimension",
//                    "apr_elevation", "apr_long_rails", "apr_norma_width", "apr_profmarks", "apr_rails_braces", "apr_rails_sections", "apr_ref_point", "apr_rfid", "apr_speed", "apr_straightening_thread", "apr_tempspeed", "apr_trackclass",
//                    "apr_traffic", "apr_waycat", "tpl_check_sections", "tpl_deep", "tpl_dist_section", "tpl_distance_between_tracks", "tpl_non_ext_km", "tpl_nst_km", "tpl_pdb_section", "tpl_profile_object", "tpl_station_section", "tpl_switch"
//                };

//                foreach (var nameofstructure in mtostructure)
//                {
//                    result &= exportimportservice.execute($@"copy (select struct.* from {nameofstructure} struct
//                        inner join tpl_period tpl_period on tpl_period.id = struct.period_id
//                        where (tpl_period.adm_track_id in (select track.id from adm_track track
//                            inner join road_direction rd on rd.road_id = {admroadid} and rd.direction_id = track.adm_direction_id)
//                        or tpl_period.adm_track_id in (select strack.adm_track_id from stw_track strack
//                            inner join adm_nod nod on nod.adm_road_id = {admroadid}
//                            inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
//                        or tpl_period.adm_track_id in (select strack.adm_track_id from stw_park_track strack
//                            inner join adm_nod nod on nod.adm_road_id = {admroadid}
//                            inner join adm_station station on station.adm_nod_id = nod.id 
//                            inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id))
//                        and ('{date.tostring("dd-mm-yyyy")}' between tpl_period.start_date and tpl_period.final_date)
//                        ) to '{$@"{dirname}\\{nameofstructure}.csv"}' with csv delimiter ',' header;");

//                    progressbar.performstep();
//                }

//                result &= exportimportservice.execute($@"copy (select elcurve.* from apr_elcurve elcurve
//                    inner join apr_curve curve on curve.id = elcurve.curve_id
//                    inner join tpl_period tpl_period on tpl_period.id = curve.period_id
//                    where (tpl_period.adm_track_id in (select track.id from adm_track track
//                        inner join road_direction rd on rd.road_id = {admroadid} and rd.direction_id = track.adm_direction_id)
//                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_track strack
//                        inner join adm_nod nod on nod.adm_road_id = {admroadid}
//                        inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
//                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_park_track strack
//                        inner join adm_nod nod on nod.adm_road_id = {admroadid}
//                        inner join adm_station station on station.adm_nod_id = nod.id 
//                        inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id))
//                    and ('{date.tostring("dd-mm-yyyy")}' between tpl_period.start_date and tpl_period.final_date)
//                    ) to '{$@"{dirname}\\apr_elcurve.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select stcurve.* from apr_stcurve stcurve
//                    inner join apr_curve curve on curve.id = stcurve.curve_id
//                    inner join tpl_period tpl_period on tpl_period.id = curve.period_id
//                    where (tpl_period.adm_track_id in (select track.id from adm_track track
//                        inner join road_direction rd on rd.road_id = {admroadid} and rd.direction_id = track.adm_direction_id)
//                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_track strack
//                        inner join adm_nod nod on nod.adm_road_id = {admroadid}
//                        inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
//                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_park_track strack
//                        inner join adm_nod nod on nod.adm_road_id = {admroadid}
//                        inner join adm_station station on station.adm_nod_id = nod.id 
//                        inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id))
//                    and ('{date.tostring("dd-mm-yyyy")}' between tpl_period.start_date and tpl_period.final_date)
//                    ) to '{$@"{dirname}\\apr_stcurve.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select repair.* from repair_project repair 
//                        where repair.adm_track_id in (select track.id from adm_track track
//                            inner join road_direction rd on rd.road_id = {admroadid} and rd.direction_id = track.adm_direction_id)
//                        or repair.adm_track_id in (select strack.adm_track_id from stw_track strack
//                            inner join adm_nod nod on nod.adm_road_id = {admroadid}
//                            inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
//                        or repair.adm_track_id in (select strack.adm_track_id from stw_park_track strack
//                            inner join adm_nod nod on nod.adm_road_id = {admroadid}
//                            inner join adm_station station on station.adm_nod_id = nod.id 
//                            inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id)
//                        ) to '{$@"{dirname}\\repair_project.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();
//            }
//            else
//            {
//                // adm_structure
//                result &= exportimportservice.execute($@"copy (select * from adm_road) to '{dirname + "\\adm_road.csv"}' with csv delimiter ',' header;");


//                result &= exportimportservice.execute($@"copy (select * from adm_nod where adm_road_id in (select id from adm_road)) to '{dirname + "\\adm_nod.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select distance.* from adm_distance distance
//                    inner join adm_nod nod on nod.id = distance.adm_nod_id
//                    where nod.adm_road_id in (select id from adm_road)) to '{dirname + "\\adm_distance.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select pchu.* from adm_pchu pchu
//                    inner join adm_distance distance on distance.id = pchu.adm_distance_id
//                    inner join adm_nod nod on nod.id = distance.adm_nod_id
//                    where nod.adm_road_id in (select id from adm_road)) to '{dirname + "\\adm_pchu.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select pd.* from adm_pd pd
//                    inner join adm_pchu pchu on pchu.id = pd.adm_pchu_id
//                    inner join adm_distance distance on distance.id = pchu.adm_distance_id
//                    inner join adm_nod nod on nod.id = distance.adm_nod_id
//                    where nod.adm_road_id in (select id from adm_road)) to '{dirname + "\\adm_pd.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select pdb.* from adm_pdb pdb
//                    inner join adm_pd pd on pd.id = pdb.adm_pd_id
//                    inner join adm_pchu pchu on pchu.id = pd.adm_pchu_id
//                    inner join adm_distance distance on distance.id = pchu.adm_distance_id
//                    inner join adm_nod nod on nod.id = distance.adm_nod_id
//                    where nod.adm_road_id in (select id from adm_road)) to '{dirname + "\\adm_pdb.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select rd.* from road_direction rd
//                    where rd.road_id in (select id from adm_road)) to '{dirname + "\\road_direction.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select direction.* from adm_direction direction
//                    inner join road_direction rd on rd.direction_id = direction.id
//                    where rd.road_id in (select id from adm_road)) to '{dirname + "\\adm_direction.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select track.* from adm_track track
//                    where track.adm_direction_id in (select direction.id from adm_direction direction
//                        inner join road_direction rd on rd.road_id in (select id from adm_road) and rd.direction_id = direction.id)
//                    or track.id in (select strack.adm_track_id from stw_track strack
//                        inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
//                        inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
//                    or track.id in (select strack.adm_track_id from stw_park_track strack
//                        inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
//                        inner join adm_station station on station.adm_nod_id = nod.id 
//                        inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id)
//                    ) to '{dirname + "\\adm_track.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select station.* from adm_station station
//                    inner join adm_nod nod on nod.id = station.adm_nod_id
//                    where nod.adm_road_id in (select id from adm_road)) to '{dirname + "\\adm_station.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select park.* from stw_park park
//                    inner join adm_station station on station.id = park.adm_station_id
//                    inner join adm_nod nod on nod.id = station.adm_nod_id
//                    where nod.adm_road_id in (select id from adm_road)) to '{dirname + "\\stw_park.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select sobject.* from stw_object sobject
//                    inner join stw_park park on park.id = sobject.stw_park_id
//                    inner join adm_station station on station.id = park.adm_station_id
//                    inner join adm_nod nod on nod.id = station.adm_nod_id
//                    where nod.adm_road_id in (select id from adm_road)) to '{dirname + "\\stw_object.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select strack.* from stw_track strack
//                    inner join adm_station station on station.id = strack.adm_station_id
//                    inner join adm_nod nod on nod.id = station.adm_nod_id
//                    where nod.adm_road_id in (select id from adm_road)) to '{dirname + "\\stw_track.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select strack.* from stw_park_track strack
//                    inner join stw_park park on park.id = strack.stw_park_id
//                    inner join adm_station station on station.id = park.adm_station_id
//                    inner join adm_nod nod on nod.id = station.adm_nod_id
//                    where nod.adm_road_id in (select id from adm_road)) to '{dirname + "\\stw_park_track.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                //period
//                result &= exportimportservice.execute($@"copy (select tpl_period.* from tpl_period
//                    where (tpl_period.adm_track_id in (select track.id from adm_track track
//                        inner join road_direction rd on rd.road_id in (select id from adm_road) and rd.direction_id = track.adm_direction_id)
//                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_track strack
//                        inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
//                        inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
//                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_park_track strack
//                        inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
//                        inner join adm_station station on station.adm_nod_id = nod.id 
//                        inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id))
//                    and ('{date.tostring("dd-mm-yyyy")}' between tpl_period.start_date and tpl_period.final_date)
//                    ) to '{dirname + "\\tpl_period.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                //mto structure
//                list<string> mtostructure = new list<string> { "apr_artificial_construction", "apr_ballast", "apr_cham_joint", "apr_communication", "apr_coordinate_gnss", "apr_crosstie", "apr_curve", "apr_defects_earth", "apr_dimension",
//                    "apr_elevation", "apr_long_rails", "apr_norma_width", "apr_profmarks", "apr_rails_braces", "apr_rails_sections", "apr_ref_point", "apr_rfid", "apr_speed", "apr_straightening_thread", "apr_tempspeed", "apr_trackclass",
//                    "apr_traffic", "apr_waycat", "tpl_check_sections", "tpl_deep", "tpl_dist_section", "tpl_distance_between_tracks", "tpl_non_ext_km", "tpl_nst_km", "tpl_pdb_section", "tpl_profile_object", "tpl_station_section", "tpl_switch"
//                };

//                foreach (var nameofstructure in mtostructure)
//                {
//                    result &= exportimportservice.execute($@"copy (select struct.* from {nameofstructure} struct
//                        inner join tpl_period tpl_period on tpl_period.id = struct.period_id
//                        where (tpl_period.adm_track_id in (select track.id from adm_track track
//                            inner join road_direction rd on rd.road_id in (select id from adm_road) and rd.direction_id = track.adm_direction_id)
//                        or tpl_period.adm_track_id in (select strack.adm_track_id from stw_track strack
//                            inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
//                            inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
//                        or tpl_period.adm_track_id in (select strack.adm_track_id from stw_park_track strack
//                            inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
//                            inner join adm_station station on station.adm_nod_id = nod.id 
//                            inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id))
//                        and ('{date.tostring("dd-mm-yyyy")}' between tpl_period.start_date and tpl_period.final_date)
//                        ) to '{$@"{dirname}\\{nameofstructure}.csv"}' with csv delimiter ',' header;");

//                    progressbar.performstep();
//                }

//                result &= exportimportservice.execute($@"copy (select elcurve.* from apr_elcurve elcurve
//                    inner join apr_curve curve on curve.id = elcurve.curve_id
//                    inner join tpl_period tpl_period on tpl_period.id = curve.period_id
//                    where (tpl_period.adm_track_id in (select track.id from adm_track track
//                        inner join road_direction rd on rd.road_id in (select id from adm_road) and rd.direction_id = track.adm_direction_id)
//                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_track strack
//                        inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
//                        inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
//                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_park_track strack
//                        inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
//                        inner join adm_station station on station.adm_nod_id = nod.id 
//                        inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id))
//                    and ('{date.tostring("dd-mm-yyyy")}' between tpl_period.start_date and tpl_period.final_date)
//                    ) to '{$@"{dirname}\\apr_elcurve.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select stcurve.* from apr_stcurve stcurve
//                    inner join apr_curve curve on curve.id = stcurve.curve_id
//                    inner join tpl_period tpl_period on tpl_period.id = curve.period_id
//                    where (tpl_period.adm_track_id in (select track.id from adm_track track
//                        inner join road_direction rd on rd.road_id in (select id from adm_road) and rd.direction_id = track.adm_direction_id)
//                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_track strack
//                        inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
//                        inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
//                    or tpl_period.adm_track_id in (select strack.adm_track_id from stw_park_track strack
//                        inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
//                        inner join adm_station station on station.adm_nod_id = nod.id 
//                        inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id))
//                    and ('{date.tostring("dd-mm-yyyy")}' between tpl_period.start_date and tpl_period.final_date)
//                    ) to '{$@"{dirname}\\apr_stcurve.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();

//                result &= exportimportservice.execute($@"copy (select repair.* from repair_project repair 
//                        where repair.adm_track_id in (select track.id from adm_track track
//                            inner join road_direction rd on rd.road_id in (select id from adm_road) and rd.direction_id = track.adm_direction_id)
//                        or repair.adm_track_id in (select strack.adm_track_id from stw_track strack
//                            inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
//                            inner join adm_station station on station.adm_nod_id = nod.id and station.id = strack.adm_station_id)
//                        or repair.adm_track_id in (select strack.adm_track_id from stw_park_track strack
//                            inner join adm_nod nod on nod.adm_road_id in (select id from adm_road)
//                            inner join adm_station station on station.adm_nod_id = nod.id 
//                            inner join stw_park park on park.adm_station_id = station.id and park.id = strack.stw_park_id)
//                        ) to '{$@"{dirname}\\repair_project.csv"}' with csv delimiter ',' header;");

//                progressbar.performstep();
//            }

//            return result;
//        }

//        internal static bool import(fileinfo[] fileinfo, metroframework.controls.metroprogressbar progressbar, int import_type, long road_id, long nod_id, period period)
//        {

//            //for (int i = 19; i < 346; i++)
//            //{
//            //    var droptable = rdstructureservice.droptable(i);
//            //}




//            console.writeline("tables dropped successfully.");
//            string dirname = system.io.directory.getcurrentdirectory() + "\\logs";
//            directoryinfo dirinfo = new directoryinfo(dirname);

//            if (!dirinfo.exists)
//                dirinfo.create();

//            string logfile = system.io.directory.getcurrentdirectory() + "\\logs\\import_log.txt";

//            using (streamwriter outputfile = new streamwriter(logfile, false))
//            {
//                outputfile.writeline(datetime.now);
//                outputfile.writeline(fileinfo.first().directoryname);
//                outputfile.writeline();
//            }

//            list<importlistdirtrackid> listids = new list<importlistdirtrackid>();
//            list<importlistdirtrackid> ekasui_listids = new list<importlistdirtrackid>();

//            list<importliststationid> liststationids = new list<importliststationid>();
//            list<importlistcurveid> listcurveids = new list<importlistcurveid>();
//            list<importlistcurveid> newlistcurveid = new list<importlistcurveid>();

//            list<importlistcurveid> listpapaids = new list<importlistcurveid>();
//            list<importlistcurveid> listlevelids = new list<importlistcurveid>();

//            bool curveadd = false;
//            importlistcurveid listcurveid = new importlistcurveid();
//            importlistcurveid listcurveid_old = new importlistcurveid();
//            importlistcurveid listcurveid_new = new importlistcurveid();
//            list<importlistelcurve> listelcurves = new list<importlistelcurve>();
//            list<importliststcurve> liststcurves = new list<importliststcurve>();
//            list<importlistpdbid> listpdbids = new list<importlistpdbid>();

//            list<importliststationsection> liststationsections = new list<importliststationsection>();

//            importlistekasui list_ekasui_curve = new importlistekasui();
//            list<importlistekasui> list_ekasui_curves = new list<importlistekasui>();




//            var select_tpl_peiod = exportimportservice.exportlistperiod("select * from tpl_period ");
//            if (select_tpl_peiod.count() > 0)
//            {
//                var start_date = select_tpl_peiod.last().start_date;
//                var final_date = select_tpl_peiod.last().final_date;
//                var new_finaldate = period.start_date;
//                datetime new_date = final_date.adddays(-1);

//                var nestart_date = exportimportservice.execute($@"update tpl_period set start_date = '{start_date}', final_date = '{new_date}' where start_date = '{start_date}' and final_date ='{final_date}'");
//            }






//            progressbar.value = 0;
//            progressbar.step = 100 / 20;

//            if (fileinfo.where(tmp => tmp.name == "way.xml").count() > 0)
//            {
//                progressbar.performstep();
//                list<importlistdirtrackid> listdirid = new list<importlistdirtrackid>();
//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "way.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;

//                    listcurveid_new = new importlistcurveid();
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "way")
//                        {
//                            if (count > 0)
//                                continue;
//                            var contains = exportimportservice.exportlist("select * from ekasui_way");
//                            if (contains.count() > 0)
//                            {
//                                contains = exportimportservice.exportlist("delete from ekasui_way");
//                            }
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {
//                                var assetnum = z_row.attributes["assetnum"].value;

//                                var upnom = z_row.attributes["up_nom"].value;
//                                var location = z_row.attributes["location"].value;
//                                var put_nom = z_row.attributes["nom"].value;

//                                exportimportservice.execute("insert into ekasui_way (assetnum, put_nom, up_nom, location) values ('" + assetnum + "','" + put_nom + "','" + upnom + "','" + location + "')");
//                                count = count + 1;
//                            }
//                        }
//                    }
//                }
//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "curves.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;

//                    listcurveid_new = new importlistcurveid();
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "curves")
//                        {
//                            if (count > 0)
//                                continue;

//                            var contains = exportimportservice.exportlist("select * from ekasui_curves");
//                            if (contains.count() > 0)
//                            {
//                                contains = exportimportservice.exportlist("delete from ekasui_curves");
//                            }
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {


//                                var assetnum = z_row.attributes["assetnum"].value;
//                                var curveid = z_row.attributes["curveid"].value;
//                                var kmn_start_km = z_row.attributes["kmn"].value;
//                                var mn_start_m = z_row.attributes["mn"].value;
//                                var kmk_final_km = z_row.attributes["kmk"].value;
//                                var mk_final_m = z_row.attributes["mk"].value;
//                                var l = z_row.attributes["l"].value;
//                                var r = z_row.attributes["r"].value;
//                                var napr = z_row.attributes["napr"].value;
//                                var siteid = z_row.attributes["siteid"].value;

//                                exportimportservice.execute("insert into ekasui_curves (assetnum, kmn,mn,kmk,mk,l,r,napr,curveid,siteid) values ('" + assetnum + "','" + kmn_start_km + "','" + mn_start_m + "','" +
//                                    kmk_final_km + "','" + mk_final_m + "','" + l + "','" + r + "','" + napr + "','" + curveid + "','" + siteid + "')");
//                                count = count + 1;
//                            }

//                        }
//                    }
//                }

//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "stankm.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    var fl_st = false;
//                    var fl_ur = false;
//                    listcurveid_new = new importlistcurveid();
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "stankm")
//                        {
//                            if (count > 0)
//                                continue;
//                            var contains = exportimportservice.exportlist("select * from ekasui_stankm");
//                            if (contains.count() > 0)
//                            {
//                                contains = exportimportservice.exportlist("delete from ekasui_stankm");
//                            }
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {
//                                var upnom = z_row.attributes["up_nom"].value;
//                                var km = z_row.attributes["km"].value;
//                                var m = z_row.attributes["m"].value;
//                                var siteid = z_row.attributes["siteid"].value;
//                                var stankmid = z_row.attributes["stankmid"].value;

//                                var rowstamp = z_row.attributes["rowstamp"].value;
//                                var code = z_row.attributes["code"].value;

//                                exportimportservice.execute("insert into ekasui_stankm (code, km, m, siteid, stankmid, up_nom, rowstamp) values (" + code + "," + km + "," + m + "," + siteid + "," + stankmid + "," + upnom + "," + rowstamp + ")");
//                                count = count + 1;
//                                if (upnom == "13808")
//                                {

//                                }

//                            }
//                        }
//                    }
//                }

//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "planpoints.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    var fl_st = false;
//                    var fl_ur = false;
//                    listcurveid_new = new importlistcurveid();
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "planpoints")
//                        {
//                            if (count > 0)
//                                continue;
//                            var contains = exportimportservice.exportlist("select * from ekasui_planpoints_rightlevel");
//                            if (contains.count() > 0)
//                            {
//                                contains = exportimportservice.exportlist("delete from ekasui_planpoints_rightlevel");
//                            }
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {

//                                var up_nom = z_row.attributes["up_nom"].value;

//                                if (up_nom == "13808")
//                                {

//                                }
//                                var d_izn = z_row.attributes["d_izn"].value;
//                                var izn = z_row.attributes["izn"].value;
//                                var km = z_row.attributes["km"].value;
//                                var m = z_row.attributes["m"].value;
//                                var planpointsid = z_row.attributes["planpointsid"].value;
//                                var put_nom = z_row.attributes["put_nom"].value;
//                                var riht = z_row.attributes["riht"].value;
//                                var shab = z_row.attributes["shab"].value;
//                                var siteid = z_row.attributes["siteid"].value;
//                                var type = z_row.attributes["type"].value;
//                                var urov = z_row.attributes["urov"].value;
//                                if (urov.contains('.'))
//                                {
//                                    urov = urov.split('.').first();
//                                }
//                                var assetnum = z_row.attributes["assetnum"].value;
//                                exportimportservice.execute("insert into ekasui_planpoints_rightlevel(d_izn,izn,km, m,planid,put_nom,radius,shab,siteid,type,up_nom,urov,assetnum)" +
//                               " values ('" + d_izn + "','" + izn + "','" + km + "'," + m + "," + planpointsid + ",'" + put_nom + "','" + riht
//                               + "','" + shab + "'," + siteid + "," + type + "," + up_nom + ",'" + urov + "','" + assetnum + "')");
//                                count = count + 1;
//                            }
//                        }
//                    }
//                }
//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "plan.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    var fl_st = false;
//                    var fl_ur = false;
//                    listcurveid_new = new importlistcurveid();
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "plan")
//                        {
//                            if (count > 0)
//                                continue;
//                            var contains = exportimportservice.exportlist("select * from ekasui_plan_rightlevel");
//                            if (contains.count() > 0)
//                            {
//                                contains = exportimportservice.exportlist("delete from ekasui_plan_rightlevel");
//                            }
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {

//                                var up_nom = z_row.attributes["up_nom"].value;

//                                if (up_nom == "13808")
//                                {


//                                }
//                                var d_izn = z_row.attributes["d_izn"].value;
//                                var izn = z_row.attributes["izn"].value;
//                                var km = z_row.attributes["km"].value;
//                                var m = z_row.attributes["m"].value;
//                                var planpointsid = z_row.attributes["planid"].value;
//                                var put_nom = z_row.attributes["put_nom"].value;
//                                var riht = z_row.attributes["riht"].value;
//                                var shab = z_row.attributes["shab"].value;
//                                var siteid = z_row.attributes["siteid"].value;
//                                var type = z_row.attributes["type"].value;
//                                var urov = z_row.attributes["urov"].value;
//                                if (urov.contains('.'))
//                                {
//                                    urov = urov.split('.').first();
//                                }
//                                var assetnum = z_row.attributes["assetnum"].value;




//                                exportimportservice.execute("insert into ekasui_plan_rightlevel(d_izn,izn,km, m,planid,put_nom,radius,shab,siteid,type,up_nom,urov,assetnum)" +
//                                    " values ('" + d_izn + "','" + izn + "','" + km + "'," + m + "," + planpointsid + ",'" + put_nom + "','" + riht
//                                    + "','" + shab + "'," + siteid + "," + type + "," + up_nom + ",'" + urov + "','" + assetnum + "')");
//                                count = count + 1;

//                            }
//                        }
//                    }
//                }


//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "str.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    var fl_st = false;
//                    var fl_ur = false;
//                    listcurveid_new = new importlistcurveid();
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "str")
//                        {
//                            if (count > 0)
//                                continue;
//                            var contains = exportimportservice.exportlist("select * from ekasui_str");
//                            if (contains.count() > 0)
//                            {
//                                contains = exportimportservice.exportlist("delete from ekasui_str");
//                            }
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {

//                                var up_nom = z_row.attributes["up_nom"].value;
//                                var st_kod = z_row.attributes["st_kod"].value;
//                                var km = z_row.attributes["km"].value;
//                                var m = z_row.attributes["m"].value;
//                                var type = z_row.attributes["type"].value;
//                                var nom = z_row.attributes["nom"].value;
//                                var otb = z_row.attributes["otb"].value;
//                                var posh = z_row.attributes["posh"].value;
//                                var put_nom = z_row.attributes["put_nom"].value;

//                                if (nom.contains("#"))
//                                {
//                                    string[] substrings = nom.split('#');
//                                    nom = substrings[1];

//                                    // do something with the substrings array
//                                }
//                                exportimportservice.execute("insert into ekasui_str(up_nom, st_kod,put_nom,km, m,type,nom,otb,posh) values ('" + up_nom + "'," + st_kod + ",'" + put_nom + "'," + km + "," + m + "," + type + ",'" + nom + "'," + otb + "," + posh + ")");
//                                count = count + 1;
//                            }
//                        }
//                    }
//                }
//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "kmpoints.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    var fl_st = false;
//                    var fl_ur = false;
//                    listcurveid_new = new importlistcurveid();
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "kmpoints")
//                        {
//                            if (count > 0)
//                                continue;
//                            var contains = exportimportservice.exportlist("select * from ekasui_kmpoints");
//                            if (contains.count() > 0)
//                            {
//                                contains = exportimportservice.exportlist("delete from ekasui_kmpoints");
//                            }
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {
//                                var km = z_row.attributes["km"].value;
//                                var put_nom = z_row.attributes["put_nom"].value;
//                                var up_nom = z_row.attributes["up_nom"].value;
//                                exportimportservice.execute("insert into ekasui_kmpoints (km, put_nom,up_nom) values (" + km + ",'" + put_nom + "'," + up_nom + ")");
//                                count = count + 1;
//                            }
//                        }
//                    }
//                }

//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "podrgr.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    var fl_st = false;
//                    var fl_ur = false;
//                    listcurveid_new = new importlistcurveid();
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "podrgr")
//                        {
//                            if (count > 0)
//                                continue;
//                            var contains = exportimportservice.exportlistpodgr("select * from ekasui_podgr");
//                            if (contains.count() > 0)
//                            {
//                                contains = exportimportservice.exportlistpodgr("delete from ekasui_podgr");
//                            }
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {
//                                var skm = z_row.attributes["begin_km"].value;
//                                var sm = z_row.attributes["begin_m"].value;
//                                var fkm = z_row.attributes["end_km"].value;
//                                var fm = z_row.attributes["end_m"].value;

//                                var num = z_row.attributes["num"].value;
//                                var put_nom = z_row.attributes["put_nom"].value;
//                                var type = z_row.attributes["type"].value;
//                                var up_nom = z_row.attributes["up_nom"].value;


//                                exportimportservice.execute("insert into ekasui_podgr (kmn, mn, kmk, mk, num, put_nom,type,up_nom) values (" + skm + "," + sm + "," + fkm + "," + fm + "," + num + ",'" + put_nom + "','" + type + "'," + up_nom + ")");
//                                count = count + 1;
//                            }
//                        }
//                    }
//                }


//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "str.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    var fl_st = false;
//                    var fl_ur = false;
//                    listcurveid_new = new importlistcurveid();
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "str")
//                        {
//                            if (count > 0)
//                                continue;
//                            var contains = exportimportservice.exportlist("select * from ekasui_str");
//                            if (contains.count() > 0)
//                            {
//                                contains = exportimportservice.exportlist("delete from ekasui_str");
//                            }
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {

//                                var up_nom = z_row.attributes["up_nom"].value;
//                                var st_kod = z_row.attributes["st_kod"].value;
//                                var km = z_row.attributes["km"].value;
//                                var m = z_row.attributes["m"].value;
//                                var type = z_row.attributes["type"].value;
//                                var nom = z_row.attributes["nom"].value;
//                                var otb = z_row.attributes["otb"].value;
//                                var posh = z_row.attributes["posh"].value;
//                                var put_nom = z_row.attributes["put_nom"].value;

//                                if (nom.contains("#"))
//                                {
//                                    string[] substrings = nom.split('#');
//                                    nom = substrings[1];

//                                    // do something with the substrings array
//                                }
//                                exportimportservice.execute("insert into ekasui_str(up_nom, st_kod,put_nom,km, m,type,nom,otb,posh) values ('" + up_nom + "'," + st_kod + ",'" + put_nom + "'," + km + "," + m + "," + type + ",'" + nom + "'," + otb + "," + posh + ")");
//                                count = count + 1;
//                            }

//                        }
//                    }
//                }

//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "km.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    var fl_st = false;
//                    var fl_ur = false;
//                    listcurveid_new = new importlistcurveid();
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "km")
//                        {
//                            if (count > 0)
//                                continue;
//                            var contains = exportimportservice.exportlist("select * from ekasui_non_ext");
//                            if (contains.count() > 0)
//                            {
//                                contains = exportimportservice.exportlist("delete from ekasui_non_ext");
//                            }
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {

//                                var up_nom = z_row.attributes["up_nom"].value;
//                                var km = z_row.attributes["km"].value;
//                                var put_nom = z_row.attributes["put_nom"].value;
//                                var startm = z_row.attributes["begin_m"].value;
//                                var endm = z_row.attributes["end_m"].value;


//                                exportimportservice.execute("insert into ekasui_non_ext(up_nom,put_nom,km,start_m,final_m) values ('" + up_nom + "','" + put_nom + "','" + km + "','" + startm + "','" + endm + "')");
//                                count = count + 1;
//                            }
//                        }
//                    }
//                }

//                ///*done*/
//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "gb.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    var fl_st = false;
//                    var fl_ur = false;
//                    listcurveid_new = new importlistcurveid();
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "gb")
//                        {
//                            if (count > 0)
//                                continue;
//                            var contains = exportimportservice.exportlist("select * from ekasui_gb");
//                            if (contains.count() > 0)
//                            {
//                                contains = exportimportservice.exportlist("delete from ekasui_gb");
//                            }
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {

//                                string crosstieid;
//                                if (z_row.attributes["type"].value == "0")
//                                    crosstieid = "2";
//                                else if (z_row.attributes["type"].value == "1")
//                                    crosstieid = "1";
//                                else crosstieid = "-1";
//                                var start_km = int.parse(z_row.attributes["begin_km"].value);
//                                var start_m = int.parse(z_row.attributes["begin_m"].value);
//                                var end_km = int.parse(z_row.attributes["end_km"].value);
//                                var end_m = int.parse(z_row.attributes["end_m"].value);
//                                var up_nom = z_row.attributes["up_nom"].value;
//                                var put_nom = z_row.attributes["put_nom"].value;


//                                exportimportservice.execute("insert into ekasui_gb(start_km,start_m,final_km,final_m,type,up_nom,put_nom) values ('" + start_km + "','" + start_m + "','" + end_km + "','" + end_m + "','" + crosstieid + "','" + up_nom + "','" + put_nom + "')");
//                                count = count + 1;
//                            }
//                        }
//                    }
//                }

//                ///*done*/
//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "up.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {

//                        if (xmlnode.name == "up")
//                        {
//                            if (count > 0)
//                                continue;

//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {
//                                string name = z_row.attributes["name"].value;
//                                string code = z_row.attributes["up_nom"].value;
//                                string stantiontype = z_row.attributes["type"].value;
//                                int typeid = 0;
//                                //if (code == "13808")
//                                //{
//                                //    if (code == "13868")
//                                //{

//                                if (stantiontype == "станция")
//                                    typeid = 1;
//                                if (stantiontype == "обгонный пункт")
//                                    typeid = 2;

//                                else if (stantiontype == "разьезд")
//                                    typeid = 3;
//                                else if (stantiontype == "блок-пост")
//                                    typeid = 4;
//                                else if (stantiontype == "граница направления")
//                                    typeid = 5;
//                                else if (stantiontype == "парк")
//                                    typeid = 6;

//                                importliststationid liststationid = new importliststationid();
//                                if (z_row.attributes["type"].value == "направление")
//                                {
//                                    string directionname = z_row.attributes["name"].value;
//                                    string directioncode = z_row.attributes["up_nom"].value; //ekasui_id
//                                                                                             //string assetnum = z_row.attributes["assetnum"].value;//assetnum

//                                    var directionids = exportimportservice.importqueryreturnlong("select count(*) as record_count from adm_direction  where code = '" + directioncode + "' and adm_nod_id =" + nod_id + "");

//                                    if (directionids == 0)
//                                    {
//                                        int64 directionid = exportimportservice.importqueryreturnlong("insert into adm_direction (code, name,adm_nod_id) values (\'" + directioncode + "\', \'" + directionname + "\'," + nod_id + ") returning id");
//                                    }
//                                    else
//                                    {
//                                        continue;
//                                    }

//                                }
//                                if (z_row.attributes["type"].value == "станция")
//                                {
//                                    string directionname = z_row.attributes["name"].value;
//                                    string directioncode = z_row.attributes["up_nom"].value; //ekasui_id
//                                    if (directioncode == "944702")
//                                    {

//                                    }
//                                    var adm_direction_ids = exportimportservice.importqueryreturnliststring($@"select up_nom from ekasui_stankm where code = '{directioncode}' ");

//                                    if (adm_direction_ids.count() > 0)
//                                    {
//                                        foreach (var adm_dir_ids in adm_direction_ids)
//                                        {

//                                            liststationid.newstationid = exportimportservice.importqueryreturnlong("insert into adm_station (type_id, code, name, adm_nod_id, adm_direction_id) values (" + typeid.tostring() + ", " + directioncode + ", \'" + directionname + "\', " + nod_id + " ," + adm_dir_ids + ") returning id");
//                                        }
//                                    }

//                                }
//                                if (z_row.attributes["type"].value == "парк")
//                                {
//                                    string directionname = z_row.attributes["name"].value;
//                                    string directioncode = z_row.attributes["up_nom"].value; //ekasui_id
//                                    string numberasstring = directioncode.tostring();
//                                    string firstsixdigits = "";
//                                    if (numberasstring.length >= 6)
//                                    {
//                                        firstsixdigits = numberasstring.substring(0, 6);
//                                        console.writeline("первые шесть цифр: " + firstsixdigits);
//                                    }
//                                    else
//                                    {
//                                        console.writeline("число имеет менее шести цифр.");
//                                    }
//                                    if (directioncode == "944702")
//                                    {

//                                    }
//                                    var adm_direction_ids = exportimportservice.importqueryreturnliststring($@"select up_nom from ekasui_stankm where code = '{firstsixdigits}' ");
//                                    if (adm_direction_ids.count() > 0)
//                                    {
//                                        foreach (var adm_dir_ids in adm_direction_ids)
//                                        {
//                                            liststationid.newstationid = exportimportservice.importqueryreturnlong("insert into adm_station (type_id, code, name, adm_nod_id,adm_direction_id) values (" + typeid.tostring() + ", " + directioncode + ", \'" + directionname + "\', " + nod_id + " ," + adm_dir_ids + ") returning id");

//                                        }
//                                    }

//                                }

//                                count = count + 1;
//                            }


//                            //}


//                        }

//                    }
//                }
//                progressbar.performstep();
//                /*done*/
//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "way.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {

//                        if (xmlnode.name == "way")
//                        {

//                            if (count > 0)
//                                continue;
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {
//                                var code = (z_row.attributes["up_nom"].value);
//                                //if (code == "13808")
//                                //{
//                                if (code == "94790802")
//                                {

//                                }
//                                if (z_row.attributes["nom"].value == "10б" && code == "94790802")
//                                {

//                                }
//                                if (z_row.attributes["nom"].value == "2б" && code == "94790802")
//                                {

//                                }

//                                if (z_row.attributes["type"].value == "главный")
//                                {
//                                    string directioncode = int.parse(z_row.attributes["up_nom"].value).tostring();
//                                    string trackcode = z_row.attributes["nom"].value;
//                                    var directionnname = exportimportservice.exportqueryreturnstring("select  name  from adm_direction where code = '" + directioncode + "' and adm_nod_id=" + nod_id + "");
//                                    if (directionnname == null)
//                                    {
//                                        continue;
//                                    }
//                                    var directionids = exportimportservice.importqueryreturnlistlong("select  id  from adm_direction where code = '" + directioncode + "' and adm_nod_id=" + nod_id + "");
//                                    if (directionids == null)
//                                    {
//                                        continue;
//                                    }
//                                    foreach (var directionid in directionids)
//                                    {
//                                        //var directioncodeid = exportimportservice.importqueryreturnlistlong("select  code  from adm_direction where code = '" + directioncode + "'").first();

//                                        if (listids.where(tmp => tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() < 1)//upid
//                                        {
//                                            importlistdirtrackid listid = new importlistdirtrackid();
//                                            listid.olddirection = int.parse(z_row.attributes["up_nom"].value);
//                                            int64 trackid = exportimportservice.importqueryreturnlong("insert into adm_track (code, adm_direction_id,up_nom,adm_nod_id) values (\'" + trackcode + "\', \'" + directionid.tostring() + "\','" + directioncode + "\', " + nod_id + ") returning id");
//                                            exportimportservice.execute($@"insert into road_direction (road_id, direction_id) values({road_id}, {directionid})");

//                                            listid.newdirectionid = directionid;
//                                            listid.newtrackid = trackid;
//                                            listid.code = directioncode;
//                                            listid.stationname = directionnname;

//                                            listid.olddirectionid = int.parse(z_row.attributes["up_nom"].value);
//                                            listid.oldtrackid = (z_row.attributes["nom"].value).tostring();

//                                            listids.add(listid);
//                                        }
//                                        else
//                                        {
//                                            importlistdirtrackid listid = new importlistdirtrackid();
//                                            listid.olddirection = int.parse(z_row.attributes["up_nom"].value);
//                                            int64 trackid = exportimportservice.importqueryreturnlong("insert into adm_track (code, adm_direction_id,up_nom,adm_nod_id) values (\'" + trackcode + "\', \'" + directionid.tostring() + "\','" + directioncode + "\', " + nod_id + ") returning id");

//                                            listid.newdirectionid = directionid;
//                                            listid.newtrackid = trackid;
//                                            listid.code = directioncode;

//                                            listid.stationname = directionnname;

//                                            listid.olddirectionid = int.parse(z_row.attributes["up_nom"].value);
//                                            listid.oldtrackid = (z_row.attributes["nom"].value).tostring();
//                                            listids.add(listid);
//                                        }
//                                    }



//                                }
//                                else
//                                {
//                                    string up_nom = int.parse(z_row.attributes["up_nom"].value).tostring();
//                                    string nom = z_row.attributes["nom"].value;
//                                    if (up_nom == "940006")
//                                    {

//                                    }
//                                    importliststationid liststations = new importliststationid();
//                                    var stationname = exportimportservice.exportqueryreturnstring("select  name  from adm_station where code = '" + up_nom + "' and adm_nod_id=" + nod_id + "");
//                                    if (stationname == null)
//                                    {
//                                        continue;
//                                    }
//                                    var stationidss = exportimportservice.importqueryreturnlistlong("select  id  from adm_station where code = '" + up_nom + "' and adm_nod_id=" + nod_id + "");

//                                    foreach (var stationids in stationidss)
//                                    {
//                                        var adm_direction_id = exportimportservice.importqueryreturnlistlong("select  adm_direction_id  from adm_station where id = '" + stationids + "'");
//                                        var adm_direction_id_2 = exportimportservice.importqueryreturnlistlong("select  id  from adm_direction where code = '" + (int)adm_direction_id.first() + "'");

//                                        if (!stationname.contains("/"))
//                                        {

//                                            string cat_track_type = z_row.attributes["type"].value;
//                                            int cat_track_typeid = 0;
//                                            if (cat_track_type == "главный")
//                                                cat_track_typeid = 1;
//                                            if (cat_track_type == "приемо-отправочный" || cat_track_type == "приемо-отп.")
//                                                cat_track_typeid = 2;
//                                            if (cat_track_type == "сортировочный")
//                                                cat_track_typeid = 3;
//                                            if (cat_track_type == "погрузочно-выгрузочный")
//                                                cat_track_typeid = 4;
//                                            if (cat_track_type == "вытяжной")
//                                                cat_track_typeid = 5;
//                                            if (cat_track_type == "6оединительный")
//                                                cat_track_typeid = 6;
//                                            if (cat_track_type == "подъездной")
//                                                cat_track_typeid = 7;
//                                            if (cat_track_type == "другой" || cat_track_type == "прочий")
//                                                cat_track_typeid = 8;


//                                            string trackcode = z_row.attributes["nom"].value;

//                                            if (liststationids.where(tmp => tmp.station == stationname && up_nom.contains(tmp.code.tostring()) && tmp.olddirection == (int)adm_direction_id.first()).count() > 0)
//                                            {
//                                                importlistdirtrackid listid = new importlistdirtrackid();
//                                                listid.olddirection = (int)adm_direction_id.first();
//                                                int64 stationid = liststationids.where(tmp => tmp.station == stationname && up_nom.contains(tmp.code.tostring())).first().newstationid;

//                                                int64 trackid = exportimportservice.importqueryreturnlong("insert into adm_track (code,adm_station_id,up_nom,adm_nod_id,olddirection) values (\'" + trackcode + "\', \'" + stationids.tostring() + "\','" + up_nom + "\', " + nod_id + "," + listid.olddirection + ") returning id");
//                                                exportimportservice.execute("insert into stw_track (adm_station_id, adm_track_id, type_id,adm_nod_id) values (" + stationid.tostring() + ", " + trackid.tostring() + ", \'" + cat_track_typeid + "\', " + nod_id + ")");

//                                                listid.newdirectionid = stationid;
//                                                listid.newtrackid = trackid;
//                                                listid.code = up_nom;

//                                                listid.olddirectionid = int.parse(z_row.attributes["up_nom"].value);
//                                                listid.oldtrackid = (z_row.attributes["nom"].value).tostring();
//                                                listid.stationname = stationname;
//                                                if (listid.stationname == "лесная")
//                                                {
//                                                    //лесная 1 1 6139 834 6140 708
//                                                    listid.stationname = "лесная";
//                                                }
//                                                listids.add(listid);
//                                            }
//                                            else
//                                            {
//                                                int typeid = 1;
//                                                importliststationid liststationid = new importliststationid();

//                                                foreach (fileinfo tempfile in fileinfo.where(tmp => tmp.name == "up.xml"))
//                                                {
//                                                    xmldocument tempxmldocument = new xmldocument();
//                                                    tempxmldocument.load(tempfile.fullname);
//                                                    xmlelement tempxmlelement = tempxmldocument.documentelement;
//                                                    foreach (xmlnode tempxmlnode in tempxmlelement)
//                                                    {
//                                                        if (tempxmlnode.name == "up")
//                                                        {
//                                                            foreach (xmlnode tempz_row in tempxmlnode.parentnode)
//                                                            {
//                                                                if (tempz_row.attributes["up_nom"].value == (up_nom))
//                                                                {
//                                                                    liststationid.oldstationid = int.parse(tempz_row.attributes["up_nom"].value);
//                                                                    break;
//                                                                }
//                                                            }
//                                                        }
//                                                    }
//                                                }

//                                                liststationid.station = stationname;
//                                                liststationid.code = up_nom;
//                                                liststationid.oldtrackid = nom;
//                                                liststationid.olddirection = (int)adm_direction_id.first();

//                                                if (liststationid.station == "лесная")
//                                                {
//                                                    //лесная 1 1 6139 834 6140 708
//                                                    liststationid.station = "лесная";
//                                                }
//                                                //liststationid.newstationid = exportimportservice.importqueryreturnlong("insert into adm_station (type_id, code, name, adm_nod_id) values (" + typeid.tostring() + ", " + liststationid.code + ", \'" + stationname + "\', " + nod_id + ") returning id");
//                                                liststationid.newstationid = exportimportservice.importqueryreturnlong("select id from adm_station where type_id =" + typeid + "  and code = '" + liststationid.code + "' and name = '" + liststationid.station + "' and adm_nod_id =" + nod_id + " and adm_direction_id =" + liststationid.olddirection + "");
//                                                liststationids.add(liststationid);

//                                                int64 trackid = exportimportservice.importqueryreturnlong("insert into adm_track (code,adm_station_id,up_nom,adm_nod_id,olddirection) values (\'" + trackcode + "\', \'" + stationids.tostring() + "\','" + up_nom + "\', " + nod_id + "," + liststationid.olddirection + ") returning id");
//                                                exportimportservice.execute("insert into stw_track (adm_station_id, adm_track_id, type_id,adm_nod_id) values (" + liststationid.newstationid + ", " + trackid + ",\'" + cat_track_typeid + "\', " + nod_id + ")");

//                                                importlistdirtrackid listid = new importlistdirtrackid();
//                                                listid.newdirectionid = liststationid.newstationid;
//                                                listid.newtrackid = trackid;
//                                                listid.code = up_nom;
//                                                listid.stationname = stationname;
//                                                if (listid.stationname == "лесная")
//                                                {
//                                                    //лесная 1 1 6139 834 6140 708
//                                                    listid.stationname = "лесная";
//                                                }
//                                                listid.olddirection = (int)adm_direction_id.first();
//                                                listid.olddirectionid = int.parse(z_row.attributes["up_nom"].value);
//                                                listid.oldtrackid = (z_row.attributes["nom"].value).tostring();
//                                                listids.add(listid);
//                                            }
//                                        }
//                                        //liststations.station = stationname;
//                                        //liststationids.add(liststations);
//                                        //var directionid = exportimportservice.importqueryreturnlistlong("select  id  from adm_direction where code = '" + directioncode + "'").first();

//                                        else
//                                        {

//                                            string trackcode = z_row.attributes["nom"].value;

//                                            //var stationids = exportimportservice.importqueryreturnlistlong("select  id  from adm_station where code = '" + up_nom + "'").first();
//                                            //continue;
//                                            var parkname = exportimportservice.exportqueryreturnstring("select  name  from adm_station where code = '" + up_nom + "' and adm_nod_id =" + nod_id + "");
//                                            if (parkname == "юрты")
//                                            {

//                                            }
//                                            //var adm_direction_id = exportimportservice.importqueryreturnlistlong("select  adm_direction_id  from adm_station where id = '" + stationids + "' or name ='"+ parkname + "'");
//                                            string cat_track_type = z_row.attributes["type"].value;
//                                            int cat_track_typeid = 0;
//                                            if (cat_track_type == "главный")
//                                                cat_track_typeid = 1;
//                                            if (cat_track_type == "приемо-отп.")
//                                                cat_track_typeid = 2;
//                                            if (cat_track_type == "другой" || cat_track_type == "прочий")
//                                                cat_track_typeid = 3;
//                                            //cat_track_typeid = 3;
//                                            string[] stations = parkname.split(new char[] { '/' }, stringsplitoptions.removeemptyentries);
//                                            if (liststationids.count < 1)
//                                                continue;
//                                            var containtsstation = listids.where(tmp => tmp.code.contains(up_nom.remove(6)));

//                                            if (!containtsstation.any())
//                                            {
//                                                continue;
//                                            }

//                                            if (listids.where(tmp => tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() < 1 && listids.where(tmp => tmp.stationname.contains(stations[0]) && tmp.code.contains(up_nom.remove(6))).count() > 0)
//                                            //if (listids.where(tmp => tmp.stationname.contains(stations[0]) && tmp.code.contains(up_nom.remove(6))).count() > 0)
//                                            {
//                                                string stationid = listids.where(tmp => tmp.stationname.contains(stations[0]) && tmp.code.contains(up_nom.remove(6))).first().newdirectionid.tostring();
//                                                //var stationid = exportimportservice.importqueryreturnlistlong("select id from adm_station where code = '" + z_row.attributes["up_nom"].value + "'");
//                                                importliststationid liststationid = new importliststationid();
//                                                liststationid.station = parkname;
//                                                liststationid.code = up_nom;
//                                                liststationid.oldtrackid = nom;
//                                                liststationid.olddirection = (int)adm_direction_id.first();
//                                                liststationid.oldstationid = int.parse(z_row.attributes["up_nom"].value);
//                                                liststationid.newstationid = exportimportservice.importqueryreturnlong("insert into stw_park (type_id, adm_station_id, name,adm_nod_id,olddirection) values (" + cat_track_typeid + ", " + stationid + ", \'" + parkname + "\'," + nod_id + "," + liststationid.olddirection + ") returning id");
//                                                //liststationid.newstationid = exportimportservice.importqueryreturnlong("insert into stw_park (type_id, adm_station_id, name) values (3, " + stationid + ", \'" + stations[0] + "\') returning id");
//                                                liststationids.add(liststationid);

//                                                int64 trackid = exportimportservice.importqueryreturnlong("insert into adm_track (code,adm_station_id,up_nom,adm_nod_id,olddirection) values (\'" + trackcode + "\', \'" + stationids.tostring() + "\','" + up_nom + "\'," + nod_id + "," + liststationid.olddirection + ") returning id");
//                                                exportimportservice.execute("insert into stw_park_track (stw_park_id, adm_track_id, type_id,adm_nod_id) values (" + liststationid.newstationid.tostring() + ", " + trackid.tostring() + "," + cat_track_typeid + ", " + nod_id + ")");

//                                                importlistdirtrackid listid = new importlistdirtrackid();
//                                                listid.newdirectionid = liststationid.newstationid;
//                                                listid.newtrackid = trackid;
//                                                listid.code = up_nom;
//                                                listid.stationname = parkname;
//                                                listid.olddirection = (int)adm_direction_id.first();
//                                                listid.olddirectionid = int.parse(z_row.attributes["up_nom"].value);
//                                                listid.oldtrackid = (z_row.attributes["nom"].value).tostring();
//                                                listids.add(listid);
//                                            }
//                                            else
//                                            {
//                                                string stationid = listids.where(tmp => tmp.stationname.contains(stations[0]) && tmp.code.contains(up_nom.remove(6))).first().newdirectionid.tostring();
//                                                //var stationid = exportimportservice.importqueryreturnlistlong("select id from adm_station where code = '" + z_row.attributes["up_nom"].value + "'");
//                                                var parkid_selected = exportimportservice.importqueryreturnlistlong("select id from stw_park where adm_station_id = " + stationid + " and  name = '" + parkname + "'  and  adm_nod_id = '" + nod_id + "'");
//                                                importlistdirtrackid listid = new importlistdirtrackid();
//                                                listid.olddirection = (int)adm_direction_id.first();
//                                                //string[] stations = parkname.split(new char[] { '/' }, stringsplitoptions.removeemptyentries);
//                                                //long parkid = exportimportservice.importqueryreturnlong("insert into stw_park (type_id, adm_station_id, name,adm_nod_id,olddirection) values (" + cat_track_typeid + ", " + stationid.first() + ", \'" + parkname + "\'," + nod_id + "," + listid.olddirection + ") returning id");
//                                                //string parkid = liststationids.where(tmp => tmp.station == parkname && tmp.code.contains(up_nom) ).last().newstationid.tostring();
//                                                //string parkid = liststationids.where(tmp => tmp.station == stations[0] && tmp.code.contains(up_nom)).first().newstationid.tostring();

//                                                int64 trackid = exportimportservice.importqueryreturnlong("insert into adm_track (code,adm_station_id,up_nom,adm_nod_id,olddirection) values (\'" + trackcode + "\', \'" + stationids.tostring() + "\','" + up_nom + "\'," + nod_id + "," + listid.olddirection + ") returning id");
//                                                exportimportservice.execute("insert into stw_park_track (stw_park_id, adm_track_id, type_id,adm_nod_id) values (" + parkid_selected.first() + ", " + trackid.tostring() + "," + cat_track_typeid + "," + nod_id + ")");


//                                                listid.newdirectionid = parkid_selected.first();
//                                                listid.newtrackid = trackid;
//                                                listid.code = up_nom;
//                                                listid.stationname = parkname;

//                                                listid.olddirectionid = int.parse(z_row.attributes["up_nom"].value);
//                                                listid.oldtrackid = (z_row.attributes["nom"].value).tostring();
//                                                listids.add(listid);
//                                                //exportimportservice.execute("insert into adm_list_st (stw_park_id, adm_track_id, type_id,adm_nod_id) values (" + parkid + ", " + trackid.tostring() + "," + cat_track_typeid + nod_id + ")");
//                                                //exportimportservice.execute("insert into adm_list_station (stw_park_id, adm_track_id, type_id,adm_nod_id) values (" + parkid + ", " + trackid.tostring() + "," + cat_track_typeid + nod_id + ")");

//                                            }
//                                        }
//                                    }
//                                }
//                                count = count + 1;

//                                //}

//                            }//для up_nom = 13808

//                        }

//                    }
//                }
//                foreach (var insertlist in listids)
//                {
//                    if (insertlist.oldtrackid == null)
//                    {
//                        insertlist.oldtrackid = "";
//                    }
//                    if (insertlist.code == null)
//                    {
//                        insertlist.code = "";
//                    }
//                    if (insertlist.stationname == null)
//                    {
//                        insertlist.stationname = "";
//                    }
//                    if (insertlist.oldtrackid == "4" && insertlist.olddirectionid == 13810)
//                    {


//                    }

//                    if (insertlist.oldtrackid == "гл" && insertlist.olddirectionid == 24630)
//                    {

//                    }
//                    exportimportservice.execute("insert into adm_list_st (id,newdirectionid,olddirectionid,olddirection,oldtrackid,code,stationname,curveid) values (" + insertlist.newtrackid + "," + insertlist.newdirectionid + "," + insertlist.olddirectionid + ", " + insertlist.olddirection + ",'" + insertlist.oldtrackid + "', " + insertlist.code + ", '" + insertlist.stationname + "', " + insertlist.curveid + ")");
//                }
//                foreach (var insertlist in liststationids)
//                {
//                    if (insertlist.oldtrackid == null)
//                    {
//                        insertlist.oldtrackid = "";
//                    }
//                    if (insertlist.code == null)
//                    {
//                        insertlist.code = "";
//                    }
//                    if (insertlist.station == null)
//                    {
//                        insertlist.station = "";
//                    }
//                    exportimportservice.execute("insert into adm_list_station (oldtrackid,newdirectionid,newstationid,olddirection,code,oldstationid,station)" +
//                                                           " values ('" + insertlist.oldtrackid + "'," + insertlist.newdirectionid + "," + insertlist.newstationid + ", " + insertlist.olddirection + "," + insertlist.code + ", " + insertlist.oldstationid + ", '" + insertlist.station + "')");
//                }
//                progressbar.performstep();

//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "podr.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "podr")
//                        {
//                            if (count > 0)
//                                continue;
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {
//                                importlistpch listpchid = new importlistpch();
//                                list<importlistdirtrackid> listpchids = new list<importlistdirtrackid>();

//                                listpchid.type = z_row.attributes["type"].value;
//                                if (listpchid.type == "пч")
//                                {
//                                    listpchid.distance = z_row.attributes["num"].value;
//                                    //listpchid.id = int.parse(z_row.attributes["id"].value);//текущий айди обьекта
//                                    listpchid.ekasui_id = int.parse(z_row.attributes["id"].value);//предыдущий айди обьекта

//                                    var adm_distance_id = exportimportservice.importqueryreturnlistlong("select  ekasui_id  from adm_distance where ekasui_id = '" + listpchid.ekasui_id + "'  and  code ='" + listpchid.distance + "' and adm_nod_id =" + nod_id + " ");
//                                    if (!adm_distance_id.contains(listpchid.ekasui_id))
//                                    {
//                                        listpchid.distanceid = exportimportservice.importqueryreturnlong("insert into adm_distance (code, name, adm_nod_id,ekasui_id) values (\'" + listpchid.distance + "\', \'" + "пч-" + listpchid.distance + "\',\'" + nod_id.tostring() + "\'," + listpchid.ekasui_id + ") returning id");
//                                        //listpchids.add(listpchid);
//                                    }
//                                    else
//                                    {
//                                        continue;
//                                    }


//                                }
//                                count = count + 1;
//                            }

//                        }

//                    }
//                }
//                progressbar.performstep();

//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "podr.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "podr")
//                        {
//                            if (count > 0)
//                                continue;
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {
//                                importlistpch listpchuid = new importlistpch();

//                                listpchuid.type = z_row.attributes["type"].value;
//                                if (listpchuid.type == "пчу")
//                                {
//                                    listpchuid.ekasui_id = int.parse(z_row.attributes["parent_id"].value);
//                                    listpchuid.id = int.parse(z_row.attributes["id"].value);
//                                    var listpchd = exportimportservice.importqueryreturnlistlong("select  ekasui_id,id,code  from adm_distance where ekasui_id = " + listpchuid.ekasui_id + " ");
//                                    var distanceid = exportimportservice.importqueryreturnlistlong("select  id  from adm_distance where ekasui_id = " + listpchuid.ekasui_id + "");
//                                    if (listpchd.contains(listpchuid.ekasui_id))
//                                    {
//                                        var adm_distance_id = exportimportservice.importqueryreturnlistlong("select  ekasui_id  from adm_pchu where id_parent = '" + listpchuid.ekasui_id + "'and adm_nod_id =" + nod_id + " ");
//                                        if (!adm_distance_id.contains(listpchuid.ekasui_id))
//                                        {
//                                            listpchuid.fio = z_row.attributes["chief_name"] != null ? z_row.attributes["chief_name"].value : "";
//                                            listpchuid.pchu = z_row.attributes["num"].value;
//                                            listpchuid.pchuid = exportimportservice.importqueryreturnlong("insert into adm_pchu (code, chief_fullname, adm_distance_id,ekasui_id,id_parent,adm_nod_id) values (\'" + listpchuid.pchu + "\', \'" + listpchuid.fio + "\',\' " + distanceid.first() + "\',\'" + listpchuid.ekasui_id + "\'," + listpchuid.id + "," + nod_id + ") returning id");

//                                        }
//                                        else
//                                        {
//                                            continue;
//                                        }
//                                    }
//                                }
//                                count = count + 1;
//                            }
//                        }

//                    }
//                }
//                progressbar.performstep();
//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "podr.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "podr")
//                        {
//                            if (count > 0)
//                                continue;
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {
//                                importlistpch listpdid = new importlistpch();

//                                listpdid.type = z_row.attributes["type"].value;
//                                if (listpdid.type == "пд")
//                                {
//                                    listpdid.ekasui_id = int.parse(z_row.attributes["parent_id"].value);
//                                    listpdid.id = int.parse(z_row.attributes["id"].value);

//                                    var listpd = exportimportservice.importqueryreturnlistlong("select  id_parent  from adm_pchu where id_parent = " + listpdid.ekasui_id + "");
//                                    var pchuid = exportimportservice.importqueryreturnlistlong("select  id  from adm_pchu where id_parent = " + listpdid.ekasui_id + "");


//                                    if (listpd.contains(listpdid.ekasui_id))
//                                    {
//                                        var adm_distance_id = exportimportservice.importqueryreturnlistlong("select  id_parent  from adm_pd where id_parent = '" + listpdid.ekasui_id + "' and adm_nod_id =" + nod_id + " ");
//                                        if (!adm_distance_id.contains(listpdid.ekasui_id))
//                                        {
//                                            listpdid.fio = z_row.attributes["chief_name"] != null ? z_row.attributes["chief_name"].value : "";
//                                            listpdid.pd = z_row.attributes["num"].value;
//                                            listpdid.pdid = exportimportservice.importqueryreturnlong("insert into adm_pd (code, chief_fullname, adm_pchu_id,ekasui_id,id_parent,adm_nod_id) values (\'" + listpdid.pd + "\', \'" + listpdid.fio + "\',\'" + pchuid.first() + "\',\'" + listpdid.ekasui_id + "\'," + listpdid.id + "," + nod_id + ") returning id");
//                                        }
//                                        else
//                                        {
//                                            continue;
//                                        }

//                                    }
//                                }
//                                count = count + 1;
//                            }
//                        }

//                    }
//                }
//                progressbar.performstep();
//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "podr.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "podr")
//                        {
//                            if (count > 0)
//                                continue;
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {
//                                importlistpch listpdbid = new importlistpch();

//                                listpdbid.type = z_row.attributes["type"].value;
//                                if (listpdbid.type == "пдб")
//                                {
//                                    listpdbid.ekasui_id = int.parse(z_row.attributes["parent_id"].value);
//                                    listpdbid.id = int.parse(z_row.attributes["id"].value);

//                                    var listpdb = exportimportservice.importqueryreturnlistlong("select  id_parent  from adm_pd where id_parent = " + listpdbid.ekasui_id + "");
//                                    var pdid = exportimportservice.importqueryreturnlistlong("select  id  from adm_pd where id_parent = " + listpdbid.ekasui_id + "");


//                                    if (listpdb.contains(listpdbid.ekasui_id))
//                                    {

//                                        var adm_distance_id = exportimportservice.importqueryreturnlistlong("select  id_parent  from adm_pdb where id_parent = '" + listpdbid.ekasui_id + "' and adm_nod_id =" + nod_id + " ");
//                                        if (!adm_distance_id.contains(listpdbid.ekasui_id))
//                                        {
//                                            listpdbid.fio = z_row.attributes["chief_name"] != null ? z_row.attributes["chief_name"].value : "";
//                                            listpdbid.pdb = z_row.attributes["num"].value;
//                                            listpdbid.pdbid = exportimportservice.importqueryreturnlong("insert into adm_pdb (code, chief_fullname, adm_pd_id,ekasui_id,id_parent,adm_nod_id) values (\'" + listpdbid.pdb + "\', \'" + listpdbid.fio + "\',\'" + pdid.first() + "\',\'" + listpdbid.ekasui_id + "\'," + listpdbid.id + "," + nod_id + ") returning id");

//                                        }
//                                        else
//                                        {
//                                            continue;
//                                        }
//                                    }
//                                }
//                                count = count + 1;
//                            }
//                        }

//                    }
//                }
//                progressbar.performstep();
//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "podrgr.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {

//                        if (xmlnode.name == "podrgr")
//                        {
//                            if (count > 0)
//                                continue;

//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {
//                                importlistpdbid listpdbid = new importlistpdbid();

//                                var type = z_row.attributes["type"].value;
//                                if (type == "пч")
//                                {
//                                    var oldtrack = int.parse(z_row.attributes["id"].value);
//                                    var up_nom = int.parse(z_row.attributes["up_nom"].value);
//                                    string put_nom = z_row.attributes["put_nom"].value;//номер пути

//                                    var adm_distance_ids = exportimportservice.importqueryreturnlistlong("select  id  from adm_distance where ekasui_id = '" + oldtrack + "' and  adm_nod_id =" + nod_id + "");
//                                    if (adm_distance_ids.count == 0)
//                                        continue;
//                                    var adm_track = exportimportservice.importqueryreturnlistlong("select  id  from adm_track where up_nom = '" + up_nom + "' and code = '" + put_nom + "' and adm_nod_id=" + nod_id + " ");
//                                    if (adm_track.count == 0)
//                                        continue;

//                                    //int64 newtrackid = adm_track.first();
//                                    foreach (int64 adm_distance_id in adm_distance_ids)
//                                    {
//                                        foreach (int64 newtrackid in adm_track)
//                                        {

//                                            if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + newtrackid.tostring() + " and mto_type = 0").count() > 0)
//                                            {
//                                                int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + newtrackid.tostring() + " and mto_type = 0");
//                                                exportimportservice.execute("insert into tpl_dist_section (adm_distance_id, period_id, start_km, start_m, final_km, final_m,adm_nod_id) values (" + adm_distance_id + ", " + periodid.tostring() + ", " + int.parse(z_row.attributes["begin_km"].value) + ", " + int.parse(z_row.attributes["begin_m"].value) + ", " + int.parse(z_row.attributes["end_km"].value) + ", " + int.parse(z_row.attributes["end_m"].value) + "," + nod_id + ")");
//                                            }
//                                            else
//                                            {
//                                                int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + newtrackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 0) returning id");
//                                                exportimportservice.execute("insert into tpl_dist_section (adm_distance_id, period_id, start_km, start_m, final_km, final_m,adm_nod_id) values (" + adm_distance_id + ", " + periodid.tostring() + ", " + int.parse(z_row.attributes["begin_km"].value) + ", " + int.parse(z_row.attributes["begin_m"].value) + ", " + int.parse(z_row.attributes["end_km"].value) + ", " + int.parse(z_row.attributes["end_m"].value) + "," + nod_id + ")");

//                                                int64 periodid_d = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + newtrackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 5) returning id");
//                                                exportimportservice.execute("insert into apr_norma_width (period_id, start_km, start_m, final_km, final_m, norma_width) values (" + periodid_d.tostring() + ", "
//                                                      + int.parse(z_row.attributes["begin_km"].value) + ", " + int.parse(z_row.attributes["begin_m"].value) + ", " + int.parse(z_row.attributes["end_km"].value) + ", " + int.parse(z_row.attributes["end_m"].value) + "," + "1520" + ")");
//                                            }

//                                        }
//                                    }


//                                }

//                                if (type == "пдб")
//                                {
//                                    var oldtrack = int.parse(z_row.attributes["id"].value);
//                                    var up_nom = int.parse(z_row.attributes["up_nom"].value);
//                                    string put_nom = z_row.attributes["put_nom"].value;//номер пути
//                                    var distanceekasuiids = exportimportservice.importqueryreturnlistlong("select  id  from adm_pdb where id_parent = '" + oldtrack + "'and  adm_nod_id =" + nod_id + "");
//                                    if (distanceekasuiids.count == 0)
//                                        continue;
//                                    var adm_track = exportimportservice.importqueryreturnlistlong("select  id  from adm_track where up_nom = '" + up_nom + "' and code = '" + put_nom + "' and adm_nod_id=" + nod_id + " ");
//                                    if (adm_track.count == 0)
//                                        continue;


//                                    //int64 trackid = adm_track.first();
//                                    foreach (int64 distanceekasuiid in distanceekasuiids)
//                                    {
//                                        foreach (int64 trackid in adm_track)
//                                        {
//                                            if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 9").count() > 0)
//                                            {
//                                                int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 9");
//                                                exportimportservice.execute("insert into tpl_pdb_section (adm_pdb_id, period_id, start_km, start_m, final_km, final_m,adm_nod_id) values (" + distanceekasuiid + ", " + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + "," + nod_id + ")");
//                                            }
//                                            else
//                                            {
//                                                int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 9) returning id");
//                                                exportimportservice.execute("insert into tpl_pdb_section (adm_pdb_id, period_id, start_km, start_m, final_km, final_m,adm_nod_id) values (" + distanceekasuiid + ", " + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + "," + nod_id + ")");
//                                            }
//                                        }
//                                    }


//                                }

//                                count = count + 1;
//                            }
//                        }

//                    }
//                }
//                progressbar.performstep();
//                listpdbids.clear();



//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "str.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "str")
//                        {
//                            if (count > 0)
//                                continue;

//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {

//                                string km = z_row.attributes["km"].value;
//                                string m = z_row.attributes["m"].value;
//                                string num = z_row.attributes["nom"].value;
//                                if (num == "10б" || num == "10б")
//                                {

//                                }

//                                string sideid;
//                                //string point_id = z_row.attributes["nom"].value;
//                                string point_id = "35";
//                                string dirid = z_row.attributes["posh"].value;//положение

//                                string markid = z_row.attributes["type"].value;

//                                //sideid = (z_row.attributes["otb"].value);


//                                int sidetype = -1;
//                                if (!int.tryparse(z_row.attributes["otb"].value, out sidetype))
//                                    sideid = "0";
//                                else
//                                {
//                                    if (sidetype == 1)
//                                        sideid = "0";
//                                    else if (sidetype == 2)
//                                        sideid = "2";
//                                    else if (sidetype == 3)
//                                        sideid = "1";
//                                    else if (sidetype == 4)
//                                        sideid = "0";
//                                    else if (sidetype == 0)
//                                        sideid = "0";
//                                    else sideid = "0";
//                                }
//                                if (z_row.attributes["up_nom"].value == "94790802" && z_row.attributes["put_nom"].value == "1б" && num == "14")
//                                {

//                                }
//                                if (z_row.attributes["up_nom"].value == "94790802" && z_row.attributes["put_nom"].value == "1" && num == "14")
//                                {

//                                }

//                                string directioncode = z_row.attributes["up_nom"].value; //ekasui_id
//                                string numberasstring = directioncode.tostring();
//                                string firstsixdigits = "";
//                                if (numberasstring.length > 6)
//                                {
//                                    firstsixdigits = numberasstring.substring(0, 6);
//                                    console.writeline("первые шесть цифр: " + firstsixdigits);
//                                }
//                                else
//                                {
//                                    console.writeline("число имеет менее шести цифр.");
//                                }
//                                //var st_kod = z_row.attributes["st_kod"].value;
//                                //var listnom = exportimportservice.importqueryreturnliststring($@"select nom from ekasui_str where nom = '{num}' and st_kod = '{st_kod}'");

//                                if (listids.where(tmp => tmp.olddirection == int.parse(z_row.attributes["up_nom"].value) && tmp.olddirectionid == int.parse(z_row.attributes["st_kod"].value)).count() > 0)
//                                //if (liststationids.where(tmp => (tmp.olddirection == int.parse(z_row.attributes["up_nom"].value) && tmp.oldstationid == int.parse(z_row.attributes["st_kod"].value))).count() > 0)


//                                {
//                                    var lsitsationid = listids.where(tmp => tmp.olddirectionid == int.parse(z_row.attributes["st_kod"].value));
//                                    var liststatid = lsitsationid.select(o => o.newdirectionid).tolist();

//                                    var selcetd_same_pertiod = exportimportservice.importqueryreturnlistlong("select period_id from tpl_switch where km = " + km + " and meter =" + m + " and num ='" + num + "'");
//                                    if (selcetd_same_pertiod.count() > 0)
//                                    {
//                                        if (z_row.attributes["up_nom"].value != z_row.attributes["st_kod"].value && firstsixdigits == z_row.attributes["st_kod"].value)
//                                        {
//                                            if (listids.where(tmp => (tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value))).count() > 0)
//                                            {
//                                                liststatid = exportimportservice.importqueryreturnlistlong("select id from adm_station where code = '" + z_row.attributes["up_nom"].value + "'");
//                                                foreach (int64 stationid in liststatid)
//                                                {

//                                                    if ((listids.where(tmp => tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value) && tmp.oldtrackid == (z_row.attributes["put_nom"].value)).count() > 0))
//                                                    {
//                                                        var trackid = exportimportservice.importqueryreturnlistlong("select adm_track_id from tpl_period where id = " + selcetd_same_pertiod.first() + " ");



//                                                        if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.first() + " and mto_type = 15 ").count() > 0)
//                                                        {
//                                                            int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.first() + " and mto_type = 15");
//                                                            exportimportservice.execute("insert into tpl_switch (period_id, km, meter, num, mark_id, dir_id, side_id, point_id, station_id) values (" + periodid.tostring() + ", " + km + ", " + m + ", \'" + num + "\', " + markid + ", " + (dirid == "1" ? dirid = "-1" : dirid == "2" ? dirid = "1" : dirid = "0") + ", "
//                                                                + sideid + "," + markid + ", " + stationid.tostring() + ")");
//                                                        }
//                                                        else
//                                                        {
//                                                            int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 15) returning id");
//                                                            exportimportservice.execute("insert into tpl_switch (period_id, km, meter, num, mark_id, dir_id, side_id, point_id, station_id) values (" + periodid.tostring() + ", " + km + ", " + m + ", \'" + num + "\', " + markid + ", " + (dirid == "1" ? dirid = "-1" : dirid == "2" ? dirid = "1" : dirid = "0") + ", "
//                                                                + sideid + "," + markid + ", " + stationid.tostring() + ")");
//                                                        }


//                                                        if (liststationsections.where(l => l.oldtrackid.equals(z_row.attributes["put_nom"].value) && l.oldstationid.equals(z_row.attributes["st_kod"].value) && l.olddirectionid.equals(z_row.attributes["up_nom"].value)).count() > 0)
//                                                        {
//                                                            if (z_row.attributes["m"].value == "1" && z_row.attributes["km"].value == "5781")
//                                                            {

//                                                            }
//                                                            //if ((z_row.attributes["put_nom"].value.count() == 0) || (z_row.attributes["st_kod"].value.count() == 0) || (z_row.attributes["up_nom"].value.count() == 0))
//                                                            //{
//                                                            //    continue;
//                                                            //}
//                                                            importliststationsection liststationsection = liststationsections.where(l => l.oldtrackid.equals(z_row.attributes["put_nom"].value) && l.oldstationid.equals(z_row.attributes["st_kod"].value) && l.olddirectionid.equals(z_row.attributes["up_nom"].value)).first();
//                                                            int pos = int.parse(km) * 1000 + int.parse(m);

//                                                            if (pos < liststationsection.start_pos)
//                                                            {
//                                                                liststationsection.start_pos = pos;
//                                                                liststationsection.axis_pos = (liststationsection.start_pos + liststationsection.final_pos) / 2;
//                                                            }
//                                                            else if (pos > liststationsection.final_pos)
//                                                            {
//                                                                liststationsection.final_pos = pos;
//                                                                liststationsection.axis_pos = (liststationsection.start_pos + liststationsection.final_pos) / 2;
//                                                            }
//                                                        }
//                                                        else
//                                                        {
//                                                            importliststationsection liststationsection = new importliststationsection
//                                                            {
//                                                                oldtrackid = z_row.attributes["put_nom"].value,
//                                                                oldstationid = z_row.attributes["st_kod"].value,
//                                                                olddirectionid = z_row.attributes["up_nom"].value,
//                                                                start_pos = int.parse(km) * 1000 + int.parse(m),
//                                                                axis_pos = int.parse(km) * 1000 + int.parse(m),
//                                                                final_pos = int.parse(km) * 1000 + int.parse(m),
//                                                                point_id = markid
//                                                                //add km kmstr
//                                                                //metert to km in kilometrs

//                                                            };
//                                                            liststationsections.add(liststationsection);
//                                                        }
//                                                    }
//                                                    break;
//                                                }

//                                            }
//                                        }


//                                        //int64 stationid = liststationids.where(tmp => tmp.oldstationid == int.parse(z_row.attributes["st_kod"].value)).first().newstationid;


//                                    }
//                                    else
//                                    {
//                                        foreach (int64 stationid in liststatid)
//                                        {

//                                            if ((listids.where(tmp => tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value) && tmp.oldtrackid == (z_row.attributes["put_nom"].value)).count() > 0))
//                                            {
//                                                int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value) && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;



//                                                if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 15 ").count() > 0)
//                                                {
//                                                    int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 15");
//                                                    exportimportservice.execute("insert into tpl_switch (period_id, km, meter, num, mark_id, dir_id, side_id, point_id, station_id) values (" + periodid.tostring() + ", " + km + ", " + m + ", \'" + num + "\', " + markid + ", " + (dirid == "1" ? dirid = "-1" : dirid == "2" ? dirid = "1" : dirid = "0") + ", "
//                                                        + sideid + "," + markid + ", " + stationid.tostring() + ")");
//                                                }
//                                                else
//                                                {
//                                                    int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 15) returning id");
//                                                    exportimportservice.execute("insert into tpl_switch (period_id, km, meter, num, mark_id, dir_id, side_id, point_id, station_id) values (" + periodid.tostring() + ", " + km + ", " + m + ", \'" + num + "\', " + markid + ", " + (dirid == "1" ? dirid = "-1" : dirid == "2" ? dirid = "1" : dirid = "0") + ", "
//                                                        + sideid + "," + markid + ", " + stationid.tostring() + ")");
//                                                }


//                                                if (liststationsections.where(l => l.oldtrackid.equals(z_row.attributes["put_nom"].value) && l.oldstationid.equals(z_row.attributes["st_kod"].value) && l.olddirectionid.equals(z_row.attributes["up_nom"].value)).count() > 0)
//                                                {
//                                                    if (z_row.attributes["m"].value == "1" && z_row.attributes["km"].value == "5781")
//                                                    {

//                                                    }
//                                                    //if ((z_row.attributes["put_nom"].value.count() == 0) || (z_row.attributes["st_kod"].value.count() == 0) || (z_row.attributes["up_nom"].value.count() == 0))
//                                                    //{
//                                                    //    continue;
//                                                    //}
//                                                    importliststationsection liststationsection = liststationsections.where(l => l.oldtrackid.equals(z_row.attributes["put_nom"].value) && l.oldstationid.equals(z_row.attributes["st_kod"].value) && l.olddirectionid.equals(z_row.attributes["up_nom"].value)).first();
//                                                    int pos = int.parse(km) * 1000 + int.parse(m);

//                                                    if (pos < liststationsection.start_pos)
//                                                    {
//                                                        liststationsection.start_pos = pos;
//                                                        liststationsection.axis_pos = (liststationsection.start_pos + liststationsection.final_pos) / 2;
//                                                    }
//                                                    else if (pos > liststationsection.final_pos)
//                                                    {
//                                                        liststationsection.final_pos = pos;
//                                                        liststationsection.axis_pos = (liststationsection.start_pos + liststationsection.final_pos) / 2;
//                                                    }
//                                                }
//                                                else
//                                                {
//                                                    importliststationsection liststationsection = new importliststationsection
//                                                    {
//                                                        oldtrackid = z_row.attributes["put_nom"].value,
//                                                        oldstationid = z_row.attributes["st_kod"].value,
//                                                        olddirectionid = z_row.attributes["up_nom"].value,
//                                                        start_pos = int.parse(km) * 1000 + int.parse(m),
//                                                        axis_pos = int.parse(km) * 1000 + int.parse(m),
//                                                        final_pos = int.parse(km) * 1000 + int.parse(m),
//                                                        point_id = markid
//                                                        //add km kmstr
//                                                        //metert to km in kilometrs

//                                                    };
//                                                    liststationsections.add(liststationsection);
//                                                }
//                                            }
//                                            break;
//                                        }
//                                    }




//                                    //var lsitsationid = listids.where(tmp => tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value) && tmp.oldtrackid == (z_row.attributes["put_nom"].value));

//                                    //var liststatid = lsitsationid.select(o => o.newdirectionid).tolist();




//                                    //int64 stationid = liststationids.where(tmp => tmp.oldstationid == int.parse(z_row.attributes["st_kod"].value)).first().newstationid;
//                                }

//                                count = count + 1;
//                            }
//                        }
//                    }
//                }

//                progressbar.performstep();

//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "str.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "str")
//                        {
//                            if (count > 0)
//                                continue;

//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {

//                                string km = z_row.attributes["km"].value;
//                                string m = z_row.attributes["m"].value;
//                                string num = z_row.attributes["nom"].value;
//                                if (num == "10б" || num == "10б")
//                                {

//                                }

//                                string sideid;
//                                //string point_id = z_row.attributes["nom"].value;
//                                string point_id = "35";
//                                string dirid = z_row.attributes["posh"].value;//положение

//                                string markid = z_row.attributes["type"].value;

//                                //sideid = (z_row.attributes["otb"].value);


//                                int sidetype = -1;
//                                if (!int.tryparse(z_row.attributes["otb"].value, out sidetype))
//                                    sideid = "0";
//                                else
//                                {
//                                    if (sidetype == 1)
//                                        sideid = "0";
//                                    else if (sidetype == 2)
//                                        sideid = "2";
//                                    else if (sidetype == 3)
//                                        sideid = "1";
//                                    else if (sidetype == 4)
//                                        sideid = "0";
//                                    else if (sidetype == 0)
//                                        sideid = "0";
//                                    else sideid = "0";
//                                }
//                                if (z_row.attributes["up_nom"].value == "94790802" && z_row.attributes["put_nom"].value == "1б" && num == "14")
//                                {

//                                }
//                                if (z_row.attributes["up_nom"].value == "94790802" && z_row.attributes["put_nom"].value == "1" && num == "14")
//                                {

//                                }

//                                string directioncode = z_row.attributes["up_nom"].value; //ekasui_id
//                                string numberasstring = directioncode.tostring();
//                                string firstsixdigits = "";
//                                if (numberasstring.length > 6)
//                                {
//                                    firstsixdigits = numberasstring.substring(0, 6);
//                                    console.writeline("первые шесть цифр: " + firstsixdigits);
//                                }
//                                else
//                                {
//                                    console.writeline("число имеет менее шести цифр.");
//                                }
//                                //var st_kod = z_row.attributes["st_kod"].value;
//                                //var listnom = exportimportservice.importqueryreturnliststring($@"select nom from ekasui_str where nom = '{num}' and st_kod = '{st_kod}'");

//                                if (listids.where(tmp => tmp.olddirectionid == int.parse(z_row.attributes["st_kod"].value)).count() > 0)
//                                //if (liststationids.where(tmp => (tmp.olddirection == int.parse(z_row.attributes["up_nom"].value) && tmp.oldstationid == int.parse(z_row.attributes["st_kod"].value))).count() > 0)


//                                {
//                                    var lsitsationid = listids.where(tmp => tmp.olddirectionid == int.parse(z_row.attributes["st_kod"].value));
//                                    var liststatid = lsitsationid.select(o => o.newdirectionid).tolist();

//                                    var selcetd_same_pertiod = exportimportservice.importqueryreturnlistlong("select period_id from tpl_switch where km = " + km + " and meter =" + m + " and num ='" + num + "'");
//                                    if (selcetd_same_pertiod.count() > 0)
//                                    {
//                                        if (z_row.attributes["up_nom"].value != z_row.attributes["st_kod"].value && firstsixdigits == z_row.attributes["st_kod"].value)
//                                        {
//                                            if (listids.where(tmp => (tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value))).count() > 0)
//                                            {
//                                                liststatid = exportimportservice.importqueryreturnlistlong("select id from adm_station where code = '" + z_row.attributes["up_nom"].value + "'");
//                                                foreach (int64 stationid in liststatid)
//                                                {

//                                                    if ((listids.where(tmp => tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value) && tmp.oldtrackid == (z_row.attributes["put_nom"].value)).count() > 0))
//                                                    {
//                                                        var trackid = exportimportservice.importqueryreturnlistlong("select adm_track_id from tpl_period where id = " + selcetd_same_pertiod.first() + " ");



//                                                        if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.first() + " and mto_type = 15 ").count() > 0)
//                                                        {
//                                                            int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.first() + " and mto_type = 15");
//                                                            exportimportservice.execute("insert into tpl_switch (period_id, km, meter, num, mark_id, dir_id, side_id, point_id, station_id) values (" + periodid.tostring() + ", " + km + ", " + m + ", \'" + num + "\', " + markid + ", " + (dirid == "1" ? dirid = "-1" : dirid == "2" ? dirid = "1" : dirid = "0") + ", "
//                                                                + sideid + "," + markid + ", " + stationid.tostring() + ")");
//                                                        }
//                                                        else
//                                                        {
//                                                            int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 15) returning id");
//                                                            exportimportservice.execute("insert into tpl_switch (period_id, km, meter, num, mark_id, dir_id, side_id, point_id, station_id) values (" + periodid.tostring() + ", " + km + ", " + m + ", \'" + num + "\', " + markid + ", " + (dirid == "1" ? dirid = "-1" : dirid == "2" ? dirid = "1" : dirid = "0") + ", "
//                                                                + sideid + "," + markid + ", " + stationid.tostring() + ")");
//                                                        }


//                                                        if (liststationsections.where(l => l.oldtrackid.equals(z_row.attributes["put_nom"].value) && l.oldstationid.equals(z_row.attributes["st_kod"].value) && l.olddirectionid.equals(z_row.attributes["up_nom"].value)).count() > 0)
//                                                        {
//                                                            if (z_row.attributes["m"].value == "1" && z_row.attributes["km"].value == "5781")
//                                                            {

//                                                            }
//                                                            //if ((z_row.attributes["put_nom"].value.count() == 0) || (z_row.attributes["st_kod"].value.count() == 0) || (z_row.attributes["up_nom"].value.count() == 0))
//                                                            //{
//                                                            //    continue;
//                                                            //}
//                                                            importliststationsection liststationsection = liststationsections.where(l => l.oldtrackid.equals(z_row.attributes["put_nom"].value) && l.oldstationid.equals(z_row.attributes["st_kod"].value) && l.olddirectionid.equals(z_row.attributes["up_nom"].value)).first();
//                                                            int pos = int.parse(km) * 1000 + int.parse(m);

//                                                            if (pos < liststationsection.start_pos)
//                                                            {
//                                                                liststationsection.start_pos = pos;
//                                                                liststationsection.axis_pos = (liststationsection.start_pos + liststationsection.final_pos) / 2;
//                                                            }
//                                                            else if (pos > liststationsection.final_pos)
//                                                            {
//                                                                liststationsection.final_pos = pos;
//                                                                liststationsection.axis_pos = (liststationsection.start_pos + liststationsection.final_pos) / 2;
//                                                            }
//                                                        }
//                                                        else
//                                                        {
//                                                            importliststationsection liststationsection = new importliststationsection
//                                                            {
//                                                                oldtrackid = z_row.attributes["put_nom"].value,
//                                                                oldstationid = z_row.attributes["st_kod"].value,
//                                                                olddirectionid = z_row.attributes["up_nom"].value,
//                                                                start_pos = int.parse(km) * 1000 + int.parse(m),
//                                                                axis_pos = int.parse(km) * 1000 + int.parse(m),
//                                                                final_pos = int.parse(km) * 1000 + int.parse(m),
//                                                                point_id = markid
//                                                                //add km kmstr
//                                                                //metert to km in kilometrs

//                                                            };
//                                                            liststationsections.add(liststationsection);
//                                                        }
//                                                    }
//                                                    break;
//                                                }

//                                            }
//                                        }


//                                        //int64 stationid = liststationids.where(tmp => tmp.oldstationid == int.parse(z_row.attributes["st_kod"].value)).first().newstationid;


//                                    }
//                                    else
//                                    {
//                                        continue;
//                                    }




//                                    //var lsitsationid = listids.where(tmp => tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value) && tmp.oldtrackid == (z_row.attributes["put_nom"].value));

//                                    //var liststatid = lsitsationid.select(o => o.newdirectionid).tolist();




//                                    //int64 stationid = liststationids.where(tmp => tmp.oldstationid == int.parse(z_row.attributes["st_kod"].value)).first().newstationid;
//                                }

//                                count = count + 1;
//                            }
//                        }
//                    }
//                }

//                progressbar.performstep();



//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "str.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "str")
//                        {
//                            if (count > 0)
//                                continue;
//                            bool inserted = false;
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {

//                                string km = z_row.attributes["km"].value;
//                                string m = z_row.attributes["m"].value;
//                                string num = z_row.attributes["nom"].value;
//                                string st = z_row.attributes["st_kod"].value;
//                                string up = z_row.attributes["up_nom"].value;
//                                string put = z_row.attributes["put_nom"].value;
//                                string sideid;
//                                string point_id = "35";
//                                int dirid = int.parse(z_row.attributes["posh"].value);//положение
//                                if (dirid == 1)
//                                {
//                                    dirid = -1;
//                                }
//                                else if (dirid == 2)
//                                {
//                                    dirid = 1;
//                                }
//                                else
//                                {
//                                    dirid = 0;
//                                }
//                                string markid = z_row.attributes["type"].value;


//                                int sidetype = -1;
//                                if (!int.tryparse(z_row.attributes["otb"].value, out sidetype))
//                                    sideid = "0";
//                                else
//                                {
//                                    if (sidetype == 1)
//                                        sideid = "0";
//                                    else if (sidetype == 2)
//                                        sideid = "2";
//                                    else if (sidetype == 3)
//                                        sideid = "1";
//                                    else if (sidetype == 4)
//                                        sideid = "0";
//                                    else if (sidetype == 0)
//                                        sideid = "0";
//                                    else sideid = "0";




//                                    if (st == up)
//                                    {
//                                        var lsitsationid = listids.where(tmp => tmp.code == (z_row.attributes["st_kod"].value) && tmp.oldtrackid == (z_row.attributes["put_nom"].value));
//                                        var liststatid = lsitsationid.select(o => o.newdirectionid).tolist();
//                                        //var liststatid = exportimportservice.importqueryreturnlistlong("select id from adm_station where code = '" + z_row.attributes["st_kod"].value + "'");
//                                        if (liststatid.count() > 1)
//                                        {

//                                        }
//                                        foreach (int64 stationid in liststatid)
//                                        {
//                                            int64 trackid = listids.where(tmp => tmp.oldtrackid == z_row.attributes["put_nom"].value && tmp.code == z_row.attributes["st_kod"].value && tmp.newdirectionid == stationid).first().newtrackid;

//                                            if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 15 ").count() > 0)
//                                            {
//                                                int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 15");
//                                                exportimportservice.execute("insert into tpl_switch (period_id, km, meter, num, mark_id, dir_id, side_id, point_id, station_id,olddirection) values (" + periodid.tostring() + ", " + km + ", " + m + ", \'" + num + "\', " + markid + ", " + dirid + ", "
//                                                    + sideid + "," + markid + ", " + stationid.tostring() + ", " + z_row.attributes["up_nom"].value + ")");
//                                            }
//                                            else
//                                            {
//                                                int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 15) returning id");
//                                                exportimportservice.execute("insert into tpl_switch (period_id, km, meter, num, mark_id, dir_id, side_id, point_id, station_id,olddirection) values (" + periodid.tostring() + ", " + km + ", " + m + ", \'" + num + "\', " + markid + ", " + dirid + ", "
//                                                    + sideid + "," + markid + ", " + stationid.tostring() + ", " + z_row.attributes["up_nom"].value + ")");
//                                            }


//                                            if (liststationsections.where(l => l.oldtrackid.equals(z_row.attributes["put_nom"].value) && l.oldstationid.equals(z_row.attributes["st_kod"].value) && l.olddirectionid.equals(z_row.attributes["up_nom"].value)).count() > 0)
//                                            {
//                                                if (z_row.attributes["m"].value == "1" && z_row.attributes["km"].value == "5781")
//                                                {

//                                                }
//                                                importliststationsection liststationsection = liststationsections.where(l => l.oldtrackid.equals(z_row.attributes["put_nom"].value) && l.oldstationid.equals(z_row.attributes["st_kod"].value) && l.olddirectionid.equals(z_row.attributes["up_nom"].value)).first();
//                                                int pos = int.parse(km) * 1000 + int.parse(m);

//                                                if (pos < liststationsection.start_pos)
//                                                {
//                                                    liststationsection.start_pos = pos;
//                                                    liststationsection.axis_pos = (liststationsection.start_pos + liststationsection.final_pos) / 2;
//                                                }
//                                                else if (pos > liststationsection.final_pos)
//                                                {
//                                                    liststationsection.final_pos = pos;
//                                                    liststationsection.axis_pos = (liststationsection.start_pos + liststationsection.final_pos) / 2;
//                                                }
//                                            }
//                                            else
//                                            {
//                                                importliststationsection liststationsection = new importliststationsection
//                                                {
//                                                    oldtrackid = z_row.attributes["put_nom"].value,
//                                                    oldstationid = z_row.attributes["st_kod"].value,
//                                                    olddirectionid = z_row.attributes["up_nom"].value,
//                                                    start_pos = int.parse(km) * 1000 + int.parse(m),
//                                                    axis_pos = int.parse(km) * 1000 + int.parse(m),
//                                                    final_pos = int.parse(km) * 1000 + int.parse(m),
//                                                    point_id = markid

//                                                };
//                                                exportimportservice.execute("insert into adm_list_station_section(put_nom,up_nom,st_kod,start_pos,axis_pos,final_pos,point_id) values ('" + liststationsection.oldtrackid + "','" + liststationsection.olddirectionid + "','" + liststationsection.oldstationid
//                                                    + "','" + liststationsection.start_pos + "','" + liststationsection.axis_pos + "','" + liststationsection.final_pos + "','" + liststationsection.point_id + "')");
//                                                liststationsections.add(liststationsection);

//                                            }
//                                        }
//                                    }

//                                }

//                                count = count + 1;

//                            }

//                        }
//                    }
//                }

//                progressbar.performstep();

//                foreach (string trackid in liststationsections.groupby(l => l.oldtrackid).select(l => l.key))
//                {
//                    foreach (var stationsection in liststationsections.where(l => l.oldtrackid.equals(trackid)))
//                    {


//                        foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "stankm.xml"))
//                        {
//                            xmldocument xmldocument = new xmldocument();
//                            xmldocument.load(file.fullname);
//                            xmlelement xmlelement = xmldocument.documentelement;
//                            var count = 0;
//                            foreach (xmlnode xmlnode in xmlelement)
//                            {

//                                if (xmlnode.name == "stankm")
//                                {
//                                    if (count > 0)
//                                        continue;
//                                    bool inserted = false;
//                                    foreach (xmlnode z_row in xmlnode.parentnode)
//                                    {
//                                        bool truestart = true;
//                                        bool truefinal = true;

//                                        if (z_row.attributes["up_nom"].value.equals(stationsection.olddirectionid) && z_row.attributes["code"].value.equals(stationsection.oldstationid))
//                                        {

//                                            if (z_row.attributes["code"].value.equals("941600"))
//                                            {

//                                            }
//                                            int axiskm = int.parse(z_row.attributes["km"].value);
//                                            int axism = int.parse(z_row.attributes["m"].value);
//                                            if (z_row.attributes["m"].value == "1" && z_row.attributes["km"].value == "5781")
//                                            {

//                                            }

//                                            int startkm = stationsection.start_pos / 1000, startm = stationsection.start_pos % 1000, finalkm = stationsection.final_pos / 1000, finalm = stationsection.final_pos % 1000;
//                                            string point_id = stationsection.point_id;

//                                            if (stationsection.start_pos >= axiskm * 1000 + axism)
//                                            {
//                                                startkm = (axiskm * 1000 + axism - 1) / 1000;
//                                                startm = (axiskm * 1000 + axism - 1) % 1000;
//                                                truestart = true;
//                                            }

//                                            if (stationsection.final_pos <= axiskm * 1000 + axism)
//                                            {
//                                                finalkm = (axiskm * 1000 + axism + 1) / 1000;
//                                                finalm = (axiskm * 1000 + axism + 1) % 1000;
//                                                truefinal = true;
//                                            }

//                                            var tmp2 = listids.where(tmp => tmp.oldtrackid == (trackid) && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value));
//                                            if (z_row.attributes["up_nom"].value.equals("24701") && z_row.attributes["code"].value.equals("951617"))
//                                            {
//                                                //лесная 1 1 6139 834 6140 708
//                                            }
//                                            var trackids = tmp2.select(o => o.newtrackid).tolist();
//                                            long stationid = listids.where(tmp => tmp.olddirection.tostring() == stationsection.olddirectionid && tmp.olddirectionid.tostring() == stationsection.oldstationid).first().newdirectionid;
//                                            if (truefinal == true || truestart == true)
//                                            {
//                                                foreach (int64 trackid in trackids)
//                                                {
//                                                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 10").count() > 0)
//                                                    {
//                                                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 10");
//                                                        exportimportservice.execute("insert into tpl_station_section (station_id, period_id, start_km, start_m, final_km, final_m, axis_km, axis_m, point_id) values (" + stationid.tostring() + ", " + periodid.tostring() + ", " + startkm.tostring() + ", " + startm.tostring() + ", " + finalkm.tostring() + ", " + finalm.tostring() + ", " + axiskm.tostring() + ", " + axism.tostring() + "," + point_id + " )");

//                                                    }
//                                                    else
//                                                    {

//                                                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 10) returning id");
//                                                        exportimportservice.execute("insert into tpl_station_section (station_id, period_id, start_km, start_m, final_km, final_m, axis_km, axis_m, point_id) values (" + stationid.tostring() + ", " + periodid.tostring() + ", " + startkm.tostring() + ", " + startm.tostring() + ", " + finalkm.tostring() + ", " + finalm.tostring() + ", " + axiskm.tostring() + ", " + axism.tostring() + "," + point_id + " )");
//                                                    }
//                                                }
//                                            }

//                                            truestart = false;
//                                            truefinal = false;
//                                            inserted = true;
//                                            break;
//                                        }
//                                        count = count + 1;
//                                    }

//                                    if (!inserted)
//                                    {
//                                        var tmp2 = listids.where(tmp => tmp.oldtrackid == (trackid) && tmp.olddirectionid.tostring() == stationsection.oldstationid);
//                                        if (tmp2.count() < 0)
//                                        {
//                                            continue;
//                                        }
//                                        var trackids = tmp2.select(o => o.newtrackid).tolist();
//                                        var listcount = listids.where(tmp => tmp.oldtrackid.tostring() == stationsection.oldtrackid && tmp.olddirectionid.tostring() == stationsection.oldstationid).count();
//                                        if (listcount < 1)
//                                        {
//                                            continue;
//                                        }
//                                        long stationid = listids.where(tmp => tmp.oldtrackid.tostring() == stationsection.oldtrackid && tmp.olddirectionid.tostring() == stationsection.oldstationid).first().newdirectionid;
//                                        int startkm = stationsection.start_pos / 1000, startm = stationsection.start_pos % 1000, finalkm = stationsection.final_pos / 1000, finalm = stationsection.final_pos % 1000;
//                                        int axiskm = stationsection.axis_pos / 1000;
//                                        int axism = stationsection.axis_pos % 1000;
//                                        string point_id = stationsection.point_id;
//                                        if (stationsection.start_pos == stationsection.final_pos)
//                                        {
//                                            startkm = (stationsection.start_pos - 1) / 1000;
//                                            startm = (stationsection.start_pos - 1) % 1000;
//                                            finalkm = (stationsection.final_pos + 1) / 1000;
//                                            finalm = (stationsection.final_pos + 1) % 1000;
//                                        }
//                                        foreach (int64 trackid in trackids)
//                                        {

//                                            if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 10").count() > 0)
//                                            {
//                                                int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 10");
//                                                exportimportservice.execute("insert into tpl_station_section (station_id, period_id, start_km, start_m, final_km, final_m, axis_km, axis_m, point_id) values (" + stationid.tostring() + ", " + periodid.tostring() + ", " + startkm.tostring() + ", " + startm.tostring() + ", " + finalkm.tostring() + ", " + finalm.tostring() + ", " + axiskm.tostring() + ", " + axism.tostring() + "," + point_id + " )");
//                                            }
//                                            else
//                                            {
//                                                int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 10) returning id");
//                                                exportimportservice.execute("insert into tpl_station_section (station_id, period_id, start_km, start_m, final_km, final_m, axis_km, axis_m, point_id) values (" + stationid.tostring() + ", " + periodid.tostring() + ", " + startkm.tostring() + ", " + startm.tostring() + ", " + finalkm.tostring() + ", " + finalm.tostring() + ", " + axiskm.tostring() + ", " + axism.tostring() + "," + point_id + " )");
//                                            }
//                                        }
//                                    }
//                                }

//                                count = count + 1;

//                            }

//                        }
//                    }
//                }

//                string sideidstr;
//                string point_idstr = "35";
//                string markidstr = "0";
//                sideidstr = "0";



//                liststationids.clear();
//                liststationsections.clear();
//                progressbar.performstep();

//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "str.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "str")
//                        {
//                            if (count > 0)
//                                continue;

//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {

//                                string km = z_row.attributes["km"].value;
//                                string m = z_row.attributes["m"].value;
//                                string num = z_row.attributes["nom"].value;
//                                string sideid;
//                                //string point_id = z_row.attributes["nom"].value;
//                                string point_id = "35";
//                                string dirid = z_row.attributes["posh"].value;//положение

//                                string markid = z_row.attributes["type"].value;

//                                //sideid = (z_row.attributes["otb"].value);


//                                int sidetype = -1;
//                                if (!int.tryparse(z_row.attributes["otb"].value, out sidetype))
//                                    sideid = "0";
//                                else
//                                {
//                                    if (sidetype == 1)
//                                        sideid = "0";
//                                    else if (sidetype == 2)
//                                        sideid = "2";
//                                    else if (sidetype == 3)
//                                        sideid = "1";
//                                    else if (sidetype == 4)
//                                        sideid = "0";
//                                    else if (sidetype == 0)
//                                        sideid = "0";
//                                    else sideid = "0";
//                                }
//                                if (z_row.attributes["up_nom"].value == "94790802" && z_row.attributes["st_kod"].value == "947908")
//                                {

//                                }
//                                string directioncode = z_row.attributes["up_nom"].value; //ekasui_id
//                                string numberasstring = directioncode.tostring();
//                                string firstsixdigits = "";
//                                if (numberasstring.length >= 6)
//                                {
//                                    firstsixdigits = numberasstring.substring(0, 6);
//                                    console.writeline("первые шесть цифр: " + firstsixdigits);
//                                }
//                                else
//                                {
//                                    console.writeline("число имеет менее шести цифр.");
//                                }

//                                if (z_row.attributes["up_nom"].value == "94790802" && z_row.attributes["put_nom"].value == "10б")
//                                {

//                                }
//                                if (z_row.attributes["up_nom"].value == "94790802")
//                                {

//                                }
//                                if (z_row.attributes["up_nom"].value == "94790802" && z_row.attributes["put_nom"].value == "10б")
//                                {

//                                }

//                                if (z_row.attributes["up_nom"].value != z_row.attributes["st_kod"].value && firstsixdigits == z_row.attributes["st_kod"].value)
//                                {
//                                    if (listids.where(tmp => (tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value))).count() > 0)


//                                    {
//                                        if (z_row.attributes["m"].value == "1" && z_row.attributes["km"].value == "5781")
//                                        {

//                                        }


//                                        //var lsitsationid = listids.where(tmp => tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value) && tmp.oldtrackid == (z_row.attributes["put_nom"].value));

//                                        //var liststatid = lsitsationid.select(o => o.newdirectionid).tolist();
//                                        var liststatid = exportimportservice.importqueryreturnlistlong("select id from adm_station where code = '" + z_row.attributes["up_nom"].value + "'");



//                                        foreach (int64 stationid in liststatid)
//                                        {

//                                            if ((listids.where(tmp => tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value) && tmp.oldtrackid == (z_row.attributes["put_nom"].value)).count() > 0))
//                                            {
//                                                int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value) && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;


//                                                if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 15 ").count() > 0)
//                                                {
//                                                    int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 15");
//                                                    exportimportservice.execute("insert into tpl_switch (period_id, km, meter, num, mark_id, dir_id, side_id, point_id, station_id) values (" + periodid.tostring() + ", " + km + ", " + m + ", \'" + num + "\', " + markid + ", " + (dirid == "1" ? dirid = "-1" : dirid == "2" ? dirid = "1" : dirid = "0") + ", "
//                                                        + sideid + "," + markid + ", " + stationid.tostring() + ")");
//                                                }
//                                                else
//                                                {
//                                                    int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 15) returning id");
//                                                    exportimportservice.execute("insert into tpl_switch (period_id, km, meter, num, mark_id, dir_id, side_id, point_id, station_id) values (" + periodid.tostring() + ", " + km + ", " + m + ", \'" + num + "\', " + markid + ", " + (dirid == "1" ? dirid = "-1" : dirid == "2" ? dirid = "1" : dirid = "0") + ", "
//                                                        + sideid + "," + markid + ", " + stationid.tostring() + ")");
//                                                }


//                                                if (liststationsections.where(l => l.oldtrackid.equals(z_row.attributes["put_nom"].value) && l.oldstationid.equals(z_row.attributes["st_kod"].value) && l.oldparkid.equals(z_row.attributes["up_nom"].value)).count() > 0)
//                                                {
//                                                    if (z_row.attributes["m"].value == "1" && z_row.attributes["km"].value == "5781")
//                                                    {

//                                                    }
//                                                    //if ((z_row.attributes["put_nom"].value. == 0) || (z_row.attributes["st_kod"].value.count() == 0) || (z_row.attributes["up_nom"].value.count() == 0))
//                                                    //{
//                                                    //    continue;
//                                                    //}
//                                                    importliststationsection liststationsection = liststationsections.where(l => l.oldtrackid.equals(z_row.attributes["put_nom"].value) && l.oldstationid.equals(z_row.attributes["st_kod"].value) && l.oldparkid.equals(z_row.attributes["up_nom"].value)).first();
//                                                    int pos = int.parse(km) * 1000 + int.parse(m);

//                                                    if (pos < liststationsection.start_pos)
//                                                    {
//                                                        liststationsection.start_pos = pos;
//                                                        liststationsection.axis_pos = (liststationsection.start_pos + liststationsection.final_pos) / 2;
//                                                    }
//                                                    else if (pos > liststationsection.final_pos)
//                                                    {
//                                                        liststationsection.final_pos = pos;
//                                                        liststationsection.axis_pos = (liststationsection.start_pos + liststationsection.final_pos) / 2;
//                                                    }

//                                                }
//                                                else
//                                                {
//                                                    var adm_oldirection = exportimportservice.importqueryreturnliststring($@"select olddirection from adm_list_station where oldstationid = '{z_row.attributes["up_nom"].value}' ");
//                                                    importliststationsection liststationsection = new importliststationsection
//                                                    {
//                                                        oldtrackid = z_row.attributes["put_nom"].value,
//                                                        oldstationid = z_row.attributes["st_kod"].value,
//                                                        olddirectionid = adm_oldirection.first().tostring(),
//                                                        oldparkid = z_row.attributes["up_nom"].value,
//                                                        start_pos = int.parse(km) * 1000 + int.parse(m),
//                                                        axis_pos = int.parse(km) * 1000 + int.parse(m),
//                                                        final_pos = int.parse(km) * 1000 + int.parse(m),
//                                                        point_id = markid
//                                                        //add km kmstr
//                                                        //metert to km in kilometrs

//                                                    };
//                                                    exportimportservice.execute("insert into adm_list_station_section(put_nom,up_nom,st_kod,start_pos,axis_pos,final_pos,point_id) values ('" + liststationsection.oldtrackid + "','" + liststationsection.olddirectionid + "','" + liststationsection.oldstationid
//                                                  + "','" + liststationsection.start_pos + "','" + liststationsection.axis_pos + "','" + liststationsection.final_pos + "','" + liststationsection.point_id + "')");
//                                                    liststationsections.add(liststationsection);
//                                                }
//                                            }
//                                            break;
//                                        }
//                                        //int64 stationid = liststationids.where(tmp => tmp.oldstationid == int.parse(z_row.attributes["st_kod"].value)).first().newstationid;
//                                    }

//                                }


//                                count = count + 1;
//                            }
//                        }
//                    }
//                }

//                progressbar.performstep();
//                foreach (string trackid in liststationsections.groupby(l => l.oldtrackid).select(l => l.key))
//                {
//                    foreach (var stationsection in liststationsections.where(l => l.oldtrackid.equals(trackid)))
//                    {


//                        foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "stankm.xml"))
//                        {
//                            xmldocument xmldocument = new xmldocument();
//                            xmldocument.load(file.fullname);
//                            xmlelement xmlelement = xmldocument.documentelement;
//                            var count = 0;
//                            foreach (xmlnode xmlnode in xmlelement)
//                            {

//                                if (xmlnode.name == "stankm")
//                                {
//                                    if (count > 0)
//                                        continue;
//                                    bool inserted = false;
//                                    foreach (xmlnode z_row in xmlnode.parentnode)
//                                    {
//                                        bool truestart = true;
//                                        bool truefinal = true;

//                                        //if (z_row.attributes["code"].value.equals(stationsection.oldstationid))
//                                        if (z_row.attributes["up_nom"].value.equals(stationsection.olddirectionid) && z_row.attributes["code"].value.equals(stationsection.oldstationid))
//                                        {

//                                            if (z_row.attributes["code"].value.equals("952906"))
//                                            {

//                                            }
//                                            int axiskm = int.parse(z_row.attributes["km"].value);
//                                            int axism = int.parse(z_row.attributes["m"].value);
//                                            if (z_row.attributes["m"].value == "1" && z_row.attributes["km"].value == "5781")
//                                            {

//                                            }

//                                            int startkm = stationsection.start_pos / 1000, startm = stationsection.start_pos % 1000, finalkm = stationsection.final_pos / 1000, finalm = stationsection.final_pos % 1000;
//                                            string point_id = stationsection.point_id;

//                                            if (stationsection.start_pos >= axiskm * 1000 + axism)
//                                            {
//                                                startkm = (axiskm * 1000 + axism - 1) / 1000;
//                                                startm = (axiskm * 1000 + axism - 1) % 1000;
//                                                truestart = true;
//                                            }

//                                            if (stationsection.final_pos <= axiskm * 1000 + axism)
//                                            {
//                                                finalkm = (axiskm * 1000 + axism + 1) / 1000;
//                                                finalm = (axiskm * 1000 + axism + 1) % 1000;
//                                                truefinal = true;
//                                            }

//                                            //var tmp2 = listids.where(tmp => tmp.oldtrackid == (trackid) && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value));
//                                            var tmp2 = listids.where(tmp => tmp.oldtrackid == (trackid) && tmp.olddirectionid.tostring() == stationsection.oldparkid);

//                                            //if (z_row.attributes["up_nom"].value.equals("24701") && z_row.attributes["code"].value.equals("951617"))
//                                            {
//                                                //лесная 1 1 6139 834 6140 708
//                                            }
//                                            var trackids = tmp2.select(o => o.newtrackid).tolist();
//                                            long stationid = listids.where(tmp => tmp.olddirection.tostring() == stationsection.olddirectionid && tmp.olddirectionid.tostring() == stationsection.oldparkid).first().newdirectionid;
//                                            if (truefinal == true || truestart == true)
//                                            {
//                                                foreach (int64 trackid in trackids)
//                                                {
//                                                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 10").count() > 0)
//                                                    {
//                                                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 10");
//                                                        exportimportservice.execute("insert into tpl_station_section (station_id, period_id, start_km, start_m, final_km, final_m, axis_km, axis_m, point_id) values (" + stationid.tostring() + ", " + periodid.tostring() + ", " + startkm.tostring() + ", " + startm.tostring() + ", " + finalkm.tostring() + ", " + finalm.tostring() + ", " + axiskm.tostring() + ", " + axism.tostring() + "," + point_id + " )");

//                                                    }
//                                                    else
//                                                    {

//                                                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 10) returning id");
//                                                        exportimportservice.execute("insert into tpl_station_section (station_id, period_id, start_km, start_m, final_km, final_m, axis_km, axis_m, point_id) values (" + stationid.tostring() + ", " + periodid.tostring() + ", " + startkm.tostring() + ", " + startm.tostring() + ", " + finalkm.tostring() + ", " + finalm.tostring() + ", " + axiskm.tostring() + ", " + axism.tostring() + "," + point_id + " )");
//                                                    }
//                                                    break;
//                                                }
//                                            }

//                                            truestart = false;
//                                            truefinal = false;
//                                            inserted = true;
//                                            break;
//                                        }
//                                        count = count + 1;
//                                    }

//                                    if (!inserted)
//                                    {
//                                        var tmp2 = listids.where(tmp => tmp.oldtrackid == (trackid) && tmp.olddirectionid.tostring() == stationsection.oldstationid);
//                                        if (tmp2.count() < 0)
//                                        {
//                                            continue;
//                                        }
//                                        var trackids = tmp2.select(o => o.newtrackid).tolist();
//                                        var listcount = listids.where(tmp => tmp.oldtrackid.tostring() == stationsection.oldtrackid && tmp.olddirectionid.tostring() == stationsection.oldstationid).count();
//                                        if (listcount < 1)
//                                        {
//                                            continue;
//                                        }
//                                        long stationid = listids.where(tmp => tmp.oldtrackid.tostring() == stationsection.oldtrackid && tmp.olddirectionid.tostring() == stationsection.oldstationid).first().newdirectionid;
//                                        int startkm = stationsection.start_pos / 1000, startm = stationsection.start_pos % 1000, finalkm = stationsection.final_pos / 1000, finalm = stationsection.final_pos % 1000;
//                                        int axiskm = stationsection.axis_pos / 1000;
//                                        int axism = stationsection.axis_pos % 1000;
//                                        string point_id = stationsection.point_id;
//                                        if (stationsection.start_pos == stationsection.final_pos)
//                                        {
//                                            startkm = (stationsection.start_pos - 1) / 1000;
//                                            startm = (stationsection.start_pos - 1) % 1000;
//                                            finalkm = (stationsection.final_pos + 1) / 1000;
//                                            finalm = (stationsection.final_pos + 1) % 1000;
//                                        }
//                                        foreach (int64 trackid in trackids)
//                                        {

//                                            if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 10").count() > 0)
//                                            {
//                                                int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 10");
//                                                exportimportservice.execute("insert into tpl_station_section (station_id, period_id, start_km, start_m, final_km, final_m, axis_km, axis_m, point_id) values (" + stationid.tostring() + ", " + periodid.tostring() + ", " + startkm.tostring() + ", " + startm.tostring() + ", " + finalkm.tostring() + ", " + finalm.tostring() + ", " + axiskm.tostring() + ", " + axism.tostring() + "," + point_id + " )");
//                                            }
//                                            else
//                                            {
//                                                int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 10) returning id");
//                                                exportimportservice.execute("insert into tpl_station_section (station_id, period_id, start_km, start_m, final_km, final_m, axis_km, axis_m, point_id) values (" + stationid.tostring() + ", " + periodid.tostring() + ", " + startkm.tostring() + ", " + startm.tostring() + ", " + finalkm.tostring() + ", " + finalm.tostring() + ", " + axiskm.tostring() + ", " + axism.tostring() + "," + point_id + " )");
//                                            }
//                                        }
//                                    }
//                                }

//                                count = count + 1;

//                            }

//                        }
//                    }
//                }



//                liststationsections.clear();



//                progressbar.performstep();



//                liststationids.clear();
//                liststationsections.clear();
//                progressbar.performstep();

//                var liscrosstie = exportimportservice.importqueryreturnlistimportedelevation($@"select * from ekasui_gb order by start_km,start_m");

//                var start_km_liscrosstie = 0;
//                var start_km_next_liscrosstie = 0;
//                var start_m_liscrosstie = 0;
//                var start_m_next_liscrosstie = 0;
//                var final_km_liscrosstie = 0;
//                var final_km_next_liscrosstie = 0;
//                var final_m_liscrosstie = 0;
//                var final_m_next_liscrosstie = 0;

//                var crosstieid_liscrosstie = 0;


//                var curve_napr_liscrosstie = 0;
//                var curve_put_liscrosstie = "";
//                for (int g = 0; g < liscrosstie.count() - 1; g += 1)
//                {

//                    curve_napr_liscrosstie = liscrosstie[g].up_nom;
//                    curve_put_liscrosstie = liscrosstie[g].put_nom;
//                    start_km_liscrosstie = int.parse(liscrosstie[g].start_km);
//                    start_m_liscrosstie = int.parse(liscrosstie[g].start_m);
//                    final_km_liscrosstie = int.parse(liscrosstie[g].final_km);
//                    final_m_liscrosstie = int.parse(liscrosstie[g].final_m);
//                    final_km_next_liscrosstie = int.parse(liscrosstie[g + 1].final_km);
//                    start_m_next_liscrosstie = int.parse(liscrosstie[g + 1].start_m);
//                    start_km_next_liscrosstie = int.parse(liscrosstie[g + 1].start_km);
//                    crosstieid_liscrosstie = liscrosstie[g].type;

//                    if (final_km_liscrosstie == start_km_next_liscrosstie && final_m_liscrosstie == start_m_next_liscrosstie)
//                    {
//                        final_m_liscrosstie = final_m_liscrosstie - 1;


//                    }





//                    if (listids.where(tmp => tmp.oldtrackid == curve_put_liscrosstie && tmp.olddirectionid == curve_napr_liscrosstie).count() > 0)
//                    {
//                        int64 trackid = listids.where(tmp => tmp.oldtrackid == curve_put_liscrosstie && tmp.olddirectionid == curve_napr_liscrosstie).first().newtrackid;
//                        if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 1").count() > 0)
//                        {
//                            int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 1");
//                            exportimportservice.execute("insert into apr_crosstie (period_id, crosstie_type_id, start_km, start_m, final_km, final_m) values (" + periodid.tostring() + ", " + crosstieid_liscrosstie + ", " + start_km_liscrosstie + ", " + start_m_liscrosstie + ", " + final_km_liscrosstie + ", " + final_m_liscrosstie + ")");
//                        }
//                        else
//                        {
//                            int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 1) returning id");
//                            exportimportservice.execute("insert into apr_crosstie (period_id, crosstie_type_id, start_km, start_m, final_km, final_m) values (" + periodid.tostring() + ", " + crosstieid_liscrosstie + ", " + start_km_liscrosstie + ", " + start_m_liscrosstie + ", " + final_km_liscrosstie + ", " + final_m_liscrosstie + ")");
//                        }
//                    }
//                }
//                progressbar.performstep();
//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "km.xml"))//готово
//                {
//                    using (streamwriter outputfile = new streamwriter(logfile, true))
//                    {
//                        outputfile.writeline("km.xml");
//                    }
//                    var count = 0;
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "km")
//                        {
//                            if (count > 0)
//                                continue;
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {
//                                string km = z_row.attributes["km"].value;
//                                string length = z_row.attributes["end_m"].value;
//                                string length2 = z_row.attributes["length"].value;
//                                string start = z_row.attributes["begin_m"].value;
//                                string final = z_row.attributes["end_m"].value;
//                                string up_nom = z_row.attributes["up_nom"].value;
//                                string put_nom = z_row.attributes["put_nom"].value;
//                                if (listids.where(tmp => (tmp.oldtrackid == (z_row.attributes["put_nom"].value)) && (tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)) && length != "1000").count() > 0)
//                                {
//                                    try
//                                    {
//                                        int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                                        if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 2").count() > 0)
//                                        {
//                                            int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 2");
//                                            exportimportservice.execute("insert into tpl_nst_km (period_id, km, len) values (" + periodid.tostring() + ", " + km + ", " + length + ")");
//                                        }
//                                        else
//                                        {
//                                            int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values " +
//                                                "(" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 2) returning id");
//                                            exportimportservice.execute("insert into tpl_nst_km (period_id, km, len) values (" + periodid.tostring() + ", " + km + ", " + length + ")");
//                                        }
//                                    }
//                                    catch (exception e)
//                                    {
//                                        using (streamwriter outputfile = new streamwriter(logfile, true))
//                                        {
//                                            outputfile.writeline(z_row.attributes["put_nom"].value + ", km: " + z_row.attributes["km"].value + ", len: " + z_row.attributes["end_m"].value);
//                                            outputfile.writeline(e.message);
//                                        }
//                                    }
//                                }
//                                else
//                                {
//                                    using (streamwriter outputfile = new streamwriter(logfile, true))
//                                    {
//                                        outputfile.writeline(z_row.attributes["put_nom"].value + ", km: " + z_row.attributes["km"].value + ", len: " + z_row.attributes["end_m"].value);
//                                        outputfile.writeline("путь по id не найден");
//                                    }
//                                }
//                                count = count + 1;
//                            }
//                        }
//                    }

//                    using (streamwriter outputfile = new streamwriter(logfile, true))
//                    {
//                        outputfile.writeline();
//                    }
//                }

//                progressbar.performstep();


//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "nakl.xml"))//готово
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "nakl")
//                        {
//                            if (count > 0)
//                                continue;
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {

//                                string type = z_row.attributes["type"].value;//track расположение на фрагментах
//                                int nakl = 0;


//                                switch (type)
//                                {
//                                    case "0":
//                                        nakl = 2;
//                                        //kb
//                                        break;
//                                    case "1":
//                                        nakl = 1;
//                                        //ars
//                                        break;
//                                    case "2":
//                                        nakl = 3;
//                                        //жбр
//                                        break;


//                                }
//                                ///в таблицы доабвить периуд айди

//                                if (listids.where(tmp => tmp.oldtrackid.equals(z_row.attributes["put_nom"].value) && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                                {

//                                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 16").count() > 0)
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 16");
//                                        exportimportservice.execute("insert into apr_long_rails (period_id, start_km, start_m, final_km, final_m,type_id) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + "," + nakl + ")");
//                                    }
//                                    else
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 16) returning id");
//                                        exportimportservice.execute("insert into apr_long_rails (period_id, start_km, start_m, final_km, final_m,type_id) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + "," + nakl + ")");
//                                    }
//                                }
//                                count = count + 1;
//                            }
//                        }
//                    }
//                }

//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "ctrluch.xml"))//готово
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "ctrluch")
//                        {
//                            if (count > 0)
//                                continue;
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {
//                                int type = int.parse(z_row.attributes["type"].value);

//                                //0-левая 1- правая в ебпд
//                                //у нас 1-правая 2 левая
//                                string avg_lev = z_row.attributes["ur_mo"].value; // ваша строка

//                                if (avg_lev.startswith("-"))
//                                {
//                                    // строка начинается с минуса, убираем его
//                                    avg_lev = avg_lev.substring(1);
//                                }
//                                else
//                                {
//                                    // строка не начинается с минуса, добавляем его
//                                    avg_lev = "-" + avg_lev;
//                                }

//                                //avg_level = avg_level.tostring();

//                                //type 0 =контрольный
//                                //type 1 = юстировочный
//                                if (listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                                {
//                                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 28").count() > 0)
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 28");
//                                        exportimportservice.execute("insert into tpl_check_sections (period_id, start_km, start_m, final_km, final_m, avg_width, avg_level, sko_width, sko_level,type) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + ", " + z_row.attributes["sh_mo"].value + ", " + avg_lev + ", " + z_row.attributes["sh_sko"].value + ", " + z_row.attributes["ur_sko"].value + ", " + type + ")");
//                                    }
//                                    else
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 28) returning id");
//                                        exportimportservice.execute("insert into tpl_check_sections (period_id, start_km, start_m, final_km, final_m, avg_width, avg_level, sko_width, sko_level,type) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + ", " + z_row.attributes["sh_mo"].value + ", " + avg_lev + ", " + z_row.attributes["sh_sko"].value + ", " + z_row.attributes["ur_sko"].value + ", " + type + ")");
//                                    }
//                                }
//                                count = count + 1;
//                            }
//                        }
//                    }
//                }

//                progressbar.performstep();
//                var listup_nom = listids.select(o => o.olddirectionid);


//                var containss = exportimportservice.importqueryreturnlistimportedcurvedelete("select kmn as startkm,mn as startm,* from ekasui_curves order by assetnum,kmn,mn");
//                if (containss.count() > 0)
//                {

//                    for (int i = 0; i < containss.count() - 1; i++)
//                    {
//                        if ((containss[i].startkm == containss[i + 1].startkm) && (math.abs(int.parse(containss[i].startm) - int.parse(containss[i + 1].startm)) < 2)
//                            && (containss[i].assetnum == containss[i + 1].assetnum))
//                        {
//                            exportimportservice.execute($@"delete from ekasui_curves where kmn={ containss[i].startkm} and mn={containss[i].startm} ");
//                        }
//                    }

//                }



//                var listoldirection = exportimportservice.importqueryreturnlistimportedelevation($@"select distinct up_nom from ekasui_non_ext    group by up_nom");
//                //var listoldirection = exportimportservice.importqueryreturnlistimportedelevation($@"select code as up_nom from adm_direction order by code");
//                var listoldtrack = exportimportservice.importqueryreturnlistimportedelevation($@"select distinct put_nom from ekasui_non_ext    group by put_nom");

//                //foreach (var upnom in listoldirection)//для ширины колеии
//                //{

//                //    foreach (var putnom in listoldtrack)
//                //    {
//                //        var listcurve = exportimportservice.importqueryreturnlistimportedelevation($@"select
//                //                                                                                     selected.start_km,
//                //                                                                                     selected.start_m,
//                //                                                                                     selected.final_km,
//                //                                                                                     selected.final_m,
//                //                                                                                     selected.width,
//                //                                                                                     selected.up_nom,
//                //                                                                                        selected.put_nom	
//                //                                                                                    from
//                //                                                                                     (
//                //                                                                                     select
//                //                                                                                      ast.start_km,
//                //                                                                                      ast.start_m,
//                //                                                                                      ast.final_km,
//                //                                                                                      ast.final_m,
//                //                                                                                      ast.width,
//                //                                                                                      ac.up_nom,
//                //                                                                                      ac.put_nom,
//                //                                                                                      row_number ( ) over ( partition by curve_id order by ac.id asc ) rn 
//                //                                                                                     from
//                //                                                                                      apr_curve as ac
//                //                                                                                      inner join apr_stcurve as ast on ac.id = ast.curve_id 
//                //                                                                                     where
//                //                                                                                      ac.up_nom = '{upnom.up_nom}' 
//                //                                                                                      and ac.put_nom = '{putnom.put_nom}' 
//                //                                                                                      and ast.width > 1520 
//                //                                                                                     order by
//                //                                                                                      ast.start_km,
//                //                                                                                      ast.start_m 
//                //                                                                                     ) as selected 
//                //                                                                                    where
//                //                                                                                     rn = 1");
//                //        var listkm = exportimportservice.importqueryreturnlistimportedelevation($@"select* from ekasui_non_ext where up_nom = '{upnom.up_nom}' and put_nom = '{putnom.put_nom}' order by km,start_m,final_m");
//                //        var norma = "1520";


//                //        string startkm, startm, finalm, finalkm;

//                //        if (listkm.count() == 0)
//                //        {
//                //            continue;
//                //        }
//                //        if (listcurve.count() != 0)
//                //        {
//                //            startkm = listkm.select(o => o.km).first();
//                //            startm = listkm.select(o => o.start_m).first();
//                //            finalkm = listkm.select(o => o.km).last();
//                //            finalm = listkm.select(o => o.final_m).last();

//                //            if (listids.where(tmp => tmp.oldtrackid == putnom.put_nom && tmp.olddirectionid == upnom.up_nom).count() > 0)
//                //            {

//                //                int64 trackidanw = listids.where(tmp => tmp.oldtrackid == putnom.put_nom && tmp.olddirectionid == upnom.up_nom).first().newtrackid;
//                //                if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackidanw.tostring() + " and mto_type = 5").count() > 0)
//                //                {
//                //                    int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackidanw.tostring() + " and mto_type = 5");
//                //                    exportimportservice.execute("insert into apr_norma_width (period_id, start_km, start_m, final_km, final_m, norma_width) values (" + periodid.tostring() + ", "
//                //                        + startkm + ", " + startm + ", " + finalkm + ", " + finalm + "," + norma + ")");
//                //                }
//                //                else
//                //                {
//                //                    int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackidanw.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 5) returning id");
//                //                    exportimportservice.execute("insert into apr_norma_width (period_id, start_km, start_m, final_km, final_m, norma_width) values (" + periodid.tostring() + ", "
//                //                            + startkm + ", " + startm + ", " + finalkm + ", " + finalm + "," + norma + ")");
//                //                }

//                //            }
//                //            continue;
//                //        }


//                //        startkm = listkm.select(o => o.km).first();
//                //        startm = listkm.select(o => o.start_m).first();
//                //        finalm = listcurve.select(o => o.start_m).first();
//                //        finalkm = listcurve.select(o => o.start_km).first();

//                //        for (int i = 1; i < listcurve.count() - 1; i++)
//                //        {
//                //            if (i > 0)
//                //            {
//                //                startkm = listcurve[i - 1].final_km;
//                //                startm = listcurve[i - 1].final_m;
//                //                finalkm = listcurve[i].start_km;
//                //                finalm = listcurve[i].start_m;
//                //            }
//                //            if (i == listcurve.count() - 1)
//                //            {
//                //                startkm = listcurve[i - 1].final_km;
//                //                startm = listcurve[i - 1].final_m;
//                //                finalkm = listkm.select(o => o.km).last();
//                //                finalm = listkm.select(o => o.final_m).last();
//                //            }

//                //            if ((math.abs(int.parse(startkm) - int.parse(finalkm)) * 1000 + math.abs(int.parse(startm) - int.parse(finalm))) >= 25)
//                //            {
//                //                if (listids.where(tmp => tmp.oldtrackid == listcurve[i].put_nom && tmp.olddirectionid == listcurve[i].up_nom).count() > 0)
//                //                {
//                //                    int64 trackidanw = listids.where(tmp => tmp.oldtrackid == listcurve[i].put_nom && tmp.olddirectionid == listcurve[i].up_nom).first().newtrackid;
//                //                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackidanw.tostring() + " and mto_type = 5").count() > 0)
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackidanw.tostring() + " and mto_type = 5");
//                //                        exportimportservice.execute("insert into apr_norma_width (period_id, start_km, start_m, final_km, final_m, norma_width) values (" + periodid.tostring() + ", "
//                //                            + startkm + ", " + startm + ", " + finalkm + ", " + finalm + "," + norma + ")");
//                //                    }
//                //                    else
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackidanw.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 5) returning id");
//                //                        exportimportservice.execute("insert into apr_norma_width (period_id, start_km, start_m, final_km, final_m, norma_width) values (" + periodid.tostring() + ", "
//                //                               + startkm + ", " + startm + ", " + finalkm + ", " + finalm + "," + norma + ")");
//                //                    }
//                //                }
//                //            }

//                //        }
//                //    }
//                //}
//                //foreach (var upnom in listoldirection)//для несуществующих
//                //{

//                //    foreach (var putnom in listoldtrack)
//                //    {

//                //        var list = exportimportservice.importqueryreturnlistimportedelevation($@"select* from ekasui_non_ext where up_nom = '{upnom.up_nom}'  order by km");

//                //        //var list = exportimportservice.importqueryreturnlistimportedelevation($@"select* from ekasui_non_ext where up_nom = '{upnom.up_nom}' and put_nom = '{putnom.put_nom}' order by km");

//                //        for (int i = 0; i < list.count() - 1; i++)
//                //        {
//                //            if ((math.abs(int.parse(list[i].km) - int.parse(list[i + 1].km)) == 1) || (math.abs(int.parse(list[i].km) - int.parse(list[i + 1].km)) == 0))
//                //                continue;

//                //            var non_ext_km = (int.parse(list[i].km) + 1).tostring();

//                //            if (list[i].put_nom == null || list[i].up_nom == null)

//                //            {
//                //                continue;

//                //            }
//                //            int64 trackid = listids.where(tmp => tmp.oldtrackid == list[i].put_nom && tmp.olddirectionid == list[i].up_nom).first().newtrackid;
//                //            if (trackid == 0)
//                //            {
//                //                continue;
//                //            }
//                //            if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 18").count() > 0)
//                //            {
//                //                int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 18");
//                //                exportimportservice.execute("insert into tpl_non_ext_km (period_id, km) values (" + periodid.tostring() + ", " + non_ext_km + ")");
//                //            }
//                //            else
//                //            {
//                //                int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 18) returning id");
//                //                exportimportservice.execute("insert into tpl_non_ext_km (period_id, km) values (" + periodid.tostring() + ", " + non_ext_km + ")");
//                //            }

//                //        }
//                //    }
//                //}




//                var list_not_filt_arp_curve = exportimportservice.importqueryreturnlistimportedcurve($@"
//                     select  up_nom as olddirectionid ,put_nom as  oldtrackid,* from ekasui_plan_rightlevel  where type=0   order by up_nom,put_nom,km,m");
//                var filter_curves = new list<importlistcurveid>();
//                var multi_filter_curve_start = new list<importlistcurveid>();
//                //bool ismulticurve = false;
//                importlistcurveid filter_curve = new importlistcurveid();
//                //importlistcurveid multi_filter_curve_start = new importlistcurveid();

//                int i_filter = 0;
//                var prom_curve = new list<importlistcurveid>();
//                var distinctcurves_filter = new list<importlistcurveid>();
//                bool ismulticurve_filter = false;
//                bool ismulticurvestart = false;
//                importlistcurveid multicurve_filter = new importlistcurveid();

//                list<importlistcurveid> liststids = new list<importlistcurveid>();
//                list<importlistcurveid> listlevelids = new list<importlistcurveid>();
//                list<importlistcurveid> missingcurves = new list<importlistcurveid>();




//                //var g = 0;
//                var flagstart = false;
//                var flagfinal = false;

//                var frst_curve = "";
//                var next_curve = "";
//                var curve_direction = 0;
//                var curve_direction_next = 0;
//                var curve_put = "";
//                var curve_put_next = "";

//                //foreach (var curves in list_not_filt_arp_curve)
//                for (int g = 0; g < list_not_filt_arp_curve.count() - 1; g += 1)
//                {

//                    frst_curve = "";
//                    next_curve = "";
//                    curve_direction = 0;
//                    curve_direction_next = 0;
//                    curve_put = "";
//                    curve_put_next = "";

//                    frst_curve = list_not_filt_arp_curve[g].radius;
//                    next_curve = list_not_filt_arp_curve[g + 1].radius;
//                    curve_direction = list_not_filt_arp_curve[g].olddirectionid;
//                    curve_direction_next = list_not_filt_arp_curve[g + 1].olddirectionid;
//                    curve_put = list_not_filt_arp_curve[g].oldtrackid;
//                    curve_put_next = list_not_filt_arp_curve[g + 1].oldtrackid;

//                    if (int.parse(frst_curve) == 0 && int.parse(next_curve) != 0 && flagstart == false && curve_direction == curve_direction_next && curve_put == curve_put_next)
//                    {
//                        multicurve_filter.startkm = list_not_filt_arp_curve[g].km;
//                        multicurve_filter.startm = list_not_filt_arp_curve[g].m;

//                        multicurve_filter.olddirectionid = list_not_filt_arp_curve[g].olddirectionid;
//                        multicurve_filter.oldtrackid = list_not_filt_arp_curve[g].oldtrackid;



//                        flagstart = true;
//                    }
//                    if (int.parse(frst_curve) != 0 && int.parse(next_curve) != 0 && flagstart)
//                    {

//                    }
//                    if (int.parse(frst_curve) != 0 && int.parse(next_curve) == 0 && flagstart)
//                    {

//                        multicurve_filter.finalkm = list_not_filt_arp_curve[g + 1].km;
//                        multicurve_filter.finalm = list_not_filt_arp_curve[g + 1].m;
//                        multicurve_filter.shab = list_not_filt_arp_curve[g + 1].shab;
//                        if (int.parse(frst_curve) > 0)
//                        {
//                            multicurve_filter.napr = 2;//левая

//                        }
//                        if (int.parse(frst_curve) < 0)
//                        {
//                            multicurve_filter.napr = 1;//правая

//                        }
//                        distinctcurves_filter.add(multicurve_filter);
//                        multicurve_filter = new importlistcurveid();
//                        ismulticurvestart = false;
//                        ismulticurve_filter = false;
//                        flagstart = false;
//                    }



//                }




//                list<long> apr_curveids = new list<long>();
//                foreach (var aprcurve in distinctcurves_filter)
//                {
//                    //0-левая 1- правая в ебпд
//                    //у нас 1-правая 2 левая
//                    if (listids.where(tmp => tmp.olddirectionid == aprcurve.olddirectionid && tmp.oldtrackid == aprcurve.oldtrackid.tostring()).count() > 0)
//                    {
//                        int64 trackid = listids.where(tmp => tmp.oldtrackid == aprcurve.oldtrackid.tostring() && tmp.olddirectionid == aprcurve.olddirectionid).first().newtrackid;
//                        if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 11").count() > 0)
//                        {
//                            int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 11");
//                            apr_curveids.add(exportimportservice.importqueryreturnlong("insert into apr_curve(period_id, start_km, start_m, final_km, final_m, side_id,up_nom,put_nom)  values (" + periodid.tostring() + ", " + int.parse(aprcurve.startkm) + ", " + int.parse(aprcurve.startm) + ", " + int.parse(aprcurve.finalkm) + ", " + int.parse(aprcurve.finalm)
//                                + "," + (aprcurve.napr) + ",'" + aprcurve.olddirectionid + "','" + aprcurve.oldtrackid + "') returning id"));
//                        }

//                        else
//                        {
//                            int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 11) returning id");
//                            apr_curveids.add(exportimportservice.importqueryreturnlong("insert into apr_curve(period_id, start_km, start_m, final_km, final_m, side_id,up_nom,put_nom)  values (" + periodid.tostring() + ", " + int.parse(aprcurve.startkm) + ", " + int.parse(aprcurve.startm) + ", " + int.parse(aprcurve.finalkm) + ", " + int.parse(aprcurve.finalm)
//                                + "," + (aprcurve.napr) + ",'" + aprcurve.olddirectionid + "','" + aprcurve.oldtrackid + "') returning id"));
//                        }
//                    }

//                }



//                var distinctcurves = new list<importlistcurveid>();
//                bool ismulticurve = false;

//                importlistcurveid multicurve = new importlistcurveid();


//                importliststcurve liststcurve = new importliststcurve();
//                importlistelcurve listelcurve = new importlistelcurve();
//                list<long> curveids = new list<long>();




//                int curveidindex = -1;
//                ismulticurve = false;
//                multicurve = new importlistcurveid();



//                int64 curveid = 0;

//                foreach (var aprcurve in distinctcurves_filter)
//                {
//                    if (listids.where(tmp => tmp.olddirectionid == aprcurve.olddirectionid && tmp.oldtrackid == aprcurve.oldtrackid.tostring()).count() > 0 == false)
//                    {
//                        continue;
//                    }

//                    curveidindex++;
//                    curveid = 0;
//                    if (apr_curveids.count() > 0 && curveidindex < apr_curveids.count())
//                    {
//                        curveid = apr_curveids[curveidindex];
//                    }
//                    else
//                    {
//                        break;
//                    }

//                    if (aprcurve.startkm == "6539" && aprcurve.startm == "65")
//                    {

//                    }

//                    var first_len = 0;
//                    var last_len = 0;


//                    liststids = rdstructureservice.get_list_st_ids_curves(aprcurve.startkm,
//                          aprcurve.startm, aprcurve.finalkm, aprcurve.finalm, aprcurve.olddirectionid, aprcurve.oldtrackid, first_len, last_len, 0);

//                    if (liststids != null)
//                    {
//                        if (liststids.count() == 0) continue;
//                        first_len = 0;
//                        last_len = 0;

//                        ///////////////////

//                        bool t1 = true;
//                        bool t2 = false;

//                        var act_start_m = "-1";
//                        var act_final_m = "-1";
//                        //////////////////////////////////////
//                        var vershind = 0;



//                        while (vershind < liststids.count() - 1)
//                        {
//                            var currriht = math.abs(int.parse(liststids[vershind].radius));
//                            var nextriht = math.abs(int.parse(liststids[vershind + 1].radius));

//                            if (nextriht - currriht == 0)
//                            {
//                                vershind++;
//                                continue;
//                            }


//                            var kilometr = exportimportservice.importqueryreturnlistimportedcurve($@"select start_m as startm,final_m as finalm,*  from apr_km where up_nom = '{liststids[vershind].olddirectionid}' and put_nom='{liststids[vershind].oldtrackid}' and km='{liststids[vershind].km}' ");
//                            var kilometr_next = exportimportservice.importqueryreturnlistimportedcurve($@"select start_m as startm,final_m as finalm,*  from apr_km where up_nom = '{liststids[vershind + 1].olddirectionid}' and put_nom='{liststids[vershind + 1].oldtrackid}' and km='{liststids[vershind + 1].km}' ");

//                            var kilometr_plan_level = exportimportservice.importqueryreturnlistimportedcurve($@"select * from ekasui_plan_rightlevel where km = '{liststids[vershind].km}'  and up_nom='{liststids[vershind + 1].olddirectionid}' and put_nom ='{liststids[vershind + 1].oldtrackid}' order by m");

//                            if ((nextriht - currriht > 0
//                                && (aprcurve.napr == 1 || aprcurve.napr == 0)) || (nextriht / (math.pow(nextriht, 2) + 0.001) - currriht / (math.pow(currriht, 2) + 0.001) > 0 && aprcurve.napr == 2))
//                            {
//                                if (t1)
//                                {
//                                    if (act_start_m == "-1")
//                                    {
//                                        act_start_m = liststids[vershind].m;
//                                    }

//                                    if ((liststids[vershind].km == liststids[vershind + 1].km) || kilometr.count() == 0 || kilometr_next.count() == 0)
//                                    {
//                                        liststcurve.t1 = (int.parse(liststids[vershind + 1].km.tostring()) * 1000 +
//                                                            int.parse(liststids[vershind + 1].m.tostring())) -
//                                                           (int.parse(liststids[vershind].km.tostring()) * 1000 +
//                                                            int.parse(liststids[vershind].m.tostring()));
//                                        if (liststcurve.t1.tostring().contains("-") || liststcurve.t2.tostring().contains("-"))
//                                        {

//                                        }
//                                        if (liststcurve.t1.tostring().contains("-")) break;
//                                    }
//                                    else
//                                    {
//                                        liststcurve.t1 = (int.parse(kilometr.first().finalm.tostring())) -
//                                                        (int.parse(liststids[vershind].m.tostring())) +
//                                                        (int.parse(liststids[vershind + 1].m.tostring())) -
//                                                        (int.parse(kilometr_next.first().startm.tostring()));
//                                        if (liststcurve.t1.tostring().contains("-") || liststcurve.t2.tostring().contains("-"))
//                                        {

//                                        }
//                                        if (liststcurve.t1.tostring().contains("-")) break;
//                                    }

//                                    liststcurve.startkm = liststids[vershind].km;
//                                    liststcurve.startm = liststids[vershind].m;
//                                }
//                                else
//                                {
//                                    liststcurve.t2 = 0;
//                                    liststcurve.finalkm = liststids[vershind].km;
//                                    liststcurve.finalm = liststids[vershind].m;
//                                    act_final_m = liststids[vershind].m;
//                                }
//                            }
//                            else
//                            {
//                                if (t2)
//                                {
//                                    if ((liststids[vershind].km == liststids[vershind + 1].km) || kilometr.count() == 0 || kilometr_next.count() == 0)
//                                    {
//                                        liststcurve.t2 = (int.parse(liststids[vershind + 1].km.tostring()) * 1000 +
//                                                            int.parse(liststids[vershind + 1].m.tostring())) -
//                                                           (int.parse(liststids[vershind].km.tostring()) * 1000 +
//                                                            int.parse(liststids[vershind].m.tostring()));
//                                        if (liststcurve.t2.tostring().contains("-")) break;
//                                    }
//                                    else
//                                    {
//                                        liststcurve.t2 = (int.parse(kilometr.first().finalm.tostring())) -
//                                                        (int.parse(liststids[vershind].m.tostring())) +
//                                                        (int.parse(liststids[vershind + 1].m.tostring())) -
//                                                        (int.parse(kilometr_next.first().startm.tostring()));
//                                        if (liststcurve.t2.tostring().contains("-")) break;
//                                    }

//                                    liststcurve.finalkm = liststids[vershind + 1].km;
//                                    liststcurve.finalm = liststids[vershind + 1].m;
//                                    act_final_m = liststids[vershind + 1].m;
//                                }
//                                else
//                                {
//                                    if (act_start_m == "-1")
//                                    {
//                                        act_start_m = liststids[vershind + 1].m;
//                                    }
//                                    liststcurve.t1 = 0;
//                                    liststcurve.startkm = liststids[vershind + 1].km;
//                                    liststcurve.startm = liststids[vershind + 1].m;
//                                }
//                            }

//                            if (t2)
//                            {

//                                if (liststcurve.t2 == 0 && liststcurve.t1 == 0 && int.parse(liststids[vershind].radius) == 0)
//                                {

//                                    vershind += 2;
//                                    continue;
//                                }
//                                liststcurve.sideid = aprcurve.napr.tostring();
//                                liststcurve.width = liststids[vershind].shab;
//                                liststcurve.wear = liststids[vershind].izn;
//                                liststcurve.radius = math.abs(int.parse(liststids[vershind].radius)).tostring();//рихтовка
//                                liststcurve.oldtrackid = aprcurve.oldtrackid;

//                                string stcurveinsertstring = "insert into apr_stcurve (curve_id, start_km, start_m, final_km, final_m, radius, transition_1, transition_2, width, wear) values ("
//                                        + curveid.tostring() + ", " + liststcurve.startkm + ", " + liststcurve.startm + ", " + liststcurve.finalkm + ", " + liststcurve.finalm + ", " + liststcurve.radius + ", "
//                                        + liststcurve.t1 + ", " + liststcurve.t2 + ", " + liststcurve.width + ", " + liststcurve.wear + ")";

//                                exportimportservice.execute(stcurveinsertstring);
//                            }
//                            else
//                            {
//                                vershind += 2;
//                            }

//                            t2 = !t2;
//                            t1 = !t1;
//                        }

//                        liststids.clear();
//                    }




//                }


//                missingcurves.clear();

//                curveidindex = -1;

//                foreach (var aprcurve in distinctcurves_filter)
//                {
//                    if (listids.where(tmp => tmp.olddirectionid == aprcurve.olddirectionid && tmp.oldtrackid == aprcurve.oldtrackid.tostring()).count() > 0 == false)
//                    {
//                        continue;
//                    }
//                    curveidindex++;


//                    curveid = 0;
//                    if (apr_curveids.count() > 0 && curveidindex < apr_curveids.count())
//                    {
//                        curveid = apr_curveids[curveidindex];
//                    }
//                    else
//                    {
//                        break;
//                    }





//                    var first_len = 0;
//                    var last_len = 0;
//                    if (aprcurve.startkm == "6195")
//                    {

//                    }
//                    if (aprcurve.finalkm == "6912")
//                    {

//                    }
//                    listlevelids = rdstructureservice.get_list_st_ids_curves(aprcurve.startkm,
//                         aprcurve.startm, aprcurve.finalkm, aprcurve.finalm, aprcurve.olddirectionid, aprcurve.oldtrackid, first_len, last_len, 1);

//                    //if (listlevelids.count() == 0)
//                    //{

//                    //}
//                    //else 
//                    //{

//                    //}

//                    if (listlevelids != null && listlevelids.count() != 0)
//                    {
//                        var vershind = 0;
//                        bool t1 = true;
//                        bool t2 = false;
//                        while (vershind < listlevelids.count() - 1)
//                        {
//                            var currriht = math.abs(float.parse(listlevelids[vershind].urov, cultureinfo.invariantculture.numberformat));
//                            var nextriht = math.abs(float.parse(listlevelids[vershind + 1].urov, cultureinfo.invariantculture.numberformat));

//                            if (nextriht - currriht == 0)
//                            {
//                                vershind++;
//                                continue;
//                            }

//                            var kilometr = exportimportservice.importqueryreturnlistimportedcurve($@"select start_m as startm,final_m as finalm,* from apr_km where up_nom = '{listlevelids[vershind].olddirectionid}' and put_nom='{listlevelids[vershind].oldtrackid}' and km='{listlevelids[vershind].km}' ");
//                            var kilometr_next = exportimportservice.importqueryreturnlistimportedcurve($@"select start_m as startm,final_m as finalm,*  from apr_km where up_nom = '{listlevelids[vershind + 1].olddirectionid}' and put_nom='{listlevelids[vershind + 1].oldtrackid}' and km='{listlevelids[vershind + 1].km}' ");


//                            if ((nextriht - currriht > 0 && (aprcurve.napr == 1 || aprcurve.napr == 0))
//                                    || (nextriht / (math.pow(nextriht, 2) + 0.001) - currriht / (math.pow(currriht, 2) + 0.001) > 0 && aprcurve.napr == 2)

//                                    )

//                            {
//                                if (t1)
//                                {
//                                    if ((listlevelids[vershind].km == listlevelids[vershind + 1].km) || kilometr.count() == 0 || kilometr_next.count() == 0)
//                                    {
//                                        listelcurve.t1 = (int.parse(listlevelids[vershind + 1].km.tostring()) * 1000 +
//                                                            int.parse(listlevelids[vershind + 1].m.tostring())) -
//                                                           (int.parse(listlevelids[vershind].km.tostring()) * 1000 +
//                                                            int.parse(listlevelids[vershind].m.tostring()));
//                                        if (listelcurve.t1.tostring().contains("-") || liststcurve.t2.tostring().contains("-"))
//                                        {

//                                        }
//                                        if (listelcurve.t1.tostring().contains("-")) break;
//                                    }
//                                    else
//                                    {
//                                        listelcurve.t1 = (int.parse(kilometr.first().finalm.tostring())) -
//                                                        (int.parse(listlevelids[vershind].m.tostring())) +
//                                                        (int.parse(listlevelids[vershind + 1].m.tostring())) -
//                                                        (int.parse(kilometr_next.first().startm.tostring()));
//                                        if (listelcurve.t1.tostring().contains("-") || listelcurve.t2.tostring().contains("-"))
//                                        {

//                                        }
//                                        if (listelcurve.t1.tostring().contains("-")) break;
//                                    }
//                                    //listelcurve.t1 = (int.parse(listlevelids[vershind + 1].km.tostring()) * 1000 + int.parse(listlevelids[vershind + 1].m.tostring())) - (int.parse(listlevelids[vershind].km.tostring()) * 1000 + int.parse(listlevelids[vershind].m.tostring()));
//                                    listelcurve.startkm = listlevelids[vershind].km;
//                                    listelcurve.startm = listlevelids[vershind].m;
//                                }
//                                else
//                                {
//                                    listelcurve.t2 = 0;
//                                    listelcurve.finalkm = listlevelids[vershind].km;
//                                    listelcurve.finalm = listlevelids[vershind].m;
//                                }
//                            }
//                            else
//                            {
//                                if (t2)
//                                {
//                                    if ((listlevelids[vershind].km == listlevelids[vershind + 1].km) || kilometr.count() == 0 || kilometr_next.count() == 0)
//                                    {
//                                        listelcurve.t2 = (int.parse(listlevelids[vershind + 1].km.tostring()) * 1000 +
//                                                            int.parse(listlevelids[vershind + 1].m.tostring())) -
//                                                           (int.parse(listlevelids[vershind].km.tostring()) * 1000 +
//                                                            int.parse(listlevelids[vershind].m.tostring()));
//                                        if (listelcurve.t1.tostring().contains("-") || listelcurve.t2.tostring().contains("-"))
//                                        {

//                                        }
//                                        if (listelcurve.t2.tostring().contains("-")) break;
//                                    }
//                                    else
//                                    {
//                                        listelcurve.t2 = (int.parse(kilometr.first().finalm.tostring())) -
//                                                        (int.parse(listlevelids[vershind].m.tostring())) +
//                                                        (int.parse(listlevelids[vershind + 1].m.tostring())) -
//                                                        (int.parse(kilometr_next.first().startm.tostring()));
//                                        if (listelcurve.t1.tostring().contains("-") || listelcurve.t2.tostring().contains("-"))
//                                        {

//                                        }
//                                        if (listelcurve.t2.tostring().contains("-")) break;
//                                    }
//                                    //listelcurve.t2 =(int.parse(listlevelids[vershind + 1].km.tostring()) * 1000 + int.parse(listlevelids[vershind + 1].m.tostring())) - (int.parse(listlevelids[vershind].km.tostring()) * 1000 + int.parse(listlevelids[vershind].m.tostring()));
//                                    listelcurve.finalkm = listlevelids[vershind + 1].km;
//                                    listelcurve.finalm = listlevelids[vershind + 1].m;
//                                }
//                                else
//                                {
//                                    listelcurve.t1 = 0;
//                                    listelcurve.startkm = listlevelids[vershind + 1].km;
//                                    listelcurve.startm = listlevelids[vershind + 1].m;
//                                }
//                            }

//                            if (t2)
//                            {
//                                if (listelcurve.t2 == 0 && listelcurve.t1 == 0 && int.parse(listlevelids[vershind].urov) == 0)
//                                {

//                                    vershind += 2;
//                                    continue;
//                                }

//                                listelcurve.sideid = aprcurve.napr.tostring();
//                                listelcurve.lvl = math.abs(float.parse(listlevelids[vershind].urov, cultureinfo.invariantculture.numberformat));
//                                listelcurve.oldtrackid = aprcurve.oldtrackid;
//                                exportimportservice.execute("insert into apr_elcurve (curve_id, start_km, start_m, final_km, final_m, lvl, transition_1, transition_2) values ("
//                                + curveid.tostring() + ", " + listelcurve.startkm + ", " + listelcurve.startm + ", " + listelcurve.finalkm + ", " + listelcurve.finalm + ", " + listelcurve.lvl + ", "
//                                + listelcurve.t1 + ", " + listelcurve.t2 + ")");

//                            }
//                            else
//                            {
//                                vershind += 2;
//                            }
//                            t2 = !t2;
//                            t1 = !t1;
//                        }
//                    }
//                    else
//                    {
//                        liststids = rdstructureservice.get_list_st_ids_curves(aprcurve.startkm,
//                         aprcurve.startm, aprcurve.finalkm, aprcurve.finalm, aprcurve.olddirectionid, aprcurve.oldtrackid, first_len, last_len, 0);
//                        if (liststids.count() == 0) continue;
//                        first_len = 0;
//                        last_len = 0;

//                        ///////////////////

//                        bool t1 = true;
//                        bool t2 = false;

//                        var act_start_m = "-1";
//                        var act_final_m = "-1";
//                        //////////////////////////////////////
//                        var vershind = 0;



//                        while (vershind < liststids.count() - 1)
//                        {
//                            var currriht = math.abs(int.parse(liststids[vershind].radius));
//                            var nextriht = math.abs(int.parse(liststids[vershind + 1].radius));

//                            if (nextriht - currriht == 0)
//                            {
//                                vershind++;
//                                continue;
//                            }


//                            var kilometr = exportimportservice.importqueryreturnlistimportedcurve($@"select start_m as startm,final_m as finalm,*  from apr_km where up_nom = '{liststids[vershind].olddirectionid}' and put_nom='{liststids[vershind].oldtrackid}' and km='{liststids[vershind].km}' ");
//                            var kilometr_next = exportimportservice.importqueryreturnlistimportedcurve($@"select start_m as startm,final_m as finalm,*  from apr_km where up_nom = '{liststids[vershind + 1].olddirectionid}' and put_nom='{liststids[vershind + 1].oldtrackid}' and km='{liststids[vershind + 1].km}' ");

//                            var kilometr_plan_level = exportimportservice.importqueryreturnlistimportedcurve($@"select * from ekasui_plan_rightlevel where km = '{liststids[vershind].km}'  and up_nom='{liststids[vershind + 1].olddirectionid}' and put_nom ='{liststids[vershind + 1].oldtrackid}' order by m");

//                            if ((nextriht - currriht > 0
//                                && (aprcurve.napr == 1 || aprcurve.napr == 0)) || (nextriht / (math.pow(nextriht, 2) + 0.001) - currriht / (math.pow(currriht, 2) + 0.001) > 0 && aprcurve.napr == 2))
//                            {
//                                if (t1)
//                                {
//                                    if (act_start_m == "-1")
//                                    {
//                                        act_start_m = liststids[vershind].m;
//                                    }

//                                    if ((liststids[vershind].km == liststids[vershind + 1].km) || kilometr.count() == 0 || kilometr_next.count() == 0)
//                                    {
//                                        listelcurve.t1 = (int.parse(liststids[vershind + 1].km.tostring()) * 1000 +
//                                                            int.parse(liststids[vershind + 1].m.tostring())) -
//                                                           (int.parse(liststids[vershind].km.tostring()) * 1000 +
//                                                            int.parse(liststids[vershind].m.tostring()));
//                                        if (listelcurve.t1.tostring().contains("-") || listelcurve.t2.tostring().contains("-"))
//                                        {

//                                        }
//                                        if (listelcurve.t1.tostring().contains("-")) break;
//                                    }
//                                    else
//                                    {
//                                        listelcurve.t1 = (int.parse(kilometr.first().finalm.tostring())) -
//                                                        (int.parse(liststids[vershind].m.tostring())) +
//                                                        (int.parse(liststids[vershind + 1].m.tostring())) -
//                                                        (int.parse(kilometr_next.first().startm.tostring()));
//                                        if (listelcurve.t1.tostring().contains("-") || listelcurve.t2.tostring().contains("-"))
//                                        {

//                                        }
//                                        if (listelcurve.t1.tostring().contains("-")) break;
//                                    }

//                                    listelcurve.startkm = liststids[vershind].km;
//                                    listelcurve.startm = liststids[vershind].m;
//                                }
//                                else
//                                {
//                                    listelcurve.t2 = 0;
//                                    listelcurve.finalkm = liststids[vershind].km;
//                                    listelcurve.finalm = liststids[vershind].m;
//                                    act_final_m = liststids[vershind].m;
//                                }
//                            }
//                            else
//                            {
//                                if (t2)
//                                {
//                                    if ((liststids[vershind].km == liststids[vershind + 1].km) || kilometr.count() == 0 || kilometr_next.count() == 0)
//                                    {
//                                        listelcurve.t2 = (int.parse(liststids[vershind + 1].km.tostring()) * 1000 +
//                                                            int.parse(liststids[vershind + 1].m.tostring())) -
//                                                           (int.parse(liststids[vershind].km.tostring()) * 1000 +
//                                                            int.parse(liststids[vershind].m.tostring()));
//                                        if (listelcurve.t2.tostring().contains("-")) break;
//                                    }
//                                    else
//                                    {
//                                        listelcurve.t2 = (int.parse(kilometr.first().finalm.tostring())) -
//                                                        (int.parse(liststids[vershind].m.tostring())) +
//                                                        (int.parse(liststids[vershind + 1].m.tostring())) -
//                                                        (int.parse(kilometr_next.first().startm.tostring()));
//                                        if (listelcurve.t2.tostring().contains("-")) break;
//                                    }

//                                    listelcurve.finalkm = liststids[vershind + 1].km;
//                                    listelcurve.finalm = liststids[vershind + 1].m;
//                                    act_final_m = liststids[vershind + 1].m;
//                                }
//                                else
//                                {
//                                    if (act_start_m == "-1")
//                                    {
//                                        act_start_m = liststids[vershind + 1].m;
//                                    }
//                                    listelcurve.t1 = 0;
//                                    listelcurve.startkm = liststids[vershind + 1].km;
//                                    listelcurve.startm = liststids[vershind + 1].m;
//                                }
//                            }

//                            if (t2)
//                            {

//                                if (listelcurve.t2 == 0 && listelcurve.t1 == 0 && int.parse(liststids[vershind].radius) == 0)
//                                {

//                                    vershind += 2;
//                                    continue;
//                                }

//                                exportimportservice.execute("insert into apr_elcurve (curve_id, start_km, start_m, final_km, final_m, lvl, transition_1, transition_2) values ("
//                                + curveid.tostring() + ", " + liststcurve.startkm + ", " + liststcurve.startm + ", " + liststcurve.finalkm + ", " + liststcurve.finalm + ", " + 0 + ", "
//                                + listelcurve.t1 + ", " + listelcurve.t2 + ")");
//                            }
//                            else
//                            {
//                                vershind += 2;
//                            }

//                            t2 = !t2;
//                            t1 = !t1;
//                        }

//                        liststids.clear();
//                    }

//                }











//                //foreach (var listtracks in liststationids)
//                //{
//                //    var listput = exportimportservice.importqueryreturnliststrtrack("select * from ekasui_str where st_kod = '" + listtracks.oldstationid + "' and up_nom = '" + listtracks.oldstationid + "'");
//                //    foreach (var list in listput)
//                //    {
//                //        var trackid = exportimportservice.importqueryreturnlistlong("select track.id from adm_track track inner join stw_track st on st.adm_track_id = track.id where track.code = '" + list.put_nom + "' and track.up_nom = " + list.up_nom + "");
//                //        var strlist = exportimportservice.importqueryreturnliststrtrack("select * from ekasui_str where put_nom = '" + list.put_nom + "' and st_kod = '" + listtracks.oldstationid + "' ");
//                //        foreach (var str in strlist)
//                //        {
//                //            //var lsitsationid = strlist.where(tmp => tmp.st == str.st_kod);
//                //            //var liststatid = lsitsationid.select(o => o.newstationid).tolist();
//                //            //foreach (int64 stationid in liststatid)
//                //            //{

//                //            if (trackid.count < 1)
//                //            {
//                //                continue;
//                //            }
//                //            //foreach (var trackid in trackidstation)
//                //            //{
//                //            //int64 trackid = exportimportservice.importqueryreturnlistlong(" ");
//                //            //int64 trackid = listids.where(tmp => tmp.oldtrackid == (str.put_nom)).first().newtrackid;
//                //            string pointid = "35";


//                //            var lsitsationid = liststationids.where(tmp => tmp.oldstationid == int.parse(str.st_kod));
//                //            var liststatid = lsitsationid.select(o => o.newstationid).tolist();



//                //            switch (str.otb)
//                //            {

//                //                case "1":
//                //                    sideidstr = "0";
//                //                    break;
//                //                case "2":
//                //                    sideidstr = "2";
//                //                    break;
//                //                case "3":
//                //                    sideidstr = "1";
//                //                    break;
//                //                case "0":
//                //                    sideidstr = "0";
//                //                    break;

//                //            }


//                //            if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.first().tostring() + " and mto_type = 15 ").count() > 0)
//                //            {
//                //                int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.first().tostring() + " and mto_type = 15");
//                //                exportimportservice.execute("insert into tpl_switch (period_id, km, meter, num, mark_id, dir_id, side_id, point_id, station_id) values (" + periodid.tostring() + ", " + str.km + ", " + str.m + ", \'" + str.nom + "\', " + str.type + ", " + (str.posh == "1" ? str.posh = "-1" : str.posh == "2" ? str.posh = "1" : str.posh = "0") + ", "
//                //                    + sideidstr + "," + str.type + ", " + liststatid.first().tostring() + ")");
//                //            }
//                //            else
//                //            {
//                //                int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.first().tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 15) returning id");
//                //                exportimportservice.execute("insert into tpl_switch (period_id, km, meter, num, mark_id, dir_id, side_id, point_id, station_id) values (" + periodid.tostring() + ", " + str.km + ", " + str.m + ", \'" + str.nom + "\', " + str.type + ", " + (str.posh == "1" ? str.posh = "-1" : str.posh == "2" ? str.posh = "1" : str.posh = "0") + ", "
//                //                    + sideidstr + "," + str.type + ", " + liststatid.first().tostring() + ")");
//                //            }
//                //            //}

//                //            //}
//                //        }
//                //    }
//                //}


//                liststationids.clear();
//                liststationsections.clear();
//                progressbar.performstep();











//                list<importlistelevationsix> listshablonl = new list<importlistelevationsix>();
//                //6мм
//                listshablonl = exportimportservice.importqueryreturnlistimportedelevation($@"select * from ekasui_plan_rightlevel where urov='6' or  urov='0'     order by up_nom,put_nom,km,m");
//                distinctcurves_filter = new list<importlistcurveid>();
//                for (int g = 0; g < listshablonl.count() - 1; g += 1)
//                {

//                    frst_curve = "";
//                    next_curve = "";
//                    curve_direction = 0;
//                    curve_direction_next = 0;
//                    curve_put = "";
//                    curve_put_next = "";

//                    frst_curve = listshablonl[g].urov;
//                    next_curve = listshablonl[g + 1].urov;
//                    curve_direction = listshablonl[g].up_nom;
//                    curve_direction_next = listshablonl[g + 1].up_nom;
//                    curve_put = listshablonl[g].put_nom;
//                    curve_put_next = listshablonl[g + 1].put_nom;

//                    if (int.parse(frst_curve) == 0 && int.parse(next_curve) != 0 && flagstart == false && curve_direction == curve_direction_next && curve_put == curve_put_next)
//                    {
//                        multicurve_filter.startkm = listshablonl[g].km;
//                        multicurve_filter.startm = listshablonl[g].m;

//                        multicurve_filter.olddirectionid = listshablonl[g].up_nom;
//                        multicurve_filter.oldtrackid = listshablonl[g].put_nom;



//                        flagstart = true;
//                    }
//                    if (int.parse(frst_curve) != 0 && int.parse(next_curve) != 0 && flagstart)
//                    {

//                    }
//                    if (int.parse(frst_curve) != 0 && int.parse(next_curve) == 0 && flagstart)
//                    {

//                        multicurve_filter.finalkm = listshablonl[g + 1].km;
//                        multicurve_filter.finalm = listshablonl[g + 1].m;

//                        distinctcurves_filter.add(multicurve_filter);
//                        multicurve_filter = new importlistcurveid();
//                        ismulticurvestart = false;
//                        ismulticurve_filter = false;
//                        flagstart = false;
//                    }



//                }

//                var caountel = 0;
//                list<long> apr_level_six = new list<long>();
//                foreach (var aprcurve in distinctcurves_filter)
//                {
//                    //0-левая 1- правая в ебпд
//                    //у нас 1-правая 2 левая
//                    if (listids.where(tmp => tmp.oldtrackid == aprcurve.oldtrackid && tmp.olddirectionid == aprcurve.olddirectionid).count() > 0)
//                    {
//                        int64 trackid = listids.where(tmp => tmp.oldtrackid == aprcurve.oldtrackid && tmp.olddirectionid == aprcurve.olddirectionid).first().newtrackid;

//                        if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 8").count() > 0)
//                        {
//                            int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 8");
//                            exportimportservice.execute("insert into apr_elevation (period_id, level_id, start_km, start_m, final_km, final_m) values (" + periodid.tostring() + ", " + "6" + ", " + aprcurve.startkm + ", " + (int.parse(aprcurve.startm)) + ", " + aprcurve.finalkm + ", " + (int.parse(aprcurve.finalm)) + ")");
//                        }
//                        else
//                        {
//                            int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 8) returning id");
//                            exportimportservice.execute("insert into apr_elevation (period_id, level_id, start_km, start_m, final_km, final_m) values (" + periodid.tostring() + ", " + "6" + ", " + aprcurve.startkm + ", " + (int.parse(aprcurve.startm)) + ", " + aprcurve.finalkm + ", " + (int.parse(aprcurve.finalm)) + ")");
//                        }
//                    }

//                }




//                list<importlistelevationsix> listshablonr = new list<importlistelevationsix>();

//                listshablonr = exportimportservice.importqueryreturnlistimportedelevation($@"select * from ekasui_plan_rightlevel where urov='-6' or  urov='0'     order by up_nom,put_nom,km,m");

//                importlistcurveid listelevationsixr = new importlistcurveid();
//                distinctcurves_filter = new list<importlistcurveid>();

//                var caounter = 0;
//                //list<importlistcurveid> listelevationsix = new list<importlistcurveid>();
//                for (int g = 0; g < listshablonr.count() - 1; g += 1)
//                {

//                    frst_curve = "";
//                    next_curve = "";
//                    curve_direction = 0;
//                    curve_direction_next = 0;
//                    curve_put = "";
//                    curve_put_next = "";

//                    frst_curve = listshablonr[g].urov;
//                    next_curve = listshablonr[g + 1].urov;
//                    curve_direction = listshablonr[g].up_nom;
//                    curve_direction_next = listshablonr[g + 1].up_nom;
//                    curve_put = listshablonr[g].put_nom;
//                    curve_put_next = listshablonr[g + 1].put_nom;

//                    if (int.parse(frst_curve) == 0 && int.parse(next_curve) != 0 && flagstart == false && curve_direction == curve_direction_next && curve_put == curve_put_next)
//                    {
//                        multicurve_filter.startkm = listshablonr[g].km;
//                        multicurve_filter.startm = listshablonr[g].m;

//                        multicurve_filter.olddirectionid = listshablonr[g].up_nom;
//                        multicurve_filter.oldtrackid = listshablonr[g].put_nom;



//                        flagstart = true;
//                    }
//                    if (int.parse(frst_curve) != 0 && int.parse(next_curve) != 0 && flagstart)
//                    {

//                    }
//                    if (int.parse(frst_curve) != 0 && int.parse(next_curve) == 0 && flagstart)
//                    {

//                        multicurve_filter.finalkm = listshablonr[g + 1].km;
//                        multicurve_filter.finalm = listshablonr[g + 1].m;

//                        distinctcurves_filter.add(multicurve_filter);
//                        multicurve_filter = new importlistcurveid();
//                        ismulticurvestart = false;
//                        ismulticurve_filter = false;
//                        flagstart = false;
//                    }



//                }
//                foreach (var aprcurve in distinctcurves_filter)
//                {
//                    //0-левая 1- правая в ебпд
//                    //у нас 1-правая 2 левая
//                    if (listids.where(tmp => tmp.oldtrackid == aprcurve.oldtrackid && tmp.olddirectionid == aprcurve.olddirectionid).count() > 0)
//                    {
//                        int64 trackid = listids.where(tmp => tmp.oldtrackid == aprcurve.oldtrackid && tmp.olddirectionid == aprcurve.olddirectionid).first().newtrackid;
//                        if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 8").count() > 0)
//                        {
//                            int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 8");
//                            exportimportservice.execute("insert into apr_elevation (period_id, level_id, start_km, start_m, final_km, final_m) values (" + periodid.tostring() + ", " + "-6" + ", " + aprcurve.startkm + ", " + (int.parse(aprcurve.startm)) + ", " + aprcurve.finalkm + ", " + (int.parse(aprcurve.finalm)) + ")");
//                        }
//                        else
//                        {
//                            int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 8) returning id");
//                            exportimportservice.execute("insert into apr_elevation (period_id, level_id, start_km, start_m, final_km, final_m) values (" + periodid.tostring() + ", " + "-6" + ", " + aprcurve.startkm + ", " + (int.parse(aprcurve.startm)) + ", " + aprcurve.finalkm + ", " + (int.parse(aprcurve.finalm)) + ")");
//                        }
//                    }

//                }


//                foreach (var upnom in listoldirection)//для ширины колеии
//                {

//                    foreach (var putnom in listoldtrack)
//                    {
//                        var listcurve = exportimportservice.importqueryreturnlistimportedelevation($@"select
//                                                                                                     selected.start_km,
//                                                                                                     selected.start_m,
//                                                                                                     selected.final_km,
//                                                                                                     selected.final_m,
//                                                                                                     selected.width,
//                                                                                                     selected.up_nom,
//                                                                                                        selected.put_nom	
//                                                                                                    from
//                                                                                                     (
//                                                                                                     select
//                                                                                                      ast.start_km,
//                                                                                                      ast.start_m,
//                                                                                                      ast.final_km,
//                                                                                                      ast.final_m,
//                                                                                                      ast.width,
//                                                                                                      ac.up_nom,
//                                                                                                      ac.put_nom,
//                                                                                                      row_number ( ) over ( partition by curve_id order by ac.id asc ) rn 
//                                                                                                     from
//                                                                                                      apr_curve as ac
//                                                                                                      inner join apr_stcurve as ast on ac.id = ast.curve_id 
//                                                                                                     where
//                                                                                                      ac.up_nom = '{upnom.up_nom}' 
//                                                                                                      and ac.put_nom = '{putnom.put_nom}' 
//                                                                                                      and ast.width > 1520 
//                                                                                                     order by
//                                                                                                      ast.start_km,
//                                                                                                      ast.start_m 
//                                                                                                     ) as selected 
//                                                                                                    where
//                                                                                                     rn = 1");
//                        var listkm = exportimportservice.importqueryreturnlistimportedelevation($@"select* from ekasui_non_ext where up_nom = '{upnom.up_nom}' and put_nom = '{putnom.put_nom}' order by km,start_m,final_m");
//                        var norma = "1520";


//                        string startkm, startm, finalm, finalkm;

//                        if (listkm.count() == 0)
//                        {
//                            continue;
//                        }
//                        //if (listcurve.count() != 0)
//                        //{
//                        //    //startkm = listkm.select(o => o.km).first();
//                        //    //startm = listkm.select(o => o.start_m).first();
//                        //    //finalkm = listkm.select(o => o.km).last();
//                        //    //finalm = listkm.select(o => o.final_m).last();

//                        //    //if (listids.where(tmp => tmp.oldtrackid == putnom.put_nom && tmp.olddirectionid == upnom.up_nom).count() > 0)
//                        //    //{

//                        //    //    int64 trackidanw = listids.where(tmp => tmp.oldtrackid == putnom.put_nom && tmp.olddirectionid == upnom.up_nom).first().newtrackid;
//                        //    //    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackidanw.tostring() + " and mto_type = 5").count() > 0)
//                        //    //    {
//                        //    //        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackidanw.tostring() + " and mto_type = 5");
//                        //    //        exportimportservice.execute("insert into apr_norma_width (period_id, start_km, start_m, final_km, final_m, norma_width) values (" + periodid.tostring() + ", "
//                        //    //            + startkm + ", " + startm + ", " + finalkm + ", " + finalm + "," + norma + ")");
//                        //    //    }
//                        //    //    else
//                        //    //    {
//                        //    //        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackidanw.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 5) returning id");
//                        //    //        exportimportservice.execute("insert into apr_norma_width (period_id, start_km, start_m, final_km, final_m, norma_width) values (" + periodid.tostring() + ", "
//                        //    //                + startkm + ", " + startm + ", " + finalkm + ", " + finalm + "," + norma + ")");
//                        //    //    }

//                        //    //}
//                        //    //continue;
//                        //    startkm = listkm.select(o => o.km).first();
//                        //    startm = listkm.select(o => o.start_m).first();
//                        //    finalm = listcurve.select(o => o.start_m).first();
//                        //    finalkm = listcurve.select(o => o.start_km).first();

//                        //    for (int i = 1; i < listcurve.count() - 1; i++)
//                        //    {
//                        //        if (i > 0)
//                        //        {
//                        //            startkm = listcurve[i - 1].final_km;
//                        //            startm = listcurve[i - 1].final_m;
//                        //            finalkm = listcurve[i].start_km;
//                        //            finalm = listcurve[i].start_m;
//                        //        }
//                        //        if (i == listcurve.count() - 1)
//                        //        {
//                        //            startkm = listcurve[i - 1].final_km;
//                        //            startm = listcurve[i - 1].final_m;
//                        //            finalkm = listkm.select(o => o.km).last();
//                        //            finalm = listkm.select(o => o.final_m).last();
//                        //        }

//                        //        if ((math.abs(int.parse(startkm) - int.parse(finalkm)) * 1000 + math.abs(int.parse(startm) - int.parse(finalm))) >= 25)
//                        //        {
//                        //            if (listids.where(tmp => tmp.oldtrackid == listcurve[i].put_nom && tmp.olddirectionid == listcurve[i].up_nom).count() > 0)
//                        //            {
//                        //                int64 trackidanw = listids.where(tmp => tmp.oldtrackid == listcurve[i].put_nom && tmp.olddirectionid == listcurve[i].up_nom).first().newtrackid;
//                        //                if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackidanw.tostring() + " and mto_type = 5").count() > 0)
//                        //                {
//                        //                    int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackidanw.tostring() + " and mto_type = 5");
//                        //                    exportimportservice.execute("insert into apr_norma_width (period_id, start_km, start_m, final_km, final_m, norma_width) values (" + periodid.tostring() + ", "
//                        //                        + startkm + ", " + startm + ", " + finalkm + ", " + finalm + "," + norma + ")");
//                        //                }
//                        //                else
//                        //                {
//                        //                    int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackidanw.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 5) returning id");
//                        //                    exportimportservice.execute("insert into apr_norma_width (period_id, start_km, start_m, final_km, final_m, norma_width) values (" + periodid.tostring() + ", "
//                        //                           + startkm + ", " + startm + ", " + finalkm + ", " + finalm + "," + norma + ")");
//                        //                }
//                        //            }
//                        //        }

//                        //    }



//                        //}
//                    }
//                }





//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "rem.xml"))//готово
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "rem")
//                        {
//                            if (count > 0)
//                                continue;
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {
//                                //int tupe_rem = int.parse(z_row.attributes["type"].value);
//                                string tupe_rem = z_row.attributes["type"].value;
//                                int tupe_remid = 0;
//                                string shorname = "";

//                                //0 –  просроченный капитальный ремонт, ....юю
//                                //1 –  усиленный капитальный ремонт, ююю
//                                //2 –  капитальный ремонт новый, ююю
//                                //3 –  средний ремонт,..юю
//                                //4 –  усиленный средний ремонт,.. юю
//                                //5 –  подъемочный ремонт,..юю
//                                //6 –  сплошная замена новая, ..юю
//                                //7 –  сплошная замена старая, юю
//                                //8 –  планово предупредительный ремонт, 
//                                //9 –  необходим планово предупредительный ремонт,
//                                //10 –  реконструкция пути,
//                                //11 –  капитальный ремонт старый,    
//                                //12 –  просроченный восстановительный,
//                                //13 –  переложенные рельсы


//                                //0   не определен    но
//                                //1   кап.усил.ук....
//                                //2   кап.на новых рельсах к
//                                //3   кап.на с/ г рельс.к
//                                //4   сред.усил.ус
//                                //5   сред.с
//                                //6   подъем.п
//                                //7   подъем.усил.уп
//                                //8   смена рельсов новыми рсююю  
//                                //9   смена рельсов с / г   рс  юю
//                                //10  смена наружной  рельсовой нити новыми рик
//                                //11  смена наружной рельсовой нити с / г   рик
//                                //12  смена внутренней рельсовой нити новыми рик
//                                //13  смена внутренней рельсовой нити с / г рик
//                                //14  планово - предупредительная выправка в
//                                //15  сварка рельсов  ср
//                                //16  наплавка рельсов    н
//                                //17  шлифовка профильная шр
//                                //18  шлифовка поверхностная  шр
//                                //19  наплавка крестовин  н
//                                //20  новое строительство нс
//                                //21 –  реконструкция пути,
//                                //22 - смена   рельсов   с   переменой рабочего канта
//                                //23  просроченный капитальный ремонт пкр....

//                                //24 –  капитальный ремонт новый,  крн...
//                                //25 –  планово предупредительный ремонт, 
//                                //26 –  необходим планово предупредительный ремонт,

//                                //27 –  просроченный восстановительный,
//                                //28 –  переложенные рельсы
//                                switch (tupe_rem)
//                                {
//                                    case "0":
//                                        tupe_remid = 23;
//                                        shorname = "пкрп";
//                                        break;
//                                    case "1":
//                                        tupe_remid = 1;
//                                        shorname = "ук";
//                                        break;
//                                    case "2":
//                                        tupe_remid = 2;
//                                        shorname = "к";
//                                        break;
//                                    case "3":
//                                        tupe_remid = 5;
//                                        shorname = "с";
//                                        break;
//                                    case "4":
//                                        tupe_remid = 4;
//                                        shorname = "ус";
//                                        break;
//                                    case "5":
//                                        tupe_remid = 5;
//                                        shorname = "п";
//                                        break;
//                                    case "6":
//                                        tupe_remid = 8;
//                                        shorname = "срн";
//                                        break;
//                                    case "7":
//                                        tupe_remid = 9;
//                                        shorname = "срс";
//                                        break;
//                                    case "8":
//                                        tupe_remid = 14;
//                                        shorname = "в";
//                                        //14 –  планово предупредительный ремонт, 
//                                        break;
//                                    case "9":
//                                        tupe_remid = 26;
//                                        shorname = "нппр";
//                                        //24 –  необходим планово предупредительный ремонт,
//                                        break;
//                                    case "10":
//                                        tupe_remid = 21;
//                                        shorname = "р";
//                                        //21 –  реконструкция пути,
//                                        break;
//                                    case "11":
//                                        tupe_remid = 3;
//                                        shorname = "кс";
//                                        //3 –  капитальный ремонт старый,    
//                                        break;
//                                    case "12":
//                                        tupe_remid = 27;
//                                        shorname = "пв";
//                                        //28 –  просроченный восстановительный,

//                                        break;
//                                    case "13":
//                                        tupe_remid = 28;
//                                        shorname = "пр";
//                                        //29 –  переложенные рельсы

//                                        break;


//                                }
//                                var start_km = z_row.attributes["begin_km"].value;
//                                var start_m = z_row.attributes["begin_m"].value;
//                                var final_km = z_row.attributes["end_km"].value;
//                                var final_m = int.parse(z_row.attributes["end_m"].value);
//                                final_m = final_m - 1;
//                                string daterem = z_row.attributes["daterem"].value.tostring();
//                                var datetime_rem = datetime.parse(daterem);
//                                //string datetime_rem = datetime.split('t').tostring();//надо сделать с анияр
//                                if (listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                                {
//                                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 26").count() > 0)
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 26");
//                                        exportimportservice.execute("insert into repair_project (period_id, adm_track_id,start_km, start_m, final_km, final_m, type_id,repair_date,accept_id) values (" + periodid.tostring() + "," + trackid.tostring() + ", " + start_km + ", "
//                                            + start_m + ", " + final_km + ", " + final_m + ", " + tupe_remid.tostring() + ", \'" + datetime_rem.tostring() + "\'" + "," + 1 + ")");
//                                    }
//                                    else
//                                    {

//                                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 26) returning id");
//                                        exportimportservice.execute("insert into repair_project (period_id, adm_track_id,start_km, start_m, final_km, final_m, type_id,repair_date,accept_id) values (" + periodid.tostring() + "," + trackid.tostring() + ", " + start_km + ", "
//                                                + start_m + ", " + final_km + ", " + final_m + ", " + tupe_remid.tostring() + ", \'" + datetime_rem.tostring() + "\'" + "," + 1 + ")");
//                                    }
//                                }
//                                count = count + 1;
//                            }
//                        }
//                    }
//                }
//                progressbar.performstep();
//                //progressbar.performstep();


//                progressbar.performstep();

//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "iso.xml"))//готово
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "iso")
//                        {
//                            if (count > 0)
//                                continue;
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {
//                                if (listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                                {
//                                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 19").count() > 0)
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 19");
//                                        exportimportservice.execute("insert into tpl_profile_object (period_id, object_id, side_id, km, meter) values (" + periodid.tostring() + ", 26, 0, " + z_row.attributes["km"].value + ", " + z_row.attributes["m"].value + ")");
//                                    }
//                                    else
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 19) returning id");
//                                        exportimportservice.execute("insert into tpl_profile_object (period_id, object_id, side_id, km, meter) values (" + periodid.tostring() + ", 26, 0, " + z_row.attributes["km"].value + ", " + z_row.attributes["m"].value + ")");
//                                    }
//                                }
//                            }
//                            count = count + 1;
//                        }
//                    }
//                }

//                progressbar.performstep();
//                ////   ///*done*/

//                ///*done*/









//                ////progressbar.performstep();
//                ///////*done*/

//                ///////*done not_yet*/
//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "issoext.xml"))//готово
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "issoext")
//                        {
//                            if (count > 0)
//                                continue;
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {
//                                string start_km = z_row.attributes["begin_km"].value;
//                                string start_m = z_row.attributes["begin_m"].value;
//                                string final_km = z_row.attributes["end_km"].value;
//                                string final_m = z_row.attributes["end_m"].value;
//                                string up_nom = z_row.attributes["up_nom"].value;

//                                var len = exportimportservice.importqueryreturnlong($@"select getdistancefrom({start_km}, {start_m}, {final_km}, {final_m}, {up_nom}, '10/10/2020')");
//                                var coord = exportimportservice.importqueryreturndouble($@"select getcoordbylen({start_km}, {start_m}, {len / 2}, {up_nom}, '10/10/2020')");

//                                int km = (int)math.truncate(coord);
//                                int m = (int)((coord - km) * 10000);

//                                string typeid = "0";


//                                switch (z_row.attributes["type"].value)
//                                {
//                                    //0-не определенно (возмодн мост)
//                                    case "0":
//                                        typeid = "0";
//                                        break;
//                                    case "1":
//                                        typeid = "1";
//                                        break;
//                                    case "2":
//                                        typeid = "2";
//                                        break;
//                                    case "3":
//                                        typeid = "3";
//                                        break;
//                                    case "4.":
//                                        typeid = "4";
//                                        break;
//                                    case "5":
//                                        typeid = "5";
//                                        break;
//                                    case "6":
//                                        typeid = "6";
//                                        break;
//                                }

//                                if (listids.where(tmp => tmp.oldtrackid == z_row.attributes["put_nom"].value.tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value.tostring())).count() > 0)
//                                {
//                                    int64 trackid = listids.where(tmp => tmp.oldtrackid == z_row.attributes["put_nom"].value.tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value.tostring())).first().newtrackid;
//                                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 14").count() > 0)
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 14");
//                                        exportimportservice.execute("insert into apr_artificial_construction (period_id, km, meter, len, type_id) values (" + periodid.tostring() + ", " + km + "," + m + ", " + len.tostring() + ", " + typeid + ")");
//                                    }
//                                    else
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 14) returning id");
//                                        exportimportservice.execute("insert into apr_artificial_construction (period_id, km, meter, len, type_id) values (" + periodid.tostring() + ", " + km + "," + m + ", " + len.tostring() + ", " + typeid + ")"); ;
//                                    }
//                                }
//                                count = count + 1;
//                            }
//                        }
//                    }
//                }

//                //progressbar.performstep();
//                //foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "kv_nsk.xml"))
//                //{
//                //    xmldocument xmldocument = new xmldocument();
//                //    xmldocument.load(file.fullname);
//                //    xmlelement xmlelement = xmldocument.documentelement;
//                //    foreach (xmlnode xmlnode in xmlelement)
//                //    {
//                //        if (xmlnode.name == "rs:data")
//                //        {
//                //            foreach (xmlnode z_row in xmlnode.parentnode)
//                //            {
//                //                string start_km = z_row.attributes["kmn"].value;
//                //                string start_m = z_row.attributes["mn"].value;
//                //                string final_km = z_row.attributes["kmk"].value;
//                //                string final_m = z_row.attributes["mk"].value;
//                //                string width = z_row.attributes["norma"].value;
//                //                if (listids.where(tmp => tmp.oldtrackid == z_row.attributes["nom"].value.tostring()).count() > 0)
//                //                {
//                //                    int64 trackid = listids.where(tmp => tmp.oldtrackid == z_row.attributes["nom"].value.tostring()).first().newtrackid;
//                //                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 5").count() > 0)
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 5");
//                //                        exportimportservice.execute("insert into apr_norma_width (period_id, start_km, start_m, final_km, final_m, norma_width) values (" + periodid.tostring() + ", " + start_km + "," + start_m + ", " + final_km + "," + final_m + ", " + width + ")");
//                //                    }
//                //                    else
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 5) returning id");
//                //                        exportimportservice.execute("insert into apr_norma_width (period_id, start_km, start_m, final_km, final_m, norma_width) values (" + periodid.tostring() + ", " + start_km + "," + start_m + ", " + final_km + "," + final_m + ", " + width + ")");
//                //                    }
//                //                }
//                //            }
//                //        }
//                //    }
//                //}

//                //progressbar.performstep();


//                //foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "puch.xml"))//готово
//                //{
//                //    xmldocument xmldocument = new xmldocument();
//                //    xmldocument.load(file.fullname);
//                //    xmlelement xmlelement = xmldocument.documentelement;
//                //    var count = 0;
//                //    foreach (xmlnode xmlnode in xmlelement)
//                //    {
//                //        if (xmlnode.name == "puch")
//                //        {
//                //            if (count > 0)
//                //                continue;
//                //            foreach (xmlnode z_row in xmlnode.parentnode)
//                //            {


//                //                if (listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                //                {
//                //                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                //                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 35").count() > 0)
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 35");
//                //                        exportimportservice.execute("insert into tpl_deep (period_id, start_km, start_m, final_km, final_m) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + ")");
//                //                    }
//                //                    else
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 35) returning id");
//                //                        exportimportservice.execute("insert into tpl_deep (period_id, start_km, start_m, final_km, final_m) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + ")");
//                //                    }
//                //                }
//                //                count = count + 1;
//                //            }
//                //        }
//                //    }
//                //}
//                //progressbar.performstep();
//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "upsext.xml"))//готово
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "upsext")
//                        {
//                            if (count > 0)
//                                continue;
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {
//                                string objectid;
//                                if (z_row.attributes["vid"].value == "уравн. приб")
//                                    objectid = "2";
//                                else if (z_row.attributes["vid"].value == "уравн. стык")
//                                    objectid = "1";
//                                else objectid = "1";
//                                if (listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                                {
//                                    int64 trackid = listids.where(tmp => tmp.oldtrackid == z_row.attributes["put_nom"].value.tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 21").count() > 0)
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 21");
//                                        exportimportservice.execute("insert into apr_cham_joint (period_id, start_km, start_m, final_km, final_m, type_id) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + ", " + objectid + ")");
//                                    }
//                                    else
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 21) returning id");
//                                        exportimportservice.execute("insert into apr_cham_joint (period_id, start_km, start_m, final_km, final_m, type_id) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + ", " + objectid + ")");
//                                    }
//                                }
//                                count = count + 1;
//                            }
//                        }
//                    }
//                }
//                progressbar.performstep();

//                //foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "gb.xml"))//готово
//                //{
//                //    xmldocument xmldocument = new xmldocument();
//                //    xmldocument.load(file.fullname);
//                //    xmlelement xmlelement = xmldocument.documentelement;
//                //    var count = 0;
//                //    foreach (xmlnode xmlnode in xmlelement)
//                //    {

//                //        if (xmlnode.name == "gb")
//                //        {

//                //            if (count > 0)
//                //                continue;
//                //            foreach (xmlnode z_row in xmlnode.parentnode)
//                //            {
//                //                string crosstieid;
//                //                if (z_row.attributes["type"].value == "0")
//                //                    crosstieid = "2";
//                //                else if (z_row.attributes["type"].value == "1")
//                //                    crosstieid = "1";
//                //                else crosstieid = "-1";
//                //                if (listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                //                {
//                //                    int64 trackid = listids.where(tmp => tmp.oldtrackid == z_row.attributes["put_nom"].value.tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                //                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 1").count() > 0)
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 1");
//                //                        exportimportservice.execute("insert into apr_crosstie (period_id, crosstie_type_id, start_km, start_m, final_km, final_m) values (" + periodid.tostring() + ", " + crosstieid + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + ")");
//                //                    }
//                //                    else
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 1) returning id");
//                //                        exportimportservice.execute("insert into apr_crosstie (period_id, crosstie_type_id, start_km, start_m, final_km, final_m) values (" + periodid.tostring() + ", " + crosstieid + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + ")");
//                //                    }
//                //                }
//                //                count = count + 1;
//                //            }
//                //        }
//                //    }
//                //}
//                //foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "gabtype.xml"))//готово
//                //{
//                //    xmldocument xmldocument = new xmldocument();
//                //    xmldocument.load(file.fullname);
//                //    xmlelement xmlelement = xmldocument.documentelement;
//                //    var count = 0;
//                //    foreach (xmlnode xmlnode in xmlelement)
//                //    {

//                //        if (xmlnode.name == "gabtype")
//                //        {

//                //            if (count > 0)
//                //                continue;
//                //            foreach (xmlnode z_row in xmlnode.parentnode)
//                //            {
//                //                string dimenssionid;
//                //                if (z_row.attributes["type"].value == "0")
//                //                    dimenssionid = "0";
//                //                else if (z_row.attributes["type"].value == "1")
//                //                    dimenssionid = "1";
//                //                else dimenssionid = "-1";
//                //                if (listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                //                {
//                //                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                //                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 37").count() > 0)
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 37");
//                //                        exportimportservice.execute("insert into apr_dimension (period_id,  start_km, start_m, final_km, final_m,type_id) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + ", " + dimenssionid + ")");
//                //                    }
//                //                    else
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 37) returning id");
//                //                        exportimportservice.execute("insert into apr_dimension (period_id,  start_km, start_m, final_km, final_m,type_id) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + ", " + dimenssionid + ")");
//                //                    }
//                //                }
//                //                count = count + 1;
//                //            }
//                //        }
//                //    }
//                //}
//                //  действующие предупреждения
//                //foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "wrn.xml"))//готово
//                //{
//                //    xmldocument xmldocument = new xmldocument();
//                //    xmldocument.load(file.fullname);
//                //    xmlelement xmlelement = xmldocument.documentelement;
//                //    var count = 0;
//                //    foreach (xmlnode xmlnode in xmlelement)
//                //    {

//                //        if (xmlnode.name == "wrn")
//                //        {

//                //            if (count > 0)
//                //                continue;
//                //            foreach (xmlnode z_row in xmlnode.parentnode)
//                //            {

//                //                string reason_id;
//                //                if (z_row.attributes["kod"].value == "440")
//                //                    reason_id = "6";
//                //                else if (z_row.attributes["kod"].value == "512")
//                //                    reason_id = "7";
//                //                else if (z_row.attributes["kod"].value == "513")
//                //                    reason_id = "8";
//                //                else if (z_row.attributes["kod"].value == "514")
//                //                    reason_id = "9";
//                //                else if (z_row.attributes["kod"].value == "515")
//                //                    reason_id = "10";
//                //                else if (z_row.attributes["kod"].value == "522")
//                //                    reason_id = "11";
//                //                else if (z_row.attributes["kod"].value == "525")
//                //                    reason_id = "12";
//                //                else if (z_row.attributes["kod"].value == "550")
//                //                    reason_id = "1";
//                //                else if (z_row.attributes["kod"].value == "551")
//                //                    reason_id = "2";
//                //                else if (z_row.attributes["kod"].value == "552")
//                //                    reason_id = "3";
//                //                else if (z_row.attributes["kod"].value == "553")
//                //                    reason_id = "4";
//                //                else if (z_row.attributes["kod"].value == "561")
//                //                    reason_id = "13";
//                //                else if (z_row.attributes["kod"].value == "562")
//                //                    reason_id = "14";

//                //                else reason_id = "0";
//                //                var speed = z_row.attributes["speed"].value;
//                //                //string start_date = z_row.attributes["b_date"].value;
//                //                //start_date = start_date.split('t')[0];

//                //                //string start_date = z_row.attributes["b_date"].value.tostring();
//                //                //var datetime_rem = datetime.parse(start_date);


//                //                //var datetime_satart = datetime.parseexact(start_date, "yyyy-mm-dd", cultureinfo.invariantculture);
//                //                //var yournewstring_start = datetime_satart.tostring("yyyy-mm-dd");

//                //                string datetime_satart = z_row.attributes["b_date"].value.tostring();
//                //                var yournewstring_start = datetime.parse(datetime_satart);

//                //                //var final_date = z_row.attributes["e_date"].value;
//                //                //final_date = final_date.split('t')[0];
//                //                //var datetime_final = datetime.parseexact(final_date, "yyyy-mm-dd", cultureinfo.invariantculture);
//                //                //var yournewstring_final = datetime_final.tostring("yyyy-mm-dd");

//                //                string final_date = z_row.attributes["e_date"].value.tostring();
//                //                var yournewstring_final = datetime.parse(final_date);

//                //                string canselled;
//                //                if (z_row.attributes["cancelled"].value == "0")
//                //                    canselled = "0";
//                //                else if (z_row.attributes["cancelled"].value == "1")
//                //                    canselled = "1";
//                //                else canselled = "-1";
//                //                if (listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                //                {
//                //                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                //                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 7").count() > 0)
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 7");
//                //                        exportimportservice.execute("insert into apr_tempspeed (period_id, start_km, start_m, final_km, final_m, reason_id,canselled, passenger, freight, empty_freight,start_date,final_date) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value
//                //                           + reason_id + ", " + canselled + ", " + speed + ", " + ", " + speed + ", " + speed + ", " + speed + ", " + yournewstring_start + ", " + yournewstring_final + ")");
//                //                    }
//                //                    else
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 7) returning id");
//                //                        exportimportservice.execute("insert into apr_tempspeed (period_id, start_km, start_m, final_km, final_m, reason_id,canselled, passenger, freight, empty_freight,start_date,final_date) values" +
//                //                            " (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value
//                //                        + reason_id + ", " + canselled + ", " + speed + ", " + speed + ", " + speed + ", " + speed + ",' " + yournewstring_start + "', '" + yournewstring_final + "')");
//                //                    }
//                //                }
//                //                count = count + 1;
//                //            }
//                //        }
//                //    }
//                //}
//                //progressbar.performstep();
//                //foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "com.xml"))//готово
//                //{
//                //    var count = 0;
//                //    xmldocument xmldocument = new xmldocument();
//                //    xmldocument.load(file.fullname);
//                //    xmlelement xmlelement = xmldocument.documentelement;
//                //    foreach (xmlnode xmlnode in xmlelement)
//                //    {

//                //        if (xmlnode.name == "com")
//                //        {
//                //            if (count > 0)
//                //                continue;
//                //            foreach (xmlnode z_row in xmlnode.parentnode)
//                //            {
//                //                string objectid;
//                //                if (z_row.attributes["name"].value.tolower() == "энергокабель")
//                //                    objectid = "85";
//                //                else if (z_row.attributes["name"].value.tolower() == "нефтепровод")
//                //                    objectid = "86";
//                //                else if (z_row.attributes["name"].value.tolower() == "кабель связи")
//                //                    objectid = "87";
//                //                else if (z_row.attributes["name"].value.tolower() == "водопровод")
//                //                    objectid = "88";
//                //                else if (z_row.attributes["name"].value.tolower() == "канализация")
//                //                    objectid = "89";
//                //                else if (z_row.attributes["name"].value.tolower() == "турбопровод")
//                //                    objectid = "90";
//                //                else if (z_row.attributes["name"].value.tolower() == "теплотрасса")
//                //                    objectid = "91";
//                //                else if (z_row.attributes["name"].value.tolower() == "теплосеть")
//                //                    objectid = "92";
//                //                else if (z_row.attributes["name"].value.tolower() == "кабельная линия")
//                //                    objectid = "93";
//                //                else if (z_row.attributes["name"].value.tolower() == "влэп")
//                //                    objectid = "94";
//                //                else if (z_row.attributes["name"].value.tolower() == "магистральный кабель")
//                //                    objectid = "95";
//                //                else if (z_row.attributes["name"].value.tolower() == "путепровод")
//                //                    objectid = "96";
//                //                else if (z_row.attributes["name"].value.tolower() == "трасса гидрозолоудаления")
//                //                    objectid = "97";
//                //                else if (z_row.attributes["name"].value.tolower() == "клэп")
//                //                    objectid = "98";
//                //                else if (z_row.attributes["name"].value.tolower() == "коллектор канализационный")
//                //                    objectid = "99";
//                //                else if (z_row.attributes["name"].value.tolower() == "золопровод")
//                //                    objectid = "100";
//                //                else if (z_row.attributes["name"].value.tolower() == "паропровод")
//                //                    objectid = "101";
//                //                else if (z_row.attributes["name"].value.tolower() == "газопровод")
//                //                    objectid = "102";
//                //                else objectid = "35";
//                //                if (listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                //                {
//                //                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                //                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 31").count() > 0)
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 31");
//                //                        exportimportservice.execute("insert into apr_communication (period_id, object_id, km, meter) values (" + periodid.tostring() + ", " + objectid + ", " + z_row.attributes["km"].value + ", " + z_row.attributes["m"].value + ")");
//                //                    }
//                //                    else
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 31) returning id");
//                //                        exportimportservice.execute("insert into apr_communication (period_id, object_id, km, meter) values (" + periodid.tostring() + ", " + objectid + ", " + z_row.attributes["km"].value + ", " + z_row.attributes["m"].value + ")");
//                //                    }

//                //                }
//                //                count = count + 1;
//                //            }
//                //        }
//                //    }
//                //}

//                //progressbar.performstep();



//                //foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "dzp.xml"))
//                //{
//                //    xmldocument xmldocument = new xmldocument();
//                //    xmldocument.load(file.fullname);
//                //    xmlelement xmlelement = xmldocument.documentelement;
//                //    var count = 0;
//                //    foreach (xmlnode xmlnode in xmlelement)
//                //    {
//                //        if (xmlnode.name == "dzp")
//                //        {
//                //            if (count > 0)
//                //                continue;
//                //            foreach (xmlnode z_row in xmlnode.parentnode)//готово
//                //            {
//                //                string defearth = z_row.attributes["name"].value;

//                //                int defearthid = 0;
//                //                if (defearth.contains("длит.ос-ки на подх.к мост"))
//                //                {
//                //                    defearthid = 18;

//                //                }

//                //                switch (defearth)
//                //                {
//                //                    case "выпирание грунтов в выемке":
//                //                        defearthid = 1;
//                //                        break;
//                //                    case "карсты":
//                //                        defearthid = 2;
//                //                        break;
//                //                    case "осадка из-за выпора грунтов":
//                //                        defearthid = 3;
//                //                        break;
//                //                    case "осадка из-за сползания насыпи":
//                //                        defearthid = 4;
//                //                        break;
//                //                    case "расползание насыпи":
//                //                        defearthid = 5;
//                //                        break;
//                //                    case "сплыв откоса выемки":
//                //                        defearthid = 6;
//                //                        break;
//                //                    case "вывал":
//                //                        defearthid = 7;
//                //                        break;
//                //                    case "оползень":
//                //                        defearthid = 8;
//                //                        break;
//                //                    case "оползень, осадка":
//                //                        defearthid = 9;
//                //                        break;
//                //                    case "оползень, сплыв":
//                //                        defearthid = 10;
//                //                        break;
//                //                    case "сплыв":
//                //                        defearthid = 11;
//                //                        break;
//                //                    case "сплыв, оползень":
//                //                        defearthid = 12;
//                //                        break;
//                //                    case "осадки и перекосы из-за выпора":
//                //                        defearthid = 13;
//                //                        break;
//                //                    case "пучина":
//                //                        defearthid = 14;
//                //                        break;
//                //                    case "карсты":
//                //                        defearthid = 15;
//                //                        break;
//                //                    case "осадки пути из-за протаивания":
//                //                        defearthid = 16;
//                //                        break;
//                //                    case "осадки пути из-за слаб.грунтов":
//                //                        defearthid = 17;
//                //                        break;

//                //                    case "длит.ос-ки на подх.к мост&amp;труб":
//                //                        defearthid = 18;
//                //                        break;

//                //                    case "осадки пути из-за расползания":
//                //                        defearthid = 19;
//                //                        break;
//                //                    case "осадки пути из-за сползания":
//                //                        defearthid = 20;
//                //                        break;



//                //                }

//                //                if (listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                //                {
//                //                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                //                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 33").count() > 0)
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 33");
//                //                        exportimportservice.execute("insert into apr_defects_earth (period_id, start_km, start_m, final_km, final_m, type_id) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + ", " + defearthid.tostring() + ")");
//                //                    }
//                //                    else
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 33) returning id");
//                //                        exportimportservice.execute("insert into apr_defects_earth (period_id, start_km, start_m, final_km, final_m, type_id) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + ", " + defearthid.tostring() + ")");
//                //                    }
//                //                }
//                //                count = count + 1;
//                //            }
//                //        }
//                //    }
//                //}
//                //foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "gnsss.xml"))//готово
//                //{
//                //    xmldocument xmldocument = new xmldocument();
//                //    xmldocument.load(file.fullname);
//                //    xmlelement xmlelement = xmldocument.documentelement;
//                //    var count = 0;
//                //    foreach (xmlnode xmlnode in xmlelement)
//                //    {
//                //        if (xmlnode.name == "gnss")
//                //        {
//                //            if (count > 0)
//                //                continue;
//                //            foreach (xmlnode z_row in xmlnode.parentnode)
//                //            {
//                //                int km = int.parse(z_row.attributes["km"].value);
//                //                string meter = z_row.attributes["m"].value;
//                //                string lat = z_row.attributes["lat"].value;
//                //                string lon = z_row.attributes["lon"].value;
//                //                string high = z_row.attributes["hgt"].value;
//                //                int gnssid = int.parse(z_row.attributes["gnssid"].value);
//                //                var track = z_row.attributes["track"].value;
//                //                int up_nom = int.parse(z_row.attributes["up_nom"].value);
//                //                string assetnum = (z_row.attributes["assetnum"].value).tostring();
//                //                if (listids.where(tmp => tmp.oldtrackid.equals(z_row.attributes["put_nom"].value.tostring()) && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                //                {
//                //                    int64 trackid = listids.where(tmp => tmp.oldtrackid.equals(z_row.attributes["put_nom"].value.tostring()) && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;

//                //                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 32").count() > 0)
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 32");
//                //                        exportimportservice.execute("insert into apr_coordinate_gnss (period_id, km, meter, latitude, longtitude, altitude, ) values (" + periodid.tostring() + ", " + km + ", " + meter + ", " + lat + ", " + lon + ", " + high + ")");
//                //                    }
//                //                    else
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 32) returning id");
//                //                        exportimportservice.execute("insert into apr_coordinate_gnss (period_id, km, meter, latitude, longtitude, altitude) values (" + periodid.tostring() + "," + km + ", " + meter + ", " + lat + ", " + lon + ", " + high + ")");
//                //                    }
//                //                }
//                //                count = count + 1;
//                //            }
//                //        }
//                //    }
//                //}
//                //progressbar.performstep();




//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "scr.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "scr")
//                        {
//                            if (count > 0)
//                                continue;

//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {
//                                string type = z_row.attributes["type"].value;//track расположение на фрагментах



//                                int brace_type_id = 0;


//                                switch (type)
//                                {
//                                    case "0":
//                                        brace_type_id = 11;
//                                        //kb
//                                        break;
//                                    case "1":
//                                        brace_type_id = 7;
//                                        //ars
//                                        break;
//                                    case "2":
//                                        brace_type_id = 2;
//                                        //жбр
//                                        break;
//                                    case "3":
//                                        brace_type_id = 12;

//                                        break;
//                                    case "4":
//                                        brace_type_id = 5;

//                                        break;
//                                    case "5":
//                                        brace_type_id = 13;

//                                        break;
//                                    case "6":
//                                        brace_type_id = 9;

//                                        break;
//                                    case "7":
//                                        brace_type_id = 14;

//                                        break;
//                                    case "8":
//                                        brace_type_id = 15;

//                                        //сб-3
//                                        break;
//                                    case "9":
//                                        brace_type_id = 16;

//                                        //pandrol,
//                                        break;
//                                    case "10":
//                                        brace_type_id = 10;

//                                        //
//                                        break;
//                                }





//                                if (listids.where(tmp => tmp.oldtrackid.equals(z_row.attributes["put_nom"].value) && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                                {
//                                    //result = db.execute("update apr_trackclass set start_km=@skm, start_m=@sm, final_km=@fkm, final_m=@fm, class_id=@classid where id=@id",
//                                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 4").count() > 0)
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 4");
//                                        exportimportservice.execute("insert into apr_rails_braces (period_id, start_km, start_m, final_km, final_m,brace_type_id) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + "," + brace_type_id + ")");
//                                    }
//                                    else
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 4) returning id");
//                                        exportimportservice.execute("insert into apr_rails_braces (period_id, start_km, start_m, final_km, final_m,brace_type_id) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + "," + brace_type_id + ")");
//                                    }
//                                }
//                                count = count + 1;
//                            }
//                        }
//                    }
//                }



//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "cat.xml"))//готово "категория пути"
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "cat")
//                        {
//                            if (count > 0)
//                                continue;

//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {
//                                string type = z_row.attributes["cat"].value;//track расположение на фрагментах



//                                int traffic = 0;


//                                switch (type)
//                                {
//                                    case "0":
//                                        traffic = 0;
//                                        //kb
//                                        break;
//                                    case "1":
//                                        traffic = 1;
//                                        //ars
//                                        break;
//                                    case "2":
//                                        traffic = 2;
//                                        //жбр
//                                        break;
//                                    case "3":
//                                        traffic = 3;

//                                        break;
//                                    case "4":
//                                        traffic = 4;

//                                        break;
//                                    case "5":
//                                        traffic = 5;

//                                        break;
//                                    case "6":
//                                        traffic = 6;

//                                        break;
//                                    case "7":
//                                        traffic = 7;
//                                        break;

//                                }


//                                if (listids.where(tmp => tmp.oldtrackid.equals(z_row.attributes["put_nom"].value) && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                                {
//                                    //result = db.execute("update apr_trackclass set start_km=@skm, start_m=@sm, final_km=@fkm, final_m=@fm, class_id=@classid where id=@id",
//                                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 24").count() > 0)
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 24");
//                                        exportimportservice.execute("insert into apr_waycat (period_id, start_km, start_m, final_km, final_m,type_id) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + "," + traffic + ")");
//                                    }
//                                    else
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 24) returning id");
//                                        exportimportservice.execute("insert into apr_waycat (period_id, start_km, start_m, final_km, final_m,type_id) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + "," + traffic + ")");
//                                    }
//                                }
//                                count = count + 1;
//                            }
//                        }
//                    }
//                }
//                progressbar.performstep();

//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "rlt.xml"))//готово
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "rlt")
//                        {
//                            if (count > 0)
//                                continue;
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {

//                                string type = z_row.attributes["type"].value;//track расположение на фрагментах
//                                int brace_type_id = 0;


//                                switch (type)
//                                {
//                                    case "0":
//                                        brace_type_id = 1;
//                                        //p75
//                                        break;
//                                    case "1":
//                                        brace_type_id = 2;
//                                        //р65
//                                        break;
//                                    case "2":
//                                        brace_type_id = 4;
//                                        //р50
//                                        break;
//                                    case "3":
//                                        brace_type_id = 5;


//                                        break;

//                                }



//                                if (listids.where(tmp => tmp.oldtrackid.equals(z_row.attributes["put_nom"].value) && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                                {

//                                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 17").count() > 0)
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 17");
//                                        exportimportservice.execute("insert into apr_rails_sections (period_id, start_km, start_m, final_km, final_m,type_id) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + "," + brace_type_id + ")");
//                                    }
//                                    else
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 17) returning id");
//                                        exportimportservice.execute("insert into apr_rails_sections (period_id, start_km, start_m, final_km, final_m,type_id) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + "," + brace_type_id + ")");
//                                    }
//                                }
//                                count = count + 1;
//                            }
//                        }
//                    }
//                }
//                progressbar.performstep();

//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "issouch.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "issouch")
//                        {
//                            if (count > 0)
//                                continue;
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {

//                                string type = z_row.attributes["type"].value;//track расположение на фрагментах
//                                int most = 0;


//                                switch (type)
//                                {
//                                    case "0":
//                                        most = 0;
//                                        //kb
//                                        break;
//                                    case "1":
//                                        most = 1;
//                                        //ars
//                                        break;
//                                    case "2":
//                                        most = 2;
//                                        //жбр
//                                        break;
//                                    case "3":
//                                        most = 3;
//                                        break;
//                                    case "4":
//                                        most = 4;
//                                        break;
//                                    case "5":
//                                        most = 5;
//                                        break;
//                                    case "6":
//                                        most = 6;
//                                        break;

//                                }

//                                if (listids.where(tmp => tmp.oldtrackid.equals(z_row.attributes["put_nom"].value) && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                                {

//                                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 46").count() > 0)
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 46");
//                                        exportimportservice.execute("insert into apr_issouch (period_id, start_km, start_m, final_km, final_m,issouch_type_id) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + "," + most + ")");
//                                    }
//                                    else
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 46) returning id");
//                                        exportimportservice.execute("insert into apr_issouch (period_id, start_km, start_m, final_km, final_m,issouch_type_id) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + "," + most + ")");
//                                    }
//                                }
//                                count = count + 1;
//                            }
//                        }
//                    }
//                }
//                progressbar.performstep();






//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "class_line.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "class_line")
//                        {
//                            if (count > 0)
//                                continue;
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {

//                                //string type = z_row.attributes["type"].value;//track расположение на фрагментах


//                                var class_nom = z_row.attributes["class_nom"].value;



//                                if (listids.where(tmp => tmp.oldtrackid.equals(z_row.attributes["put_nom"].value) && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                                {

//                                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 49").count() > 0)
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 49");
//                                        exportimportservice.execute("insert into apr_class_line (period_id, start_km, start_m, final_km, final_m,class_nom) values (" + periodid.tostring() + ", "
//                                            + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + ", " + class_nom + ")");
//                                    }
//                                    else
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 49) returning id");
//                                        exportimportservice.execute("insert into apr_class_line (period_id, start_km, start_m, final_km, final_m,class_nom) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + ", " + class_nom + ")");
//                                    }
//                                }
//                                count = count + 1;
//                            }
//                        }
//                    }
//                }
//                progressbar.performstep();

//                //foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "frags.xml"))
//                //{
//                //    xmldocument xmldocument = new xmldocument();
//                //    xmldocument.load(file.fullname);
//                //    xmlelement xmlelement = xmldocument.documentelement;
//                //    var count = 0;
//                //    foreach (xmlnode xmlnode in xmlelement)
//                //    {
//                //        if (xmlnode.name == "frags")
//                //        {
//                //            if (count > 0)
//                //                continue;
//                //            foreach (xmlnode z_row in xmlnode.childnodes)
//                //            {



//                //                if (listids.where(tmp => tmp.oldtrackid.equals(z_row.attributes["put_nom"].value) && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                //                {

//                //                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring()).first().newtrackid;
//                //                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 48").count() > 0)
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 48");
//                //                        exportimportservice.execute("insert into apr_frags_ekasui (period_id, start_km, start_m, final_km, final_m,length,begin_switch_id,end_prim_type,end_switch_id,class) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", "
//                //                            + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + ", " + z_row.attributes["length"].value + ", " + z_row.attributes["begin_prim_type"].value + ", " + z_row.attributes["begin_switch_id"].value + ", " + z_row.attributes["end_prim_type"].value + ", "
//                //                            + z_row.attributes["end_switch_id"].value + ", " + z_row.attributes["class"].value + ")");
//                //                    }
//                //                    else
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 48) returning id");
//                //                        exportimportservice.execute("insert into apr_frags_ekasui (period_id, start_km, start_m, final_km, final_m,length,begin_switch_id,end_prim_type,end_switch_id,class) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", "
//                //                          + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + ", " + z_row.attributes["length"].value + ", " + z_row.attributes["begin_prim_type"].value + ", " + z_row.attributes["begin_switch_id"].value + ", " + z_row.attributes["end_prim_type"].value + ", "
//                //                          + z_row.attributes["end_switch_id"].value + ", " + z_row.attributes["class"].value + ")");
//                //                    }
//                //                }
//                //                count = count + 1;
//                //            }
//                //        }
//                //    }
//                //}
//                //progressbar.performstep();

//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "lrr.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "lrr")
//                        {
//                            if (count > 0)
//                                continue;
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {
//                                string sideid = "2";
//                                if (listids.where(tmp => tmp.oldtrackid.equals(z_row.attributes["put_nom"].value) && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                                {

//                                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 13").count() > 0)
//                                    {

//                                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 13");
//                                        exportimportservice.execute("insert into apr_straightening_thread (period_id, side_id, start_km, start_m, final_km, final_m) values (" + periodid.tostring() + ", " + sideid + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + ")");
//                                    }
//                                    else
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 13) returning id");
//                                        exportimportservice.execute("insert into apr_straightening_thread (period_id, side_id, start_km, start_m, final_km, final_m) values (" + periodid.tostring() + ", " + sideid + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + ")");
//                                    }
//                                }
//                                count = count + 1;
//                            }
//                        }
//                    }
//                }
//                //foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "rfid.xml"))
//                //{
//                //    xmldocument xmldocument = new xmldocument();
//                //    xmldocument.load(file.fullname);
//                //    xmlelement xmlelement = xmldocument.documentelement;
//                //    var count = 0;
//                //    foreach (xmlnode xmlnode in xmlelement)
//                //    {
//                //        if (xmlnode.name == "rfid")
//                //        {
//                //            if (count > 0)
//                //                continue;
//                //            foreach (xmlnode z_row in xmlnode.parentnode)
//                //            {
//                //                int km = int.parse(z_row.attributes["km"].value);
//                //                string meter = z_row.attributes["m"].value;
//                //                string mark = z_row.attributes["id"].value;

//                //                int up_nom = int.parse(z_row.attributes["up_nom"].value);

//                //                string sideid = "2";
//                //                if (listids.where(tmp => tmp.oldtrackid.equals(z_row.attributes["put_nom"].value) && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                //                {
//                //                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                //                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 27").count() > 0)
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 27");
//                //                        exportimportservice.execute($@"insert into apr_rfid (period_id, mark, km, meter) values  (" + periodid.tostring() + ", " + mark + ", " + km + ", " + meter + ")");
//                //                    }

//                //                    else
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 27) returning id");
//                //                        exportimportservice.execute($@"insert into apr_rfid (period_id, mark, km, meter) values  (" + periodid.tostring() + ", " + mark + ", " + km + ", " + meter + ")");
//                //                    }

//                //                }
//                //                count = count + 1;
//                //            }
//                //        }
//                //    }
//                //}

//                //progressbar.performstep();

//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "class_put.xml"))//готово
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "class_put")
//                        {
//                            if (count > 0)
//                                continue;

//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {



//                                var track = z_row.attributes["track"].value;//track расположение на фрагментах
//                                var classputid = z_row.attributes["class_putid"].value;//classputid_ekasui расположение на фрагментах
//                                var classnom = z_row.attributes["class_nom"].value;//classnom_ekasui расположение на фрагментах

//                                if (classnom == "")
//                                {
//                                    classnom = "6";
//                                }
//                                int up_nom = int.parse(z_row.attributes["up_nom"].value);
//                                string assetnum = (z_row.attributes["assetnum"].value).tostring();

//                                if (listids.where(tmp => tmp.oldtrackid.equals(z_row.attributes["put_nom"].value) && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                                {
//                                    //result = db.execute("update apr_trackclass set start_km=@skm, start_m=@sm, final_km=@fkm, final_m=@fm, class_id=@classid where id=@id",
//                                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 3").count() > 0)
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 3");
//                                        exportimportservice.execute("insert into apr_trackclass (period_id,  start_km, start_m, final_km, final_m,class_id) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + "," + int.parse(classnom) + ")");
//                                    }
//                                    else
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 3) returning id");
//                                        exportimportservice.execute("insert into apr_trackclass (period_id,  start_km, start_m, final_km, final_m,class_id) values (" + periodid.tostring() + ", " + z_row.attributes["begin_km"].value + ", " + z_row.attributes["begin_m"].value + ", " + z_row.attributes["end_km"].value + ", " + z_row.attributes["end_m"].value + "," + int.parse(classnom) + ")");
//                                    }
//                                }
//                                count = count + 1;
//                            }
//                        }
//                    }
//                }

//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "vus.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "vus")
//                        {
//                            if (count > 0)
//                                continue;
//                            foreach (xmlnode z_row in xmlnode.parentnode)//готово
//                            {
//                                string start_km = z_row.attributes["begin_km"].value;

//                                string start_m = z_row.attributes["begin_m"].value;



//                                string final_km = z_row.attributes["end_km"].value;
//                                string f_m = z_row.attributes["end_m"].value;

//                                int final_m = int.parse(f_m) - 1;
//                                string passenger = z_row.attributes["vpass"].value;
//                                string freight = z_row.attributes["vgr"].value;
//                                string empty = z_row.attributes["vpor"].value;
//                                string sapsan = z_row.attributes["vsaps"].value;
//                                string lastochka = z_row.attributes["vlast"].value;
//                                string strij = z_row.attributes["vstrij"].value;
//                                string alegro = z_row.attributes["vstrij"].value;
//                                string alegro_nk = z_row.attributes["vstrij"].value;
//                                if (listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value.tostring())).count() > 0)
//                                {
//                                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value.tostring())).first().newtrackid;
//                                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 6").count() > 0)
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 6");
//                                        exportimportservice.execute("insert into apr_speed (sapsan, lastochka,strij,alegro,alegro_nk, period_id, start_km, start_m, final_km, final_m, passenger, freight, empty_freight) values (" + sapsan + "," + lastochka + "," + strij + "," + alegro + "," + alegro_nk + "," + periodid.tostring() + ", " + start_km + "," + start_m + ", " + final_km + "," + final_m + ", " + passenger + "," + freight + ", " + empty + ")");
//                                    }
//                                    else
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 6) returning id");
//                                        exportimportservice.execute("insert into apr_speed (sapsan, lastochka, strij,alegro,alegro_nk,period_id, start_km, start_m, final_km, final_m, passenger, freight, empty_freight) values (" + sapsan + "," + lastochka + "," + strij + "," + alegro + "," + alegro_nk + "," + periodid.tostring() + ", " + start_km + "," + start_m + ", " + final_km + "," + final_m + ", " + passenger + "," + freight + ", " + empty + ")");
//                                    }
//                                }
//                                count = count + 1;
//                            }

//                        }
//                    }
//                }

//                progressbar.performstep();


//                foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "gnss.xml"))
//                {
//                    xmldocument xmldocument = new xmldocument();
//                    xmldocument.load(file.fullname);
//                    xmlelement xmlelement = xmldocument.documentelement;
//                    var count = 0;
//                    foreach (xmlnode xmlnode in xmlelement)
//                    {
//                        if (xmlnode.name == "gnss")
//                        {
//                            if (count > 0)
//                                continue;
//                            foreach (xmlnode z_row in xmlnode.parentnode)
//                            {
//                                int km = int.parse(z_row.attributes["km"].value);
//                                string meter = z_row.attributes["m"].value;
//                                string mark = z_row.attributes["hgt"].value;

//                                int up_nom = int.parse(z_row.attributes["up_nom"].value);

//                                string sideid = "2";
//                                if (listids.where(tmp => tmp.oldtrackid.equals(z_row.attributes["put_nom"].value) && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                                {
//                                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 25").count() > 0)
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 25");
//                                        exportimportservice.execute($@"insert into apr_ref_point (period_id, mark, km, meter) values  (" + periodid.tostring() + ", " + mark + ", " + km + ", " + meter + ")");
//                                    }

//                                    else
//                                    {
//                                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 25) returning id");
//                                        exportimportservice.execute($@"insert into apr_ref_point (period_id, mark, km, meter) values  (" + periodid.tostring() + ", " + mark + ", " + km + ", " + meter + ")");
//                                    }

//                                }
//                                count = count + 1;
//                            }
//                        }
//                    }
//                }

//                //progressbar.performstep();
//                //foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "gnsss.xml"))
//                //{
//                //    xmldocument xmldocument = new xmldocument();
//                //    xmldocument.load(file.fullname);
//                //    xmlelement xmlelement = xmldocument.documentelement;
//                //    var count = 0;
//                //    foreach (xmlnode xmlnode in xmlelement)
//                //    {
//                //        if (xmlnode.name == "gnss")
//                //        {
//                //            if (count > 0)
//                //                continue;
//                //            foreach (xmlnode z_row in xmlnode.parentnode)
//                //            {
//                //                int km = int.parse(z_row.attributes["km"].value);
//                //                string meter = z_row.attributes["m"].value;
//                //                string mark = z_row.attributes["hgt"].value;

//                //                int up_nom = int.parse(z_row.attributes["up_nom"].value);

//                //                string sideid = "2";
//                //                if (listids.where(tmp => tmp.oldtrackid.equals(z_row.attributes["put_nom"].value) && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                //                {
//                //                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                //                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 22").count() > 0)
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 22");
//                //                        exportimportservice.execute($@"insert into apr_profmarks (period_id, profil, km, meter) values  (" + periodid.tostring() + ", " + mark + ", " + km + ", " + meter + ")");
//                //                    }

//                //                    else
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 22) returning id");
//                //                        exportimportservice.execute($@"insert into apr_profmarks (period_id, profil, km, meter) values  (" + periodid.tostring() + ", " + mark + ", " + km + ", " + meter + ")");
//                //                    }

//                //                }
//                //                count = count + 1;
//                //            }
//                //        }
//                //    }
//                //}

//                //progressbar.performstep();





//                //foreach (fileinfo file in fileinfo.where(tmp => tmp.name == "crs.xml"))//пересечения пока не нашел 
//                //{
//                //    xmldocument xmldocument = new xmldocument();
//                //    xmldocument.load(file.fullname);
//                //    xmlelement xmlelement = xmldocument.documentelement;
//                //    var count = 0;
//                //    foreach (xmlnode xmlnode in xmlelement)
//                //    {
//                //        if (xmlnode.name == "crs")
//                //        {
//                //            if (count > 0)
//                //                continue;

//                //            foreach (xmlnode z_row in xmlnode.childnodes)
//                //            {
//                //                string type = z_row.attributes["type"].value;//track расположение на фрагментах



//                //                int traffic = 0;


//                //                switch (type)
//                //                {
//                //                    case "0":
//                //                        traffic = 0;
//                //                        //kb
//                //                        break;
//                //                    case "1":
//                //                        traffic = 1;
//                //                        //ars
//                //                        break;
//                //                    case "2":
//                //                        traffic = 2;
//                //                        //жбр
//                //                        break;
//                //                    case "3":
//                //                        traffic = 3;

//                //                        break;
//                //                    case "4":
//                //                        traffic = 4;

//                //                        break;
//                //                    case "5":
//                //                        traffic = 5;

//                //                        break;
//                //                    case "6":
//                //                        traffic = 6;

//                //                        break;
//                //                    case "7":
//                //                        traffic = 7;
//                //                        break;

//                //                }


//                //                if (listids.where(tmp => tmp.oldtrackid.equals(z_row.attributes["put_nom"].value) && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).count() > 0)
//                //                {
//                //                    //result = db.execute("update apr_trackclass set start_km=@skm, start_m=@sm, final_km=@fkm, final_m=@fm, class_id=@classid where id=@id",
//                //                    int64 trackid = listids.where(tmp => tmp.oldtrackid == (z_row.attributes["put_nom"].value).tostring() && tmp.olddirectionid == int.parse(z_row.attributes["up_nom"].value)).first().newtrackid;
//                //                    if (exportimportservice.importqueryreturnlistlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 23").count() > 0)
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("select id from tpl_period where adm_track_id = " + trackid.tostring() + " and mto_type = 23");
//                //                        exportimportservice.execute("insert into apr_traffic (period_id, km, m,traffic) values (" + periodid.tostring() + ", " + z_row.attributes["km"].value + ", " + z_row.attributes["m"].value + "," + traffic + ")");
//                //                    }
//                //                    else
//                //                    {
//                //                        int64 periodid = exportimportservice.importqueryreturnlong("insert into tpl_period (adm_track_id, start_date, final_date, mto_type) values (" + trackid.tostring() + ", \'" + period.start_date.tostring("yyyy-mm-dd") + "\', \'" + period.final_date.tostring("yyyy-mm-dd") + "\', 23) returning id");
//                //                        exportimportservice.execute("insert into apr_traffic     (period_id, km, m,traffic) values (" + periodid.tostring() + ", " + z_row.attributes["km"].value + ", " + z_row.attributes["m"].value + "," + traffic + ")");
//                //                    }
//                //                }
//                //                count = count + 1;
//                //            }
//                //        }
//                //    }
//                //}
//                //progressbar.performstep();



//                //catch (exception e)
//                //{
//                //    using (streamwriter outputfile = new streamwriter(logfile, true))
//                //    {
//                //        outputfile.writeline(z_row.attributes["put_nom"].value + ", km: " + non_ext_km);
//                //        outputfile.writeline(e.message);
//                //    }
//                //}

//                //else
//                //{
//                //    using (streamwriter outputfile = new streamwriter(logfile, true))
//                //    {
//                //        outputfile.writeline(z_row.attributes["put_nom"].value + ", km: " + non_ext_km);
//                //        outputfile.writeline("путь по id не найден");
//                //    }
//                //}


//                /*
//                        case "kv_pko":
//                        case "kv_rperiod":
//                */

//                var chita = "13807";
//                string adm_direct_id = "";
//                adm_direct_id = exportimportservice.exportqueryreturnstring($@"select id from adm_direction where code = '{chita}'");


//                var adm_track_id = exportimportservice.exportqueryreturnstring($@"select id from adm_track where adm_direction_id = {adm_direct_id} and code = '2'");
//                var adm_escort_id = exportimportservice.exportqueryreturnstring($@"select id from adm_distance where name = 'пч-1'");
//                var nod = exportimportservice.exportqueryreturnstring($@"select adm_nod_id from adm_distance where name = 'пч-1'");

//                var start_section = exportimportservice.exportqueryreturnstring($@"select id from adm_station where name = 'могоча'");
//                var final_section = exportimportservice.exportqueryreturnstring($@"select id from adm_station where name = 'ерофей павлович'");


//                exportimportservice.execute($@"insert into public.fragments(id, trip_id, adm_track_id, start_km, start_m, final_km, final_m, start_switch_id, final_switch_id, belong_id, direction) values (1244, 410, {adm_track_id}, 6906, 750, 7209, 252, -1, -1, 1768198, null);");
//                exportimportservice.execute($@"insert into public.escort(id, trip_id, distance_id, fullname) values (137, 410, {adm_escort_id}, '');");

//                exportimportservice.execute($@"update trips set direction_id = {adm_direct_id} where id =410;");
//                exportimportservice.execute($@"update trips set start_station = {start_section} where id =410;");
//                exportimportservice.execute($@"update trips set final_station = {final_section} where id =410;");
//                exportimportservice.execute($@"update trips set road_id = {nod} where id =410;");
//            }
//            return true;
//        }

//        internal static bool import(fileinfo[] fileinfo, metroframework.controls.metroprogressbar progressbar, int import_type)
//        {
//            progressbar.value = 0;
//            progressbar.step = 100 / 50;
//            bool result = true;
//            list<importlistid> roadids = new list<importlistid>();
//            list<importlistid> tempids = new list<importlistid>();
//            list<importlistid> temp2ids = new list<importlistid>();
//            list<importlistid> distanceids = new list<importlistid>();
//            list<importlistid> pdbids = new list<importlistid>();
//            list<importlistid> stationids = new list<importlistid>();
//            list<importlistid> directionids = new list<importlistid>();
//            list<importlistid> trackids = new list<importlistid>();
//            list<importlistid> periodids = new list<importlistid>();

//            if (fileinfo.any(tmp => tmp.name == "adm_road.csv"))
//            {
//                //adm structure
//                using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "adm_road.csv").fullname))
//                {
//                    csvparser.commenttokens = new string[] { "#" };
//                    csvparser.setdelimiters(new string[] { "," });
//                    csvparser.hasfieldsenclosedinquotes = true;

//                    string[] fields = csvparser.readfields();
//                    int id = fields.tolist().indexof("id"), code = fields.tolist().indexof("code"), name = fields.tolist().indexof("name"), abbr = fields.tolist().indexof("abbr");

//                    while (!csvparser.endofdata)
//                    {
//                        fields = csvparser.readfields();
//                        string id = fields[id];
//                        string code = fields[code];
//                        string name = fields[name];

//                        long newroadid = exportimportservice.importqueryreturnlong($@"insert into adm_road (code, name,abbr) values ('{code}', '{name}','{abbr}') returning coalesce(id, -1)");

//                        if (newroadid > 0)
//                            roadids.add(new importlistid
//                            {
//                                newid = newroadid,
//                                oldid = long.parse(id)
//                            });
//                    }
//                }

//                if (fileinfo.any(tmp => tmp.name == "adm_nod.csv") && roadids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "adm_nod.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), code = fields.tolist().indexof("code"), name = fields.tolist().indexof("name"), roadid = fields.tolist().indexof("adm_road_id");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string code = fields[code];
//                            string name = fields[name];
//                            string roadid = fields[roadid];

//                            if (roadids.any(r => r.oldid.equals(long.parse(roadid))))
//                            {
//                                long newid = exportimportservice.importqueryreturnlong($@"insert into adm_nod (code, name, adm_road_id) values ('{code}', '{name}', {roadids.first(r => r.oldid.equals(long.parse(roadid))).newid}) returning coalesce(id, -1)");

//                                if (newid > 0)
//                                    tempids.add(new importlistid
//                                    {
//                                        newid = newid,
//                                        oldid = long.parse(id)
//                                    });
//                            }
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "adm_distance.csv") && tempids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "adm_distance.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), code = fields.tolist().indexof("code"), name = fields.tolist().indexof("name"), nodid = fields.tolist().indexof("adm_nod_id"), ekasui_id = fields.tolist().indexof("ekasui_id");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string code = fields[code];
//                            string name = fields[name];
//                            string nodid = fields[nodid];

//                            if (tempids.any(r => r.oldid.equals(long.parse(nodid))))
//                            {
//                                long newid = exportimportservice.importqueryreturnlong($@"insert into adm_distance (code, name, adm_nod_id,ekasui_id) values ('{code}', '{name}', {tempids.first(r => r.oldid.equals(long.parse(nodid))).newid},'{ekasui_id}') returning coalesce(id, -1)");

//                                if (newid > 0)
//                                    distanceids.add(new importlistid
//                                    {
//                                        newid = newid,
//                                        oldid = long.parse(id)
//                                    });
//                            }
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "adm_station.csv") && tempids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "adm_station.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), code = fields.tolist().indexof("code"), name = fields.tolist().indexof("name"), nodid = fields.tolist().indexof("adm_nod_id"), typeid = fields.tolist().indexof("type_id"), adm_direction_id = fields.tolist().indexof("adm_direction_id");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string typeid = fields[typeid];
//                            string nodid = fields[nodid];
//                            string code = fields[code];
//                            string name = fields[name];

//                            if (tempids.any(r => r.oldid.equals(long.parse(nodid))))
//                            {
//                                long newid = exportimportservice.importqueryreturnlong($@"insert into adm_station (code, name, adm_nod_id, type_id,adm_direction_id) values ('{code}', '{name}', {tempids.first(r => r.oldid.equals(long.parse(nodid))).newid}, {typeid},{adm_direction_id}) returning coalesce(id, -1)");

//                                if (newid > 0)
//                                    stationids.add(new importlistid
//                                    {
//                                        newid = newid,
//                                        oldid = long.parse(id)
//                                    });
//                            }
//                        }
//                    }
//                tempids.clear();
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "adm_pchu.csv") && distanceids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "adm_pchu.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), code = fields.tolist().indexof("code"), name = fields.tolist().indexof("chief_fullname"), distanceid = fields.tolist().indexof("adm_distance_id"), id_parent = fields.tolist().indexof("id_parent"), ekasui_id = fields.tolist().indexof("ekasui_id");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string distanceid = fields[distanceid];
//                            string code = fields[code];
//                            string name = fields[name];

//                            if (distanceids.any(r => r.oldid.equals(long.parse(distanceid))))
//                            {
//                                long newid = exportimportservice.importqueryreturnlong($@"insert into adm_pchu (code, chief_fullname, adm_distance_id,id_parent,ekasui_id) values ('{code}', '{name}', {distanceids.first(r => r.oldid.equals(long.parse(distanceid))).newid},{id_parent},{ekasui_id}) returning coalesce(id, -1)");

//                                if (newid > 0)
//                                    tempids.add(new importlistid
//                                    {
//                                        newid = newid,
//                                        oldid = long.parse(id)
//                                    });
//                            }
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "adm_pd.csv") && tempids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "adm_pd.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), code = fields.tolist().indexof("code"), name = fields.tolist().indexof("chief_fullname"), pchuid = fields.tolist().indexof("adm_pchu_id"), id_parent = fields.tolist().indexof("id_parent"), ekasui_id = fields.tolist().indexof("ekasui_id");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string pchuid = fields[pchuid];
//                            string code = fields[code];
//                            string name = fields[name];

//                            if (tempids.any(r => r.oldid.equals(long.parse(pchuid))))
//                            {
//                                long newid = exportimportservice.importqueryreturnlong($@"insert into adm_pd (code, chief_fullname, adm_pchu_id,id_parent,ekasui_id) values ('{code}', '{name}', {tempids.first(r => r.oldid.equals(long.parse(pchuid))).newid},{id_parent},{ekasui_id}) returning coalesce(id, -1)");

//                                if (newid > 0)
//                                    temp2ids.add(new importlistid
//                                    {
//                                        newid = newid,
//                                        oldid = long.parse(id)
//                                    });
//                            }
//                        }
//                    }
//                tempids.clear();
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "adm_pdb.csv") && temp2ids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "adm_pdb.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), code = fields.tolist().indexof("code"), name = fields.tolist().indexof("chief_fullname"), pdid = fields.tolist().indexof("adm_pd_id"), id_parent = fields.tolist().indexof("id_parent"), ekasui_id = fields.tolist().indexof("ekasui_id");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string pdid = fields[pdid];
//                            string code = fields[code];
//                            string name = fields[name];

//                            if (temp2ids.any(r => r.oldid.equals(long.parse(pdid))))
//                            {
//                                long newid = exportimportservice.importqueryreturnlong($@"insert into adm_pdb (code, chief_fullname, adm_pd_id,id_parent,ekasui_id) values ('{code}', '{name}', {temp2ids.first(r => r.oldid.equals(long.parse(pdid))).newid},{id_parent},{ekasui_id}) returning coalesce(id, -1)");

//                                if (newid > 0)
//                                    pdbids.add(new importlistid
//                                    {
//                                        newid = newid,
//                                        oldid = long.parse(id)
//                                    });
//                            }
//                        }
//                    }
//                temp2ids.clear();
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "stw_park.csv") && stationids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "stw_park.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), typeid = fields.tolist().indexof("type_id"), name = fields.tolist().indexof("name"), stationid = fields.tolist().indexof("adm_station_id");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string typeid = fields[typeid];
//                            string stationid = fields[stationid];
//                            string name = fields[name];

//                            if (stationids.any(r => r.oldid.equals(long.parse(stationid))))
//                            {
//                                long newid = exportimportservice.importqueryreturnlong($@"insert into stw_park (name, adm_station_id, type_id) values ('{name}', {stationids.first(r => r.oldid.equals(long.parse(stationid))).newid}, {typeid}) returning coalesce(id, -1)");

//                                if (newid > 0)
//                                    tempids.add(new importlistid
//                                    {
//                                        newid = newid,
//                                        oldid = long.parse(id)
//                                    });
//                            }
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "stw_object.csv") && tempids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "stw_object.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), typeid = fields.tolist().indexof("type_id"), name = fields.tolist().indexof("name"), parkid = fields.tolist().indexof("stw_park_id");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string name = fields[name];
//                            string parkid = fields[parkid];
//                            string typeid = fields[typeid];

//                            if (tempids.any(r => r.oldid.equals(long.parse(parkid))))
//                                exportimportservice.execute($@"insert into stw_object (name, stw_park_id, type_id) values ('{name}', {tempids.first(r => r.oldid.equals(long.parse(parkid))).newid}, {typeid}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "adm_direction.csv"))
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "adm_direction.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), code = fields.tolist().indexof("code"), name = fields.tolist().indexof("name");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string code = fields[code];
//                            string name = fields[name];

//                            long newid = exportimportservice.importqueryreturnlong($@"insert into adm_direction (code, name) values ('{code}', '{name}') returning coalesce(id, -1)");

//                            if (newid > 0)
//                                directionids.add(new importlistid
//                                {
//                                    newid = newid,
//                                    oldid = long.parse(id)
//                                });
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "road_direction.csv") && roadids.any() && directionids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "road_direction.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), roadid = fields.tolist().indexof("road_id"), directionid = fields.tolist().indexof("direction_id");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string roadid = fields[roadid];
//                            string directionid = fields[directionid];

//                            if (roadids.any(r => r.oldid.equals(long.parse(roadid))) && directionids.any(d => d.oldid.equals(long.parse(directionid))))
//                            {
//                                exportimportservice.execute($@"insert into road_direction (road_id, direction_id) values ({roadids.first(r => r.oldid.equals(long.parse(roadid))).newid}, {directionids.first(d => d.oldid.equals(long.parse(directionid))).newid}) returning coalesce(id, -1)");

//                                if (!temp2ids.any(t => t.oldid.equals(long.parse(directionid))))
//                                    temp2ids.add(new importlistid
//                                    {
//                                        newid = directionids.first(d => d.oldid.equals(long.parse(directionid))).newid,
//                                        oldid = long.parse(directionid)
//                                    });
//                            }
//                        }
//                    }
//                directionids.clear();
//                directionids.addrange(temp2ids);
//                temp2ids.clear();
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "adm_track.csv"))
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "adm_track.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), code = fields.tolist().indexof("code"), directionid = fields.tolist().indexof("adm_direction_id"), up_nom = fields.tolist().indexof("up_nom"), adm_station_id = fields.tolist().indexof("adm_station_id");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string code = fields[code];
//                            string directionid = fields[directionid];

//                            if (!string.isnullorempty(directionid))
//                            {
//                                if (directionids.any(r => r.oldid.equals(long.parse(directionid))))
//                                {
//                                    long newid = exportimportservice.importqueryreturnlong($@"insert into adm_track (code, adm_direction_id,up_nom,adm_station_id) values ('{code}', {directionids.first(r => r.oldid.equals(long.parse(directionid))).newid},{up_nom},{adm_station_id}) returning coalesce(id, -1)");

//                                    if (newid > 0)
//                                        trackids.add(new importlistid
//                                        {
//                                            newid = newid,
//                                            oldid = long.parse(id)
//                                        });
//                                }
//                            }
//                            else
//                            {
//                                long newid = exportimportservice.importqueryreturnlong($@"insert into adm_track (code, adm_direction_id,up_nom,adm_station_id) values ('{code}', null,null,null) returning coalesce(id, -1)");

//                                if (newid > 0)
//                                    temp2ids.add(new importlistid
//                                    {
//                                        newid = newid,
//                                        oldid = long.parse(id)
//                                    });
//                            }
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "stw_track.csv") && temp2ids.any() && stationids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "stw_track.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), trackid = fields.tolist().indexof("adm_track_id"), stationid = fields.tolist().indexof("adm_station_id"), typeid = fields.tolist().indexof("type_id");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string stationid = fields[stationid];
//                            string typeid = fields[typeid];
//                            string trackid = fields[trackid];

//                            if (stationids.any(r => r.oldid.equals(long.parse(stationid))) && temp2ids.any(r => r.oldid.equals(long.parse(trackid))))
//                            {
//                                exportimportservice.execute($@"insert into stw_track (adm_station_id, adm_track_id, type_id) values ({stationids.first(r => r.oldid.equals(long.parse(stationid))).newid}, {temp2ids.first(r => r.oldid.equals(long.parse(trackid))).newid}, {typeid}) returning coalesce(id, -1)");

//                                if (!trackids.any(r => r.oldid.equals(long.parse(trackid))))
//                                    trackids.add(new importlistid
//                                    {
//                                        newid = temp2ids.first(r => r.oldid.equals(long.parse(trackid))).newid,
//                                        oldid = long.parse(trackid)
//                                    });
//                            }
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "stw_park_track.csv") && temp2ids.any() && tempids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "stw_park_track.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), parkid = fields.tolist().indexof("stw_park_id"), typeid = fields.tolist().indexof("type_id"), trackid = fields.tolist().indexof("adm_track_id");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string parkid = fields[parkid];
//                            string typeid = fields[typeid];
//                            string trackid = fields[trackid];

//                            if (tempids.any(r => r.oldid.equals(long.parse(parkid))) && temp2ids.any(r => r.oldid.equals(long.parse(trackid))))
//                            {
//                                exportimportservice.execute($@"insert into stw_park_track (stw_park_id, adm_track_id, type_id) values ({tempids.first(r => r.oldid.equals(long.parse(parkid))).newid}, {temp2ids.first(r => r.oldid.equals(long.parse(trackid))).newid}, {typeid}) returning coalesce(id, -1)");

//                                if (!trackids.any(r => r.oldid.equals(long.parse(trackid))))
//                                    trackids.add(new importlistid
//                                    {
//                                        newid = temp2ids.first(r => r.oldid.equals(long.parse(trackid))).newid,
//                                        oldid = long.parse(trackid)
//                                    });
//                            }
//                        }
//                    }
//                tempids.clear();
//                temp2ids.clear();
//                roadids.clear();
//                directionids.clear();
//                progressbar.performstep();

//                //period
//                if (fileinfo.any(tmp => tmp.name == "tpl_period.csv") && trackids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "tpl_period.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), startdate = fields.tolist().indexof("start_date"), finaldate = fields.tolist().indexof("final_date"), trackid = fields.tolist().indexof("adm_track_id"), changedate = fields.tolist().indexof("change_date"), comment = fields.tolist().indexof("comment"), mtotype = fields.tolist().indexof("mto_type");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string trackid = fields[trackid];
//                            string startdate = fields[startdate];
//                            string finaldate = fields[finaldate];
//                            string changedate = fields[changedate];
//                            string comment = fields[comment];
//                            string mtotype = fields[mtotype];

//                            if (trackids.any(r => r.oldid.equals(long.parse(trackid))))
//                            {
//                                long newid = exportimportservice.importqueryreturnlong($@"insert into tpl_period (adm_track_id, start_date, final_date, change_date, comment, mto_type) values ({trackids.first(r => r.oldid.equals(long.parse(trackid))).newid}, '{startdate}', '{finaldate}', {(string.isnullorempty(changedate) ? "null" : "\'" + changedate + "\'")}, {(string.isnullorempty(comment) ? "null" : "\'" + comment + "\'")}, {mtotype}) returning coalesce(id, -1)");

//                                if (newid > 0)
//                                    periodids.add(new importlistid
//                                    {
//                                        newid = newid,
//                                        oldid = long.parse(id)
//                                    });
//                            }
//                        }
//                    }
//                progressbar.performstep();

//                //mto structure
//                if (fileinfo.any(tmp => tmp.name == "apr_artificial_construction.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_artificial_construction.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), typeid = fields.tolist().indexof("type_id"), km = fields.tolist().indexof("km"), meter = fields.tolist().indexof("meter"), len = fields.tolist().indexof("len");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string km = fields[km];
//                            string meter = fields[meter];
//                            string typeid = fields[typeid];
//                            string len = fields[len];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_artificial_construction (period_id, type_id, km, meter, len) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {typeid}, {km}, {meter}, {len}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_ballast.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_ballast.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), ballast = fields.tolist().indexof("ballast"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string ballast = fields[ballast];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_ballast (period_id, start_km, start_m, final_km, final_m, ballast) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {ballast}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_cham_joint.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_cham_joint.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), typeid = fields.tolist().indexof("type_id"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string typeid = fields[typeid];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_cham_joint (period_id, start_km, start_m, final_km, final_m, type_id) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {typeid}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_communication.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_communication.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), objectid = fields.tolist().indexof("object_id"),
//                            km = fields.tolist().indexof("km"), meter = fields.tolist().indexof("meter");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string km = fields[km];
//                            string meter = fields[meter];
//                            string objectid = fields[objectid];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_communication (period_id, object_id, km, meter) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {objectid}, {km}, {meter}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_coordinate_gnss.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_coordinate_gnss.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"),
//                            km = fields.tolist().indexof("km"), meter = fields.tolist().indexof("meter"),
//                            alti = fields.tolist().indexof("altitude"), longti = fields.tolist().indexof("longtitude"), lati = fields.tolist().indexof("latitude"),
//                            coord = fields.tolist().indexof("exact_coordinate"), height = fields.tolist().indexof("exact_height");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string km = fields[km];
//                            string meter = fields[meter];
//                            string latitude = fields[lati];
//                            string longtitude = fields[longti];
//                            string altitude = fields[alti];
//                            string coordinate = fields[coord];
//                            string height = fields[height];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_coordinate_gnss (period_id, km, meter, latitude, longtitude, altitude, exact_coordinate, exact_height) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {km}, {meter}, {latitude}, {longtitude}, {altitude}, {coordinate}, {height}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_crosstie.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_crosstie.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), typeid = fields.tolist().indexof("crosstie_type_id"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string typeid = fields[typeid];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_crosstie (period_id, start_km, start_m, final_km, final_m, crosstie_type_id) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {typeid}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_curve.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_curve.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), sideid = fields.tolist().indexof("side_id"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string sideid = fields[sideid];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                            {
//                                long newid = exportimportservice.importqueryreturnlong($@"insert into apr_curve (period_id, start_km, start_m, final_km, final_m, side_id) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {sideid}) returning coalesce(id, -1)");

//                                if (newid > 0)
//                                {
//                                    tempids.add(new importlistid
//                                    {
//                                        newid = newid,
//                                        oldid = long.parse(id)
//                                    });
//                                }
//                            }
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_defects_earth.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_defects_earth.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), typeid = fields.tolist().indexof("type_id"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string typeid = fields[typeid];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_defects_earth (period_id, start_km, start_m, final_km, final_m, type_id) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {typeid}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_dimension.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_dimension.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), typeid = fields.tolist().indexof("type_id"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string typeid = fields[typeid];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_dimension (period_id, start_km, start_m, final_km, final_m, type_id) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {typeid}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_elcurve.csv") && tempids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_elcurve.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), curveid = fields.tolist().indexof("curve_id"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m"),
//                            lvl = fields.tolist().indexof("lvl"), t1 = fields.tolist().indexof("transition_1"), t2 = fields.tolist().indexof("transition_2");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string curveid = fields[curveid];
//                            string lvl = fields[lvl];
//                            string tran1 = fields[t1];
//                            string tran2 = fields[t2];

//                            if (tempids.any(r => r.oldid.equals(long.parse(curveid))))
//                                exportimportservice.execute($@"insert into apr_elcurve (curve_id, start_km, start_m, final_km, final_m, lvl, transition_1, transition_2) values ({tempids.first(r => r.oldid.equals(long.parse(curveid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {lvl}, {tran1}, {tran2}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_elevation.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_elevation.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), lvlid = fields.tolist().indexof("level_id"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string levelid = fields[lvlid];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_elevation (period_id, start_km, start_m, final_km, final_m, level_id) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {levelid}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_long_rails.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_long_rails.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), typeid = fields.tolist().indexof("type_id"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string typeid = fields[typeid];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_long_rails (period_id, start_km, start_m, final_km, final_m, type_id) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {typeid}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_norma_width.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_norma_width.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), norma = fields.tolist().indexof("norma_width"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string norma = fields[norma];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_norma_width (period_id, start_km, start_m, final_km, final_m, norma_width) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {norma}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_profmarks.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_profmarks.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), profil = fields.tolist().indexof("profil"),
//                            km = fields.tolist().indexof("km"), meter = fields.tolist().indexof("meter");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string km = fields[km];
//                            string meter = fields[meter];
//                            string profil = fields[4];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_profmarks (period_id, profil, km, meter) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {profil}, {km}, {meter}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_rails_braces.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_rails_braces.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), typeid = fields.tolist().indexof("brace_type_id"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string typeid = fields[typeid];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_rails_braces (period_id, start_km, start_m, final_km, final_m, brace_type_id) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {typeid}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_rails_sections.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_rails_sections.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), typeid = fields.tolist().indexof("type_id"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string typeid = fields[typeid];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_rails_sections (period_id, start_km, start_m, final_km, final_m, type_id) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {typeid}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_ref_point.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_ref_point.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), mark = fields.tolist().indexof("mark"),
//                            km = fields.tolist().indexof("km"), meter = fields.tolist().indexof("meter");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string km = fields[km];
//                            string meter = fields[meter];
//                            string mark = fields[mark];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_ref_point (period_id, mark, km, meter) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {mark}, {km}, {meter}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_rfid.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_rfid.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), mark = fields.tolist().indexof("mark"),
//                            km = fields.tolist().indexof("km"), meter = fields.tolist().indexof("meter"), len = fields.tolist().indexof("len");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string km = fields[km];
//                            string meter = fields[meter];
//                            string mark = fields[mark];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_rfid (period_id, mark, km, meter) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, '{mark}', {km}, {meter}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_speed.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_speed.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), sapsan = fields.tolist().indexof("sapsan"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m"),
//                            last = fields.tolist().indexof("lastochka"), pass = fields.tolist().indexof("passenger"), frei = fields.tolist().indexof("freight"), emfrei = fields.tolist().indexof("empty_freight");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string sapsan = fields[sapsan];
//                            string lastochka = fields[last];
//                            string pass = fields[pass];
//                            string frei = fields[frei];
//                            string emfrei = fields[emfrei];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_speed (period_id, start_km, start_m, final_km, final_m, sapsan, lastochka, passenger, freight, empty_freight) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {sapsan}, {lastochka}, {pass}, {frei}, {emfrei}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_stcurve.csv") && tempids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_stcurve.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), curveid = fields.tolist().indexof("curve_id"), wear = fields.tolist().indexof("wear"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m"),
//                            radius = fields.tolist().indexof("radius"), t1 = fields.tolist().indexof("transition_1"), t2 = fields.tolist().indexof("transition_2"), width = fields.tolist().indexof("width");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string curveid = fields[curveid];
//                            string radius = fields[radius];
//                            string tran1 = fields[t1];
//                            string tran2 = fields[t2];
//                            string width = fields[width];
//                            string wear = fields[wear];

//                            if (tempids.any(r => r.oldid.equals(long.parse(curveid))))
//                                exportimportservice.execute($@"insert into apr_stcurve (curve_id, start_km, start_m, final_km, final_m, radius, transition_1, transition_2, width, wear) values ({tempids.first(r => r.oldid.equals(long.parse(curveid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {radius}, {tran1}, {tran2}, {width}, {wear}) returning coalesce(id, -1)");
//                        }
//                    }
//                tempids.clear();
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_straightening_thread.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_straightening_thread.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), sideid = fields.tolist().indexof("side_id"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string sideid = fields[sideid];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_straightening_thread (period_id, start_km, start_m, final_km, final_m, side_id) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {sideid}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_tempspeed.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_tempspeed.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m"),
//                            reason = fields.tolist().indexof("reason_id"), pass = fields.tolist().indexof("passenger"), frei = fields.tolist().indexof("freight"), emfrei = fields.tolist().indexof("empty_freight"),
//                            startdate = fields.tolist().indexof("start_date"), finaldate = fields.tolist().indexof("final_date");
//                        //date = fields.tolist().indexof("repair_date");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string reasonid = fields[reason];
//                            // string repairdate = fields[date];
//                            string sdate = fields[startdate];
//                            string fdate = fields[finaldate];
//                            string pass = fields[pass];
//                            string frei = fields[frei];
//                            string emfrei = fields[emfrei];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_tempspeed (period_id, start_km, start_m, final_km, final_m, reason_id, passenger, freight, empty_freight,start_date,final_date) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {reasonid}, {pass}, {frei}, {emfrei},'{sdate}','{fdate}') returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_trackclass.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_trackclass.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), classid = fields.tolist().indexof("class_id"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string classid = fields[classid];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_trackclass (period_id, start_km, start_m, final_km, final_m, class_id) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {classid}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_traffic.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_traffic.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), traffic = fields.tolist().indexof("traffic"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string traffic = fields[traffic];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_traffic (period_id, start_km, start_m, final_km, final_m, traffic) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {traffic}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "apr_waycat.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "apr_waycat.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), typeid = fields.tolist().indexof("type_id"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string typeid = fields[typeid];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into apr_waycat (period_id, start_km, start_m, final_km, final_m, type_id) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {typeid}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "repair_project.csv") && trackids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "repair_project.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), trackid = fields.tolist().indexof("adm_track_id"), typeid = fields.tolist().indexof("type_id"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m"),
//                            accept = fields.tolist().indexof("accept_id"), date = fields.tolist().indexof("repair_date");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string trackid = fields[trackid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string typeid = fields[typeid];
//                            string acceptid = fields[accept];
//                            string repairdate = fields[date];

//                            if (trackids.any(r => r.oldid.equals(long.parse(trackid))))
//                                exportimportservice.execute($@"insert into repair_project (adm_track_id, start_km, start_m, final_km, final_m, type_id, accept_id, repair_date) values ({trackids.first(r => r.oldid.equals(long.parse(trackid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {typeid}, {acceptid}, '{repairdate}') returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "tpl_check_sections.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "tpl_check_sections.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m"),
//                            aw = fields.tolist().indexof("avg_width"), al = fields.tolist().indexof("avg_level"), sw = fields.tolist().indexof("sko_width"), sl = fields.tolist().indexof("sko_level");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string avgw = fields[aw];
//                            string avgl = fields[al];
//                            string skow = fields[sw];
//                            string skol = fields[sl];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into tpl_check_sections (period_id, start_km, start_m, final_km, final_m, avg_width, avg_level, sko_width, sko_level) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {avgw}, {avgl}, {skow}, {skol}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "tpl_deep.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "tpl_deep.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into tpl_deep (period_id, start_km, start_m, final_km, final_m) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "tpl_dist_section.csv") && periodids.any() && distanceids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "tpl_dist_section.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), distid = fields.tolist().indexof("adm_distance_id"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string distanceid = fields[distid];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))) && distanceids.any(r => r.oldid.equals(long.parse(distanceid))))
//                                exportimportservice.execute($@"insert into tpl_dist_section (period_id, start_km, start_m, final_km, final_m, adm_distance_id) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {distanceids.first(r => r.oldid.equals(long.parse(distanceid))).newid}) returning coalesce(id, -1)");
//                        }
//                    }
//                distanceids.clear();
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "tpl_distance_between_tracks.csv") && periodids.any() && trackids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "tpl_distance_between_tracks.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), leftid = fields.tolist().indexof("left_adm_track_id"), rightid = fields.tolist().indexof("right_adm_track_id"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m"),
//                            lm = fields.tolist().indexof("left_m"), rm = fields.tolist().indexof("right_m");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string leftm = fields[lm];
//                            string lefttrack = fields[leftid];
//                            string rightm = fields[rm];
//                            string righttrack = fields[rightid];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))) && trackids.any(r => r.oldid.equals(long.parse(lefttrack))) && trackids.any(r => r.oldid.equals(long.parse(righttrack))))
//                                exportimportservice.execute($@"insert into tpl_distance_between_tracks (period_id, start_km, start_m, final_km, final_m, left_m, right_m, left_adm_track_id, right_adm_track_id) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {leftm}, {rightm}, {trackids.first(r => r.oldid.equals(long.parse(lefttrack))).newid}, {trackids.first(r => r.oldid.equals(long.parse(righttrack))).newid}) returning coalesce(id, -1)");
//                        }
//                    }
//                trackids.clear();
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "tpl_non_ext_km.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "tpl_non_ext_km.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"),
//                            km = fields.tolist().indexof("km");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string km = fields[km];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into tpl_non_ext_km (period_id, km) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {km}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "tpl_nst_km.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "tpl_nst_km.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"),
//                            km = fields.tolist().indexof("km"), len = fields.tolist().indexof("len");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string km = fields[km];
//                            string len = fields[len];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into tpl_nst_km (period_id, km, len) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {km}, {len}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "tpl_pdb_section.csv") && periodids.any() && pdbids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "tpl_pdb_section.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), pdbid = fields.tolist().indexof("adm_pdb_id"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string pdbid = fields[pdbid];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))) && pdbids.any(r => r.oldid.equals(long.parse(pdbid))))
//                                exportimportservice.execute($@"insert into tpl_pdb_section (period_id, start_km, start_m, final_km, final_m, adm_pdb_id) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {pdbids.first(r => r.oldid.equals(long.parse(pdbid))).newid}) returning coalesce(id, -1)");
//                        }
//                    }
//                pdbids.clear();
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "tpl_profile_object.csv") && periodids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "tpl_profile_object.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), objid = fields.tolist().indexof("object_id"),
//                            km = fields.tolist().indexof("km"), meter = fields.tolist().indexof("meter"), sid = fields.tolist().indexof("side_id");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string km = fields[km];
//                            string meter = fields[meter];
//                            string objectid = fields[objid];
//                            string sideid = fields[sid];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))))
//                                exportimportservice.execute($@"insert into tpl_profile_object (period_id, object_id, side_id, km, meter) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {objectid}, {sideid}, {km}, {meter}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "tpl_station_section.csv") && periodids.any() && stationids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "tpl_station_section.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), stationid = fields.tolist().indexof("station_id"),
//                            startkm = fields.tolist().indexof("start_km"), startm = fields.tolist().indexof("start_m"), finalkm = fields.tolist().indexof("final_km"), finalm = fields.tolist().indexof("final_m"),
//                            axiskm = fields.tolist().indexof("axis_km"), axism = fields.tolist().indexof("axis_m"), pointid = fields.tolist().indexof("point_id");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string startkm = fields[startkm];
//                            string startm = fields[startm];
//                            string finalkm = fields[finalkm];
//                            string finalm = fields[finalm];
//                            string stationid = fields[stationid];
//                            string pointid = fields[pointid];
//                            string axiskm = fields[axiskm];
//                            string axism = fields[axism];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))) && stationids.any(r => r.oldid.equals(long.parse(stationid))))
//                                exportimportservice.execute($@"insert into tpl_station_section (period_id, start_km, start_m, final_km, final_m, axis_km, axis_m, point_id, station_id) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {startkm}, {startm}, {finalkm}, {finalm}, {axiskm}, {axism}, {pointid}, {stationids.first(r => r.oldid.equals(long.parse(stationid))).newid}) returning coalesce(id, -1)");
//                        }
//                    }
//                progressbar.performstep();

//                if (fileinfo.any(tmp => tmp.name == "tpl_switch.csv") && periodids.any() && stationids.any())
//                    using (textfieldparser csvparser = new textfieldparser(fileinfo.firstordefault(f => f.name == "tpl_switch.csv").fullname))
//                    {
//                        csvparser.commenttokens = new string[] { "#" };
//                        csvparser.setdelimiters(new string[] { "," });
//                        csvparser.hasfieldsenclosedinquotes = true;

//                        string[] fields = csvparser.readfields();
//                        int id = fields.tolist().indexof("id"), periodid = fields.tolist().indexof("period_id"), stationid = fields.tolist().indexof("station_id"),
//                            km = fields.tolist().indexof("km"), meter = fields.tolist().indexof("meter"), sid = fields.tolist().indexof("side_id"),
//                            pid = fields.tolist().indexof("point_id"), mid = fields.tolist().indexof("mark_id"), did = fields.tolist().indexof("dir_id"), num = fields.tolist().indexof("num");

//                        while (!csvparser.endofdata)
//                        {
//                            fields = csvparser.readfields();
//                            string id = fields[id];
//                            string periodid = fields[periodid];
//                            string km = fields[km];
//                            string meter = fields[meter];
//                            string stationid = fields[stationid];
//                            string sideid = fields[sid];
//                            string pointid = fields[pid];
//                            string markid = fields[mid];
//                            string dirid = fields[did];
//                            string num = fields[num];

//                            if (periodids.any(r => r.oldid.equals(long.parse(periodid))) && stationids.any(r => r.oldid.equals(long.parse(stationid))))
//                                exportimportservice.execute($@"insert into tpl_switch (period_id, station_id, point_id, side_id, km, meter, mark_id, dir_id, num) values ({periodids.first(r => r.oldid.equals(long.parse(periodid))).newid}, {stationids.first(r => r.oldid.equals(long.parse(stationid))).newid}, {pointid}, {sideid}, {km}, {meter}, {markid}, {dirid}, '{num}') returning coalesce(id, -1)");
//                        }
//                    }
//                stationids.clear();
//                periodids.clear();
//                progressbar.performstep();
//            }
//            else
//            {
//                result = false;
//            }

//            return result;
//        }
//    }
//}
